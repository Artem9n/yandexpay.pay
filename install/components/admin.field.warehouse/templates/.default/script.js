this.BX=this.BX||{},this.BX.YandexPay=this.BX.YandexPay||{},this.BX.YandexPay.Ui=this.BX.YandexPay.Ui||{},function(e){"use strict";class t{static getInstance(){return null==this.instance&&(this.instance=new this),this.instance}constructor(e={}){this.options=Object.assign({},this.constructor.defaults,e)}load(e){if(null!=this._loadPromise)return this._loadPromise;const t=this.loaded();return null!=t?Promise.resolve(t):(this._loadElapsed=0,this._loadPromise=new Promise(((t,s)=>{this.injectScript(e),this.waitLoaded(t,s)})),this._loadPromise.finally((()=>{this._loadPromise=null})),this._loadPromise)}loaded(){var e;return null==(null==(e=window.ymaps)?void 0:e.Map)?null:window.ymaps}injectScript(e){const t=window.document.head||window.document.body||window.document.documentElement,s=document.createElement("script");s.src=this.options.scriptUrl+"&apikey="+encodeURIComponent(e),t.appendChild(s),s.onload=()=>{t.removeChild(s)}}waitLoaded(e,t){const s=this.loaded();null==s?(this._loadElapsed>this.options.loadTimeout&&t(new Error("cant load ymaps")),setTimeout((()=>{this.waitLoaded(e,t)}),this.options.loadStep),this._loadElapsed+=this.options.loadStep):e(s)}}t.defaults={scriptUrl:"https://api-maps.yandex.ru/2.1?lang=ru&wizard=bitrix&load=package.full&mode=release",loadStep:100,loadTimeout:3e4};class s extends BX.ui.autoComplete{constructor(e){super(e.widget),this.selectItem=e=>{super.selectItem(e),this.onSelect(e)},this.onSelect=e.onSelect,this.search=e.search}downloadBundle(e,t,s,a){this.search(e,t,s,a)}}class a{constructor(e,t={}){this.onSelect=e=>{ymaps.geocode(e).then((e=>{let t=e.geoObjects.get(0),s=t.properties.get("metaDataProperty").GeocoderMetaData.Address.Components,a=t.geometry.getCoordinates();t.properties.get("boundedBy");for(let e=0;e<s.length;e++){let t=s[e];"country"===t.kind&&$('input[name*="COUNTRY"]').val(t.name),"street"!==t.kind&&"district"!==t.kind||$('input[name*="STREET"]').val(t.name),"house"===t.kind&&$('input[name*="BUILDING"]').val(t.name),"locality"===t.kind&&$('input[name*="LOCALITY"]').val(t.name)}$('input[name*="LOCATION_LAT"]').val(a[0]),$('input[name*="LOCATION_LON"]').val(a[1]),null!=this.placemark&&this.options.map.geoObjects.remove(this.placemark),this.placemark=new ymaps.Placemark(a,{balloonContentHeader:"test"},{preset:"islands#blueDotIcon"}),this.options.map.geoObjects.add(this.placemark),this.options.map.setBounds(a,{checkZoomRange:!0,zoomMargin:5})}))},this.$el=e,this.el=this.$el[0],this.options=Object.assign({},this.constructor.defaults,t),this.initialize()}initialize(){this.widget=new s({widget:{scope:this.el},onSelect:this.onSelect,search:this.search}),this.options.map.events.add("dblclick",(e=>{null!=this.placemark&&this.options.map.geoObjects.remove(this.placemark);let t=e.get("coords");ymaps.geocode(t).then((e=>{let t=e.geoObjects.get(0).properties.get("metaDataProperty").GeocoderMetaData.text;$('[data-name="WAREHOUSE"]').val(t)})),this.onSelect(t)}))}search(e,t,s,a){ymaps.geocode(e.QUERY).then((e=>{this.opts;let a=this.vars;this.ctrls;a.loader.show();let o,i,n=e.geoObjects.getLength(),l=[];for(let t=0;t<n;t++)o=e.geoObjects.get(t).properties.get("metaDataProperty").GeocoderMetaData.text,i=e.geoObjects.get(t).properties.get("boundedBy"),l[t]={VALUE:o,DISPLAY:o};t.apply(this,[l]),s.call(this)}))}}a.defaults={};class o extends BX.YandexPay.Plugin.Base{constructor(...e){super(...e),this.searchStop=e=>{},this.searchEnd=e=>{console.log(e)}}initialize(){super.initialize(),t.getInstance().load(this.options.apiKey).then((()=>{this.bootMap(),this.bootSuggest()}))}bootMap(){const e=this.getElement("map");return this._map=new ymaps.Map(e[0],{center:[55.76,37.64],controls:["zoomControl"],zoom:10}),this._map}bootSuggest(){const e=this.getElement("suggest");this._suggest=new a(e,{map:this._map})}search(){const e=this.getElement("suggest").val();this._mapLibrary.geocode(e).then(this.searchEnd,this.searchStop)}}o.defaults={mapElement:".js-field-warehouse__map",suggestElement:".js-field-warehouse__suggest",apiKey:null},o.dataName="uiFieldWarehouse",e.Warehouse=o}(this.BX.YandexPay.Ui.Field=this.BX.YandexPay.Ui.Field||{});
//# sourceMappingURL=script.js.map
