{"version":3,"file":"script.js","sources":["src/mapsLoader.js","src/suggestwidget.js","src/suggest.js","src/index.js"],"sourcesContent":["export class MapsLoader {\n\n\tstatic instance;\n\n\tstatic defaults = {\n\t\tscriptUrl: 'https://enterprise.api-maps.yandex.ru/2.0/?load=package.full&mode=release&lang=ru&wizard=bitrix', // todo locale and wizard\n\t\tloadStep: 100,\n\t\tloadTimeout: 30000,\n\t};\n\n\t_loadPromise;\n\t_loadElapsed;\n\n\tstatic getInstance() : MapsLoader {\n\t\tif (this.instance == null) {\n\t\t\tthis.instance = new this();\n\t\t}\n\n\t\treturn this.instance;\n\t}\n\n\tconstructor(options: Object = {}) {\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\n\t}\n\n\tload(apiKey: string) : Promise {\n\t\tif (this._loadPromise != null) { return this._loadPromise; }\n\n\t\tconst loaded = this.loaded();\n\n\t\tif (loaded != null) { return Promise.resolve(loaded); }\n\n\t\tthis._loadElapsed = 0;\n\t\tthis._loadPromise = new Promise((resolve, reject) => {\n\t\t\tthis.injectScript(apiKey);\n\t\t\tthis.waitLoaded(resolve, reject);\n\t\t});\n\n\t\tthis._loadPromise.finally(() => {\n\t\t\tthis._loadPromise = null;\n\t\t})\n\n\t\treturn this._loadPromise;\n\t}\n\n\tloaded() {\n\t\tif (window.ymaps?.Map == null) { return null; }\n\n\t\treturn window.ymaps;\n\t}\n\n\tinjectScript(apiKey: string) : void {\n\t\tconst anchor = window.document.head || window.document.body || window.document.documentElement;\n\t\tconst script = document.createElement('script');\n\n\t\tscript.src = this.options.scriptUrl + '&apikey=' + encodeURIComponent(apiKey);\n\n\t\tanchor.appendChild(script);\n\n\t\tscript.onload = () => {\n\t\t\tanchor.removeChild(script);\n\t\t};\n\t}\n\n\twaitLoaded(resolve, reject) : void {\n\t\tconst loaded = this.loaded();\n\n\t\tif (loaded != null) {\n\t\t\tresolve(loaded);\n\t\t\treturn;\n\t\t}\n\n\t\tif (this._loadElapsed > this.options.loadTimeout) {\n\t\t\treject(new Error('cant load ymaps')); // todo lang message\n\t\t}\n\n\t\tsetTimeout(\n\t\t\t() => { this.waitLoaded(resolve, reject) },\n\t\t\tthis.options.loadStep\n\t\t);\n\n\t\tthis._loadElapsed += this.options.loadStep;\n\t}\n\n}","export class SuggestWidget extends BX.ui.autoComplete {\n\n\tdownloadBundle(request, onLoad, onComplete, onError) {\n\t\tymaps.geocode(request['QUERY'])\n\t\t\t.then((response) => {\n\t\t\t\tconsole.log(response);\n\t\t\t});\n\t}\n\n}\n","import {SuggestWidget} from \"./suggestwidget\";\n\nexport class Suggest {\n\n\tstatic defaults = {\n\n\t};\n\n\tconstructor(element: $, options: Object = {}) {\n\t\tthis.$el = element;\n\t\tthis.el = this.$el[0];\n\t\tthis.options = Object.assign({}, this.constructor.defaults, {});\n\n\t\tthis.initialize();\n\t}\n\n\tinitialize() {\n\t\tconsole.log(SuggestWidget);\n\n\t\tthis.widget = new SuggestWidget({\n\t\t\tscope: this.el,\n\t\t});\n\t}\n\n}","import {MapsLoader} from \"./mapsLoader\";\nimport {Suggest} from \"./suggest\";\n\nexport class Warehouse extends BX.YandexPay.Plugin.Base {\n\n\tstatic defaults = {\n\t\tmapElement: '.js-field-warehouse__map',\n\t\tsuggestElement: '.js-field-warehouse__suggest',\n\t\tapiKey: null,\n\t};\n\n\tstatic dataName = 'uiFieldWarehouse';\n\n\tinitialize() {\n\t\tsuper.initialize();\n\n\t\tMapsLoader.getInstance().load(this.options.apiKey)\n\t\t\t.then(() => {\n\t\t\t\tthis.bootMap();\n\t\t\t\tthis.bootSuggest();\n\t\t\t});\n\t}\n\n\tbootMap() {\n\t\tconst element = this.getElement('map');\n\n\t\tthis._map = new ymaps.Map(element[0], {\n\t\t\tcenter: [50, 50],\n\t\t\tzoom: 13,\n\t\t});\n\n\t\treturn this._map;\n\t}\n\n\tbootSuggest() {\n\t\tconst element = this.getElement('suggest');\n\n\t\tthis._suggest = new Suggest(element, {\n\n\t\t});\n\t}\n\n\tsearch() {\n\t\tconst suggest = this.getElement('suggest');\n\t\tconst query = suggest.val();\n\n\t\tthis._mapLibrary.geocode(query).then(\n\t\t\tthis.searchEnd,\n\t\t\tthis.searchStop\n\t\t);\n\t}\n\n\tsearchStop = (error: Error) => {\n\t\t// todo handle error\n\t}\n\n\tsearchEnd = (response: Object) => {\n\t\tconsole.log(response);\n\t}\n\n}"],"names":["MapsLoader","this","instance","constructor","options","Object","assign","defaults","load","apiKey","_loadPromise","loaded","Promise","resolve","_loadElapsed","reject","injectScript","waitLoaded","finally","window","ymaps","Map","anchor","document","head","body","documentElement","script","createElement","src","scriptUrl","encodeURIComponent","appendChild","onload","removeChild","loadTimeout","Error","setTimeout","loadStep","SuggestWidget","BX","ui","autoComplete","downloadBundle","request","onLoad","onComplete","onError","geocode","then","response","console","log","Suggest","element","$el","el","initialize","widget","scope","Warehouse","YandexPay","Plugin","Base","searchStop","error","searchEnd","getInstance","bootMap","bootSuggest","getElement","_map","center","zoom","_suggest","search","query","val","_mapLibrary","mapElement","suggestElement","dataName"],"mappings":"mIAAO,MAAMA,8BAcU,MAAjBC,KAAKC,gBACHA,SAAW,IAAID,MAGdA,KAAKC,SAGbC,YAAYC,EAAkB,SACxBA,QAAUC,OAAOC,OAAO,GAAIL,KAAKE,YAAYI,SAAUH,GAG7DI,KAAKC,MACqB,MAArBR,KAAKS,oBAA+BT,KAAKS,mBAEvCC,EAASV,KAAKU,gBAEN,MAAVA,EAAyBC,QAAQC,QAAQF,SAExCG,aAAe,OACfJ,aAAe,IAAIE,SAAQ,CAACC,EAASE,UACpCC,aAAaP,QACbQ,WAAWJ,EAASE,WAGrBL,aAAaQ,SAAQ,UACpBR,aAAe,QAGdT,KAAKS,cAGbC,sBAC0B,gBAArBQ,OAAOC,gBAAOC,KAAsB,KAEjCF,OAAOC,MAGfJ,aAAaP,SACNa,EAASH,OAAOI,SAASC,MAAQL,OAAOI,SAASE,MAAQN,OAAOI,SAASG,gBACzEC,EAASJ,SAASK,cAAc,UAEtCD,EAAOE,IAAM5B,KAAKG,QAAQ0B,UAAY,WAAaC,mBAAmBtB,GAEtEa,EAAOU,YAAYL,GAEnBA,EAAOM,OAAS,KACfX,EAAOY,YAAYP,IAIrBV,WAAWJ,EAASE,SACbJ,EAASV,KAAKU,SAEN,MAAVA,GAKAV,KAAKa,aAAeb,KAAKG,QAAQ+B,aACpCpB,EAAO,IAAIqB,MAAM,oBAGlBC,YACC,UAAapB,WAAWJ,EAASE,KACjCd,KAAKG,QAAQkC,eAGTxB,cAAgBb,KAAKG,QAAQkC,UAbjCzB,EAAQF,IApEEX,EAILO,SAAW,CACjBuB,UAAW,kGACXQ,SAAU,IACVH,YAAa,WCPFI,UAAsBC,GAAGC,GAAGC,aAExCC,eAAeC,EAASC,EAAQC,EAAYC,GAC3C3B,MAAM4B,QAAQJ,EAAO,OACnBK,MAAMC,IACNC,QAAQC,IAAIF,aCHHG,EAMZlD,YAAYmD,EAAYlD,EAAkB,SACpCmD,IAAMD,OACNE,GAAKvD,KAAKsD,IAAI,QACdnD,QAAUC,OAAOC,OAAO,GAAIL,KAAKE,YAAYI,SAAU,SAEvDkD,aAGNA,aACCN,QAAQC,IAAIb,QAEPmB,OAAS,IAAInB,EAAc,CAC/BoB,MAAO1D,KAAKuD,MAlBFH,EAEL9C,SAAW,SCDNqD,UAAkBpB,GAAGqB,UAAUC,OAAOC,wCAiDlDC,WAAcC,WAIdC,UAAahB,IACZC,QAAQC,IAAIF,IA5CbO,mBACOA,aAENzD,EAAWmE,cAAc3D,KAAKP,KAAKG,QAAQK,QACzCwC,MAAK,UACAmB,eACAC,iBAIRD,gBACOd,EAAUrD,KAAKqE,WAAW,mBAE3BC,KAAO,IAAInD,MAAMC,IAAIiC,EAAQ,GAAI,CACrCkB,OAAQ,CAAC,GAAI,IACbC,KAAM,KAGAxE,KAAKsE,KAGbF,oBACOf,EAAUrD,KAAKqE,WAAW,gBAE3BI,SAAW,IAAIrB,EAAQC,EAAS,IAKtCqB,eAEOC,EADU3E,KAAKqE,WAAW,WACVO,WAEjBC,YAAY9B,QAAQ4B,GAAO3B,KAC/BhD,KAAKiE,UACLjE,KAAK+D,aA7CKJ,EAELrD,SAAW,CACjBwE,WAAY,2BACZC,eAAgB,+BAChBvE,OAAQ,MALGmD,EAQLqB,SAAW"}