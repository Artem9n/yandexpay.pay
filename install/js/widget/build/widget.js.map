{"version":3,"file":"widget.js","sources":["../solutionregistry.js","../ui/nodepreserver/mutationskeleton.js","../ui/nodepreserver/mutationloop.js","../ui/nodepreserver/mutationobserver.js","../utils/eventproxy.js","../ui/nodepreserver/subscriber.js","../ui/nodepreserver.js","../ui/nodepreserver/mutationfactory.js","../utils/template.js","../sdkloader.js","../intersection.js","../factory.js","../step/abstractstep.js","../secure3d/base.js","../secure3d/form.js","../secure3d/iframe.js","../secure3d/iframerbs.js","../step/secure3d.js","../step/finish.js","../step/failure.js","../step/loader.js","../step/payment/proxy.js","../step/payment/rest.js","../step/payment/site.js","../step/payment/abstractpayment.js","../step/cart/proxy.js","../step/cart/rest.js","../step/cart/site.js","../step/cart/abstractcart.js","../utils/ready.js","../widget.js","../step/factory.js"],"sourcesContent":["export default class SolutionRegistry {\r\n\r\n\tstatic pages = {};\r\n\r\n\tstatic getFactory(name) {\r\n\t\tif (name == null) { return null; }\r\n\r\n\t\tconst factory = window?.BX?.YandexPay?.Solution?.[name]?.factory;\r\n\r\n\t\tif (factory == null) {\r\n\t\t\tconsole?.warn(`cant find solution ${name}`);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\treturn factory;\r\n\t}\r\n\r\n\tstatic getPage(name, mode) {\r\n\t\tif (name == null || mode == null) { return null; }\r\n\r\n\t\tconst key = name + ':' + mode;\r\n\r\n\t\tif (this.pages[key] == null) {\r\n\t\t\tthis.pages[key] = this.createPage(name, mode);\r\n\t\t}\r\n\r\n\t\treturn this.pages[key];\r\n\t}\r\n\r\n\tstatic createPage(name, mode) {\r\n\t\tconst factory = this.getFactory(name);\r\n\r\n\t\tif (factory == null) { return null; }\r\n\r\n\t\treturn factory.create(mode);\r\n\t}\r\n\r\n}","export default class MutationSkeleton {\r\n\r\n\tstatic defaults = {\r\n\t\tcheck: null,\r\n\t}\r\n\r\n\tconstructor(element, options = {}) {\r\n\t\tthis.el = element;\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t}\r\n\r\n\tdestroy() {\r\n\r\n\t}\r\n\r\n}","import MutationSkeleton from \"./mutationskeleton\";\r\n\r\nexport default class MutationLoop extends MutationSkeleton {\r\n\r\n\tstatic defaults = Object.assign({}, MutationSkeleton.defaults, {\r\n\t\ttimeout: 1000,\r\n\t})\r\n\r\n\tconstructor(element, options = {}) {\r\n\t\tsuper(element, options);\r\n\t\tthis.loopTimeout();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.loopCancel();\r\n\t}\r\n\r\n\tloopTimeout() {\r\n\t\tclearTimeout(this._loopTimeout);\r\n\t\tthis._loopTimeout = setTimeout(this.loop, this.options.timeout);\r\n\t}\r\n\r\n\tloopCancel() {\r\n\t\tclearTimeout(this._loopTimeout);\r\n\t}\r\n\r\n\tloop = () => {\r\n\t\tthis.options.check() && this.loopTimeout();\r\n\t}\r\n\r\n}","import MutationSkeleton from \"./mutationskeleton\";\r\n\r\nexport default class MutationObserver extends MutationSkeleton {\r\n\r\n\tstatic defaults = Object.assign({}, MutationSkeleton.defaults, {\r\n\t\tanchor: null,\r\n\t\tdelay: 0,\r\n\t})\r\n\r\n\tconstructor(element, options = {}) {\r\n\t\tsuper(element, options);\r\n\t\tthis.observe();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.disconnect();\r\n\t}\r\n\r\n\tobserve() {\r\n\t\tconst anchor = this.getAnchor();\r\n\r\n\t\tif (anchor == null) {\r\n\t\t\tconsole?.warn('cant find anchor for node preserver');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.observer = new window.MutationObserver(this.listener);\r\n\t\tthis.observer.observe(anchor, {\r\n\t\t\tchildList: true,\r\n\t\t\tsubtree: true,\r\n\t\t});\r\n\t}\r\n\r\n\tdisconnect() {\r\n\t\tif (this.observer == null) { return; }\r\n\r\n\t\tthis.observer.disconnect();\r\n\t\tthis.observer = null;\r\n\t}\r\n\r\n\tlistener = (mutations) => {\r\n\t\tfor (const mutation of mutations) {\r\n\t\t\tif (mutation.removedNodes == null) { continue; }\r\n\r\n\t\t\tfor (const removedNode of mutation.removedNodes) {\r\n\t\t\t\tif (!(removedNode instanceof HTMLElement)) { continue; }\r\n\r\n\t\t\t\tif (removedNode === this.el || removedNode.contains(this.el)) {\r\n\t\t\t\t\tthis.runCheck();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\trunCheck() {\r\n\t\tconst delay = this.options.delay;\r\n\r\n\t\tif (delay == null) {\r\n\t\t\tthis.options.check();\r\n\t\t} else {\r\n\t\t\tclearTimeout(this._checkTimeout);\r\n\t\t\tthis._checkTimeout = setTimeout(() => { this.options.check(); }, delay);\r\n\t\t}\r\n\t}\r\n\r\n\tgetAnchor() {\r\n\t\tif (this.options.anchor == null) { return document.body; }\r\n\r\n\t\treturn this.el.closest(this.options.anchor);\r\n\t}\r\n\r\n}","export class EventProxy {\r\n\r\n\tstatic make(config = {}) {\r\n\t\treturn new EventProxy(config);\r\n\t}\r\n\r\n\tconstructor(config = {}) {\r\n\t\tthis.config = config;\r\n\t\tthis.callbackMap = {};\r\n\t}\r\n\r\n\ton(name, callback) {\r\n\t\tthis.matchEvent('bx') && this.onBxEvent(name, callback);\r\n\t\tthis.matchEvent('jquery') && this.onJQueryEvent(name, callback);\r\n\t\tthis.matchEvent('plain') && this.onPlainEvent(name, callback);\r\n\t}\r\n\r\n\toff(name, callback) {\r\n\t\tthis.matchEvent('bx') && this.offBxEvent(name, callback);\r\n\t\tthis.matchEvent('jquery') && this.offJQueryEvent(name, callback);\r\n\t\tthis.matchEvent('plain') && this.offPlainEvent(name, callback);\r\n\t}\r\n\r\n\tfire(name, data = {}) {\r\n\t\tthis.matchEvent('bx') && this.fireBxEvent(name, data);\r\n\t\tthis.matchEvent('jquery') && this.fireJQueryEvent(name, data);\r\n\t\tthis.matchEvent('plain') && this.firePlainEvent(name, data);\r\n\t}\r\n\r\n\tmatchEvent(type) {\r\n\t\treturn this.config[type] != null ? !!this.config[type] : !this.config['strict'];\r\n\t}\r\n\r\n\tonBxEvent(name, callback) {\r\n\t\tif (typeof BX === 'undefined') { return; }\r\n\r\n\t\tBX.addCustomEvent(name, callback);\r\n\t}\r\n\r\n\toffBxEvent(name, callback) {\r\n\t\tif (typeof BX === 'undefined') { return; }\r\n\r\n\t\tBX.removeCustomEvent(name, callback);\r\n\t}\r\n\r\n\tfireBxEvent(name, data) {\r\n\t\tif (typeof BX === 'undefined') { return; }\r\n\r\n\t\tBX.onCustomEvent(name, [data]);\r\n\t}\r\n\r\n\tonJQueryEvent(name, callback) {\r\n\t\tif (typeof jQuery === 'undefined') { return; }\r\n\r\n\t\tconst selfConfig = this.typeConfig('jquery');\r\n\r\n\t\tif (this.canProxyCallback(selfConfig)) {\r\n\t\t\tconst originalCallback = callback;\r\n\r\n\t\t\tcallback = (evt, data) => {\r\n\t\t\t\tconst proxyData = data != null ? data : evt?.originalEvent?.detail;\r\n\r\n\t\t\t\toriginalCallback(proxyData);\r\n\t\t\t};\r\n\r\n\t\t\tthis.pushCallbackVariation('jquery', originalCallback, callback);\r\n\t\t}\r\n\r\n\t\tjQuery(document).on(name, callback);\r\n\t}\r\n\r\n\toffJQueryEvent(name, callback) {\r\n\t\tif (typeof jQuery === 'undefined') { return; }\r\n\r\n\t\tconst selfConfig = this.typeConfig('jquery');\r\n\r\n\t\tif (this.canProxyCallback(selfConfig)) {\r\n\t\t\tcallback = this.popCallbackVariation('jquery', callback);\r\n\r\n\t\t\tif (callback == null) { return; }\r\n\t\t}\r\n\r\n\t\tjQuery(document).off(name, callback);\r\n\t}\r\n\r\n\tfireJQueryEvent(name, data) {\r\n\t\tif (typeof jQuery === 'undefined') { return; }\r\n\t\tif (this.hasPlainAndJQueryCollision()) { return; }\r\n\r\n\t\tjQuery(document).triggerHandler(new CustomEvent(name, { \"detail\": data }));\r\n\t}\r\n\r\n\tonPlainEvent(name, callback) {\r\n\t\tif (this.hasPlainAndJQueryCollision()) { return; }\r\n\r\n\t\tconst selfConfig = this.typeConfig('plain');\r\n\r\n\t\tif (this.canProxyCallback(selfConfig)) {\r\n\t\t\tconst originalCallback = callback;\r\n\r\n\t\t\tcallback = (evt) => {\r\n\t\t\t\toriginalCallback(evt.detail);\r\n\t\t\t};\r\n\r\n\t\t\tthis.pushCallbackVariation('plain', originalCallback, callback);\r\n\t\t}\r\n\r\n\t\tdocument.addEventListener(name, callback);\r\n\t}\r\n\r\n\toffPlainEvent(name, callback) {\r\n\t\tif (this.hasPlainAndJQueryCollision()) { return; }\r\n\r\n\t\tconst selfConfig = this.typeConfig('plain');\r\n\r\n\t\tif (this.canProxyCallback(selfConfig)) {\r\n\t\t\tcallback = this.popCallbackVariation('plain', callback);\r\n\r\n\t\t\tif (callback == null) { return; }\r\n\t\t}\r\n\r\n\t\tdocument.removeEventListener(name, callback);\r\n\t}\r\n\r\n\tfirePlainEvent(name, data) {\r\n\t\tdocument.dispatchEvent(new CustomEvent(name, { \"detail\": data }));\r\n\t}\r\n\r\n\thasPlainAndJQueryCollision() {\r\n\t\tif (!this.matchEvent('plain') || !this.matchEvent('jquery')) { return false; }\r\n\r\n\t\tconst plainConfig = this.typeConfig('plain');\r\n\r\n\t\treturn (plainConfig['force'] !== true && typeof jQuery !== 'undefined');\r\n\t}\r\n\r\n\tcanProxyCallback(selfConfig) {\r\n\t\treturn selfConfig['proxy'] !== false;\r\n\t}\r\n\r\n\ttypeConfig(type) {\r\n\t\treturn typeof this.config[type] === 'object' && this.config[type] != null ? this.config : {};\r\n\t}\r\n\r\n\tpushCallbackVariation(type, callback, proxy) {\r\n\t\tif (this.callbackMap[type] == null) {\r\n\t\t\tthis.callbackMap[type] = new WeakMap();\r\n\t\t}\r\n\r\n\t\tthis.callbackMap[type].set(callback, proxy);\r\n\t}\r\n\r\n\tpopCallbackVariation(type, callback) {\r\n\t\tif (this.callbackMap[type] == null) { return null; }\r\n\r\n\t\tconst map = this.callbackMap[type];\r\n\t\tconst result = map.get(callback);\r\n\r\n\t\tif (result != null) {\r\n\t\t\tmap.delete(callback);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n}","import {EventProxy} from \"../../utils/eventproxy\";\r\n\r\nexport default class Subscriber {\r\n\r\n\tstatic defaults = {\r\n\t\tcheck: null,\r\n\t\tevent: null,\r\n\t\tconfig: {},\r\n\t\ton: null,\r\n\t\toff: null,\r\n\t}\r\n\r\n\tconstructor(element, options = {}) {\r\n\t\tthis.el = element;\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t\tthis.eventProxy = new EventProxy(this.options.config);\r\n\r\n\t\tthis.bind();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.unbind();\r\n\r\n\t\tthis.eventProxy = null;\r\n\t\tthis.options = {};\r\n\t\tthis.el = null;\r\n\t}\r\n\r\n\tbind() {\r\n\t\tthis.bindOn();\r\n\t\tthis.bindEvent();\r\n\t}\r\n\r\n\tunbind() {\r\n\t\tthis.unbindOff();\r\n\t\tthis.unbindEvent();\r\n\t}\r\n\r\n\tbindOn() {\r\n\t\tif (this.options.on == null) { return; }\r\n\r\n\t\tthis.options.on(this.options.check);\r\n\t}\r\n\r\n\tunbindOff() {\r\n\t\tif (this.options.off == null) { return; }\r\n\r\n\t\tthis.options.off(this.options.check);\r\n\t}\r\n\r\n\tbindEvent() {\r\n\t\tconst event = this.options.event;\r\n\r\n\t\tif (event == null) { return; }\r\n\r\n\t\tif (typeof event === 'string') {\r\n\t\t\tthis.eventProxy.on(event, this.options.check);\r\n\t\t} else if (Array.isArray(event)) {\r\n\t\t\tevent.forEach((one) => {\r\n\t\t\t\tthis.eventProxy.on(one, this.options.check);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tconsole?.warn(`unknown event type ${typeof event}`);\r\n\t\t}\r\n\t}\r\n\r\n\tunbindEvent() {\r\n\t\tconst event = this.options.event;\r\n\r\n\t\tif (event == null) { return; }\r\n\r\n\t\tif (typeof event === 'string') {\r\n\t\t\tthis.eventProxy.off(event, this.options.check);\r\n\t\t} else if (Array.isArray(event)) {\r\n\t\t\tevent.forEach((one) => {\r\n\t\t\t\tthis.eventProxy.off(one, this.options.check);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tconsole?.warn(`unknown event type ${typeof event}`);\r\n\t\t}\r\n\t}\r\n\r\n}","import MutationFactory from \"./nodepreserver/mutationfactory\";\r\nimport Subscriber from \"./nodepreserver/subscriber\";\r\n\r\nexport default class NodePreserver {\r\n\r\n\tstatic defaults = {\r\n\t\trestore: null,\r\n\t\tsubscriber: null,\r\n\t\tmutation: true,\r\n\t}\r\n\r\n\t/** @var MutationSkeleton */\r\n\tmutation;\r\n\t/** @var Subscriber */\r\n\tsubscriber;\r\n\r\n\tconstructor(element, options = {}) {\r\n\t\tthis.el = element;\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\r\n\t\tthis.install();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.uninstall();\r\n\t\tthis.options = {};\r\n\t\tthis.el = null;\r\n\t}\r\n\r\n\tinstall() {\r\n\t\tthis.installMutation();\r\n\t\tthis.installSubscriber();\r\n\t}\r\n\r\n\tuninstall() {\r\n\t\tthis.uninstallMutation();\r\n\t\tthis.uninstallSubscriber();\r\n\t}\r\n\r\n\tinstallMutation() {\r\n\t\tif (!this.isEnabled('mutation')) { return; }\r\n\r\n\t\tthis.mutation = MutationFactory.make(this.el, this.driverOptions('mutation'));\r\n\t}\r\n\r\n\tuninstallMutation() {\r\n\t\tif (this.mutation == null) { return; }\r\n\r\n\t\tthis.mutation.destroy();\r\n\t}\r\n\r\n\tinstallSubscriber() {\r\n\t\tif (!this.isEnabled('subscriber')) { return; }\r\n\r\n\t\tthis.subscriber = new Subscriber(this.el, this.driverOptions('subscriber'));\r\n\t}\r\n\r\n\tuninstallSubscriber() {\r\n\t\tif (this.subscriber == null) { return; }\r\n\r\n\t\tthis.subscriber.destroy();\r\n\t\tthis.subscriber = null;\r\n\t}\r\n\r\n\tisEnabled(type) {\r\n\t\treturn !!this.options[type];\r\n\t}\r\n\r\n\tdriverOptions(type) {\r\n\t\tconst option = typeof this.options[type] === 'object' ? this.options[type] : {};\r\n\t\tconst overrides = {\r\n\t\t\tcheck: this.check,\r\n\t\t};\r\n\r\n\t\treturn Object.assign({}, option, overrides);\r\n\t}\r\n\r\n\tcheck = () => {\r\n\t\tconst found = document.body.contains(this.el);\r\n\r\n\t\tif (!found) {\r\n\t\t\tthis.options.restore();\r\n\t\t}\r\n\r\n\t\treturn found;\r\n\t}\r\n}","import MutationLoop from \"./mutationloop\";\r\nimport MutationObserver from \"./mutationobserver\";\r\n\r\nexport default class MutationFactory {\r\n\r\n\tstatic make(element, options) {\r\n\t\tif (typeof window.MutationObserver === 'function') {\r\n\t\t\treturn new MutationObserver(element, options);\r\n\t\t}\r\n\r\n\t\treturn new MutationLoop(element, options);\r\n\t}\r\n\r\n}","export default class Template {\r\n\r\n\t/**\r\n\t * @param {string=} template\r\n\t * @param {Object} vars\r\n\t * @returns {string}\r\n\t */\r\n\tstatic compile(template, vars) {\r\n\t\tlet key;\r\n\t\tlet replaceKey;\r\n\t\tlet replaceValue;\r\n\t\tlet result = template;\r\n\r\n\t\tfor (key in vars) {\r\n\t\t\tif (!vars.hasOwnProperty(key)) { continue; }\r\n\r\n\t\t\treplaceKey = '#' + key.toUpperCase() + '#';\r\n\t\t\treplaceValue = vars[key];\r\n\r\n\t\t\tdo {\r\n\t\t\t\tresult = result.replace(replaceKey, replaceValue);\r\n\t\t\t} while (result.indexOf(replaceKey) !== -1);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tstatic toElement(html) {\r\n\t\tconst context = document.createElement('div');\r\n\t\tcontext.innerHTML = html;\r\n\r\n\t\treturn context.firstElementChild;\r\n\t}\r\n\r\n\tstatic toElements(html) {\r\n\t\tconst context = document.createElement('div');\r\n\t\tcontext.innerHTML = html;\r\n\r\n\t\treturn [...context.children];\r\n\t}\r\n\r\n}","export class Sdkloader {\r\n\r\n\tstatic instance = null;\r\n\r\n\tstatic getInstance() {\r\n\t\tif (this.instance == null) {\r\n\t\t\tthis.instance = new Sdkloader();\r\n\t\t}\r\n\r\n\t\treturn this.instance;\r\n\t}\r\n\r\n\tload() : Promise {\r\n\t\tif (this._loadPromise != null) { return this._loadPromise; }\r\n\r\n\t\tthis._loadPromise = new Promise((resolve, reject) => {\r\n\t\t\tif (this.testGlobal()) {\r\n\t\t\t\tresolve();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst script = document.createElement('script');\r\n\t\t\tconst anchor = document.getElementsByTagName(\"script\")[0] || document.body;\r\n\r\n\t\t\tscript.type = \"text/javascript\";\r\n\t\t\tscript.async = true;\r\n\t\t\tscript.src = 'https://pay.yandex.ru/sdk/v1/pay.js';\r\n\r\n\t\t\tscript.onload = () => {\r\n\t\t\t\tthis.loopGlobal(() => {\r\n\t\t\t\t\tthis._loadPromise = null;\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t\tscript.onerror = () => {\r\n\t\t\t\tthis._loadPromise = null;\r\n\t\t\t\tscript.remove();\r\n\r\n\t\t\t\treject(new Error('cant load yandex pay sdk library'));\r\n\t\t\t};\r\n\r\n\t\t\tanchor.parentNode.insertBefore(script, anchor);\r\n\t\t});\r\n\r\n\t\treturn this._loadPromise;\r\n\t}\r\n\r\n\tloopGlobal(resolve) : void {\r\n\t\tif (this.testGlobal()) {\r\n\t\t\tresolve();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsetTimeout(() => { this.loopGlobal(resolve) }, 100);\r\n\t}\r\n\r\n\ttestGlobal() : boolean {\r\n\t\treturn window.YaPay?.createPayment != null;\r\n\t}\r\n}","export class Intersection {\r\n\r\n\tstatic defaults = {};\r\n\r\n\tobserver;\r\n\r\n\tconstructor(element: HTMLElement, options: Object = {}) {\r\n\t\tthis.el = element;\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t}\r\n\r\n\twait() : Promise {\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tif (typeof IntersectionObserver === 'undefined') {\r\n\t\t\t\tresolve(this.el);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.observer = new IntersectionObserver((entries, observer) => {\r\n\t\t\t\tentries.forEach((entry) => {\r\n\t\t\t\t\tif (entry.isIntersecting) {\r\n\t\t\t\t\t\tconst element = entry.target;\r\n\t\t\t\t\t\tobserver.unobserve(element);\r\n\t\t\t\t\t\tresolve(element);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\tthis.observer.observe(this.el);\r\n\t\t});\r\n\t}\r\n\r\n\trestore(node: HTMLElement) : void {\r\n\t\tthis.observer?.unobserve(this.el);\r\n\t\tthis.el = node;\r\n\t\tthis.observer?.observe(this.el);\r\n\t}\r\n}","import SolutionRegistry from './solutionregistry';\r\nimport NodePreserver from \"./ui/nodepreserver\";\r\nimport Utils from './utils/template';\r\nimport {EventProxy} from \"./utils/eventproxy\";\r\nimport {Sdkloader} from \"./sdkloader\";\r\nimport {Intersection} from \"./intersection\";\r\nimport Template from \"./utils/template\";\r\n\r\nexport default class Factory {\r\n\r\n\tstatic defaults = {\r\n\t\tsolution: null,\r\n\t\ttemplate: '<div id=\"#ID#\" class=\"bx-yapay-drawer\"></div>',\r\n\t\tcontainerSelector: '.bx-yapay-drawer',\r\n\t\tloaderSelector: '.bx-yapay-skeleton-loading',\r\n\t\tpreserve: false,\r\n\t\twaitLimit: 30,\r\n\t\twaitTimeout: 1000,\r\n\t}\r\n\r\n\tdefaults;\r\n\toptions;\r\n\twaitCount = 0;\r\n\r\n\tconstructor(options = {}) {\r\n\t\tthis.defaults = Object.assign({}, this.constructor.defaults);\r\n\t\tthis.options = {};\r\n\r\n\t\tthis.setOptions(options);\r\n\t\tthis.bootSolution();\r\n\t\tthis.bootLocal();\r\n\t}\r\n\r\n\tinject(selector, position) {\r\n\t\treturn Promise.resolve()\r\n\t\t\t.then(() => this.waitElement(selector))\r\n\t\t\t.then((anchor) => this.checkElement(anchor))\r\n\t\t\t.then((anchor) => this.renderElement(anchor, position))\r\n\t\t\t.then((element) => this.install(element))\r\n\t\t\t.then((widget) => this.insertLoader(widget))\r\n\t\t\t.then((widget) => {\r\n\t\t\t\tconst intersection = new Intersection(widget.el);\r\n\t\t\t\t\r\n\t\t\t\tif (this.getOption('preserve')) {\r\n\t\t\t\t\tthis.preserve(selector, position, widget, intersection);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn intersection.wait().then(() => widget);\r\n\t\t\t})\r\n\t\t\t.then((widget) => Sdkloader.getInstance().load().then(() => widget));\r\n\t}\r\n\r\n\tcheckElement(anchor) {\r\n\t\tconst selector = this.getOption('containerSelector');\r\n\t\tconst contains = (\r\n\t\t\t!!anchor.querySelector(selector)\r\n\t\t\t|| this.containsSiblingElement(anchor, selector)\r\n\t\t);\r\n\r\n\t\tif (contains) {\r\n\t\t\tthrow new Error('the element already has a container');\r\n\t\t}\r\n\r\n\t\treturn anchor;\r\n\t}\r\n\r\n\tcontainsSiblingElement(anchor, selector) {\r\n\t\tlet result = false;\r\n\t\tlet next = anchor.parentElement?.firstElementChild;\r\n\r\n\t\twhile (next) {\r\n\t\t\tif (next.matches(selector) || next.querySelector(selector)) {\r\n\t\t\t\tresult = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tnext = next.nextElementSibling;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\t\r\n\tpreserve(selector, position, widget, intersection) {\r\n\t\tconst preserver = new NodePreserver(widget.el, Object.assign({}, this.preserveOptions(), {\r\n\t\t\trestore: () => {\r\n\t\t\t\tpreserver.destroy();\r\n\t\t\t\t// noinspection JSIgnoredPromiseFromCall\r\n\t\t\t\tthis.restore(selector, position, widget, intersection);\r\n\t\t\t},\r\n\t\t}));\r\n\t}\r\n\r\n\tpreserveOptions() {\r\n\t\tconst preserveOption = this.getOption('preserve');\r\n\r\n\t\treturn typeof preserveOption === 'object' ? preserveOption : {};\r\n\t}\r\n\r\n\trestore(selector, position, widget, intersection) {\r\n\t\treturn Promise.resolve()\r\n\t\t\t.then(() => this.waitElement(selector))\r\n\t\t\t.then((anchor) => {\r\n\t\t\t\tconst element = this.renderElement(anchor, position);\r\n\r\n\t\t\t\twidget.restore(element);\r\n\t\t\t\tintersection?.restore(element);\r\n\r\n\t\t\t\tif (this.getOption('preserve')) {\r\n\t\t\t\t\tthis.preserve(selector, position, widget, intersection);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn widget;\r\n\t\t\t});\r\n\t}\r\n\r\n\tinstall(element) {\r\n\t\treturn new BX.YandexPay.Widget(element);\r\n\t}\r\n\r\n\tinsertLoader(widget) {\r\n\t\tconst width = this.getOption('buttonWidth') || 'AUTO';\r\n\r\n\t\twidget.go('loader', {\r\n\t\t\twidth: width.toLowerCase(),\r\n\t\t\tlabel: this.getOption('label'),\r\n\t\t});\r\n\r\n\t\treturn widget;\r\n\t}\r\n\r\n\twaitElement(selector) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthis.waitCount = 0;\r\n\t\t\tthis.waitElementLoop(selector, resolve, reject);\r\n\t\t});\r\n\t}\r\n\r\n\twaitElementLoop(selector, resolve, reject) {\r\n\t\tconst anchor = this.findElement(selector);\r\n\r\n\t\tif (anchor) {\r\n\t\t\tresolve(anchor);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t++this.waitCount;\r\n\r\n\t\tif (this.waitCount >= this.getOption('waitLimit')) {\r\n\t\t\treject('cant find element by selector ' + selector);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsetTimeout(this.waitElementLoop.bind(this, selector, resolve, reject), this.getOption('waitTimeout'));\r\n\t}\r\n\r\n\tfindElement(selector) {\r\n\t\tlet elementList;\r\n\t\tlet variant = selector.trim();\r\n\t\tlet result;\r\n\r\n\t\tif (variant === '') { throw new Error('widget selector is empty'); }\r\n\r\n\t\telementList = this.searchBySelector(variant) ?? this.searchById(selector) ?? this.searchByClassName(selector);\r\n\r\n\t\tif (elementList == null) { return null; }\r\n\r\n\t\tif (elementList.length > 1) {\r\n\t\t\tresult = this.reduceVisible(elementList);\r\n\t\t}\r\n\r\n\t\tif (result == null) {\r\n\t\t\tresult = elementList[0];\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tsearchBySelector(selector) {\r\n\t\ttry {\r\n\t\t\tconst result = [];\r\n\r\n\t\t\tfor (const part of selector.split(',')) { // first selector\r\n\t\t\t\tconst partSanitized = part.trim();\r\n\r\n\t\t\t\tif (partSanitized === '' || !this.isCssSelector(partSanitized)) { continue; }\r\n\r\n\t\t\t\tconst collection = document.querySelectorAll(partSanitized);\r\n\r\n\t\t\t\tfor (const element of collection) {\r\n\t\t\t\t\tresult.push(element);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn result.length > 0 ? result : null;\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tsearchById(selector) {\r\n\t\ttry {\r\n\t\t\tconst element = document.getElementById(selector);\r\n\r\n\t\t\treturn element != null ? [element] : null;\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tsearchByClassName(selector) {\r\n\t\ttry {\r\n\t\t\tconst collection = document.getElementsByClassName(selector);\r\n\r\n\t\t\treturn collection.length > 0 ? collection : null;\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\treduceVisible(collection) {\r\n\t\tlet result = null;\r\n\t\t\r\n\t\tfor (const element of collection) {\r\n\t\t\tif (this.testVisible(element)) {\r\n\t\t\t\tresult = element;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\t\r\n\ttestVisible(element) {\r\n\t\treturn (element.offsetWidth || element.offsetHeight || element.getClientRects().length );\r\n\t}\r\n\r\n\tisCssSelector(selector) {\r\n\t\treturn /^[.#]/.test(selector);\r\n\t}\r\n\r\n\trenderElement(anchor, position) {\r\n\t\tconst selector = this.getOption('containerSelector');\r\n\t\tconst width = this.getOption('buttonWidth') || 'AUTO';\r\n\t\tconst html = Utils.compile(this.getOption('template'), {\r\n\t\t\tlabel: this.getOption('label'),\r\n\t\t\twidth: width.toLowerCase(),\r\n\t\t\tid: this.getOption('containerId'),\r\n\t\t});\r\n\t\tlet elements = Utils.toElements(html);\r\n\t\tlet result = null;\r\n\r\n\t\tif (position.indexOf('after') === 0) { elements = elements.reverse(); }\r\n\r\n\t\tfor (const element of elements) {\r\n\t\t\tanchor.insertAdjacentElement(position, element);\r\n\r\n\t\t\tif (result != null) { continue; }\r\n\r\n\t\t\tresult = element.matches(selector) ? element : element.querySelector(selector);\r\n\t\t}\r\n\r\n\t\tif (result == null) {\r\n\t\t\tthrow new Error(`cant find template container by selector ${selector}`);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tbootSolution() {\r\n\t\tconst name = this.getOption('solution');\r\n\t\tconst mode = this.getOption('mode');\r\n\t\tconst solution = SolutionRegistry.getPage(name, mode);\r\n\r\n\t\tif (solution == null) { return; }\r\n\r\n\t\tsolution.bootFactory(this);\r\n\t}\r\n\r\n\tbootLocal() {\r\n\t\tEventProxy.make().fire('bxYapayFactoryInit', {\r\n\t\t\tfactory: this,\r\n\t\t});\r\n\t}\r\n\r\n\textendDefaults(options) {\r\n\t\tthis.defaults = Object.assign(this.defaults, options);\r\n\t}\r\n\r\n\tsetOptions(options) {\r\n\t\tthis.options = Object.assign(this.options, options);\r\n\t}\r\n\r\n\tgetOption(name) {\r\n\t\treturn this.options[name] ?? this.defaults[name]\r\n\t}\r\n}","import Template from '../utils/template';\r\n\r\nexport default class AbstractStep {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '',\r\n\t}\r\n\r\n\tdefaults;\r\n\toptions;\r\n\twidget;\r\n\tdelayTimeouts = {};\r\n\r\n\t/**\r\n\t * @param {Widget} widget\r\n\t * @param {Object} options\r\n\t */\r\n\tconstructor(widget, options = {}) {\r\n\t\tthis.widget = widget;\r\n\t\tthis.defaults = Object.assign({}, this.constructor.defaults);\r\n\t\tthis.options = Object.assign({}, options);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param {string} name\r\n\t * @returns {*}\r\n\t */\r\n\tgetOption(name) {\r\n\t\treturn this.options[name] ?? this.widget.getOption(name) ?? this.defaults[name];\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object<Element>} node Element\r\n\t * @param {Object} data Options\r\n\t */\r\n\trender(node, data = {}) {\r\n\t\tnode.innerHTML = this.compile(data);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object} data\r\n\t * @returns {string}\r\n\t */\r\n\tcompile(data) {\r\n\t\treturn Template.compile(this.getOption('template'), data);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object<Element>} node\r\n\t */\r\n\trestore(node) {\r\n\t\t// nothing by default\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} url\r\n\t * @param {Object} data\r\n\t * @returns {Promise.<Object>}\r\n\t */\r\n\tquery(url, data) {\r\n\t\treturn fetch(url, {\r\n\t\t\tmethod: 'POST',\r\n\t\t\theaders: { 'Content-Type': 'application/json' },\r\n\t\t\tbody: JSON.stringify(data)\r\n\t\t})\r\n\t\t\t.then(response => {return response.json()})\r\n\t}\r\n\r\n\tgetTemplate(key) {\r\n\t\tlet optionKey = key + 'Template';\r\n\t\tlet option = this.options[optionKey];\r\n\t\tlet optionFirstSymbol = option.substr(0, 1);\r\n\t\tlet result;\r\n\r\n\t\tif (optionFirstSymbol === '.' || optionFirstSymbol === '#') {\r\n\t\t\tresult = this.getNode(option).innerHTML;\r\n\t\t} else {\r\n\t\t\tresult = option;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetElement(key, context, method) {\r\n\t\tlet selector = this.getElementSelector(key);\r\n\r\n\t\treturn this.getNode(selector, context, method || 'querySelector');\r\n\t}\r\n\r\n\tgetElementSelector(key) {\r\n\t\tlet optionKey = key + 'Element';\r\n\r\n\t\treturn this.options[optionKey];\r\n\t}\r\n\r\n\tgetNode(selector, context, method) {\r\n\t\tif (selector.substr(0, 1) === '#') { // is id query\r\n\t\t\tcontext = document;\r\n\t\t} else if (!context) {\r\n\t\t\tcontext = this.el;\r\n\t\t}\r\n\r\n\t\treturn context[method](selector);\r\n\t}\r\n\r\n\tclearDelay(name) {\r\n\t\tif (this.delayTimeouts[name] == null) { return; }\r\n\r\n\t\tclearTimeout(this.delayTimeouts[name]);\r\n\t\tthis.delayTimeouts[name] = null;\r\n\t}\r\n\r\n\tdelay(name, args = [], timeout = 300) {\r\n\t\tthis.clearDelay(name);\r\n\t\tthis.delayTimeouts[name] = setTimeout(this[name].bind(this, ...args), timeout);\r\n\t}\r\n\r\n\tshowError(type, message, err = null) {\r\n\t\tlet notify = type + ' - ' + message;\r\n\r\n\t\tif (err) {\r\n\t\t\tnotify += ' ' + err;\r\n\t\t}\r\n\r\n\t\talert(notify);\r\n\t}\r\n}","import Template from \"../utils/template\";\r\n\r\nexport default class Base {\r\n\tstatic defaults = {\r\n\t\ttemplate: null,\r\n\t}\r\n\r\n\tconstructor(options = {}) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t\tthis.widget = null;\r\n\t}\r\n\r\n\trender(node, data = {}) {\r\n\t\tnode.innerHTML = this.compile(data);\r\n\t}\r\n\r\n\tcompile(data) {\r\n\t\treturn Template.compile(this.options.template, data);\r\n\t}\r\n\r\n\tsetWidget(widget) {\r\n\t\tthis.widget = widget;\r\n\t}\r\n\r\n\tgetOption(key) {\r\n\t\tif (key in this.options) {\r\n\t\t\treturn this.options[key];\r\n\t\t} else {\r\n\t\t\treturn this.widget.options[key];\r\n\t\t}\r\n\t}\r\n}","import Base from \"./base\";\r\nimport Template from \"../utils/template\";\r\n\r\nexport default class Form extends Base {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<form name=\"form\" action=\"#ACTION#\" method=\"#METHOD#\">'\r\n\t\t\t+ '#INPUTS#'\r\n\t\t\t+ '</form>',\r\n\t}\r\n\r\n\trender(node, data) {\r\n\t\tsuper.render(node, data);\r\n\t\tthis.autosubmit(node);\r\n\t}\r\n\r\n\tcompile(data) {\r\n\t\tconst template = this.options.template;\r\n\t\tconst vars = Object.assign(data, {\r\n\t\t\t'inputs': this.makeInputs(data)\r\n\t\t});\r\n\r\n\t\treturn Template.compile(template, vars);\r\n\t}\r\n\r\n\tmakeInputs(data) {\r\n\t\tlet key;\r\n\t\tlet vars = data.params;\r\n\t\tlet value;\r\n\t\tlet template;\r\n\r\n\t\tif (Object.keys(vars).length === 0) { return ''; }\r\n\r\n\t\ttemplate = data.termUrl ? '<input type=\"hidden\" name=\"TermUrl\" value=\"' + vars.termUrl + '\">' : '';\r\n\r\n\t\tfor (key in vars)\r\n\t\t{\r\n\t\t\tif (!vars.hasOwnProperty(key)) { continue; }\r\n\r\n\t\t\tvalue = vars[key];\r\n\r\n\t\t\ttemplate += '<input type=\"hidden\" name=\"' + key + '\" value=\"' + value + '\">';\r\n\t\t}\r\n\r\n\t\treturn template;\r\n\t}\r\n\r\n\tmakeTermUrl() {\r\n\t\tlet result = this.getOption('notifyUrl');\r\n\t\tlet backUrl = window.location.href;\r\n\r\n\t\tresult +=\r\n\t\t\t(result.indexOf('?') === -1 ? '?' : '&')\r\n\t\t\t+ 'backurl=' + encodeURIComponent(backUrl)\r\n\t\t\t+ '&service=' + this.getOption('requestSign')\r\n\t\t\t+ '&paymentId=' + this.getOption('externalId');\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tautosubmit(node) {\r\n\t\tconst form = node.querySelector('form');\r\n\r\n\t\tform.submit();\r\n\t}\r\n}","import Base from \"./base\";\r\nimport Template from \"../utils/template\";\r\n\r\nexport default class Iframe extends Base {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<iframe style=\"display: none;\"></iframe>',\r\n\t}\r\n\r\n\trender(node, data) {\r\n\t\tthis.insertIframe(node, data);\r\n\t}\r\n\r\n\tinsertIframe(node, data) {\r\n\t\tnode.innerHTML = Template.compile(this.options.template, data);\r\n\t\tthis.compile(node, data);\r\n\t}\r\n\r\n\tcompile(node, data) {\r\n\t\tlet iframe = node.querySelector('iframe');\r\n\t\tlet contentIframe = iframe.contentWindow || ( iframe.contentDocument.document || iframe.contentDocument);\r\n\t\tlet html = data.params;\r\n\r\n\t\tcontentIframe.document.open();\r\n\t\tcontentIframe.document.write(html);\r\n\t\tcontentIframe.document.close();\r\n\t}\r\n}","import Base from \"./base\";\r\nimport Template from \"../utils/template\";\r\n\r\nexport default class IframeRbs extends Base {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<iframe style=\"display: none;\"></iframe>',\r\n\t}\r\n\r\n\trender(node, data) {\r\n\t\tthis.insertIframe(node, data);\r\n\t}\r\n\r\n\tinsertIframe(node, data) {\r\n\t\tnode.innerHTML = Template.compile(this.options.template, data);\r\n\t\tthis.compile(node, data);\r\n\t}\r\n\r\n\tcompile(node, data) {\r\n\t\tPromise.resolve()\r\n\t\t\t.then(() => this.renderIframe(node, data))\r\n\t\t\t.then(() => this.query(data));\r\n\t}\r\n\r\n\tquery (data) {\r\n\t\tfetch(this.getOption('notifyUrl'), {\r\n\t\t\tmethod: 'POST',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t},\r\n\t\t\tbody: JSON.stringify({\r\n\t\t\t\tservice: this.getOption('requestSign'),\r\n\t\t\t\taccept: 'json',\r\n\t\t\t\tsecure: data.params.secure,\r\n\t\t\t\texternalId: data.params.notify.externalId,\r\n\t\t\t\tpaySystemId: data.params.notify.paySystemId\r\n\t\t\t})\r\n\t\t})\r\n\t\t\t.then(response => response.json())\r\n\t\t\t.then(result => {\r\n\t\t\t\tif (result.success === true) {\r\n\t\t\t\t\tthis.widget.go(result.state, result);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.widget.go('error', result);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(error => console.log(error) );\r\n\t}\r\n\r\n\trenderIframe(node, data) {\r\n\t\tlet iframe = node.querySelector('iframe');\r\n\t\tlet contentIframe = iframe.contentWindow || ( iframe.contentDocument.document || iframe.contentDocument);\r\n\t\tlet html = `<form name=\"form\" action=\"${data.action}\" method=\"POST\">`;\r\n\r\n\t\tcontentIframe.document.open();\r\n\t\tcontentIframe.document.write(html);\r\n\t\tcontentIframe.document.close();\r\n\r\n\t\tcontentIframe.document.querySelector('form').submit();\r\n\t}\r\n}\r\n","import AbstractStep from \"./abstractstep\";\r\nimport SecureForm from \"../secure3d/form\";\r\nimport SecureIframe from \"../secure3d/iframe\";\r\nimport SecureRbs from \"../secure3d/iframerbs\";\r\n\r\nexport default class Step3ds extends AbstractStep {\r\n\r\n\trender(node, data) {\r\n\t\tconst view = this.makeView(data);\r\n\t\tview.setWidget(this.widget);\r\n\t\tview.render(node, data);\r\n\t}\r\n\r\n\tmakeView(data) {\r\n\t\tlet view = data.view;\r\n\r\n\t\tif (view === 'form') {\r\n\t\t\treturn new SecureForm();\r\n\t\t} else if (view === 'iframe') {\r\n\t\t\treturn new SecureIframe();\r\n\t\t} else if (view === 'iframerbs') {\r\n\t\t\treturn new SecureRbs();\r\n\t\t}\r\n\r\n\t\tthrow new Error('view secure3d missing')\r\n\t}\r\n}","import AbstractStep from './abstractstep';\r\n\r\nexport default class Finish extends AbstractStep {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<div class=\"alert alert-success\" role=\"alert\"><strong>#MESSAGE#</strong></div>'\r\n\t}\r\n\r\n}","import AbstractStep from './abstractstep';\r\n\r\nexport default class Failure extends AbstractStep {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<div class=\"alert alert-danger\" role=\"alert\"><strong>#MESSAGE#</strong></div>'\r\n\t}\r\n\r\n}","import AbstractStep from './abstractstep';\r\n\r\nexport default class Loader extends AbstractStep {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<div class=\"bx-yapay-skeleton-loading width--#WIDTH#\"></div>'\r\n\t}\r\n\r\n\trender(node, data = {}) {\r\n\t\tconst html = this.compile(data);\r\n\r\n\t\tnode.innerHTML = html;\r\n\t\tthis.restoreHtml = html;\r\n\t}\r\n\r\n\trestore(node) {\r\n\t\tif (this.restoreHtml == null) { return; }\r\n\r\n\t\tnode.innerHTML = this.restoreHtml;\r\n\t}\r\n\r\n}\r\n","export default class Proxy {\r\n\r\n\tconstructor(order) {\r\n\t\tthis.order = order;\r\n\t}\r\n\r\n\tgetOption(name) {\r\n\t\treturn this.order.getOption(name);\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\r\n\t}\r\n\r\n\tgetPaymentData(data) {\r\n\r\n\t}\r\n}","import Proxy from \"./proxy\";\r\n\r\nexport default class RestProxy extends Proxy {\r\n\r\n\tgetPaymentData(data) {\r\n\t\treturn   {\r\n\t\t\tenv: this.getOption('env'),\r\n\t\t\tversion: 3,\r\n\t\t\tcurrencyCode: YaPay.CurrencyCode.Rub,\r\n\t\t\tmerchantId: this.getOption('merchantId'),\r\n\t\t\torderId: data.id,\r\n\t\t\tcart: {\r\n\t\t\t\titems: data.items,\r\n\t\t\t\ttotal: {\r\n\t\t\t\t\tamount: data.total,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tmetadata: this.getOption('metadata'),\r\n\t\t}\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\t\t// Создать платеж.\r\n\t\tYaPay.createPayment(paymentData, { agent: { name: \"CMS-Bitrix\", version: \"1.0\" } })\r\n\t\t\t.then((payment) => {\r\n\r\n\t\t\t\tthis.order.removeLoader();\r\n\t\t\t\t// Смонтировать кнопку в DOM.\r\n\t\t\t\tpayment.mountButton(node, {\r\n\t\t\t\t\ttype: YaPay.ButtonType.Pay,\r\n\t\t\t\t\ttheme: this.getOption('buttonTheme') || YaPay.ButtonTheme.Black,\r\n\t\t\t\t\twidth: this.getOption('buttonWidth') || YaPay.ButtonWidth.Auto,\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Подписаться на событие process.\r\n\t\t\t\tpayment.on(YaPay.CheckoutEventType.Success, (event) => {\r\n\r\n\t\t\t\t\tnode.remove();\r\n\r\n\t\t\t\t\tthis.authorize(event)\r\n\t\t\t\t\t\t.then((result) => {\r\n\t\t\t\t\t\t\tif (result.status === 'success') {\r\n\t\t\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\t\t\twindow.location.href = result.data.redirect;\r\n\t\t\t\t\t\t\t\t}, 1000);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tthis.order.showError('authorize', result.reasonCode, result.reason);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\r\n\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Success);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tpayment.on(YaPay.CheckoutEventType.Abort, (event) => {\r\n\t\t\t\t\t// ...\r\n\t\t\t\t});\r\n\r\n\t\t\t\tpayment.on(YaPay.CheckoutEventType.Error, (event) => {\r\n\t\t\t\t\tthis.order.showError('yapayPayment', 'error', event);\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.catch((err) => {\r\n\t\t\t\tthis.order.showError('yapayPayment','payment not created', err);\r\n\t\t\t});\r\n\t}\r\n\r\n\tauthorize(event) {\r\n\t\tlet data = {\r\n\t\t\torderId: event.orderId,\r\n\t\t\thash: event.metadata,\r\n\t\t\tsuccessUrl: this.getOption('successUrl'),\r\n\t\t};\r\n\r\n\t\treturn this.order.query(this.getOption('restUrl') + 'authorize', data);\r\n\t}\r\n}","import Proxy from \"./proxy\";\r\n\r\nexport default class SiteProxy extends Proxy {\r\n\r\n\tgetPaymentData(data) {\r\n\t\treturn {\r\n\t\t\tenv: this.getOption('env'),\r\n\t\t\tversion: 2,\r\n\t\t\tcountryCode: YaPay.CountryCode.Ru,\r\n\t\t\tcurrencyCode: YaPay.CurrencyCode.Rub,\r\n\t\t\tmerchant: {\r\n\t\t\t\tid: this.getOption('merchantId'),\r\n\t\t\t\tname: this.getOption('merchantName')\r\n\t\t\t},\r\n\t\t\torder: {\r\n\t\t\t\tid: data.id,\r\n\t\t\t\ttotal: { amount: data.total },\r\n\t\t\t\titems: data.items\r\n\t\t\t},\r\n\t\t\tpaymentMethods: [\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: YaPay.PaymentMethodType.Card,\r\n\t\t\t\t\tgateway: this.getOption('gateway'),\r\n\t\t\t\t\tgatewayMerchantId: this.getOption('gatewayMerchantId'),\r\n\t\t\t\t\tallowedAuthMethods: [YaPay.AllowedAuthMethod.PanOnly],\r\n\t\t\t\t\tallowedCardNetworks: [\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.UnionPay,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Uzcard,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Discover,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.AmericanExpress,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Visa,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Mastercard,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Mir,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Maestro,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.VisaElectron\r\n\t\t\t\t\t]\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t}\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\t\tYaPay.createPayment(paymentData, { agent: { name: \"CMS-Bitrix\", version: \"1.0\" } })\r\n\t\t\t.then( (payment) => {\r\n\t\t\t\tlet button = payment.createButton({\r\n\t\t\t\t\ttype: YaPay.ButtonType.Pay,\r\n\t\t\t\t\ttheme: this.getOption('buttonTheme') || YaPay.ButtonTheme.Black,\r\n\t\t\t\t\twidth: this.getOption('buttonWidth') || YaPay.ButtonWidth.Auto,\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.order.removeLoader();\r\n\t\t\t\tbutton.mount(node);\r\n\r\n\t\t\t\tbutton.on(YaPay.ButtonEventType.Click, function onPaymentButtonClick() {\r\n\t\t\t\t\tpayment.checkout();\r\n\t\t\t\t});\r\n\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Process, (event) => {\r\n\r\n\t\t\t\t\tthis.notify(payment, event).then((result) => {});\r\n\r\n\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Success);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Error, function onPaymentError(event) {\r\n\t\t\t\t\tconsole.log({'errors': event});\r\n\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Error);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Abort, function onPaymentAbort(event) {});\r\n\t\t\t})\r\n\t\t\t.catch(function (err) {\r\n\t\t\t\tconsole.log({'payment not create': err});\r\n\t\t\t});\r\n\t}\r\n\r\n\tnotify(payment, yandexPayData) {\r\n\t\treturn fetch(this.getOption('notifyUrl'), {\r\n\t\t\tmethod: 'POST',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t},\r\n\t\t\tbody: JSON.stringify({\r\n\t\t\t\tservice: this.getOption('requestSign'),\r\n\t\t\t\taccept: 'json',\r\n\t\t\t\tyandexData: yandexPayData,\r\n\t\t\t\texternalId: this.getOption('externalId'),\r\n\t\t\t\tpaySystemId: this.getOption('paySystemId')\r\n\t\t\t})\r\n\t\t})\r\n\t\t\t.then(response => response.json())\r\n\t\t\t.then(result => {\r\n\t\t\t\tif (result.success === true) {\r\n\t\t\t\t\tthis.order.widget.go(result.state, result);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.order.widget.go('error', result);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(error => console.log(error) );\r\n\t}\r\n}","import Template from '../../utils/template';\r\nimport AbstractStep from '../abstractstep';\r\nimport RestProxy from './rest';\r\nimport SiteProxy from './site';\r\n\r\nexport default class AbstractPayment extends AbstractStep {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<div class=\"alert alert-success\" role=\"alert\"><strong>#MESSAGE#</strong></div>',\r\n\t\tloaderSelector: '.bx-yapay-skeleton-loading',\r\n\t}\r\n\r\n\trender(node, data) {\r\n\t\tthis.element = node;\r\n\t\tthis.proxy = this.getOption('isRest')\r\n\t\t\t? new RestProxy(this)\r\n\t\t\t: new SiteProxy(this);\r\n\r\n\t\tconst paymentData = this.getPaymentData(data);\r\n\r\n\t\tthis.createPayment(node, paymentData);\r\n\t}\r\n\r\n\tcompile(data) {\r\n\t\treturn Template.compile(this.options.template, data);\r\n\t}\r\n\r\n\tgetPaymentData(data) {\r\n\t\treturn this.proxy.getPaymentData(data);\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\t\tthis.proxy.createPayment(node, paymentData);\r\n\t}\r\n\r\n\tremoveLoader() {\r\n\t\tconst loader = this.element.querySelector(this.getOption('loaderSelector'));\r\n\r\n\t\tif (loader == null) { return; }\r\n\r\n\t\tloader.remove();\r\n\t}\r\n}","export default class Proxy {\r\n\r\n\tconstructor(cart) {\r\n\t\tthis.cart = cart;\r\n\t}\r\n\r\n\tgetOption(name) {\r\n\t\treturn this.cart.getOption(name);\r\n\t}\r\n\r\n\tbootstrap() {\r\n\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\r\n\t}\r\n\r\n\tgetPaymentData() {\r\n\r\n\t}\r\n}","import Proxy from \"./proxy\";\r\n\r\nexport default class RestProxy extends Proxy {\r\n\r\n\tbootstrap() {\r\n\t\tthis.reflow();\r\n\t}\r\n\r\n\tgetButtonData() {\r\n\r\n\t\tlet data = {\r\n\t\t\tproductId: this.getOption('productId'),\r\n\t\t\tmode: this.getOption('mode'),\r\n\t\t\tcurrencyCode: this.getOption('currencyCode'),\r\n\t\t\tsetupId: this.getOption('setupId'),\r\n\t\t};\r\n\r\n\t\treturn this.cart.query(this.getOption('restUrl') + 'button/data', data);\r\n\t}\r\n\r\n\tgetPaymentData() {\r\n\t\treturn {\r\n\t\t\tenv: this.getOption('env'),\r\n\t\t\tversion: 3,\r\n\t\t\tmerchantId: this.getOption('merchantId'),\r\n\t\t\tcart: { externalId: \"checkout-b2b-test-order-id\", },\r\n\t\t\tcurrencyCode: this.getOption('currencyCode'),\r\n\t\t}\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\t\tif (this._mounted != null) { return; }\r\n\r\n\t\tthis._mounted = false;\r\n\r\n\t\tYaPay.createCheckout(paymentData, { agent: { name: \"CMS-Bitrix\", version: \"1.0\" } })\r\n\t\t\t.then((payment) => {\r\n\t\t\t\tthis._mounted = true;\r\n\r\n\t\t\t\tthis.cart.removeLoader();\r\n\t\t\t\tthis.mountButton(node, payment);\r\n\r\n\t\t\t\tpayment.on(YaPay.CheckoutEventType.Success, (event) => {\r\n\r\n\t\t\t\t\tthis.authorize(event)\r\n\t\t\t\t\t\t.then((result) => {\r\n\t\t\t\t\t\t\tif (result.status === 'success') {\r\n\t\t\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\t\t\twindow.location.href = result.data.redirect;\r\n\t\t\t\t\t\t\t\t}, 1000);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tthis.cart.showError('authorize', result.reasonCode, result.reason);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Success);\r\n\t\t\t\t\tconsole.log(\"Process\", event);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tpayment.on(YaPay.CheckoutEventType.Error, (event) => {\r\n\t\t\t\t\tconsole.log(\"Process\", event);\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.catch((err) => {\r\n\t\t\t\tthis._mounted = null;\r\n\t\t\t\tnode.remove();\r\n\t\t\t\tthis.cart.showError('yapayPayment','payment not created', err);\r\n\t\t\t});\r\n\t}\r\n\r\n\tauthorize(event) {\r\n\t\tlet data = {\r\n\t\t\torderId: event.orderId,\r\n\t\t\thash: event.metadata,\r\n\t\t\tsuccessUrl: this.getOption('successUrl'),\r\n\t\t};\r\n\r\n\t\treturn this.cart.query(this.getOption('restUrl') + 'authorize', data);\r\n\t}\r\n\r\n\tbindDebug(payment) {\r\n\t\tfor (const key in YaPay.CheckoutEventType) {\r\n\t\t\tif (!YaPay.CheckoutEventType.hasOwnProperty(key)) { continue; }\r\n\r\n\t\t\tpayment.on(YaPay.CheckoutEventType[key], function() {\r\n\t\t\t\tconsole.log(arguments);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tmountButton(node, payment) {\r\n\r\n\t\tthis.payment = payment;\r\n\r\n\t\tpayment.mountButton(this.cart.element, {\r\n\t\t\ttype: YaPay.ButtonType.Checkout,\r\n\t\t\ttheme: this.getOption('buttonTheme') || YaPay.ButtonTheme.Black,\r\n\t\t\twidth: this.getOption('buttonWidth') || YaPay.ButtonWidth.Auto,\r\n\t\t});\r\n\t}\r\n\r\n\trestoreButton(node) {\r\n\t\tif (this.payment == null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.payment.mountButton(node, {\r\n\t\t\ttype: YaPay.ButtonType.Checkout,\r\n\t\t\ttheme: this.getOption('buttonTheme') || YaPay.ButtonTheme.Black,\r\n\t\t\twidth: this.getOption('buttonWidth') || YaPay.ButtonWidth.Auto,\r\n\t\t});\r\n\t}\r\n\r\n\tcombineOrderWithData(data) {\r\n\t\tconst { cart } = this.cart.paymentData;\r\n\r\n\t\tlet exampleData = {\r\n\t\t\tcart: {\r\n\t\t\t\t...cart,\r\n\t\t\t\titems: data.items,\r\n\t\t\t\ttotal: {\r\n\t\t\t\t\tamount: data.total.amount,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tmetadata: data.metadata\r\n\t\t};\r\n\r\n\t\tObject.assign(this.cart.paymentData, exampleData);\r\n\t}\r\n\r\n\tchangeOffer(newProductId) {\r\n\t\tlet productId = this.getOption('productId');\r\n\r\n\t\tif (productId !== newProductId) { // todo in items\r\n\t\t\tthis.cart.widget.setOptions({productId: newProductId});\r\n\t\t\tthis.reflow();\r\n\t\t}\r\n\t}\r\n\r\n\tchangeBasket() {\r\n\t\tthis.reflow();\r\n\t}\r\n\r\n\tsetupPaymentCash(){\r\n\r\n\t}\r\n\r\n\treflow() {\r\n\t\tthis.getButtonData()\r\n\t\t\t.then((result) => {\r\n\t\t\t\tif (result.status === 'fail') { throw new Error(result.reason); }\r\n\r\n\t\t\t\tthis.combineOrderWithData(result.data);\r\n\t\t\t\tthis.createPayment(this.cart.element, this.cart.paymentData);\r\n\t\t\t\tthis.payment?.update(this.cart.paymentData);\r\n\t\t\t})\r\n\t\t\t.catch((error) => {\r\n\t\t\t\tthis.cart.removeLoader();\r\n\t\t\t});\r\n\t}\r\n}","import Proxy from \"./proxy\";\r\n\r\nexport default class SiteProxy extends Proxy {\r\n\r\n\tbootstrap() {\r\n\t\tthis.reflow();\r\n\t}\r\n\r\n\tgetPaymentData() {\r\n\t\treturn {\r\n\t\t\tenv: this.getOption('env'),\r\n\t\t\tversion: 2,\r\n\t\t\tcountryCode: YaPay.CountryCode.Ru,\r\n\t\t\tcurrencyCode: YaPay.CurrencyCode.Rub,\r\n\t\t\tmerchant: {\r\n\t\t\t\tid: this.getOption('merchantId'),\r\n\t\t\t\tname: this.getOption('merchantName'),\r\n\t\t\t\turl: this.getOption('siteUrl')\r\n\t\t\t},\r\n\t\t\torder: { id: '0' },\r\n\t\t\tpaymentMethods: [\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: YaPay.PaymentMethodType.Card,\r\n\t\t\t\t\tgateway: this.getOption('gateway'),\r\n\t\t\t\t\tgatewayMerchantId: this.getOption('gatewayMerchantId'),\r\n\t\t\t\t\tallowedAuthMethods: [YaPay.AllowedAuthMethod.PanOnly],\r\n\t\t\t\t\tallowedCardNetworks: [\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.UnionPay,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Uzcard,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Discover,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.AmericanExpress,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Visa,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Mastercard,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Mir,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Maestro,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.VisaElectron\r\n\t\t\t\t\t]\r\n\t\t\t\t}\r\n\t\t\t],\r\n\r\n\t\t\trequiredFields: {\r\n\r\n\t\t\t\tbillingContact: {\r\n\t\t\t\t\temail: this.getOption('useEmail') || false\r\n\t\t\t\t},\r\n\r\n\t\t\t\tshippingContact: {\r\n\t\t\t\t\tname: this.getOption('useName') || false,\r\n\t\t\t\t\temail: this.getOption('useEmail') || false,\r\n\t\t\t\t\tphone: this.getOption('usePhone') || false,\r\n\t\t\t\t},\r\n\r\n\t\t\t\tshippingTypes: {\r\n\t\t\t\t\tdirect: true,\r\n\t\t\t\t\tpickup: true,\r\n\t\t\t\t},\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetProducts(){\r\n\r\n\t\tlet data = {\r\n\t\t\tyapayAction: 'getProducts',\r\n\t\t\tproductId: this.getOption('productId'),\r\n\t\t\tmode: this.getOption('mode'),\r\n\t\t\tsetupId: this.getOption('setupId')\r\n\t\t};\r\n\r\n\t\treturn this.cart.query(this.getOption('purchaseUrl'), data);\r\n\t}\r\n\r\n\tgetShippingOptions(address) {\r\n\r\n\t\tlet data = {\r\n\t\t\taddress: address,\r\n\t\t\tyapayAction: 'deliveryOptions',\r\n\t\t\titems: this.cart.paymentData.order.items,\r\n\t\t\tsetupId: this.getOption('setupId'),\r\n\t\t\tpaySystemId: this.getOption('paySystemId'),\r\n\t\t};\r\n\r\n\t\treturn this.cart.query(this.getOption('purchaseUrl'), data);\r\n\t}\r\n\r\n\tgetPickupOptions(bounds) {\r\n\r\n\t\tlet data = {\r\n\t\t\tbounds: bounds,\r\n\t\t\tyapayAction: 'pickupOptions',\r\n\t\t\titems: this.cart.paymentData.order.items,\r\n\t\t\tsetupId: this.getOption('setupId'),\r\n\t\t\tpaySystemId: this.getOption('paySystemId'),\r\n\t\t};\r\n\r\n\t\treturn this.cart.query(this.getOption('purchaseUrl'), data);\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\t\tif (this._mounted != null) { return; }\r\n\r\n\t\tthis._mounted = false;\r\n\r\n\t\tYaPay.createPayment(paymentData, { agent: { name: \"CMS-Bitrix\", version: \"1.0\" } })\r\n\t\t\t.then((payment) => {\r\n\t\t\t\tthis._mounted = true;\r\n\r\n\t\t\t\tthis.cart.removeLoader();\r\n\t\t\t\tthis.cart.mountButton(node, payment);\r\n\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Process, (event) => {\r\n\r\n\t\t\t\t\tthis.orderAccept(event).then((result) => {\r\n\r\n\t\t\t\t\t\tif (result.error) { throw new Error(result.error.message, result.error.code); }\r\n\r\n\t\t\t\t\t\tif(!this.isPaymentTypeCash(event)) {\r\n\t\t\t\t\t\t\tthis.notify(result, event).then(result => {\r\n\t\t\t\t\t\t\t\tif (result.success === true) {\r\n\t\t\t\t\t\t\t\t\tthis.cart.widget.go(result.state, result);\r\n\t\t\t\t\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Success);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.cart.widget.go('error', result);\r\n\t\t\t\t\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Error);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Success);\r\n\r\n\t\t\t\t\t\t\t\tif (result.redirect != null) {\r\n\t\t\t\t\t\t\t\t\twindow.location.href = result.redirect;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.catch((error) => {\r\n\t\t\t\t\t\t\tthis.cart.showError('yapayProcess', '', error); // todo test it\r\n\t\t\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Error);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Error, (event) => {\r\n\t\t\t\t\tthis.cart.showError('yapayError', 'service temporary unavailable');\r\n\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Error);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Change, (event) => {\r\n\t\t\t\t\t// если выбрали адрес доставки, отдаем скисок доставок\r\n\t\t\t\t\tif (event.shippingAddress) {\r\n\t\t\t\t\t\tthis.getShippingOptions(event.shippingAddress).then((result) => {\r\n\t\t\t\t\t\t\tpayment.update({shippingOptions: result})\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// добавляем выбранную доставку\r\n\t\t\t\t\tif (event.shippingOption){\r\n\t\t\t\t\t\tpayment.update({\r\n\t\t\t\t\t\t\torder: this.combineOrderWithDirectShipping(event.shippingOption),\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// если выбрали ПВЗ, отдаем список ПВЗ\r\n\t\t\t\t\tif (event.pickupBounds) {\r\n\t\t\t\t\t\tthis.getPickupOptions(event.pickupBounds).then((result) => {\r\n\t\t\t\t\t\t\tpayment.update({pickupPoints: result})\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (event.pickupInfo) {\r\n\t\t\t\t\t\tthis.getPickupDetail(event.pickupInfo.pickupPointId).then((result) => {\r\n\t\t\t\t\t\t\tpayment.update({\r\n\t\t\t\t\t\t\t\tpickupPoint: result\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// добавляем выбранный ПВЗ\r\n\t\t\t\t\tif (event.pickupPoint) {\r\n\t\t\t\t\t\tpayment.update({\r\n\t\t\t\t\t\t\torder: this.combineOrderWithPickupShipping(event.pickupPoint),\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.catch((err) => {\r\n\t\t\t\tthis._mounted = null;\r\n\t\t\t\tthis.cart.showError('yapayPayment','payment not created', err);\r\n\t\t\t});\r\n\t}\r\n\r\n\tgetPickupDetail(pickupId) {\r\n\t\tlet data = {\r\n\t\t\tpickupId: pickupId,\r\n\t\t\tyapayAction: 'pickupDetail',\r\n\t\t\titems: this.cart.paymentData.order.items,\r\n\t\t\tsetupId: this.getOption('setupId'),\r\n\t\t\tpaySystemId: this.getOption('paySystemId'),\r\n\t\t};\r\n\r\n\t\treturn this.cart.query(this.getOption('purchaseUrl'), data);\r\n\t}\r\n\r\n\torderAccept(event) {\r\n\r\n\t\tlet deliveryType = event.shippingMethodInfo.shippingOption ? 'delivery' : 'pickup';\r\n\t\tlet delivery;\r\n\r\n\t\tif (deliveryType === 'pickup') {\r\n\t\t\tdelivery = {\r\n\t\t\t\taddress: event.shippingMethodInfo.pickupPoint.address,\r\n\t\t\t\tpickup: event.shippingMethodInfo.pickupPoint,\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdelivery = {\r\n\t\t\t\taddress: event.shippingMethodInfo.shippingAddress,\r\n\t\t\t\tdelivery: event.shippingMethodInfo.shippingOption,\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet orderData = {\r\n\t\t\tsetupId: this.getOption('setupId'),\r\n\t\t\titems: this.cart.paymentData.order.items,\r\n\t\t\tpayment: event.paymentMethodInfo,\r\n\t\t\tcontact: event.shippingContact,\r\n\t\t\tyapayAction: 'orderAccept',\r\n\t\t\tdeliveryType: deliveryType,\r\n\t\t\tpaySystemId: this.isPaymentTypeCash(event) ? this.getOption('paymentCash') : this.getOption('paySystemId'),\r\n\t\t\torderAmount: event.orderAmount\r\n\t\t};\r\n\r\n\t\tlet data = {...orderData, ...delivery };\r\n\r\n\t\treturn this.cart.query(this.getOption('purchaseUrl'), data);\r\n\t}\r\n\r\n\tisPaymentTypeCash(event) {\r\n\t\treturn (event.paymentMethodInfo.type === 'CASH');\r\n\t}\r\n\r\n\tnotify(payment, yandexPayData) {\r\n\r\n\t\tlet data = {\r\n\t\t\tservice: this.getOption('requestSign'),\r\n\t\t\taccept: 'json',\r\n\t\t\tyandexData: yandexPayData,\r\n\t\t\texternalId: payment.externalId,\r\n\t\t\tpaySystemId: payment.paySystemId\r\n\t\t};\r\n\r\n\t\treturn this.cart.query(this.getOption('notifyUrl'), data);\r\n\t}\r\n\r\n\tchangeOffer(newProductId) {\r\n\t\tlet productId = this.getOption('productId');\r\n\r\n\t\tif (productId !== newProductId) { // todo in items\r\n\t\t\tthis.cart.widget.setOptions({productId: newProductId});\r\n\t\t\tthis.reflow();\r\n\t\t}\r\n\t}\r\n\r\n\tchangeBasket() {\r\n\t\tthis.reflow();\r\n\t}\r\n\r\n\treflow() {\r\n\t\tthis.getProducts()\r\n\t\t\t.then((result) => {\r\n\t\t\t\tif (result.error) { throw new Error(result.error.message); }\r\n\r\n\t\t\t\tthis.combineOrderWithProducts(result);\r\n\t\t\t\tthis.createPayment(this.cart.element, this.cart.paymentData);\r\n\t\t\t})\r\n\t\t\t.catch((error) => {\r\n\t\t\t\tthis.cart.removeLoader();\r\n\t\t\t\t// todo this.showError();\r\n\t\t\t});\r\n\t}\r\n\r\n\tcombineOrderWithPickupShipping(pickupOption) {\r\n\t\tconst { order } = this.cart.paymentData;\r\n\r\n\t\treturn {\r\n\t\t\t...order,\r\n\t\t\titems: [\r\n\t\t\t\t...order.items,\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: 'SHIPPING',\r\n\t\t\t\t\tlabel: pickupOption.label,\r\n\t\t\t\t\tamount: pickupOption.amount,\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\ttotal: {\r\n\t\t\t\t...order.total,\r\n\t\t\t\tamount: this.cart.amountSum(order.total.amount, pickupOption.amount),\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n\r\n\tcombineOrderWithDirectShipping(shippingOption) {\r\n\t\tconst { order } = this.cart.paymentData;\r\n\r\n\t\treturn {\r\n\t\t\t...order,\r\n\t\t\titems: [\r\n\t\t\t\t...order.items,\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: 'SHIPPING',\r\n\t\t\t\t\tlabel: shippingOption.label,\r\n\t\t\t\t\tamount: shippingOption.amount,\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\ttotal: {\r\n\t\t\t\t...order.total,\r\n\t\t\t\tamount: this.cart.amountSum(order.total.amount, shippingOption.amount),\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n\r\n\tcombineOrderWithProducts(products) {\r\n\t\tconst { order } = this.cart.paymentData;\r\n\r\n\t\tlet exampleOrder = {\r\n\t\t\t...order,\r\n\t\t\titems: products.items,\r\n\t\t\ttotal: {\r\n\t\t\t\tamount: products.amount,\r\n\t\t\t},\r\n\t\t};\r\n\r\n\t\tObject.assign(this.cart.paymentData.order, exampleOrder);\r\n\t}\r\n\r\n\trestoreButton(node) {\r\n\t\tif (this.cart.paymentButton == null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//this.removeLoader();\r\n\t\tthis.cart.paymentButton.mount(node);\r\n\t}\r\n\r\n\tsetupPaymentCash(){\r\n\t\t// Указываем возможность оплаты заказа при получении\r\n\t\tif (this.getOption('paymentCash') == null) { return; }\r\n\r\n\t\tthis.cart.paymentData.paymentMethods.push({\r\n\t\t\ttype: YaPay.PaymentMethodType.Cash,\r\n\t\t});\r\n\t}\r\n}","import Template from '../../utils/template';\r\nimport AbstractStep from '../abstractstep';\r\nimport { ready } from \"../../utils/ready\";\r\nimport RestProxy from \"./rest\";\r\nimport SiteProxy from \"./site\";\r\n\r\nexport default class AbstractCart extends AbstractStep {\r\n\r\n\tstatic defaults = {\r\n\t\tloaderSelector: '.bx-yapay-skeleton-loading',\r\n\t}\r\n\r\n\trender(node, data) {\r\n\t\tthis.isBootstrap = false;\r\n\t\tthis.element = node;\r\n\t\tthis.paymentButton = null;\r\n\t\tthis.proxy = this.getOption('isRest')\r\n\t\t\t? new RestProxy(this)\r\n\t\t\t: new SiteProxy(this);\r\n\t\tthis.paymentData = this.getPaymentData();\r\n\r\n\t\tthis.bootSolution();\r\n\t\tthis.setupPaymentCash();\r\n\t\tthis.delayBootstrap();\r\n\t}\r\n\r\n\tcompile(data) {\r\n\t\treturn Template.compile(this.options.template, data);\r\n\t}\r\n\r\n\trestore(node) {\r\n\t\tthis.element = node;\r\n\t\tthis.restoreButton(node);\r\n\t}\r\n\r\n\tbootstrap() {\r\n\t\tthis.isBootstrap = true;\r\n\t\tthis.proxy.bootstrap();\r\n\t}\r\n\r\n\tbootSolution() {\r\n\t\tconst solution = this.widget.getSolution();\r\n\r\n\t\tif (solution == null) { return; }\r\n\r\n\t\tsolution.bootCart(this);\r\n\t}\r\n\r\n\tdelayChangeBasket() {\r\n\t\tthis.delay('changeBasket');\r\n\t}\r\n\r\n\tdelayChangeOffer(productId) {\r\n\t\tthis.delay('changeOffer', [productId]);\r\n\t}\r\n\r\n\tdelayBootstrap() {\r\n\t\tready(() => {\r\n\t\t\tthis.delay('bootstrap');\r\n\t\t});\r\n\t}\r\n\r\n\tchangeBasket() {\r\n\t\tif (!this.isBootstrap) { return; }\r\n\t\tthis.proxy?.changeBasket();\r\n\t}\r\n\r\n\tchangeOffer(newProductId) {\r\n\t\tif (this.isBootstrap) {\r\n\t\t\tthis.proxy?.changeOffer(newProductId);\r\n\t\t} else {\r\n\t\t\tthis.widget.setOptions({productId: newProductId});\r\n\t\t}\r\n\t}\r\n\r\n\tsetupPaymentCash(){\r\n\t\tthis.proxy?.setupPaymentCash();\r\n\t}\r\n\r\n\tgetPaymentData() {\r\n\t\treturn this.proxy.getPaymentData();\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\t\tthis.proxy.createPayment(node, paymentData);\r\n\t}\r\n\r\n\tmountButton(node, payment) {\r\n\t\tthis.paymentButton = payment.createButton({\r\n\t\t\ttype: YaPay.ButtonType.Checkout,\r\n\t\t\ttheme: this.getOption('buttonTheme') || YaPay.ButtonTheme.Black,\r\n\t\t\twidth: this.getOption('buttonWidth') || YaPay.ButtonWidth.Auto,\r\n\t\t});\r\n\r\n\t\tthis.paymentButton.mount(this.element);\r\n\r\n\t\tthis.paymentButton.on(YaPay.ButtonEventType.Click, () => {\r\n\t\t\tpayment.checkout();\r\n\t\t});\r\n\t}\r\n\r\n\trestoreButton(node) {\r\n\t\tthis.proxy.restoreButton(node);\r\n\t}\r\n\r\n\tamountSum(amountA, amountB) {\r\n\t\treturn (Number(amountA) + Number(amountB)).toFixed(2);\r\n\t}\r\n\r\n\tshowError(type, message, err = null) {\r\n\t\tlet notify = type + ' - ' + message;\r\n\r\n\t\tif (err) {\r\n\t\t\tnotify += ' ' + err;\r\n\t\t}\r\n\r\n\t\talert(notify);\r\n\t}\r\n\r\n\tremoveLoader() {\r\n\t\tconst loader = this.element.querySelector(this.getOption('loaderSelector'));\r\n\r\n\t\tif (loader == null) { return; }\r\n\r\n\t\tloader.remove();\r\n\t}\r\n}","export function ready(callback) {\r\n\tif (document.readyState === 'complete' || document.readyState === 'interactive') {\r\n\t\tsetTimeout(callback, 1);\r\n\t} else {\r\n\t\tdocument.addEventListener('DOMContentLoaded', callback);\r\n\t}\r\n}","import StepFactory from './step/factory';\r\nimport SolutionRegistry from \"./solutionregistry\";\r\n\r\nexport default class Widget {\r\n\r\n\tstatic defaults = {}\r\n\r\n\tdefaults;\r\n\toptions;\r\n\tel;\r\n\tstep;\r\n\r\n\t/**\r\n\t * @param {Object<Element>} element\r\n\t * @param {Object} options\r\n\t */\r\n\tconstructor(element, options = {}) {\r\n\t\tthis.defaults = Object.assign({}, this.constructor.defaults);\r\n\t\tthis.options = {};\r\n\t\tthis.el = element;\r\n\r\n\t\tthis.setOptions(options);\r\n\t\tthis.bootSolution();\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object} data\r\n\t */\r\n\tpayment(data) {\r\n\t\tthis.go('payment', data);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object} data\r\n\t */\r\n\tcart(data){\r\n\t\tthis.go('cart', data);\r\n\t}\r\n\r\n\trestore(element) {\r\n\t\tthis.el = element;\r\n\t\tthis.step?.restore(element);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} type\r\n\t * @param {Object} data\r\n\t */\r\n\tgo(type, data) {\r\n\t\tthis.step = this.makeStep(type);\r\n\t\tthis.step.render(this.el, data);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {String} type\r\n\t * @returns {AbstractCart|Finish|Step3ds|Payment|Failure}\r\n\t * @throws {Error}\r\n\t */\r\n\tmakeStep(type) {\r\n\t\tconst options = this.getOption(type) || {};\r\n\r\n\t\treturn StepFactory.make(type, this, options);\r\n\t}\r\n\r\n\tgetSolution() {\r\n\t\tconst name = this.getOption('solution');\r\n\t\tconst mode = this.getOption('mode');\r\n\r\n\t\treturn SolutionRegistry.getPage(name, mode);\r\n\t}\r\n\r\n\tbootSolution() {\r\n\t\tconst solution = this.getSolution();\r\n\r\n\t\tif (solution == null) { return; }\r\n\r\n\t\tsolution.bootWidget(this);\r\n\t}\r\n\r\n\textendDefaults(options) {\r\n\t\tthis.defaults = Object.assign(this.defaults, options);\r\n\t}\r\n\r\n\tsetOptions(options) {\r\n\t\tthis.options = Object.assign(this.options, options);\r\n\t}\r\n\r\n\tgetOption(name) {\r\n\t\treturn this.options[name] ?? this.defaults[name];\r\n\t}\r\n}\r\n","import Secure3d from './secure3d';\r\nimport Finish from './finish';\r\nimport Failure from './failure';\r\nimport Loader from './loader';\r\nimport AbstractPayment from './payment/abstractpayment';\r\nimport AbstractCart from './cart/abstractcart';\r\n\r\nexport default class Factory {\r\n\r\n\t/**\r\n\t * @param {string} type\r\n\t * @param {Widget} widget\r\n\t * @param {Object} options\r\n\t * @returns {AbstractCart|Finish|Step3ds|AbstractPayment|Failure}\r\n\t * @throws {Error}\r\n\t */\r\n\tstatic make(type, widget, options = {}) {\r\n\t\tif (type === '3ds') {\r\n\t\t\treturn new Secure3d(widget, options);\r\n\t\t} else if (type === 'finished') {\r\n\t\t\treturn new Finish(widget, options);\r\n\t\t} else if (type === 'error') {\r\n\t\t\treturn new Failure(widget, options);\r\n\t\t} else if (type === 'payment') {\r\n\t\t\treturn new AbstractPayment(widget, options);\r\n\t\t} else if (type === 'cart') {\r\n\t\t\treturn new AbstractCart(widget, options);\r\n\t\t} else if (type === 'loader') {\r\n\t\t\treturn new Loader(widget, options);\r\n\t\t}\r\n\r\n\t\tthrow new Error('unknown step ' + type);\r\n\t}\r\n\r\n}"],"names":["SolutionRegistry","name","factory","window","_window","BX","_window$BX","YandexPay","_window$BX$YandexPay","Solution","_window$BX$YandexPay$","_window$BX$YandexPay$2","console","warn","mode","key","this","pages","createPage","getFactory","create","MutationSkeleton","constructor","element","options","el","Object","assign","defaults","destroy","check","MutationLoop","loop","loopTimeout","loopCancel","clearTimeout","_loopTimeout","setTimeout","timeout","MutationObserver","listener","mutations","mutation","removedNodes","removedNode","HTMLElement","contains","runCheck","observe","disconnect","anchor","getAnchor","observer","childList","subtree","delay","_checkTimeout","document","body","closest","EventProxy","config","callbackMap","on","callback","matchEvent","onBxEvent","onJQueryEvent","onPlainEvent","off","offBxEvent","offJQueryEvent","offPlainEvent","fire","data","fireBxEvent","fireJQueryEvent","firePlainEvent","type","addCustomEvent","removeCustomEvent","onCustomEvent","jQuery","selfConfig","typeConfig","canProxyCallback","originalCallback","evt","proxyData","originalEvent","_evt$originalEvent","detail","pushCallbackVariation","popCallbackVariation","hasPlainAndJQueryCollision","triggerHandler","CustomEvent","addEventListener","removeEventListener","dispatchEvent","proxy","WeakMap","set","map","result","get","delete","Subscriber","eventProxy","bind","unbind","bindOn","bindEvent","unbindOff","unbindEvent","event","Array","isArray","forEach","one","NodePreserver","found","restore","install","uninstall","installMutation","installSubscriber","uninstallMutation","uninstallSubscriber","isEnabled","make","driverOptions","subscriber","option","overrides","Template","template","vars","replaceKey","replaceValue","hasOwnProperty","toUpperCase","replace","indexOf","html","context","createElement","innerHTML","firstElementChild","children","Sdkloader","instance","load","_loadPromise","Promise","resolve","reject","testGlobal","script","getElementsByTagName","async","src","onload","loopGlobal","onerror","remove","Error","parentNode","insertBefore","YaPay","createPayment","Intersection","wait","IntersectionObserver","entries","entry","isIntersecting","target","unobserve","node","Factory","waitCount","setOptions","bootSolution","bootLocal","inject","selector","position","then","waitElement","checkElement","renderElement","widget","insertLoader","intersection","getOption","preserve","getInstance","querySelector","containsSiblingElement","next","parentElement","_anchor$parentElement","matches","nextElementSibling","preserver","preserveOptions","preserveOption","Widget","width","go","toLowerCase","label","waitElementLoop","findElement","elementList","variant","trim","searchBySelector","searchById","searchByClassName","length","reduceVisible","part","split","partSanitized","isCssSelector","collection","querySelectorAll","push","e","getElementById","getElementsByClassName","testVisible","offsetWidth","offsetHeight","getClientRects","test","Utils","compile","id","elements","toElements","reverse","insertAdjacentElement","solution","getPage","bootFactory","extendDefaults","containerSelector","loaderSelector","waitLimit","waitTimeout","AbstractStep","delayTimeouts","render","query","url","fetch","method","headers","JSON","stringify","response","json","getTemplate","optionKey","optionFirstSymbol","substr","getNode","getElement","getElementSelector","clearDelay","args","showError","message","err","notify","alert","Base","setWidget","Form","autosubmit","makeInputs","value","params","keys","termUrl","makeTermUrl","backUrl","location","href","encodeURIComponent","submit","Iframe","insertIframe","iframe","contentIframe","contentWindow","contentDocument","open","write","close","IframeRbs","renderIframe","service","accept","secure","externalId","paySystemId","success","state","catch","error","log","action","Step3ds","view","makeView","SecureForm","SecureIframe","SecureRbs","Finish","Failure","Loader","restoreHtml","Proxy","order","paymentData","getPaymentData","RestProxy","env","version","currencyCode","CurrencyCode","Rub","merchantId","orderId","cart","items","total","amount","metadata","agent","payment","removeLoader","mountButton","ButtonType","Pay","theme","ButtonTheme","Black","ButtonWidth","Auto","CheckoutEventType","Success","authorize","status","redirect","reasonCode","reason","complete","CompleteReason","Abort","hash","successUrl","SiteProxy","countryCode","CountryCode","Ru","merchant","paymentMethods","PaymentMethodType","Card","gateway","gatewayMerchantId","allowedAuthMethods","AllowedAuthMethod","PanOnly","allowedCardNetworks","AllowedCardNetwork","UnionPay","Uzcard","Discover","AmericanExpress","Visa","Mastercard","Mir","Maestro","VisaElectron","button","createButton","mount","ButtonEventType","Click","checkout","PaymentEventType","Process","yandexPayData","yandexData","AbstractPayment","loader","bootstrap","reflow","getButtonData","productId","setupId","_mounted","createCheckout","bindDebug","arguments","Checkout","restoreButton","combineOrderWithData","exampleData","changeOffer","newProductId","changeBasket","setupPaymentCash","update","requiredFields","billingContact","email","shippingContact","phone","shippingTypes","direct","pickup","getProducts","yapayAction","getShippingOptions","address","getPickupOptions","bounds","orderAccept","code","isPaymentTypeCash","Change","shippingAddress","shippingOptions","shippingOption","combineOrderWithDirectShipping","pickupBounds","pickupPoints","pickupInfo","getPickupDetail","pickupPointId","pickupPoint","combineOrderWithPickupShipping","pickupId","delivery","deliveryType","shippingMethodInfo","paymentMethodInfo","contact","orderAmount","combineOrderWithProducts","pickupOption","amountSum","products","exampleOrder","paymentButton","Cash","AbstractCart","isBootstrap","delayBootstrap","getSolution","bootCart","delayChangeBasket","delayChangeOffer","readyState","amountA","amountB","Number","toFixed","step","makeStep","Secure3d","bootWidget"],"mappings":"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"}