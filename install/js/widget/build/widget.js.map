{"version":3,"file":"widget.js","sources":["../solutionregistry.js","../ui/nodepreserver/mutationskeleton.js","../ui/nodepreserver/mutationloop.js","../ui/nodepreserver/mutationobserver.js","../utils/eventproxy.js","../ui/nodepreserver/subscriber.js","../ui/nodepreserver/composite.js","../ui/nodepreserver.js","../ui/nodepreserver/mutationfactory.js","../utils/template.js","../sdkloader.js","../intersection.js","../ui/display/display.js","../ui/display/button.js","../ui/display/widget.js","../ui/display/factory.js","../factory.js","../step/abstractstep.js","../secure3d/base.js","../secure3d/form.js","../secure3d/iframe.js","../secure3d/iframerbs.js","../step/secure3d.js","../step/finish.js","../step/failure.js","../step/loader.js","../step/payment/proxy.js","../step/payment/rest.js","../step/payment/site.js","../step/payment/abstractpayment.js","../step/cart/proxy.js","../step/cart/rest.js","../step/cart/site.js","../step/cart/abstractcart.js","../utils/ready.js","../widget.js","../step/factory.js"],"sourcesContent":["export default class SolutionRegistry {\r\n\r\n\tstatic pages = {};\r\n\r\n\tstatic getFactory(name) {\r\n\t\tif (name == null) { return null; }\r\n\r\n\t\tconst factory = window?.BX?.YandexPay?.Solution?.[name]?.factory;\r\n\r\n\t\tif (factory == null) {\r\n\t\t\tconsole?.warn(`cant find solution ${name}`);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\treturn factory;\r\n\t}\r\n\r\n\tstatic getPage(name, mode) {\r\n\t\tif (name == null || mode == null) { return null; }\r\n\r\n\t\tconst key = name + ':' + mode;\r\n\r\n\t\tif (this.pages[key] == null) {\r\n\t\t\tthis.pages[key] = this.createPage(name, mode);\r\n\t\t}\r\n\r\n\t\treturn this.pages[key];\r\n\t}\r\n\r\n\tstatic createPage(name, mode) {\r\n\t\tconst factory = this.getFactory(name);\r\n\r\n\t\tif (factory == null) { return null; }\r\n\r\n\t\treturn factory.create(mode);\r\n\t}\r\n\r\n}","export default class MutationSkeleton {\r\n\r\n\tstatic defaults = {\r\n\t\tcheck: null,\r\n\t}\r\n\r\n\tconstructor(element, options = {}) {\r\n\t\tthis.el = element;\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t}\r\n\r\n\tdestroy() {\r\n\r\n\t}\r\n\r\n}","import MutationSkeleton from \"./mutationskeleton\";\r\n\r\nexport default class MutationLoop extends MutationSkeleton {\r\n\r\n\tstatic defaults = Object.assign({}, MutationSkeleton.defaults, {\r\n\t\ttimeout: 1000,\r\n\t})\r\n\r\n\tconstructor(element, options = {}) {\r\n\t\tsuper(element, options);\r\n\t\tthis.loopTimeout();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.loopCancel();\r\n\t}\r\n\r\n\tloopTimeout() {\r\n\t\tclearTimeout(this._loopTimeout);\r\n\t\tthis._loopTimeout = setTimeout(this.loop, this.options.timeout);\r\n\t}\r\n\r\n\tloopCancel() {\r\n\t\tclearTimeout(this._loopTimeout);\r\n\t}\r\n\r\n\tloop = () => {\r\n\t\tthis.options.check() && this.loopTimeout();\r\n\t}\r\n\r\n}","import MutationSkeleton from \"./mutationskeleton\";\r\n\r\nexport default class MutationObserver extends MutationSkeleton {\r\n\r\n\tstatic defaults = Object.assign({}, MutationSkeleton.defaults, {\r\n\t\tanchor: null,\r\n\t\tdelay: 0,\r\n\t})\r\n\r\n\tconstructor(element, options = {}) {\r\n\t\tsuper(element, options);\r\n\t\tthis.observe();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.disconnect();\r\n\t}\r\n\r\n\tobserve() {\r\n\t\tconst anchor = this.getAnchor();\r\n\r\n\t\tif (anchor == null) {\r\n\t\t\tconsole?.warn('cant find anchor for node preserver');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.observer = new window.MutationObserver(this.listener);\r\n\t\tthis.observer.observe(anchor, {\r\n\t\t\tchildList: true,\r\n\t\t\tsubtree: true,\r\n\t\t});\r\n\t}\r\n\r\n\tdisconnect() {\r\n\t\tif (this.observer == null) { return; }\r\n\r\n\t\tthis.observer.disconnect();\r\n\t\tthis.observer = null;\r\n\t}\r\n\r\n\tlistener = (mutations) => {\r\n\t\tfor (const mutation of mutations) {\r\n\t\t\tif (mutation.removedNodes == null) { continue; }\r\n\r\n\t\t\tfor (const removedNode of mutation.removedNodes) {\r\n\t\t\t\tif (!(removedNode instanceof HTMLElement)) { continue; }\r\n\r\n\t\t\t\tif (removedNode === this.el || removedNode.contains(this.el)) {\r\n\t\t\t\t\tthis.runCheck();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\trunCheck() {\r\n\t\tconst delay = this.options.delay;\r\n\r\n\t\tif (delay == null) {\r\n\t\t\tthis.options.check();\r\n\t\t} else {\r\n\t\t\tclearTimeout(this._checkTimeout);\r\n\t\t\tthis._checkTimeout = setTimeout(() => { this.options.check(); }, delay);\r\n\t\t}\r\n\t}\r\n\r\n\tgetAnchor() {\r\n\t\tif (this.options.anchor == null) { return document.body; }\r\n\r\n\t\tlet matched = null;\r\n\r\n\t\tfor (let selector of this.options.anchor.split(',')) {\r\n\t\t\tselector = selector.trim();\r\n\r\n\t\t\tif (selector === '') { continue; }\r\n\r\n\t\t\tmatched = this.el.closest(selector);\r\n\r\n\t\t\tif (matched != null) { break; }\r\n\t\t}\r\n\r\n\t\treturn matched;\r\n\t}\r\n\r\n}","export class EventProxy {\r\n\r\n\tstatic make(config = {}) {\r\n\t\treturn new EventProxy(config);\r\n\t}\r\n\r\n\tconstructor(config = {}) {\r\n\t\tthis.config = config;\r\n\t\tthis.callbackMap = {};\r\n\t}\r\n\r\n\ton(name, callback) {\r\n\t\tthis.matchEvent('bx') && this.onBxEvent(name, callback);\r\n\t\tthis.matchEvent('jquery') && this.onJQueryEvent(name, callback);\r\n\t\tthis.matchEvent('plain') && this.onPlainEvent(name, callback);\r\n\t}\r\n\r\n\toff(name, callback) {\r\n\t\tthis.matchEvent('bx') && this.offBxEvent(name, callback);\r\n\t\tthis.matchEvent('jquery') && this.offJQueryEvent(name, callback);\r\n\t\tthis.matchEvent('plain') && this.offPlainEvent(name, callback);\r\n\t}\r\n\r\n\tfire(name, data = {}) {\r\n\t\tthis.matchEvent('bx') && this.fireBxEvent(name, data);\r\n\t\tthis.matchEvent('jquery') && this.fireJQueryEvent(name, data);\r\n\t\tthis.matchEvent('plain') && this.firePlainEvent(name, data);\r\n\t}\r\n\r\n\tmatchEvent(type) {\r\n\t\treturn this.config[type] != null ? !!this.config[type] : !this.config['strict'];\r\n\t}\r\n\r\n\tonBxEvent(name, callback) {\r\n\t\tif (typeof BX === 'undefined' || BX.addCustomEvent == null) { return; }\r\n\r\n\t\tBX.addCustomEvent(name, callback);\r\n\t}\r\n\r\n\toffBxEvent(name, callback) {\r\n\t\tif (typeof BX === 'undefined' || BX.removeCustomEvent == null) { return; }\r\n\r\n\t\tBX.removeCustomEvent(name, callback);\r\n\t}\r\n\r\n\tfireBxEvent(name, data) {\r\n\t\tif (typeof BX === 'undefined' || BX.onCustomEvent == null) { return; }\r\n\r\n\t\tBX.onCustomEvent(name, [data]);\r\n\t}\r\n\r\n\tonJQueryEvent(name, callback) {\r\n\t\tif (typeof jQuery === 'undefined') { return; }\r\n\r\n\t\tconst selfConfig = this.typeConfig('jquery');\r\n\r\n\t\tif (this.canProxyCallback(selfConfig)) {\r\n\t\t\tconst originalCallback = callback;\r\n\r\n\t\t\tcallback = (evt, data) => {\r\n\t\t\t\tconst proxyData = data != null ? data : evt?.originalEvent?.detail;\r\n\r\n\t\t\t\toriginalCallback(proxyData);\r\n\t\t\t};\r\n\r\n\t\t\tthis.pushCallbackVariation('jquery', originalCallback, callback);\r\n\t\t}\r\n\r\n\t\tjQuery(document).on(name, callback);\r\n\t}\r\n\r\n\toffJQueryEvent(name, callback) {\r\n\t\tif (typeof jQuery === 'undefined') { return; }\r\n\r\n\t\tconst selfConfig = this.typeConfig('jquery');\r\n\r\n\t\tif (this.canProxyCallback(selfConfig)) {\r\n\t\t\tcallback = this.popCallbackVariation('jquery', callback);\r\n\r\n\t\t\tif (callback == null) { return; }\r\n\t\t}\r\n\r\n\t\tjQuery(document).off(name, callback);\r\n\t}\r\n\r\n\tfireJQueryEvent(name, data) {\r\n\t\tif (typeof jQuery === 'undefined') { return; }\r\n\t\tif (this.hasPlainAndJQueryCollision()) { return; }\r\n\r\n\t\tjQuery(document).triggerHandler(new CustomEvent(name, { \"detail\": data }));\r\n\t}\r\n\r\n\tonPlainEvent(name, callback) {\r\n\t\tif (this.hasPlainAndJQueryCollision()) { return; }\r\n\r\n\t\tconst selfConfig = this.typeConfig('plain');\r\n\r\n\t\tif (this.canProxyCallback(selfConfig)) {\r\n\t\t\tconst originalCallback = callback;\r\n\r\n\t\t\tcallback = (evt) => {\r\n\t\t\t\toriginalCallback(evt.detail);\r\n\t\t\t};\r\n\r\n\t\t\tthis.pushCallbackVariation('plain', originalCallback, callback);\r\n\t\t}\r\n\r\n\t\tdocument.addEventListener(name, callback);\r\n\t}\r\n\r\n\toffPlainEvent(name, callback) {\r\n\t\tif (this.hasPlainAndJQueryCollision()) { return; }\r\n\r\n\t\tconst selfConfig = this.typeConfig('plain');\r\n\r\n\t\tif (this.canProxyCallback(selfConfig)) {\r\n\t\t\tcallback = this.popCallbackVariation('plain', callback);\r\n\r\n\t\t\tif (callback == null) { return; }\r\n\t\t}\r\n\r\n\t\tdocument.removeEventListener(name, callback);\r\n\t}\r\n\r\n\tfirePlainEvent(name, data) {\r\n\t\tdocument.dispatchEvent(new CustomEvent(name, { \"detail\": data }));\r\n\t}\r\n\r\n\thasPlainAndJQueryCollision() {\r\n\t\tif (!this.matchEvent('plain') || !this.matchEvent('jquery')) { return false; }\r\n\r\n\t\tconst plainConfig = this.typeConfig('plain');\r\n\r\n\t\treturn (plainConfig['force'] !== true && typeof jQuery !== 'undefined');\r\n\t}\r\n\r\n\tcanProxyCallback(selfConfig) {\r\n\t\treturn selfConfig['proxy'] !== false;\r\n\t}\r\n\r\n\ttypeConfig(type) {\r\n\t\treturn typeof this.config[type] === 'object' && this.config[type] != null ? this.config : {};\r\n\t}\r\n\r\n\tpushCallbackVariation(type, callback, proxy) {\r\n\t\tif (this.callbackMap[type] == null) {\r\n\t\t\tthis.callbackMap[type] = new WeakMap();\r\n\t\t}\r\n\r\n\t\tthis.callbackMap[type].set(callback, proxy);\r\n\t}\r\n\r\n\tpopCallbackVariation(type, callback) {\r\n\t\tif (this.callbackMap[type] == null) { return null; }\r\n\r\n\t\tconst map = this.callbackMap[type];\r\n\t\tconst result = map.get(callback);\r\n\r\n\t\tif (result != null) {\r\n\t\t\tmap.delete(callback);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n}","import {EventProxy} from \"../../utils/eventproxy\";\r\n\r\nexport default class Subscriber {\r\n\r\n\tstatic defaults = {\r\n\t\tcheck: null,\r\n\t\tevent: null,\r\n\t\tconfig: {},\r\n\t\ton: null,\r\n\t\toff: null,\r\n\t}\r\n\r\n\tconstructor(element, options = {}) {\r\n\t\tthis.el = element;\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t\tthis.eventProxy = new EventProxy(this.options.config);\r\n\r\n\t\tthis.bind();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.unbind();\r\n\r\n\t\tthis.eventProxy = null;\r\n\t\tthis.options = {};\r\n\t\tthis.el = null;\r\n\t}\r\n\r\n\tbind() {\r\n\t\tthis.bindOn();\r\n\t\tthis.bindEvent();\r\n\t}\r\n\r\n\tunbind() {\r\n\t\tthis.unbindOff();\r\n\t\tthis.unbindEvent();\r\n\t}\r\n\r\n\tbindOn() {\r\n\t\tif (this.options.on == null) { return; }\r\n\r\n\t\tthis.options.on(this.options.check);\r\n\t}\r\n\r\n\tunbindOff() {\r\n\t\tif (this.options.off == null) { return; }\r\n\r\n\t\tthis.options.off(this.options.check);\r\n\t}\r\n\r\n\tbindEvent() {\r\n\t\tconst event = this.options.event;\r\n\r\n\t\tif (event == null) { return; }\r\n\r\n\t\tif (typeof event === 'string') {\r\n\t\t\tthis.eventProxy.on(event, this.options.check);\r\n\t\t} else if (Array.isArray(event)) {\r\n\t\t\tevent.forEach((one) => {\r\n\t\t\t\tthis.eventProxy.on(one, this.options.check);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tconsole?.warn(`unknown event type ${typeof event}`);\r\n\t\t}\r\n\t}\r\n\r\n\tunbindEvent() {\r\n\t\tconst event = this.options.event;\r\n\r\n\t\tif (event == null) { return; }\r\n\r\n\t\tif (typeof event === 'string') {\r\n\t\t\tthis.eventProxy.off(event, this.options.check);\r\n\t\t} else if (Array.isArray(event)) {\r\n\t\t\tevent.forEach((one) => {\r\n\t\t\t\tthis.eventProxy.off(one, this.options.check);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tconsole?.warn(`unknown event type ${typeof event}`);\r\n\t\t}\r\n\t}\r\n\r\n}","export default class Composite {\r\n\r\n\tstatic defaults = {\r\n\t\tcheck: null,\r\n\t}\r\n\r\n\tconstructor(element: HTMLElement, options: Object = {}) {\r\n\t\tthis.el = element;\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\r\n\t\tthis.boot();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tif (typeof BX !== 'undefined') { return; }\r\n\r\n\t\tBX?.removeCustomEvent('onFrameDataReceived', this.onFrameReady);\r\n\t}\r\n\r\n\tboot() {\r\n\t\tconst anchor = this.anchor();\r\n\r\n\t\tif (typeof BX !== 'undefined' && anchor == null) { return; }\r\n\r\n\t\tBX?.addCustomEvent('onFrameDataReceived', this.onFrameReady);\r\n\t}\r\n\r\n\tonFrameReady = () => {\r\n\t\tthis.options.check();\r\n\t}\r\n\r\n\tanchor() {\r\n\t\tlet parent = this.el.parentElement;\r\n\r\n\t\twhile (parent) {\r\n\t\t\tlet start = false;\r\n\t\t\tlet nodes = [];\r\n\r\n\t\t\tfor (const child of parent.children) {\r\n\t\t\t\tif (child.id == null != null && /^bxdynamic_.*_start$/.test(child.id)) {\r\n\t\t\t\t\tstart = true;\r\n\t\t\t\t} else if (child.id == null != null && /^bxdynamic_.*_end$/.test(child.id)) {\r\n\t\t\t\t\tstart = false;\r\n\r\n\t\t\t\t\tfor (const node of nodes) {\r\n\t\t\t\t\t\tif (node === this.el || node.contains(this.el)) {\r\n\t\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tnodes = [];\r\n\t\t\t\t} else if (start) {\r\n\t\t\t\t\tnodes.push(child);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tparent = parent.parentElement;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n}","import MutationFactory from \"./nodepreserver/mutationfactory\";\r\nimport Subscriber from \"./nodepreserver/subscriber\";\r\nimport Composite from \"./nodepreserver/composite\";\r\n\r\nexport default class NodePreserver {\r\n\r\n\tstatic defaults = {\r\n\t\trestore: null,\r\n\t\tsubscriber: null,\r\n\t\tmutation: true,\r\n\t\tcomposite: true,\r\n\t}\r\n\r\n\t/** @var MutationSkeleton */\r\n\tmutation;\r\n\t/** @var Subscriber */\r\n\tsubscriber;\r\n\t/** @var Composite */\r\n\tcomposite;\r\n\r\n\tconstructor(element, options = {}) {\r\n\t\tthis.el = element;\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\r\n\t\tthis.install();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.uninstall();\r\n\t\tthis.options = {};\r\n\t\tthis.el = null;\r\n\t}\r\n\r\n\tinstall() {\r\n\t\tthis.installMutation();\r\n\t\tthis.installSubscriber();\r\n\t\tthis.installComposite();\r\n\t}\r\n\r\n\tuninstall() {\r\n\t\tthis.uninstallMutation();\r\n\t\tthis.uninstallSubscriber();\r\n\t\tthis.uninstallComposite();\r\n\t}\r\n\r\n\tinstallMutation() {\r\n\t\tif (!this.isEnabled('mutation')) { return; }\r\n\r\n\t\tthis.mutation = MutationFactory.make(this.el, this.driverOptions('mutation'));\r\n\t}\r\n\r\n\tuninstallMutation() {\r\n\t\tif (this.mutation == null) { return; }\r\n\r\n\t\tthis.mutation.destroy();\r\n\t}\r\n\r\n\tinstallSubscriber() {\r\n\t\tif (!this.isEnabled('subscriber')) { return; }\r\n\r\n\t\tthis.subscriber = new Subscriber(this.el, this.driverOptions('subscriber'));\r\n\t}\r\n\r\n\tuninstallSubscriber() {\r\n\t\tif (this.subscriber == null) { return; }\r\n\r\n\t\tthis.subscriber.destroy();\r\n\t\tthis.subscriber = null;\r\n\t}\r\n\r\n\tinstallComposite() {\r\n\t\tif (!this.isEnabled('composite')) { return; }\r\n\r\n\t\tthis.composite = new Composite(this.el, this.driverOptions('composite'));\r\n\t}\r\n\r\n\tuninstallComposite() {\r\n\t\tif (this.composite == null) { return; }\r\n\r\n\t\tthis.composite.destroy();\r\n\t}\r\n\r\n\tisEnabled(type) {\r\n\t\treturn !!this.options[type];\r\n\t}\r\n\r\n\tdriverOptions(type) {\r\n\t\tconst option = typeof this.options[type] === 'object' ? this.options[type] : {};\r\n\t\tconst overrides = {\r\n\t\t\tcheck: this.check,\r\n\t\t};\r\n\r\n\t\treturn Object.assign({}, option, overrides);\r\n\t}\r\n\r\n\tcheck = () => {\r\n\t\tconst found = document.body.contains(this.el);\r\n\r\n\t\tif (!found) {\r\n\t\t\tthis.options.restore();\r\n\t\t}\r\n\r\n\t\treturn found;\r\n\t}\r\n}","import MutationLoop from \"./mutationloop\";\r\nimport MutationObserver from \"./mutationobserver\";\r\n\r\nexport default class MutationFactory {\r\n\r\n\tstatic make(element, options) {\r\n\t\tif (typeof window.MutationObserver === 'function') {\r\n\t\t\treturn new MutationObserver(element, options);\r\n\t\t}\r\n\r\n\t\treturn new MutationLoop(element, options);\r\n\t}\r\n\r\n}","export default class Template {\r\n\r\n\t/**\r\n\t * @param {string=} template\r\n\t * @param {Object} vars\r\n\t * @returns {string}\r\n\t */\r\n\tstatic compile(template, vars) {\r\n\t\tlet key;\r\n\t\tlet replaceKey;\r\n\t\tlet replaceValue;\r\n\t\tlet result = template;\r\n\r\n\t\tfor (key in vars) {\r\n\t\t\tif (!vars.hasOwnProperty(key)) { continue; }\r\n\r\n\t\t\treplaceKey = '#' + key.toUpperCase() + '#';\r\n\t\t\treplaceValue = vars[key];\r\n\r\n\t\t\tdo {\r\n\t\t\t\tresult = result.replace(replaceKey, replaceValue);\r\n\t\t\t} while (result.indexOf(replaceKey) !== -1);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tstatic toElement(html) {\r\n\t\tconst context = document.createElement('div');\r\n\t\tcontext.innerHTML = html;\r\n\r\n\t\treturn context.firstElementChild;\r\n\t}\r\n\r\n\tstatic toElements(html) {\r\n\t\tconst context = document.createElement('div');\r\n\t\tcontext.innerHTML = html;\r\n\r\n\t\treturn [...context.children];\r\n\t}\r\n\r\n}","export class Sdkloader {\r\n\r\n\tstatic instance = null;\r\n\r\n\tstatic getInstance() {\r\n\t\tif (this.instance == null) {\r\n\t\t\tthis.instance = new Sdkloader();\r\n\t\t}\r\n\r\n\t\treturn this.instance;\r\n\t}\r\n\r\n\tload() : Promise {\r\n\t\tif (this._loadPromise != null) { return this._loadPromise; }\r\n\r\n\t\tthis._loadPromise = new Promise((resolve, reject) => {\r\n\t\t\tif (this.testGlobal()) {\r\n\t\t\t\tresolve();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst script = document.createElement('script');\r\n\t\t\tconst anchor = document.getElementsByTagName(\"script\")[0] || document.body;\r\n\r\n\t\t\tscript.type = \"text/javascript\";\r\n\t\t\tscript.async = true;\r\n\t\t\tscript.src = 'https://pay.yandex.ru/sdk/v1/pay.js';\r\n\r\n\t\t\tscript.onload = () => {\r\n\t\t\t\tthis.loopGlobal(() => {\r\n\t\t\t\t\tthis._loadPromise = null;\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t\tscript.onerror = () => {\r\n\t\t\t\tthis._loadPromise = null;\r\n\t\t\t\tscript.remove();\r\n\r\n\t\t\t\treject(new Error('cant load yandex pay sdk library'));\r\n\t\t\t};\r\n\r\n\t\t\tanchor.parentNode.insertBefore(script, anchor);\r\n\t\t});\r\n\r\n\t\treturn this._loadPromise;\r\n\t}\r\n\r\n\tloopGlobal(resolve) : void {\r\n\t\tif (this.testGlobal()) {\r\n\t\t\tresolve();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsetTimeout(() => { this.loopGlobal(resolve) }, 100);\r\n\t}\r\n\r\n\ttestGlobal() : boolean {\r\n\t\treturn window.YaPay?.createPayment != null;\r\n\t}\r\n}","export class Intersection {\r\n\r\n\tstatic defaults = {};\r\n\r\n\tobserver;\r\n\r\n\tconstructor(element: HTMLElement, options: Object = {}) {\r\n\t\tthis.el = element;\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t}\r\n\r\n\twait() : Promise {\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tif (typeof IntersectionObserver === 'undefined') {\r\n\t\t\t\tresolve(this.el);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.observer = new IntersectionObserver((entries, observer) => {\r\n\t\t\t\tentries.forEach((entry) => {\r\n\t\t\t\t\tif (entry.isIntersecting) {\r\n\t\t\t\t\t\tconst element = entry.target;\r\n\t\t\t\t\t\tobserver.unobserve(element);\r\n\t\t\t\t\t\tresolve(element);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\tthis.observer.observe(this.el);\r\n\t\t});\r\n\t}\r\n\r\n\trestore(node: HTMLElement) : void {\r\n\t\tthis.observer?.unobserve(this.el);\r\n\t\tthis.el = node;\r\n\t\tthis.observer?.observe(this.el);\r\n\t}\r\n}","import Utils from \"../../utils/template\";\r\n\r\nexport default class Display {\r\n\r\n\tstatic defaults = {\r\n\r\n\t}\r\n\r\n\tconstructor(factory, options) {\r\n\t\tthis.factory = factory;\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t}\r\n\r\n\tstyle() {\r\n\r\n\t}\r\n\r\n\tmount(node, payment, type) {\r\n\r\n\t}\r\n\r\n\tgetOption(name) {\r\n\t\treturn this.options[name];\r\n\t}\r\n}","import Display from './display';\r\nimport Utils from \"../../utils/template\";\r\n\r\nexport default class Button extends Display {\r\n\r\n\tstatic defaults = {\r\n\t\tstyle: `<style>#STYLE#</style>`,\r\n\t\tstyleHeight: `##ID# .ya-pay-button, ##ID# .bx-yapay-skeleton-loading {height:#HEIGHT#px;}`,\r\n\t\tstyleBorder: `##ID# .ya-pay-button, ##ID# .bx-yapay-skeleton-loading {border-radius:#BORDER#px;}`,\r\n\t\tstyleWidth: `##ID# .ya-pay-button, ##ID# .bx-yapay-skeleton-loading, ##ID# .bx-yapay-divider{width: #WIDTH#px;}`,\r\n\t}\r\n\r\n\tstyle() {\r\n\t\tconst collectHeight = this.collectHeight();\r\n\t\tconst collectBorder = this.collectBorder();\r\n\t\tconst collectWidth = this.collectWidth();\r\n\r\n\t\treturn Utils.compile(this.getOption('style'), {\r\n\t\t\tstyle: collectHeight + collectBorder + collectWidth,\r\n\t\t});\r\n\t}\r\n\r\n\tmount(node, payment, type) {\r\n\t\tconst theme = this.getOption('VARIANT_BUTTON') || YaPay.ButtonTheme.Black;\r\n\t\tconst width = this.getOption('WIDTH_BUTTON') || YaPay.ButtonWidth.Max;\r\n\r\n\t\tpayment.mountButton(node, {\r\n\t\t\ttype: type,\r\n\t\t\ttheme: theme,\r\n\t\t\twidth: width !== 'OWN' ? width : YaPay.ButtonWidth.Max\r\n\t\t});\r\n\t}\r\n\r\n\tcollectHeight() {\r\n\r\n\t\tlet result = '';\r\n\r\n\t\tconst heightVariant = this.getOption('HEIGHT_TYPE_BUTTON') || null;\r\n\r\n\t\tif (heightVariant == null) {\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tresult = Utils.compile(this.getOption('styleHeight'), {\r\n\t\t\tid: this.factory.getOption('containerId'),\r\n\t\t\theight: this.getOption('HEIGHT_VALUE_BUTTON') || '54',\r\n\t\t});\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tcollectBorder() {\r\n\t\tlet result = '';\r\n\r\n\t\tconst borderVariant = this.getOption('BORDER_RADIUS_TYPE_BUTTON') || null;\r\n\r\n\t\tif (borderVariant == null) {\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tresult = Utils.compile(this.getOption('styleBorder'), {\r\n\t\t\tid: this.factory.getOption('containerId'),\r\n\t\t\tborder: this.getOption('BORDER_RADIUS_VALUE_BUTTON') ?? '8',\r\n\t\t});\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tcollectWidth() {\r\n\t\tlet result = '';\r\n\r\n\t\tconst widthVariant = this.getOption('WIDTH_BUTTON');\r\n\r\n\t\tif (widthVariant !== 'OWN') {\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tresult = Utils.compile(this.getOption('styleWidth'), {\r\n\t\t\tid: this.factory.getOption('containerId'),\r\n\t\t\twidth: this.getOption('WIDTH_VALUE_BUTTON') || '282',\r\n\t\t});\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\twidth() {\r\n\t\tlet width = this.getOption('WIDTH_BUTTON') || 'MAX';\r\n\r\n\t\tif (width === 'OWN'){\r\n\t\t\twidth = 'MAX';\r\n\t\t}\r\n\r\n\t\treturn width;\r\n\t}\r\n}","import Display from './display';\r\nimport Utils from \"../../utils/template\";\r\n\r\nexport default class Widget extends Display {\r\n\r\n\tstatic defaults = {\r\n\t\tstyle: `<style>#STYLE#</style>`,\r\n\t\tstyleBorder: `##ID# .ya-pay-widget, ##ID# .bx-yapay-skeleton-loading {border-radius:#BORDER#px !important;}`,\r\n\t\tstyleWidth: `##ID# .ya-pay-widget, ##ID# .bx-yapay-skeleton-loading, ##ID# .bx-yapay-divider{width: #WIDTH#px !important;}`,\r\n\t}\r\n\r\n\tstyle() {\r\n\t\tconst collectBorder = this.collectBorder();\r\n\t\tconst collectWidth = this.collectWidth();\r\n\r\n\t\treturn Utils.compile(this.getOption('style'), {\r\n\t\t\tstyle: collectBorder + collectWidth,\r\n\t\t});\r\n\t}\r\n\r\n\tmount(node, payment, type) {\r\n\t\tpayment.mountWidget(node, {\r\n\t\t\twidgetType: this.getOption('TYPE_WIDGET') || YaPay.WidgetType.Compact,\r\n\t\t});\r\n\t}\r\n\r\n\tcollectBorder() {\r\n\t\tlet result = '';\r\n\r\n\t\tconst borderVariant = this.getOption('BORDER_RADIUS_TYPE_WIDGET') || null;\r\n\r\n\t\tif (borderVariant == null) {\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tresult = Utils.compile(this.getOption('styleBorder'), {\r\n\t\t\tid: this.factory.getOption('containerId'),\r\n\t\t\tborder: this.getOption('BORDER_RADIUS_VALUE_WIDGET') ?? '8',\r\n\t\t});\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tcollectWidth() {\r\n\t\tlet result = '';\r\n\r\n\t\tconst widthVariant = this.getOption('WIDTH_TYPE_WIDGET') || null;\r\n\r\n\t\tif (widthVariant == null) {\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tresult = Utils.compile(this.getOption('styleWidth'), {\r\n\t\t\tid: this.factory.getOption('containerId'),\r\n\t\t\twidth: this.getOption('WIDTH_VALUE_WIDGET') || '282',\r\n\t\t});\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\twidth() {\r\n\t\treturn 'MAX';\r\n\t}\r\n}","import Button from \"./button\";\r\nimport Widget from \"./widget\";\r\n\r\nexport default class Factory {\r\n\r\n\t/**\r\n\t * @param {string} type\r\n\t * @param {Factory} factory\r\n\t * @param {Object} options\r\n\t * @returns {Button|Widget}\r\n\t * @throws {Error}\r\n\t */\r\n\tstatic make(type, factory, options) {\r\n\t\tif (type === 'Button') {\r\n\t\t\treturn new Button(factory, options);\r\n\t\t} else if (type === 'Widget') {\r\n\t\t\treturn new Widget(factory, options);\r\n\t\t}\r\n\r\n\t\tthrow new Error('unknown display ' + type);\r\n\t}\r\n\r\n}","import SolutionRegistry from './solutionregistry';\r\nimport NodePreserver from \"./ui/nodepreserver\";\r\nimport Utils from './utils/template';\r\nimport {EventProxy} from \"./utils/eventproxy\";\r\nimport {Sdkloader} from \"./sdkloader\";\r\nimport {Intersection} from \"./intersection\";\r\nimport Display from \"./ui/display/factory\";\r\n\r\nexport default class Factory {\r\n\r\n\tstatic defaults = {\r\n\t\tsolution: null,\r\n\t\ttemplate:\r\n\t\t\t'<div id=\"#ID#\" ' +\r\n\t\t\t\t'class=\"bx-yapay-drawer-container ' +\r\n\t\t\t\t'yapay-behavior--#MODE# ' +\r\n\t\t\t\t'yapay-display--#DISPLAY# ' +\r\n\t\t\t\t'yapay-width--#WIDTH# ' +\r\n\t\t\t\t'yapay-solution--#SOLUTION#\">' +\r\n\t\t\t\t'#STYLE#' +\r\n\t\t\t\t'#DIVIDER#' +\r\n\t\t\t\t'<div class=\"bx-yapay-drawer\"></div>' +\r\n\t\t\t'</div>',\r\n\t\tdivider:\r\n\t\t\t'<div class=\"bx-yapay-divider\"> ' +\r\n\t\t\t\t'<span class=\"bx-yapay-divider__corner\"></span> ' +\r\n\t\t\t\t'<span class=\"bx-yapay-divider__text\">#LABEL#</span> ' +\r\n\t\t\t\t'<span class=\"bx-yapay-divider__corner at--right\"></span> ' +\r\n\t\t\t'</div>',\r\n\t\tuseDivider: false,\r\n\t\tcontainerSelector: '.bx-yapay-drawer',\r\n\t\tloaderSelector: '.bx-yapay-skeleton-loading',\r\n\t\tpreserve: {\r\n\t\t\tcomposite: true,\r\n\t\t},\r\n\t\twaitLimit: 30,\r\n\t\twaitTimeout: 1000,\r\n\t}\r\n\r\n\tdefaults;\r\n\toptions;\r\n\twaitCount = 0;\r\n\r\n\tconstructor(options = {}) {\r\n\t\tthis.defaults = Object.assign({}, this.constructor.defaults);\r\n\t\tthis.options = {};\r\n\r\n\t\tthis.setOptions(options);\r\n\t\tthis.bootSolution();\r\n\t\tthis.bootLocal();\r\n\t}\r\n\r\n\tinject(selector, position) {\r\n\t\treturn Promise.resolve()\r\n\t\t\t.then(() => this.waitElement(selector))\r\n\t\t\t.then((anchor) => this.checkElement(anchor))\r\n\t\t\t.then((anchor) => this.renderElement(anchor, position))\r\n\t\t\t.then((element) => this.install(element))\r\n\t\t\t.then((widget) => this.insertLoader(widget))\r\n\t\t\t.then((widget) => {\r\n\t\t\t\tconst intersection = new Intersection(widget.el);\r\n\t\t\t\t\r\n\t\t\t\tif (this.getOption('preserve')) {\r\n\t\t\t\t\tthis.preserve(selector, position, widget, intersection);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn intersection.wait().then(() => widget);\r\n\t\t\t})\r\n\t\t\t.then((widget) => Sdkloader.getInstance().load().then(() => widget));\r\n\t}\r\n\r\n\tcheckElement(anchor) {\r\n\t\tconst selector = this.containerSelector();\r\n\t\tconst contains = (\r\n\t\t\t!!anchor.querySelector(selector)\r\n\t\t\t|| this.containsSiblingElement(anchor, selector)\r\n\t\t);\r\n\r\n\t\tif (contains) {\r\n\t\t\tthrow new Error('the element already has a container');\r\n\t\t}\r\n\r\n\t\treturn anchor;\r\n\t}\r\n\r\n\tcontainerSelector() {\r\n\t\treturn '#' + this.getOption('containerId') + ' ' + this.getOption('containerSelector');\r\n\t}\r\n\r\n\tcontainsSiblingElement(anchor, selector) {\r\n\t\tlet result = false;\r\n\t\tlet next = anchor.parentElement?.firstElementChild;\r\n\r\n\t\twhile (next) {\r\n\t\t\tif (next.matches(selector) || next.querySelector(selector)) {\r\n\t\t\t\tresult = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tnext = next.nextElementSibling;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\t\r\n\tpreserve(selector, position, widget, intersection) {\r\n\t\tconst preserver = new NodePreserver(widget.el, Object.assign({}, this.preserveOptions(), {\r\n\t\t\trestore: () => {\r\n\t\t\t\tpreserver.destroy();\r\n\t\t\t\t// noinspection JSIgnoredPromiseFromCall\r\n\t\t\t\tthis.restore(selector, position, widget, intersection);\r\n\t\t\t},\r\n\t\t}));\r\n\t}\r\n\r\n\tpreserveOptions() {\r\n\t\tconst preserveOption = this.getOption('preserve');\r\n\r\n\t\treturn typeof preserveOption === 'object' ? preserveOption : {};\r\n\t}\r\n\r\n\trestore(selector, position, widget, intersection) {\r\n\t\treturn Promise.resolve()\r\n\t\t\t.then(() => this.waitElement(selector))\r\n\t\t\t.then((anchor) => {\r\n\t\t\t\tconst element = this.renderElement(anchor, position);\r\n\r\n\t\t\t\twidget.restore(element);\r\n\t\t\t\tintersection?.restore(element);\r\n\r\n\t\t\t\tif (this.getOption('preserve')) {\r\n\t\t\t\t\tthis.preserve(selector, position, widget, intersection);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn widget;\r\n\t\t\t});\r\n\t}\r\n\r\n\tinstall(element) {\r\n\t\treturn new BX.YandexPay.Widget(element);\r\n\t}\r\n\r\n\tinsertLoader(widget) {\r\n\t\twidget.go('loader', {\r\n\t\t\tlabel: this.getOption('label'),\r\n\t\t});\r\n\r\n\t\treturn widget;\r\n\t}\r\n\r\n\twaitElement(selector) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthis.waitCount = 0;\r\n\t\t\tthis.waitElementLoop(selector, resolve, reject);\r\n\t\t});\r\n\t}\r\n\r\n\twaitElementLoop(selector, resolve, reject) {\r\n\t\tconst anchor = this.findElement(selector);\r\n\r\n\t\tif (anchor) {\r\n\t\t\tresolve(anchor);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t++this.waitCount;\r\n\r\n\t\tif (this.waitCount >= this.getOption('waitLimit')) {\r\n\t\t\treject('cant find element by selector ' + selector);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsetTimeout(this.waitElementLoop.bind(this, selector, resolve, reject), this.getOption('waitTimeout'));\r\n\t}\r\n\r\n\tfindElement(selector) {\r\n\t\tlet elementList;\r\n\t\tlet variant = selector.trim();\r\n\t\tlet result;\r\n\r\n\t\tif (variant === '') { throw new Error('widget selector is empty'); }\r\n\r\n\t\telementList = this.searchBySelector(variant) ?? this.searchById(selector) ?? this.searchByClassName(selector);\r\n\r\n\t\tif (elementList == null) { return null; }\r\n\r\n\t\tif (elementList.length > 1) {\r\n\t\t\tresult = this.reduceVisible(elementList);\r\n\t\t}\r\n\r\n\t\tif (result == null) {\r\n\t\t\tresult = elementList[0];\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tsearchBySelector(selector) {\r\n\t\ttry {\r\n\t\t\tconst result = [];\r\n\r\n\t\t\tfor (const part of selector.split(',')) { // first selector\r\n\t\t\t\tconst partSanitized = part.trim();\r\n\r\n\t\t\t\tif (partSanitized === '' || !this.isCssSelector(partSanitized)) { continue; }\r\n\r\n\t\t\t\tconst [partSelector, matchMedia] = this.testSelectorMedia(partSanitized);\r\n\r\n\t\t\t\tif (!matchMedia) { continue; }\r\n\r\n\t\t\t\tconst collection = document.querySelectorAll(partSelector);\r\n\r\n\t\t\t\tfor (const element of collection) {\r\n\t\t\t\t\tresult.push(element);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn result.length > 0 ? result : null;\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tsearchById(selector) {\r\n\t\ttry {\r\n\t\t\tconst element = document.getElementById(selector);\r\n\r\n\t\t\treturn element != null ? [element] : null;\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tsearchByClassName(selector) {\r\n\t\ttry {\r\n\t\t\tconst collection = document.getElementsByClassName(selector);\r\n\r\n\t\t\treturn collection.length > 0 ? collection : null;\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\treduceVisible(collection) {\r\n\t\tlet result = null;\r\n\t\t\r\n\t\tfor (const element of collection) {\r\n\t\t\tif (this.testVisible(element)) {\r\n\t\t\t\tresult = element;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\t\r\n\ttestVisible(element) {\r\n\t\treturn (element.offsetWidth || element.offsetHeight || element.getClientRects().length );\r\n\t}\r\n\r\n\tisCssSelector(selector) {\r\n\t\treturn /^[.#]/.test(selector);\r\n\t}\r\n\r\n\ttestSelectorMedia(selector) {\r\n\t\tconst partials = /^(.*):media(\\(.*\\))$/.exec(selector);\r\n\r\n\t\tif (partials == null) { return [ selector, true ]; }\r\n\r\n\t\treturn [\r\n\t\t\tpartials[1],\r\n\t\t\twindow.matchMedia(partials[2]).matches,\r\n\t\t];\r\n\t}\r\n\r\n\trenderElement(anchor, position) {\r\n\t\tconst selector = this.containerSelector();\r\n\t\tconst divider = this.getDivider();\r\n\t\tconst display = this.getDisplay();\r\n\r\n\t\tconst html = Utils.compile(this.getOption('template'), {\r\n\t\t\tdivider: divider,\r\n\t\t\tstyle: display != null ? display.style() : '',\r\n\t\t\twidth: display != null ? display.width().toLowerCase() : 'auto',\r\n\t\t\tid: this.getOption('containerId'),\r\n\t\t\tmode: this.getOption('mode') || 'payment',\r\n\t\t\tdisplay: this.getOption('displayType')?.toLowerCase() || 'button',\r\n\t\t\tsolution: this.getOption('solution')?.toLowerCase(),\r\n\t\t});\r\n\r\n\t\tlet elements = Utils.toElements(html);\r\n\t\tlet result = null;\r\n\r\n\t\tif (position.indexOf('after') === 0) { elements = elements.reverse(); }\r\n\r\n\t\tfor (const element of elements) {\r\n\t\t\tanchor.insertAdjacentElement(position, element);\r\n\r\n\t\t\tif (result != null) { continue; }\r\n\r\n\t\t\tresult = element.matches(selector) ? element : element.querySelector(selector);\r\n\t\t}\r\n\r\n\t\tif (result == null) {\r\n\t\t\tthrow new Error(`cant find template container by selector ${selector}`);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tbootSolution() {\r\n\t\tconst name = this.getOption('solution');\r\n\t\tconst mode = this.getOption('mode');\r\n\t\tconst solution = SolutionRegistry.getPage(name, mode);\r\n\r\n\t\tif (solution == null) { return; }\r\n\r\n\t\tsolution.bootFactory(this);\r\n\t}\r\n\r\n\tgetDisplay() {\r\n\t\tconst type = this.getOption('displayType');\r\n\t\tconst options = this.getOption('displayParameters');\r\n\r\n\t\tif (type == null) { return null; }\r\n\r\n\t\treturn Display.make(type, this, options);\r\n\t}\r\n\r\n\tgetDivider() {\r\n\t\treturn this.getOption('useDivider')\r\n\t\t\t? Utils.compile(this.getOption('divider'), {label: this.getOption('label')})\r\n\t\t\t: '';\r\n\t}\r\n\r\n\tbootLocal() {\r\n\t\tEventProxy.make().fire('bxYapayFactoryInit', {\r\n\t\t\tfactory: this,\r\n\t\t});\r\n\t}\r\n\r\n\textendDefaults(options) {\r\n\t\tthis.defaults = Object.assign(this.defaults, options);\r\n\t}\r\n\r\n\tsetOptions(options) {\r\n\t\tthis.options = Object.assign(this.options, options);\r\n\t}\r\n\r\n\tgetOption(name) {\r\n\t\treturn this.options[name] ?? this.defaults[name];\r\n\t}\r\n}","import Template from '../utils/template';\r\n\r\nexport default class AbstractStep {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '',\r\n\t}\r\n\r\n\tdefaults;\r\n\toptions;\r\n\twidget;\r\n\tdelayTimeouts = {};\r\n\r\n\t/**\r\n\t * @param {Widget} widget\r\n\t * @param {Object} options\r\n\t */\r\n\tconstructor(widget, options = {}) {\r\n\t\tthis.widget = widget;\r\n\t\tthis.defaults = Object.assign({}, this.constructor.defaults);\r\n\t\tthis.options = Object.assign({}, options);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param {string} name\r\n\t * @returns {*}\r\n\t */\r\n\tgetOption(name) {\r\n\t\treturn this.options[name] ?? this.widget.getOption(name) ?? this.defaults[name];\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object<Element>} node Element\r\n\t * @param {Object} data Options\r\n\t */\r\n\trender(node, data = {}) {\r\n\t\tnode.innerHTML = this.compile(data);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object} data\r\n\t * @returns {string}\r\n\t */\r\n\tcompile(data) {\r\n\t\treturn Template.compile(this.getOption('template'), data);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object<Element>} node\r\n\t */\r\n\trestore(node) {\r\n\t\t// nothing by default\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} url\r\n\t * @param {Object} data\r\n\t * @returns {Promise.<Object>}\r\n\t */\r\n\tquery(url, data) {\r\n\t\treturn fetch(url, {\r\n\t\t\tmethod: 'POST',\r\n\t\t\theaders: { 'Content-Type': 'application/json' },\r\n\t\t\tbody: JSON.stringify(data)\r\n\t\t})\r\n\t\t\t.then(response => {return response.json()})\r\n\t}\r\n\r\n\tgetTemplate(key) {\r\n\t\tlet optionKey = key + 'Template';\r\n\t\tlet option = this.options[optionKey];\r\n\t\tlet optionFirstSymbol = option.substr(0, 1);\r\n\t\tlet result;\r\n\r\n\t\tif (optionFirstSymbol === '.' || optionFirstSymbol === '#') {\r\n\t\t\tresult = this.getNode(option).innerHTML;\r\n\t\t} else {\r\n\t\t\tresult = option;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetElement(key, context, method) {\r\n\t\tlet selector = this.getElementSelector(key);\r\n\r\n\t\treturn this.getNode(selector, context, method || 'querySelector');\r\n\t}\r\n\r\n\tgetElementSelector(key) {\r\n\t\tlet optionKey = key + 'Element';\r\n\r\n\t\treturn this.options[optionKey];\r\n\t}\r\n\r\n\tgetNode(selector, context, method) {\r\n\t\tif (selector.substr(0, 1) === '#') { // is id query\r\n\t\t\tcontext = document;\r\n\t\t} else if (!context) {\r\n\t\t\tcontext = this.el;\r\n\t\t}\r\n\r\n\t\treturn context[method](selector);\r\n\t}\r\n\r\n\tclearDelay(name) {\r\n\t\tif (this.delayTimeouts[name] == null) { return; }\r\n\r\n\t\tclearTimeout(this.delayTimeouts[name]);\r\n\t\tthis.delayTimeouts[name] = null;\r\n\t}\r\n\r\n\tdelay(name, args = [], timeout = 300) {\r\n\t\tthis.clearDelay(name);\r\n\t\tthis.delayTimeouts[name] = setTimeout(this[name].bind(this, ...args), timeout);\r\n\t}\r\n\r\n\tshowError(type, message, err = null) {\r\n\t\tlet notify = type + ' - ' + message;\r\n\r\n\t\tif (err) {\r\n\t\t\tnotify += ' ' + err;\r\n\t\t}\r\n\r\n\t\talert(notify);\r\n\t}\r\n}","import Template from \"../utils/template\";\r\n\r\nexport default class Base {\r\n\tstatic defaults = {\r\n\t\ttemplate: null,\r\n\t}\r\n\r\n\tconstructor(options = {}) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t\tthis.widget = null;\r\n\t}\r\n\r\n\trender(node, data = {}) {\r\n\t\tnode.innerHTML = this.compile(data);\r\n\t}\r\n\r\n\tcompile(data) {\r\n\t\treturn Template.compile(this.options.template, data);\r\n\t}\r\n\r\n\tsetWidget(widget) {\r\n\t\tthis.widget = widget;\r\n\t}\r\n\r\n\tgetOption(key) {\r\n\t\tif (key in this.options) {\r\n\t\t\treturn this.options[key];\r\n\t\t} else {\r\n\t\t\treturn this.widget.options[key];\r\n\t\t}\r\n\t}\r\n}","import Base from \"./base\";\r\nimport Template from \"../utils/template\";\r\n\r\nexport default class Form extends Base {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<form name=\"form\" action=\"#ACTION#\" method=\"#METHOD#\">'\r\n\t\t\t+ '#INPUTS#'\r\n\t\t\t+ '</form>',\r\n\t}\r\n\r\n\trender(node, data) {\r\n\t\tsuper.render(node, data);\r\n\t\tthis.autosubmit(node);\r\n\t}\r\n\r\n\tcompile(data) {\r\n\t\tconst template = this.options.template;\r\n\t\tconst vars = Object.assign(data, {\r\n\t\t\t'inputs': this.makeInputs(data)\r\n\t\t});\r\n\r\n\t\treturn Template.compile(template, vars);\r\n\t}\r\n\r\n\tmakeInputs(data) {\r\n\t\tlet key;\r\n\t\tlet vars = data.params;\r\n\t\tlet value;\r\n\t\tlet template;\r\n\r\n\t\tif (Object.keys(vars).length === 0) { return ''; }\r\n\r\n\t\ttemplate = data.termUrl ? '<input type=\"hidden\" name=\"TermUrl\" value=\"' + vars.termUrl + '\">' : '';\r\n\r\n\t\tfor (key in vars)\r\n\t\t{\r\n\t\t\tif (!vars.hasOwnProperty(key)) { continue; }\r\n\r\n\t\t\tvalue = vars[key];\r\n\r\n\t\t\ttemplate += '<input type=\"hidden\" name=\"' + key + '\" value=\"' + value + '\">';\r\n\t\t}\r\n\r\n\t\treturn template;\r\n\t}\r\n\r\n\tmakeTermUrl() {\r\n\t\tlet result = this.getOption('notifyUrl');\r\n\t\tlet backUrl = window.location.href;\r\n\r\n\t\tresult +=\r\n\t\t\t(result.indexOf('?') === -1 ? '?' : '&')\r\n\t\t\t+ 'backurl=' + encodeURIComponent(backUrl)\r\n\t\t\t+ '&service=' + this.getOption('requestSign')\r\n\t\t\t+ '&paymentId=' + this.getOption('externalId');\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tautosubmit(node) {\r\n\t\tconst form = node.querySelector('form');\r\n\r\n\t\tform.submit();\r\n\t}\r\n}","import Base from \"./base\";\r\nimport Template from \"../utils/template\";\r\n\r\nexport default class Iframe extends Base {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<iframe style=\"display: none;\"></iframe>',\r\n\t}\r\n\r\n\trender(node, data) {\r\n\t\tthis.insertIframe(node, data);\r\n\t}\r\n\r\n\tinsertIframe(node, data) {\r\n\t\tnode.innerHTML = Template.compile(this.options.template, data);\r\n\t\tthis.compile(node, data);\r\n\t}\r\n\r\n\tcompile(node, data) {\r\n\t\tlet iframe = node.querySelector('iframe');\r\n\t\tlet contentIframe = iframe.contentWindow || ( iframe.contentDocument.document || iframe.contentDocument);\r\n\t\tlet html = data.params;\r\n\r\n\t\tcontentIframe.document.open();\r\n\t\tcontentIframe.document.write(html);\r\n\t\tcontentIframe.document.close();\r\n\t}\r\n}","import Base from \"./base\";\r\nimport Template from \"../utils/template\";\r\n\r\nexport default class IframeRbs extends Base {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<iframe style=\"display: none;\"></iframe>',\r\n\t}\r\n\r\n\trender(node, data) {\r\n\t\tthis.insertIframe(node, data);\r\n\t}\r\n\r\n\tinsertIframe(node, data) {\r\n\t\tnode.innerHTML = Template.compile(this.options.template, data);\r\n\t\tthis.compile(node, data);\r\n\t}\r\n\r\n\tcompile(node, data) {\r\n\t\tPromise.resolve()\r\n\t\t\t.then(() => this.renderIframe(node, data))\r\n\t\t\t.then(() => this.query(data));\r\n\t}\r\n\r\n\tquery (data) {\r\n\t\tfetch(this.getOption('notifyUrl'), {\r\n\t\t\tmethod: 'POST',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t},\r\n\t\t\tbody: JSON.stringify({\r\n\t\t\t\tservice: this.getOption('requestSign'),\r\n\t\t\t\taccept: 'json',\r\n\t\t\t\tsecure: data.params.secure,\r\n\t\t\t\texternalId: data.params.notify.externalId,\r\n\t\t\t\tpaySystemId: data.params.notify.paySystemId\r\n\t\t\t})\r\n\t\t})\r\n\t\t\t.then(response => response.json())\r\n\t\t\t.then(result => {\r\n\t\t\t\tif (result.success === true) {\r\n\t\t\t\t\tthis.widget.go(result.state, result);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.widget.go('error', result);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(error => console.log(error) );\r\n\t}\r\n\r\n\trenderIframe(node, data) {\r\n\t\tlet iframe = node.querySelector('iframe');\r\n\t\tlet contentIframe = iframe.contentWindow || ( iframe.contentDocument.document || iframe.contentDocument);\r\n\t\tlet html = `<form name=\"form\" action=\"${data.action}\" method=\"POST\">`;\r\n\r\n\t\tcontentIframe.document.open();\r\n\t\tcontentIframe.document.write(html);\r\n\t\tcontentIframe.document.close();\r\n\r\n\t\tcontentIframe.document.querySelector('form').submit();\r\n\t}\r\n}\r\n","import AbstractStep from \"./abstractstep\";\r\nimport SecureForm from \"../secure3d/form\";\r\nimport SecureIframe from \"../secure3d/iframe\";\r\nimport SecureRbs from \"../secure3d/iframerbs\";\r\n\r\nexport default class Step3ds extends AbstractStep {\r\n\r\n\trender(node, data) {\r\n\t\tconst view = this.makeView(data);\r\n\t\tview.setWidget(this.widget);\r\n\t\tview.render(node, data);\r\n\t}\r\n\r\n\tmakeView(data) {\r\n\t\tlet view = data.view;\r\n\r\n\t\tif (view === 'form') {\r\n\t\t\treturn new SecureForm();\r\n\t\t} else if (view === 'iframe') {\r\n\t\t\treturn new SecureIframe();\r\n\t\t} else if (view === 'iframerbs') {\r\n\t\t\treturn new SecureRbs();\r\n\t\t}\r\n\r\n\t\tthrow new Error('view secure3d missing')\r\n\t}\r\n}","import AbstractStep from './abstractstep';\r\n\r\nexport default class Finish extends AbstractStep {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<div class=\"alert alert-success\" role=\"alert\"><strong>#MESSAGE#</strong></div>'\r\n\t}\r\n\r\n}","import AbstractStep from './abstractstep';\r\n\r\nexport default class Failure extends AbstractStep {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<div class=\"alert alert-danger\" role=\"alert\"><strong>#MESSAGE#</strong></div>'\r\n\t}\r\n\r\n}","import AbstractStep from './abstractstep';\r\nimport Utils from \"../utils/template\";\r\n\r\nexport default class Loader extends AbstractStep {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<div class=\"bx-yapay-skeleton-loading\"></div>'\r\n\t}\r\n\r\n\trender(node, data = {}) {\r\n\t\tconst html = this.compile(data);\r\n\t\tconst element = Utils.toElement(html);\r\n\r\n\t\tnode.insertAdjacentElement('beforeend', element);\r\n\t\tthis.restoreElement = element;\r\n\t}\r\n\r\n\trestore(node) {\r\n\t\tif (this.restoreElement == null) { return; }\r\n\r\n\t\tnode.insertAdjacentElement('beforeend', this.restoreElement);\r\n\t}\r\n\r\n}\r\n","export default class Proxy {\r\n\r\n\tconstructor(order) {\r\n\t\tthis.order = order;\r\n\t}\r\n\r\n\tgetOption(name) {\r\n\t\treturn this.order.getOption(name);\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\r\n\t}\r\n\r\n\tgetPaymentData(data) {\r\n\r\n\t}\r\n}","import Proxy from \"./proxy\";\r\n\r\nexport default class RestProxy extends Proxy {\r\n\r\n\tgetPaymentData(data) {\r\n\t\treturn   {\r\n\t\t\tenv: this.getOption('env'),\r\n\t\t\tversion: 3,\r\n\t\t\tcurrencyCode: YaPay.CurrencyCode.Rub,\r\n\t\t\tmerchantId: this.getOption('merchantId'),\r\n\t\t\torderId: data.id,\r\n\t\t\tcart: {\r\n\t\t\t\titems: data.items,\r\n\t\t\t\ttotal: {\r\n\t\t\t\t\tamount: data.total,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tmetadata: this.getOption('metadata'),\r\n\t\t}\r\n\t}\r\n\r\n\tonPaymentSuccess(event) {\r\n\t\tthis.order.element.remove();\r\n\r\n\t\tthis.authorize(event)\r\n\t\t\t.then((result) => {\r\n\t\t\t\tif (result.status === 'success') {\r\n\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\twindow.location.href = result.data.redirect;\r\n\t\t\t\t\t}, 1000);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.order.showError('authorize', result.reasonCode, result.reason);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t}\r\n\r\n\tonPaymentAbort(event) {\r\n\r\n\t}\r\n\r\n\tonPaymentError(event) {\r\n\t\tsetTimeout(() => {\r\n\t\t\twindow.location.href = this.getOption('failUrl');\r\n\t\t}, 1000);\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\r\n\t\tYaPay.createSession(paymentData, {\r\n\t\t\tonSuccess: this.onPaymentSuccess.bind(this),\r\n\t\t\tonAbort: this.onPaymentAbort.bind(this),\r\n\t\t\tonError: this.onPaymentError.bind(this),\r\n\t\t\tagent: { name: 'CMS-Bitrix', version: '1.0' }\r\n\t\t})\r\n\t\t\t.then( (paymentSession) => {\r\n\r\n\t\t\t\tthis.order.removeLoader();\r\n\r\n\t\t\t\tpaymentSession.mountButton(node, {\r\n\t\t\t\t\ttype: YaPay.ButtonType.Pay,\r\n\t\t\t\t\ttheme: this.getOption('buttonTheme') || YaPay.ButtonTheme.Black,\r\n\t\t\t\t\twidth: this.getOption('buttonWidth') || YaPay.ButtonWidth.Auto,\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.catch( (err) => {\r\n\t\t\t\tthis.order.showError('yapayPayment','payment not created', err);\r\n\t\t\t});\r\n\t}\r\n\r\n\tauthorize(event) {\r\n\t\tlet data = {\r\n\t\t\torderId: event.orderId,\r\n\t\t\thash: event.metadata,\r\n\t\t\tsuccessUrl: this.getOption('successUrl'),\r\n\t\t};\r\n\r\n\t\treturn this.order.query(this.getOption('restUrl') + 'authorize', data);\r\n\t}\r\n}","import Proxy from \"./proxy\";\r\n\r\nexport default class SiteProxy extends Proxy {\r\n\r\n\tgetPaymentData(data) {\r\n\t\treturn {\r\n\t\t\tenv: this.getOption('env'),\r\n\t\t\tversion: 2,\r\n\t\t\tcountryCode: YaPay.CountryCode.Ru,\r\n\t\t\tcurrencyCode: YaPay.CurrencyCode.Rub,\r\n\t\t\tmerchant: {\r\n\t\t\t\tid: this.getOption('merchantId'),\r\n\t\t\t\tname: this.getOption('merchantName')\r\n\t\t\t},\r\n\t\t\torder: {\r\n\t\t\t\tid: data.id,\r\n\t\t\t\ttotal: { amount: data.total },\r\n\t\t\t\titems: data.items\r\n\t\t\t},\r\n\t\t\tpaymentMethods: [\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: YaPay.PaymentMethodType.Card,\r\n\t\t\t\t\tgateway: this.getOption('gateway'),\r\n\t\t\t\t\tgatewayMerchantId: this.getOption('gatewayMerchantId'),\r\n\t\t\t\t\tallowedAuthMethods: [YaPay.AllowedAuthMethod.PanOnly],\r\n\t\t\t\t\tallowedCardNetworks: [\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.UnionPay,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Uzcard,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Discover,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.AmericanExpress,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Visa,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Mastercard,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Mir,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Maestro,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.VisaElectron\r\n\t\t\t\t\t]\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t}\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\t\tYaPay.createPayment(paymentData, { agent: { name: \"CMS-Bitrix\", version: \"1.0\" } })\r\n\t\t\t.then( (payment) => {\r\n\t\t\t\tlet button = payment.createButton({\r\n\t\t\t\t\ttype: YaPay.ButtonType.Pay,\r\n\t\t\t\t\ttheme: this.getOption('buttonTheme') || YaPay.ButtonTheme.Black,\r\n\t\t\t\t\twidth: this.getOption('buttonWidth') || YaPay.ButtonWidth.Auto,\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.order.removeLoader();\r\n\t\t\t\tbutton.mount(node);\r\n\r\n\t\t\t\tbutton.on(YaPay.ButtonEventType.Click, function onPaymentButtonClick() {\r\n\t\t\t\t\tpayment.checkout();\r\n\t\t\t\t});\r\n\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Process, (event) => {\r\n\r\n\t\t\t\t\tthis.notify(payment, event).then((result) => {});\r\n\r\n\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Success);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Error, function onPaymentError(event) {\r\n\t\t\t\t\tconsole.log({'errors': event});\r\n\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Error);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Abort, function onPaymentAbort(event) {});\r\n\t\t\t})\r\n\t\t\t.catch(function (err) {\r\n\t\t\t\tconsole.log({'payment not create': err});\r\n\t\t\t});\r\n\t}\r\n\r\n\tnotify(payment, yandexPayData) {\r\n\t\treturn fetch(this.getOption('notifyUrl'), {\r\n\t\t\tmethod: 'POST',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t},\r\n\t\t\tbody: JSON.stringify({\r\n\t\t\t\tservice: this.getOption('requestSign'),\r\n\t\t\t\taccept: 'json',\r\n\t\t\t\tyandexData: yandexPayData,\r\n\t\t\t\texternalId: this.getOption('externalId'),\r\n\t\t\t\tpaySystemId: this.getOption('paySystemId')\r\n\t\t\t})\r\n\t\t})\r\n\t\t\t.then(response => response.json())\r\n\t\t\t.then(result => {\r\n\t\t\t\tif (result.success === true) {\r\n\t\t\t\t\tthis.order.widget.go(result.state, result);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.order.widget.go('error', result);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(error => console.log(error) );\r\n\t}\r\n}","import Template from '../../utils/template';\r\nimport AbstractStep from '../abstractstep';\r\nimport RestProxy from './rest';\r\nimport SiteProxy from './site';\r\n\r\nexport default class AbstractPayment extends AbstractStep {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<div class=\"alert alert-success\" role=\"alert\"><strong>#MESSAGE#</strong></div>',\r\n\t\tloaderSelector: '.bx-yapay-skeleton-loading',\r\n\t}\r\n\r\n\trender(node, data) {\r\n\t\tthis.element = node;\r\n\t\tthis.proxy = this.getOption('isRest')\r\n\t\t\t? new RestProxy(this)\r\n\t\t\t: new SiteProxy(this);\r\n\r\n\t\tconst paymentData = this.getPaymentData(data);\r\n\r\n\t\tthis.createPayment(node, paymentData);\r\n\t}\r\n\r\n\tcompile(data) {\r\n\t\treturn Template.compile(this.options.template, data);\r\n\t}\r\n\r\n\tgetPaymentData(data) {\r\n\t\treturn this.proxy.getPaymentData(data);\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\t\tthis.proxy.createPayment(node, paymentData);\r\n\t}\r\n\r\n\tremoveLoader() {\r\n\t\tconst loader = this.element.querySelector(this.getOption('loaderSelector'));\r\n\r\n\t\tif (loader == null) { return; }\r\n\r\n\t\tloader.remove();\r\n\t}\r\n}","export default class Proxy {\r\n\r\n\tconstructor(cart) {\r\n\t\tthis.cart = cart;\r\n\t}\r\n\r\n\tgetOption(name) {\r\n\t\treturn this.cart.getOption(name);\r\n\t}\r\n\r\n\tbootstrap() {\r\n\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\r\n\t}\r\n\r\n\tgetPaymentData() {\r\n\r\n\t}\r\n\r\n\trestoreButton(node) {\r\n\r\n\t}\r\n\r\n\tmountButton(node, payment) {\r\n\r\n\t}\r\n}","import Proxy from \"./proxy\";\r\nimport {EventProxy} from \"../../utils/eventproxy\";\r\n\r\nexport default class RestProxy extends Proxy {\r\n\r\n\tbootstrap() {\r\n\t\tthis.getButtonData()\r\n\t\t\t.then((result) => {\r\n\t\t\t\tif (result.status === 'fail') { throw new Error(result.reason); }\r\n\t\t\t\tthis.combineOrderWithData(result.data);\r\n\t\t\t\tthis.createPayment(this.cart.element, this.cart.paymentData);\r\n\t\t\t})\r\n\t\t\t.catch((error) => {\r\n\t\t\t\tthis.cart.removeLoader();\r\n\t\t\t});\r\n\t}\r\n\r\n\tgetButtonData() {\r\n\r\n\t\tlet data = {\r\n\t\t\tproductId: this.getOption('productId'),\r\n\t\t\tmode: this.getOption('mode'),\r\n\t\t\tcurrencyCode: this.getOption('currencyCode'),\r\n\t\t\tsetupId: this.getOption('setupId'),\r\n\t\t};\r\n\r\n\t\treturn this.cart.query(this.getOption('restUrl') + 'button/data', data);\r\n\t}\r\n\r\n\tgetPaymentData() {\r\n\t\treturn {\r\n\t\t\tenv: this.getOption('env'),\r\n\t\t\tversion: 3,\r\n\t\t\tmerchantId: this.getOption('merchantId'),\r\n\t\t\tcart: { externalId: \"checkout-b2b-test-order-id\", },\r\n\t\t\tcurrencyCode: this.getOption('currencyCode'),\r\n\t\t}\r\n\t}\r\n\r\n\tonPaymentSuccess(event) {\r\n\t\tthis.authorize(event)\r\n\t\t\t.then((result) => {\r\n\t\t\t\tif (result.status === 'success') {\r\n\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\twindow.location.href = result.data.redirect;\r\n\t\t\t\t\t}, 1000);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.cart.showError('authorize', result.reasonCode, result.reason);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\tEventProxy.make().fire('bxYapayPaymentSuccess', event);\r\n\t}\r\n\r\n\tonPaymentAbort(event) {\r\n\t\tEventProxy.make().fire('bxYapayPaymentAbort', event);\r\n\t}\r\n\r\n\tonPaymentError(event) {\r\n\t\tEventProxy.make().fire('bxYapayPaymentError', event);\r\n\t\tthis.cart.showError('yapayPayment','payment not created', event.reason);\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\t\tif (this._mounted != null) { return; }\r\n\r\n\t\tthis._mounted = false;\r\n\r\n\t\tYaPay.createSession(paymentData, {\r\n\t\t\tonSuccess: this.onPaymentSuccess.bind(this),\r\n\t\t\tonAbort: this.onPaymentAbort.bind(this),\r\n\t\t\tonError: this.onPaymentError.bind(this),\r\n\t\t\tagent: { name: \"CMS-Bitrix\", version: \"1.0\" }\r\n\t\t})\r\n\t\t\t.then((paymentSession) => {\r\n\t\t\t\tthis._mounted = true;\r\n\t\t\t\tthis.cart.removeLoader();\r\n\t\t\t\tthis.mountButton(paymentSession);\r\n\t\t\t})\r\n\t\t\t.catch((err) => {\r\n\t\t\t\tthis._mounted = null;\r\n\t\t\t\tnode.remove();\r\n\t\t\t\tthis.cart.showError('yapayPayment', 'payment not created', err);\r\n\t\t\t});\r\n\t}\r\n\r\n\tauthorize(event) {\r\n\t\tlet data = {\r\n\t\t\torderId: event.orderId,\r\n\t\t\thash: event.metadata,\r\n\t\t\tsuccessUrl: this.getOption('successUrl'),\r\n\t\t};\r\n\r\n\t\treturn this.cart.query(this.getOption('restUrl') + 'authorize', data);\r\n\t}\r\n\r\n\tbindDebug(payment) {\r\n\t\tfor (const key in YaPay.CheckoutEventType) {\r\n\t\t\tif (!YaPay.CheckoutEventType.hasOwnProperty(key)) { continue; }\r\n\r\n\t\t\tpayment.on(YaPay.CheckoutEventType[key], function() {\r\n\t\t\t\tconsole.log(arguments);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tmountButton(payment) {\r\n\t\tthis.cart.initialContent = null;\r\n\t\tthis.payment = payment;\r\n\t\tthis.cart.display.mount(this.cart.element, payment, YaPay.ButtonType.Checkout);\r\n\r\n\t\tEventProxy.make().fire('bxYapayMountButton');\r\n\t}\r\n\r\n\trestoreButton(node) {\r\n\t\tif (this.payment == null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.cart.display.mount(node, this.payment, YaPay.ButtonType.Checkout);\r\n\t\tEventProxy.make().fire('bxYapayRestoreButton');\r\n\t}\r\n\r\n\tcombineOrderWithData(data) {\r\n\t\tconst { cart } = this.cart.paymentData;\r\n\r\n\t\tlet exampleData = {\r\n\t\t\tcart: {\r\n\t\t\t\t...cart,\r\n\t\t\t\titems: data.items,\r\n\t\t\t\ttotal: {\r\n\t\t\t\t\tamount: data.total.amount,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tmetadata: data.metadata\r\n\t\t};\r\n\r\n\t\tObject.assign(this.cart.paymentData, exampleData);\r\n\t}\r\n\r\n\tchangeOffer(newProductId) {\r\n\t\tlet productId = this.getOption('productId');\r\n\r\n\t\tif (productId !== newProductId) { // todo in items\r\n\t\t\tthis.cart.widget.setOptions({productId: newProductId});\r\n\t\t\tthis.update();\r\n\t\t}\r\n\t}\r\n\r\n\tchangeBasket() {\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tsetupPaymentCash() {\r\n\r\n\t}\r\n\r\n\tupdate() {\r\n\t\tthis.payment.update(async () => {\r\n\t\t\tconst result = await this.getButtonData()\r\n\t\t\t\t.then(result => result)\r\n\t\t\t\t.catch((error) => {\r\n\t\t\t\t\tthis.cart.showError('getButtonData','get not button data', error);\r\n\t\t\t\t});\r\n\r\n\t\t\tif (result.status === 'fail') { throw new Error(result.reason); }\r\n\r\n\t\t\treturn {\r\n\t\t\t\tcart: {\r\n\t\t\t\t\titems: result.data.items\r\n\t\t\t\t},\r\n\t\t\t\ttotal: {\r\n\t\t\t\t\tamount: result.data.total.amount,\r\n\t\t\t\t},\r\n\t\t\t\tmetadata: result.data.metadata,\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}","import Proxy from \"./proxy\";\r\n\r\nexport default class SiteProxy extends Proxy {\r\n\r\n\tbootstrap() {\r\n\t\tthis.reflow();\r\n\t}\r\n\r\n\tgetPaymentData() {\r\n\t\treturn {\r\n\t\t\tenv: this.getOption('env'),\r\n\t\t\tversion: 2,\r\n\t\t\tcountryCode: YaPay.CountryCode.Ru,\r\n\t\t\tcurrencyCode: YaPay.CurrencyCode.Rub,\r\n\t\t\tmerchant: {\r\n\t\t\t\tid: this.getOption('merchantId'),\r\n\t\t\t\tname: this.getOption('merchantName'),\r\n\t\t\t\turl: this.getOption('siteUrl')\r\n\t\t\t},\r\n\t\t\torder: { id: '0' },\r\n\t\t\tpaymentMethods: [\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: YaPay.PaymentMethodType.Card,\r\n\t\t\t\t\tgateway: this.getOption('gateway'),\r\n\t\t\t\t\tgatewayMerchantId: this.getOption('gatewayMerchantId'),\r\n\t\t\t\t\tallowedAuthMethods: [YaPay.AllowedAuthMethod.PanOnly],\r\n\t\t\t\t\tallowedCardNetworks: [\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.UnionPay,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Uzcard,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Discover,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.AmericanExpress,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Visa,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Mastercard,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Mir,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Maestro,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.VisaElectron\r\n\t\t\t\t\t]\r\n\t\t\t\t}\r\n\t\t\t],\r\n\r\n\t\t\trequiredFields: {\r\n\r\n\t\t\t\tbillingContact: {\r\n\t\t\t\t\temail: this.getOption('useEmail') || false\r\n\t\t\t\t},\r\n\r\n\t\t\t\tshippingContact: {\r\n\t\t\t\t\tname: this.getOption('useName') || false,\r\n\t\t\t\t\temail: this.getOption('useEmail') || false,\r\n\t\t\t\t\tphone: this.getOption('usePhone') || false,\r\n\t\t\t\t},\r\n\r\n\t\t\t\tshippingTypes: {\r\n\t\t\t\t\tdirect: true,\r\n\t\t\t\t\tpickup: true,\r\n\t\t\t\t},\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetProducts(){\r\n\r\n\t\tlet data = {\r\n\t\t\tyapayAction: 'getProducts',\r\n\t\t\tproductId: this.getOption('productId'),\r\n\t\t\tmode: this.getOption('mode'),\r\n\t\t\tsetupId: this.getOption('setupId')\r\n\t\t};\r\n\r\n\t\treturn this.cart.query(this.getOption('purchaseUrl'), data);\r\n\t}\r\n\r\n\tgetShippingOptions(address) {\r\n\r\n\t\tlet data = {\r\n\t\t\taddress: address,\r\n\t\t\tyapayAction: 'deliveryOptions',\r\n\t\t\titems: this.cart.paymentData.order.items,\r\n\t\t\tsetupId: this.getOption('setupId'),\r\n\t\t\tpaySystemId: this.getOption('paySystemId'),\r\n\t\t};\r\n\r\n\t\treturn this.cart.query(this.getOption('purchaseUrl'), data);\r\n\t}\r\n\r\n\tgetPickupOptions(bounds) {\r\n\r\n\t\tlet data = {\r\n\t\t\tbounds: bounds,\r\n\t\t\tyapayAction: 'pickupOptions',\r\n\t\t\titems: this.cart.paymentData.order.items,\r\n\t\t\tsetupId: this.getOption('setupId'),\r\n\t\t\tpaySystemId: this.getOption('paySystemId'),\r\n\t\t};\r\n\r\n\t\treturn this.cart.query(this.getOption('purchaseUrl'), data);\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\t\tif (this._mounted != null) { return; }\r\n\r\n\t\tthis._mounted = false;\r\n\r\n\t\tYaPay.createPayment(paymentData, { agent: { name: \"CMS-Bitrix\", version: \"1.0\" } })\r\n\t\t\t.then((payment) => {\r\n\t\t\t\tthis._mounted = true;\r\n\r\n\t\t\t\tthis.cart.removeLoader();\r\n\t\t\t\tthis.mountButton(node, payment);\r\n\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Process, (event) => {\r\n\r\n\t\t\t\t\tthis.orderAccept(event).then((result) => {\r\n\r\n\t\t\t\t\t\tif (result.error) { throw new Error(result.error.message, result.error.code); }\r\n\r\n\t\t\t\t\t\tif(!this.isPaymentTypeCash(event)) {\r\n\t\t\t\t\t\t\tthis.notify(result, event).then(result => {\r\n\t\t\t\t\t\t\t\tif (result.success === true) {\r\n\t\t\t\t\t\t\t\t\tthis.cart.widget.go(result.state, result);\r\n\t\t\t\t\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Success);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.cart.widget.go('error', result);\r\n\t\t\t\t\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Error);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Success);\r\n\r\n\t\t\t\t\t\t\t\tif (result.redirect != null) {\r\n\t\t\t\t\t\t\t\t\twindow.location.href = result.redirect;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.catch((error) => {\r\n\t\t\t\t\t\t\tthis.cart.showError('yapayProcess', '', error); // todo test it\r\n\t\t\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Error);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Error, (event) => {\r\n\t\t\t\t\tthis.cart.showError('yapayError', 'service temporary unavailable');\r\n\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Error);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Change, (event) => {\r\n\t\t\t\t\t// если выбрали адрес доставки, отдаем скисок доставок\r\n\t\t\t\t\tif (event.shippingAddress) {\r\n\t\t\t\t\t\tthis.getShippingOptions(event.shippingAddress).then((result) => {\r\n\t\t\t\t\t\t\tpayment.update({shippingOptions: result})\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// добавляем выбранную доставку\r\n\t\t\t\t\tif (event.shippingOption){\r\n\t\t\t\t\t\tpayment.update({\r\n\t\t\t\t\t\t\torder: this.combineOrderWithDirectShipping(event.shippingOption),\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// если выбрали ПВЗ, отдаем список ПВЗ\r\n\t\t\t\t\tif (event.pickupBounds) {\r\n\t\t\t\t\t\tthis.getPickupOptions(event.pickupBounds).then((result) => {\r\n\t\t\t\t\t\t\tpayment.update({pickupPoints: result})\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (event.pickupInfo) {\r\n\t\t\t\t\t\tthis.getPickupDetail(event.pickupInfo.pickupPointId).then((result) => {\r\n\t\t\t\t\t\t\tpayment.update({\r\n\t\t\t\t\t\t\t\tpickupPoint: result\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// добавляем выбранный ПВЗ\r\n\t\t\t\t\tif (event.pickupPoint) {\r\n\t\t\t\t\t\tpayment.update({\r\n\t\t\t\t\t\t\torder: this.combineOrderWithPickupShipping(event.pickupPoint),\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.catch((err) => {\r\n\t\t\t\tthis._mounted = null;\r\n\t\t\t\tthis.cart.showError('yapayPayment','payment not created', err);\r\n\t\t\t});\r\n\t}\r\n\r\n\tmountButton(node, payment) {\r\n\t\tthis.cart.initialContent = null;\r\n\r\n\t\tconst theme = this.cart.display.getOption('VARIANT_BUTTON') || YaPay.ButtonTheme.Black;\r\n\t\tconst width = this.cart.display.getOption('WIDTH_BUTTON') || YaPay.ButtonWidth.Auto;\r\n\r\n\t\tthis.paymentButton = payment.createButton({\r\n\t\t\ttype: YaPay.ButtonType.Checkout,\r\n\t\t\ttheme: theme,\r\n\t\t\twidth: width,\r\n\t\t});\r\n\r\n\t\tthis.paymentButton.mount(this.cart.element);\r\n\r\n\t\tthis.paymentButton.on(YaPay.ButtonEventType.Click, () => {\r\n\t\t\tpayment.checkout();\r\n\t\t});\r\n\t}\r\n\r\n\tgetPickupDetail(pickupId) {\r\n\t\tlet data = {\r\n\t\t\tpickupId: pickupId,\r\n\t\t\tyapayAction: 'pickupDetail',\r\n\t\t\titems: this.cart.paymentData.order.items,\r\n\t\t\tsetupId: this.getOption('setupId'),\r\n\t\t\tpaySystemId: this.getOption('paySystemId'),\r\n\t\t};\r\n\r\n\t\treturn this.cart.query(this.getOption('purchaseUrl'), data);\r\n\t}\r\n\r\n\torderAccept(event) {\r\n\r\n\t\tlet deliveryType = event.shippingMethodInfo.shippingOption ? 'delivery' : 'pickup';\r\n\t\tlet delivery;\r\n\r\n\t\tif (deliveryType === 'pickup') {\r\n\t\t\tdelivery = {\r\n\t\t\t\taddress: event.shippingMethodInfo.pickupPoint.address,\r\n\t\t\t\tpickup: event.shippingMethodInfo.pickupPoint,\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdelivery = {\r\n\t\t\t\taddress: event.shippingMethodInfo.shippingAddress,\r\n\t\t\t\tdelivery: event.shippingMethodInfo.shippingOption,\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet orderData = {\r\n\t\t\tsetupId: this.getOption('setupId'),\r\n\t\t\titems: this.cart.paymentData.order.items,\r\n\t\t\tpayment: event.paymentMethodInfo,\r\n\t\t\tcontact: event.shippingContact,\r\n\t\t\tyapayAction: 'orderAccept',\r\n\t\t\tdeliveryType: deliveryType,\r\n\t\t\tpaySystemId: this.isPaymentTypeCash(event) ? this.getOption('paymentCash') : this.getOption('paySystemId'),\r\n\t\t\torderAmount: event.orderAmount\r\n\t\t};\r\n\r\n\t\tlet data = {...orderData, ...delivery };\r\n\r\n\t\treturn this.cart.query(this.getOption('purchaseUrl'), data);\r\n\t}\r\n\r\n\tisPaymentTypeCash(event) {\r\n\t\treturn (event.paymentMethodInfo.type === 'CASH');\r\n\t}\r\n\r\n\tnotify(payment, yandexPayData) {\r\n\r\n\t\tlet data = {\r\n\t\t\tservice: this.getOption('requestSign'),\r\n\t\t\taccept: 'json',\r\n\t\t\tyandexData: yandexPayData,\r\n\t\t\texternalId: payment.externalId,\r\n\t\t\tpaySystemId: payment.paySystemId\r\n\t\t};\r\n\r\n\t\treturn this.cart.query(this.getOption('notifyUrl'), data);\r\n\t}\r\n\r\n\tchangeOffer(newProductId) {\r\n\t\tlet productId = this.getOption('productId');\r\n\r\n\t\tif (productId !== newProductId) { // todo in items\r\n\t\t\tthis.cart.widget.setOptions({productId: newProductId});\r\n\t\t\tthis.reflow();\r\n\t\t}\r\n\t}\r\n\r\n\tchangeBasket() {\r\n\t\tthis.reflow();\r\n\t}\r\n\r\n\treflow() {\r\n\t\tthis.getProducts()\r\n\t\t\t.then((result) => {\r\n\t\t\t\tif (result.error) { throw new Error(result.error.message); }\r\n\r\n\t\t\t\tthis.combineOrderWithProducts(result);\r\n\t\t\t\tthis.createPayment(this.cart.element, this.cart.paymentData);\r\n\t\t\t})\r\n\t\t\t.catch((error) => {\r\n\t\t\t\tthis.cart.removeLoader();\r\n\t\t\t\t// todo this.showError();\r\n\t\t\t});\r\n\t}\r\n\r\n\tcombineOrderWithPickupShipping(pickupOption) {\r\n\t\tconst { order } = this.cart.paymentData;\r\n\r\n\t\treturn {\r\n\t\t\t...order,\r\n\t\t\titems: [\r\n\t\t\t\t...order.items,\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: 'SHIPPING',\r\n\t\t\t\t\tlabel: pickupOption.label,\r\n\t\t\t\t\tamount: pickupOption.amount,\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\ttotal: {\r\n\t\t\t\t...order.total,\r\n\t\t\t\tamount: this.cart.amountSum(order.total.amount, pickupOption.amount),\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n\r\n\tcombineOrderWithDirectShipping(shippingOption) {\r\n\t\tconst { order } = this.cart.paymentData;\r\n\r\n\t\treturn {\r\n\t\t\t...order,\r\n\t\t\titems: [\r\n\t\t\t\t...order.items,\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: 'SHIPPING',\r\n\t\t\t\t\tlabel: shippingOption.label,\r\n\t\t\t\t\tamount: shippingOption.amount,\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\ttotal: {\r\n\t\t\t\t...order.total,\r\n\t\t\t\tamount: this.cart.amountSum(order.total.amount, shippingOption.amount),\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n\r\n\tcombineOrderWithProducts(products) {\r\n\t\tconst { order } = this.cart.paymentData;\r\n\r\n\t\tlet exampleOrder = {\r\n\t\t\t...order,\r\n\t\t\titems: products.items,\r\n\t\t\ttotal: {\r\n\t\t\t\tamount: products.amount,\r\n\t\t\t},\r\n\t\t};\r\n\r\n\t\tObject.assign(this.cart.paymentData.order, exampleOrder);\r\n\t}\r\n\r\n\trestoreButton(node) {\r\n\t\tif (this.paymentButton == null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.paymentButton.mount(node);\r\n\t}\r\n\r\n\tsetupPaymentCash(){\r\n\t\t// Указываем возможность оплаты заказа при получении\r\n\t\tif (this.getOption('paymentCash') == null) { return; }\r\n\r\n\t\tthis.cart.paymentData.paymentMethods.push({\r\n\t\t\ttype: YaPay.PaymentMethodType.Cash,\r\n\t\t});\r\n\t}\r\n}","import Template from '../../utils/template';\r\nimport AbstractStep from '../abstractstep';\r\nimport { ready } from \"../../utils/ready\";\r\nimport RestProxy from \"./rest\";\r\nimport SiteProxy from \"./site\";\r\nimport Display from \"../../ui/display/factory\";\r\nimport {EventProxy} from \"../../utils/eventproxy\";\r\n\r\nexport default class AbstractCart extends AbstractStep {\r\n\r\n\tstatic defaults = {\r\n\t\tloaderSelector: '.bx-yapay-skeleton-loading',\r\n\t}\r\n\r\n\trender(node, data) {\r\n\t\tthis.isBootstrap = false;\r\n\t\tthis.element = node;\r\n\t\tthis.paymentButton = null;\r\n\t\tthis.proxy = this.getOption('isRest')\r\n\t\t\t? new RestProxy(this)\r\n\t\t\t: new SiteProxy(this);\r\n\r\n\t\tthis.paymentData = this.getPaymentData();\r\n\t\tthis.display = this.getDisplay();\r\n\t\tthis.initialContent = this.element.innerHTML;\r\n\r\n\t\tthis.bootSolution();\r\n\t\tthis.bootLocal();\r\n\t\tthis.setupPaymentCash();\r\n\t\tthis.delayBootstrap();\r\n\t}\r\n\r\n\tcompile(data) {\r\n\t\treturn Template.compile(this.options.template, data);\r\n\t}\r\n\r\n\trestore(node) {\r\n\t\tif (this.initialContent != null) {\r\n\t\t\tnode.innerHTML = this.initialContent;\r\n\t\t}\r\n\r\n\t\tthis.element = node;\r\n\t\tthis.proxy.restoreButton(node);\r\n\t}\r\n\r\n\tbootstrap() {\r\n\t\tthis.isBootstrap = true;\r\n\t\tthis.proxy.bootstrap();\r\n\t}\r\n\r\n\tbootSolution() {\r\n\t\tconst solution = this.widget.getSolution();\r\n\r\n\t\tif (solution == null) { return; }\r\n\r\n\t\tsolution.bootCart(this);\r\n\t}\r\n\r\n\tbootLocal() {\r\n\t\tEventProxy.make().fire('bxYapayCartInit', {\r\n\t\t\tcart: this,\r\n\t\t});\r\n\t}\r\n\r\n\tdelayChangeBasket() {\r\n\t\tthis.delay('changeBasket');\r\n\t}\r\n\r\n\tdelayChangeOffer(productId) {\r\n\t\tthis.delay('changeOffer', [productId]);\r\n\t}\r\n\r\n\tdelayBootstrap() {\r\n\t\tready(() => {\r\n\t\t\tthis.delay('bootstrap');\r\n\t\t});\r\n\t}\r\n\r\n\tchangeBasket() {\r\n\t\tif (!this.isBootstrap) { return; }\r\n\t\tthis.proxy?.changeBasket();\r\n\t}\r\n\r\n\tchangeOffer(newProductId) {\r\n\t\tif (this.isBootstrap) {\r\n\t\t\tthis.proxy?.changeOffer(newProductId);\r\n\t\t} else {\r\n\t\t\tthis.widget.setOptions({productId: newProductId});\r\n\t\t}\r\n\t}\r\n\r\n\tsetupPaymentCash(){\r\n\t\tthis.proxy?.setupPaymentCash();\r\n\t}\r\n\r\n\tgetPaymentData() {\r\n\t\treturn this.proxy.getPaymentData();\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\t\tthis.proxy.createPayment(node, paymentData);\r\n\t}\r\n\r\n\tgetDisplay() {\r\n\t\tconst type = this.getOption('displayType');\r\n\t\tconst options = this.getOption('displayParameters');\r\n\t\treturn Display.make(type, this, options);\r\n\t}\r\n\r\n\tamountSum(amountA, amountB) {\r\n\t\treturn (Number(amountA) + Number(amountB)).toFixed(2);\r\n\t}\r\n\r\n\tshowError(type, message, err = null) {\r\n\t\tlet notify = type + ' - ' + message;\r\n\r\n\t\tif (err) {\r\n\t\t\tnotify += ' ' + err;\r\n\t\t}\r\n\r\n\t\talert(notify);\r\n\t}\r\n\r\n\tremoveLoader() {\r\n\t\tconst loader = this.element.querySelector(this.getOption('loaderSelector'));\r\n\r\n\t\tloader?.remove();\r\n\t\tthis.initialContent = null;\r\n\t}\r\n}","export function ready(callback) {\r\n\tif (document.readyState === 'complete' || document.readyState === 'interactive') {\r\n\t\tsetTimeout(callback, 1);\r\n\t} else {\r\n\t\tdocument.addEventListener('DOMContentLoaded', callback);\r\n\t}\r\n}","import StepFactory from './step/factory';\r\nimport SolutionRegistry from \"./solutionregistry\";\r\n\r\nexport default class Widget {\r\n\r\n\tstatic defaults = {}\r\n\r\n\tdefaults;\r\n\toptions;\r\n\tel;\r\n\tstep;\r\n\r\n\t/**\r\n\t * @param {Object<Element>} element\r\n\t * @param {Object} options\r\n\t */\r\n\tconstructor(element, options = {}) {\r\n\t\tthis.defaults = Object.assign({}, this.constructor.defaults);\r\n\t\tthis.options = {};\r\n\t\tthis.el = element;\r\n\r\n\t\tthis.setOptions(options);\r\n\t\tthis.bootSolution();\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object} data\r\n\t */\r\n\tpayment(data) {\r\n\t\tthis.go('payment', data);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object} data\r\n\t */\r\n\tcart(data){\r\n\t\tthis.go('cart', data);\r\n\t}\r\n\r\n\trestore(element) {\r\n\t\tthis.el = element;\r\n\t\tthis.step?.restore(element);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} type\r\n\t * @param {Object} data\r\n\t */\r\n\tgo(type, data) {\r\n\t\tthis.step = this.makeStep(type);\r\n\t\tthis.step.render(this.el, data);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {String} type\r\n\t * @returns {AbstractCart|Finish|Step3ds|Payment|Failure}\r\n\t * @throws {Error}\r\n\t */\r\n\tmakeStep(type) {\r\n\t\tconst options = this.getOption(type) || {};\r\n\r\n\t\treturn StepFactory.make(type, this, options);\r\n\t}\r\n\r\n\tgetSolution() {\r\n\t\tconst name = this.getOption('solution');\r\n\t\tconst mode = this.getOption('mode');\r\n\r\n\t\treturn SolutionRegistry.getPage(name, mode);\r\n\t}\r\n\r\n\tbootSolution() {\r\n\t\tconst solution = this.getSolution();\r\n\r\n\t\tif (solution == null) { return; }\r\n\r\n\t\tsolution.bootWidget(this);\r\n\t}\r\n\r\n\textendDefaults(options) {\r\n\t\tthis.defaults = Object.assign(this.defaults, options);\r\n\t}\r\n\r\n\tsetOptions(options) {\r\n\t\tthis.options = Object.assign(this.options, options);\r\n\t}\r\n\r\n\tgetOption(name) {\r\n\t\treturn this.options[name] ?? this.defaults[name];\r\n\t}\r\n}\r\n","import Secure3d from './secure3d';\r\nimport Finish from './finish';\r\nimport Failure from './failure';\r\nimport Loader from './loader';\r\nimport AbstractPayment from './payment/abstractpayment';\r\nimport AbstractCart from './cart/abstractcart';\r\n\r\nexport default class Factory {\r\n\r\n\t/**\r\n\t * @param {string} type\r\n\t * @param {Widget} widget\r\n\t * @param {Object} options\r\n\t * @returns {AbstractCart|Finish|Step3ds|AbstractPayment|Failure}\r\n\t * @throws {Error}\r\n\t */\r\n\tstatic make(type, widget, options = {}) {\r\n\t\tif (type === '3ds') {\r\n\t\t\treturn new Secure3d(widget, options);\r\n\t\t} else if (type === 'finished') {\r\n\t\t\treturn new Finish(widget, options);\r\n\t\t} else if (type === 'error') {\r\n\t\t\treturn new Failure(widget, options);\r\n\t\t} else if (type === 'payment') {\r\n\t\t\treturn new AbstractPayment(widget, options);\r\n\t\t} else if (type === 'cart') {\r\n\t\t\treturn new AbstractCart(widget, options);\r\n\t\t} else if (type === 'loader') {\r\n\t\t\treturn new Loader(widget, options);\r\n\t\t}\r\n\r\n\t\tthrow new Error('unknown step ' + type);\r\n\t}\r\n\r\n}"],"names":["SolutionRegistry","name","factory","window","_window","BX","_window$BX","YandexPay","_window$BX$YandexPay","Solution","_window$BX$YandexPay$","_window$BX$YandexPay$2","console","warn","mode","key","this","pages","createPage","getFactory","create","MutationSkeleton","constructor","element","options","el","Object","assign","defaults","destroy","check","MutationLoop","loop","loopTimeout","loopCancel","clearTimeout","_loopTimeout","setTimeout","timeout","MutationObserver","listener","mutations","mutation","removedNodes","removedNode","HTMLElement","contains","runCheck","observe","disconnect","anchor","getAnchor","observer","childList","subtree","delay","_checkTimeout","document","body","matched","selector","split","trim","closest","EventProxy","config","callbackMap","on","callback","matchEvent","onBxEvent","onJQueryEvent","onPlainEvent","off","offBxEvent","offJQueryEvent","offPlainEvent","fire","data","fireBxEvent","fireJQueryEvent","firePlainEvent","type","addCustomEvent","removeCustomEvent","onCustomEvent","jQuery","selfConfig","typeConfig","canProxyCallback","originalCallback","evt","proxyData","originalEvent","_evt$originalEvent","detail","pushCallbackVariation","popCallbackVariation","hasPlainAndJQueryCollision","triggerHandler","CustomEvent","addEventListener","removeEventListener","dispatchEvent","proxy","WeakMap","set","map","result","get","delete","Subscriber","eventProxy","bind","unbind","bindOn","bindEvent","unbindOff","unbindEvent","event","Array","isArray","forEach","one","Composite","onFrameReady","boot","parent","parentElement","start","nodes","child","children","id","test","node","push","NodePreserver","found","restore","install","uninstall","installMutation","installSubscriber","installComposite","uninstallMutation","uninstallSubscriber","uninstallComposite","isEnabled","make","driverOptions","subscriber","composite","option","overrides","Template","template","vars","replaceKey","replaceValue","hasOwnProperty","toUpperCase","replace","indexOf","html","context","createElement","innerHTML","firstElementChild","Sdkloader","instance","load","_loadPromise","Promise","resolve","reject","testGlobal","script","getElementsByTagName","async","src","onload","loopGlobal","onerror","remove","Error","parentNode","insertBefore","YaPay","createPayment","Intersection","wait","IntersectionObserver","entries","entry","isIntersecting","target","unobserve","Display","style","mount","payment","getOption","Button","collectHeight","collectBorder","collectWidth","Utils","compile","theme","ButtonTheme","Black","width","ButtonWidth","Max","mountButton","height","border","styleHeight","styleBorder","styleWidth","Widget","mountWidget","widgetType","WidgetType","Compact","Factory","waitCount","setOptions","bootSolution","bootLocal","inject","position","then","waitElement","checkElement","renderElement","widget","insertLoader","intersection","preserve","getInstance","containerSelector","querySelector","containsSiblingElement","next","_anchor$parentElement","matches","nextElementSibling","preserver","preserveOptions","preserveOption","go","label","waitElementLoop","findElement","elementList","variant","searchBySelector","searchById","searchByClassName","length","reduceVisible","part","partSanitized","isCssSelector","partSelector","matchMedia","testSelectorMedia","collection","querySelectorAll","e","getElementById","getElementsByClassName","testVisible","offsetWidth","offsetHeight","getClientRects","partials","exec","divider","getDivider","display","getDisplay","toLowerCase","solution","_this$getOption2","elements","toElements","reverse","insertAdjacentElement","getPage","bootFactory","extendDefaults","useDivider","loaderSelector","waitLimit","waitTimeout","AbstractStep","delayTimeouts","render","query","url","fetch","method","headers","JSON","stringify","response","json","getTemplate","optionKey","optionFirstSymbol","substr","getNode","getElement","getElementSelector","clearDelay","args","showError","message","err","notify","alert","Base","setWidget","Form","autosubmit","makeInputs","value","params","keys","termUrl","makeTermUrl","backUrl","location","href","encodeURIComponent","submit","Iframe","insertIframe","iframe","contentIframe","contentWindow","contentDocument","open","write","close","IframeRbs","renderIframe","service","accept","secure","externalId","paySystemId","success","state","catch","error","log","action","Step3ds","view","makeView","SecureForm","SecureIframe","SecureRbs","Finish","Failure","Loader","toElement","restoreElement","Proxy","order","paymentData","getPaymentData","RestProxy","env","version","currencyCode","CurrencyCode","Rub","merchantId","orderId","cart","items","total","amount","metadata","onPaymentSuccess","authorize","status","redirect","reasonCode","reason","onPaymentAbort","onPaymentError","createSession","onSuccess","onAbort","onError","agent","paymentSession","removeLoader","ButtonType","Pay","Auto","hash","successUrl","SiteProxy","countryCode","CountryCode","Ru","merchant","paymentMethods","PaymentMethodType","Card","gateway","gatewayMerchantId","allowedAuthMethods","AllowedAuthMethod","PanOnly","allowedCardNetworks","AllowedCardNetwork","UnionPay","Uzcard","Discover","AmericanExpress","Visa","Mastercard","Mir","Maestro","VisaElectron","button","createButton","ButtonEventType","Click","checkout","PaymentEventType","Process","complete","CompleteReason","Success","Abort","yandexPayData","yandexData","AbstractPayment","loader","bootstrap","restoreButton","getButtonData","combineOrderWithData","productId","setupId","_mounted","bindDebug","CheckoutEventType","arguments","initialContent","Checkout","exampleData","changeOffer","newProductId","update","changeBasket","setupPaymentCash","reflow","requiredFields","billingContact","email","shippingContact","phone","shippingTypes","direct","pickup","getProducts","yapayAction","getShippingOptions","address","getPickupOptions","bounds","orderAccept","code","isPaymentTypeCash","Change","shippingAddress","shippingOptions","shippingOption","combineOrderWithDirectShipping","pickupBounds","pickupPoints","pickupInfo","getPickupDetail","pickupPointId","pickupPoint","combineOrderWithPickupShipping","paymentButton","pickupId","delivery","deliveryType","shippingMethodInfo","paymentMethodInfo","contact","orderAmount","combineOrderWithProducts","pickupOption","amountSum","products","exampleOrder","Cash","AbstractCart","isBootstrap","delayBootstrap","getSolution","bootCart","delayChangeBasket","delayChangeOffer","readyState","amountA","amountB","Number","toFixed","step","makeStep","Secure3d","bootWidget"],"mappings":"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"}