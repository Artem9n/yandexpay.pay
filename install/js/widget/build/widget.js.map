{"version":3,"file":"widget.js","sources":["../ui/nodepreserver/mutationskeleton.js","../ui/nodepreserver/mutationloop.js","../ui/nodepreserver/mutationobserver.js","../utils/eventproxy.js","../ui/nodepreserver/subscriber.js","../ui/nodepreserver/composite.js","../ui/nodepreserver.js","../ui/nodepreserver/mutationfactory.js","../utils/template.js","../sdkloader.js","../intersection.js","../ui/display/display.js","../ui/display/button.js","../ui/display/widget.js","../ui/display/factory.js","../concurrency.js","../factory.js","../solutionregistry.js","../step/abstractstep.js","../secure3d/base.js","../secure3d/form.js","../secure3d/iframe.js","../secure3d/iframerbs.js","../step/secure3d.js","../step/finish.js","../step/failure.js","../step/loader.js","../step/cart/proxy.js","../step/cart/rest.js","../step/cart/site.js","../step/cart/cart.js","../utils/ready.js","../step/payment/proxy.js","../step/payment/rest.js","../step/payment/site.js","../step/payment/payment.js","../widget.js","../step/factory.js","../index.js"],"sourcesContent":["export default class MutationSkeleton {\r\n\r\n\tstatic defaults = {\r\n\t\tcheck: null,\r\n\t}\r\n\r\n\tconstructor(element, options = {}) {\r\n\t\tthis.el = element;\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t}\r\n\r\n\tdestroy() {\r\n\r\n\t}\r\n\r\n}","import MutationSkeleton from \"./mutationskeleton\";\r\n\r\nexport default class MutationLoop extends MutationSkeleton {\r\n\r\n\tstatic defaults = Object.assign({}, MutationSkeleton.defaults, {\r\n\t\ttimeout: 1000,\r\n\t})\r\n\r\n\tconstructor(element, options = {}) {\r\n\t\tsuper(element, options);\r\n\t\tthis.loopTimeout();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.loopCancel();\r\n\t}\r\n\r\n\tloopTimeout() {\r\n\t\tclearTimeout(this._loopTimeout);\r\n\t\tthis._loopTimeout = setTimeout(this.loop, this.options.timeout);\r\n\t}\r\n\r\n\tloopCancel() {\r\n\t\tclearTimeout(this._loopTimeout);\r\n\t}\r\n\r\n\tloop = () => {\r\n\t\tthis.options.check() && this.loopTimeout();\r\n\t}\r\n\r\n}","import MutationSkeleton from \"./mutationskeleton\";\r\n\r\nexport default class MutationObserver extends MutationSkeleton {\r\n\r\n\tstatic defaults = Object.assign({}, MutationSkeleton.defaults, {\r\n\t\tanchor: null,\r\n\t\tdelay: 0,\r\n\t})\r\n\r\n\tconstructor(element, options = {}) {\r\n\t\tsuper(element, options);\r\n\t\tthis.observe();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.disconnect();\r\n\t}\r\n\r\n\tobserve() {\r\n\t\tconst anchor = this.getAnchor();\r\n\r\n\t\tif (anchor == null) {\r\n\t\t\tconsole?.warn('cant find anchor for node preserver');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.observer = new window.MutationObserver(this.listener);\r\n\t\tthis.observer.observe(anchor, {\r\n\t\t\tchildList: true,\r\n\t\t\tsubtree: true,\r\n\t\t});\r\n\t}\r\n\r\n\tdisconnect() {\r\n\t\tif (this.observer == null) { return; }\r\n\r\n\t\tthis.observer.disconnect();\r\n\t\tthis.observer = null;\r\n\t}\r\n\r\n\tlistener = (mutations) => {\r\n\t\tfor (const mutation of mutations) {\r\n\t\t\tif (mutation.removedNodes == null) { continue; }\r\n\r\n\t\t\tfor (const removedNode of mutation.removedNodes) {\r\n\t\t\t\tif (!(removedNode instanceof HTMLElement)) { continue; }\r\n\r\n\t\t\t\tif (removedNode === this.el || removedNode.contains(this.el)) {\r\n\t\t\t\t\tthis.runCheck();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\trunCheck() {\r\n\t\tconst delay = this.options.delay;\r\n\r\n\t\tif (delay == null) {\r\n\t\t\tthis.options.check();\r\n\t\t} else {\r\n\t\t\tclearTimeout(this._checkTimeout);\r\n\t\t\tthis._checkTimeout = setTimeout(() => { this.options.check(); }, delay);\r\n\t\t}\r\n\t}\r\n\r\n\tgetAnchor() {\r\n\t\tif (this.options.anchor == null) { return document.body; }\r\n\r\n\t\tlet matched = null;\r\n\r\n\t\tfor (let selector of this.options.anchor.split(',')) {\r\n\t\t\tselector = selector.trim();\r\n\r\n\t\t\tif (selector === '') { continue; }\r\n\r\n\t\t\tmatched = this.el.closest(selector);\r\n\r\n\t\t\tif (matched != null) { break; }\r\n\t\t}\r\n\r\n\t\treturn matched;\r\n\t}\r\n\r\n}","export class EventProxy {\r\n\r\n\tstatic make(config = {}) {\r\n\t\treturn new EventProxy(config);\r\n\t}\r\n\r\n\tconstructor(config = {}) {\r\n\t\tthis.config = config;\r\n\t\tthis.callbackMap = {};\r\n\t}\r\n\r\n\ton(name, callback) {\r\n\t\tthis.matchEvent('bx') && this.onBxEvent(name, callback);\r\n\t\tthis.matchEvent('jquery') && this.onJQueryEvent(name, callback);\r\n\t\tthis.matchEvent('plain') && this.onPlainEvent(name, callback);\r\n\t}\r\n\r\n\toff(name, callback) {\r\n\t\tthis.matchEvent('bx') && this.offBxEvent(name, callback);\r\n\t\tthis.matchEvent('jquery') && this.offJQueryEvent(name, callback);\r\n\t\tthis.matchEvent('plain') && this.offPlainEvent(name, callback);\r\n\t}\r\n\r\n\tfire(name, data = {}) {\r\n\t\tthis.matchEvent('bx') && this.fireBxEvent(name, data);\r\n\t\tthis.matchEvent('jquery') && this.fireJQueryEvent(name, data);\r\n\t\tthis.matchEvent('plain') && this.firePlainEvent(name, data);\r\n\t}\r\n\r\n\tmatchEvent(type) {\r\n\t\treturn this.config[type] != null ? !!this.config[type] : !this.config['strict'];\r\n\t}\r\n\r\n\tonBxEvent(name, callback) {\r\n\t\tif (typeof BX === 'undefined' || BX.addCustomEvent == null) { return; }\r\n\r\n\t\tBX.addCustomEvent(name, callback);\r\n\t}\r\n\r\n\toffBxEvent(name, callback) {\r\n\t\tif (typeof BX === 'undefined' || BX.removeCustomEvent == null) { return; }\r\n\r\n\t\tBX.removeCustomEvent(name, callback);\r\n\t}\r\n\r\n\tfireBxEvent(name, data) {\r\n\t\tif (typeof BX === 'undefined' || BX.onCustomEvent == null) { return; }\r\n\r\n\t\tBX.onCustomEvent(name, [data]);\r\n\t}\r\n\r\n\tonJQueryEvent(name, callback) {\r\n\t\tif (typeof jQuery === 'undefined') { return; }\r\n\r\n\t\tconst selfConfig = this.typeConfig('jquery');\r\n\r\n\t\tif (this.canProxyCallback(selfConfig)) {\r\n\t\t\tconst originalCallback = callback;\r\n\r\n\t\t\tcallback = (evt, data) => {\r\n\t\t\t\tconst proxyData = data != null ? data : evt?.originalEvent?.detail;\r\n\r\n\t\t\t\toriginalCallback(proxyData);\r\n\t\t\t};\r\n\r\n\t\t\tthis.pushCallbackVariation('jquery', originalCallback, callback);\r\n\t\t}\r\n\r\n\t\tjQuery(document).on(name, callback);\r\n\t}\r\n\r\n\toffJQueryEvent(name, callback) {\r\n\t\tif (typeof jQuery === 'undefined') { return; }\r\n\r\n\t\tconst selfConfig = this.typeConfig('jquery');\r\n\r\n\t\tif (this.canProxyCallback(selfConfig)) {\r\n\t\t\tcallback = this.popCallbackVariation('jquery', callback);\r\n\r\n\t\t\tif (callback == null) { return; }\r\n\t\t}\r\n\r\n\t\tjQuery(document).off(name, callback);\r\n\t}\r\n\r\n\tfireJQueryEvent(name, data) {\r\n\t\tif (typeof jQuery === 'undefined') { return; }\r\n\t\tif (this.hasPlainAndJQueryCollision()) { return; }\r\n\r\n\t\tjQuery(document).triggerHandler(new CustomEvent(name, { \"detail\": data }));\r\n\t}\r\n\r\n\tonPlainEvent(name, callback) {\r\n\t\tif (this.hasPlainAndJQueryCollision()) { return; }\r\n\r\n\t\tconst selfConfig = this.typeConfig('plain');\r\n\r\n\t\tif (this.canProxyCallback(selfConfig)) {\r\n\t\t\tconst originalCallback = callback;\r\n\r\n\t\t\tcallback = (evt) => {\r\n\t\t\t\toriginalCallback(evt.detail);\r\n\t\t\t};\r\n\r\n\t\t\tthis.pushCallbackVariation('plain', originalCallback, callback);\r\n\t\t}\r\n\r\n\t\tdocument.addEventListener(name, callback);\r\n\t}\r\n\r\n\toffPlainEvent(name, callback) {\r\n\t\tif (this.hasPlainAndJQueryCollision()) { return; }\r\n\r\n\t\tconst selfConfig = this.typeConfig('plain');\r\n\r\n\t\tif (this.canProxyCallback(selfConfig)) {\r\n\t\t\tcallback = this.popCallbackVariation('plain', callback);\r\n\r\n\t\t\tif (callback == null) { return; }\r\n\t\t}\r\n\r\n\t\tdocument.removeEventListener(name, callback);\r\n\t}\r\n\r\n\tfirePlainEvent(name, data) {\r\n\t\tdocument.dispatchEvent(new CustomEvent(name, { \"detail\": data }));\r\n\t}\r\n\r\n\thasPlainAndJQueryCollision() {\r\n\t\tif (!this.matchEvent('plain') || !this.matchEvent('jquery')) { return false; }\r\n\r\n\t\tconst plainConfig = this.typeConfig('plain');\r\n\r\n\t\treturn (plainConfig['force'] !== true && typeof jQuery !== 'undefined');\r\n\t}\r\n\r\n\tcanProxyCallback(selfConfig) {\r\n\t\treturn selfConfig['proxy'] !== false;\r\n\t}\r\n\r\n\ttypeConfig(type) {\r\n\t\treturn typeof this.config[type] === 'object' && this.config[type] != null ? this.config : {};\r\n\t}\r\n\r\n\tpushCallbackVariation(type, callback, proxy) {\r\n\t\tif (this.callbackMap[type] == null) {\r\n\t\t\tthis.callbackMap[type] = new WeakMap();\r\n\t\t}\r\n\r\n\t\tthis.callbackMap[type].set(callback, proxy);\r\n\t}\r\n\r\n\tpopCallbackVariation(type, callback) {\r\n\t\tif (this.callbackMap[type] == null) { return null; }\r\n\r\n\t\tconst map = this.callbackMap[type];\r\n\t\tconst result = map.get(callback);\r\n\r\n\t\tif (result != null) {\r\n\t\t\tmap.delete(callback);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n}","import {EventProxy} from \"../../utils/eventproxy\";\r\n\r\nexport default class Subscriber {\r\n\r\n\tstatic defaults = {\r\n\t\tcheck: null,\r\n\t\tevent: null,\r\n\t\tconfig: {},\r\n\t\ton: null,\r\n\t\toff: null,\r\n\t}\r\n\r\n\tconstructor(element, options = {}) {\r\n\t\tthis.el = element;\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t\tthis.eventProxy = new EventProxy(this.options.config);\r\n\r\n\t\tthis.bind();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.unbind();\r\n\r\n\t\tthis.eventProxy = null;\r\n\t\tthis.options = {};\r\n\t\tthis.el = null;\r\n\t}\r\n\r\n\tbind() {\r\n\t\tthis.bindOn();\r\n\t\tthis.bindEvent();\r\n\t}\r\n\r\n\tunbind() {\r\n\t\tthis.unbindOff();\r\n\t\tthis.unbindEvent();\r\n\t}\r\n\r\n\tbindOn() {\r\n\t\tif (this.options.on == null) { return; }\r\n\r\n\t\tthis.options.on(this.options.check);\r\n\t}\r\n\r\n\tunbindOff() {\r\n\t\tif (this.options.off == null) { return; }\r\n\r\n\t\tthis.options.off(this.options.check);\r\n\t}\r\n\r\n\tbindEvent() {\r\n\t\tconst event = this.options.event;\r\n\r\n\t\tif (event == null) { return; }\r\n\r\n\t\tif (typeof event === 'string') {\r\n\t\t\tthis.eventProxy.on(event, this.options.check);\r\n\t\t} else if (Array.isArray(event)) {\r\n\t\t\tevent.forEach((one) => {\r\n\t\t\t\tthis.eventProxy.on(one, this.options.check);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tconsole?.warn(`unknown event type ${typeof event}`);\r\n\t\t}\r\n\t}\r\n\r\n\tunbindEvent() {\r\n\t\tconst event = this.options.event;\r\n\r\n\t\tif (event == null) { return; }\r\n\r\n\t\tif (typeof event === 'string') {\r\n\t\t\tthis.eventProxy.off(event, this.options.check);\r\n\t\t} else if (Array.isArray(event)) {\r\n\t\t\tevent.forEach((one) => {\r\n\t\t\t\tthis.eventProxy.off(one, this.options.check);\r\n\t\t\t});\r\n\t\t} else {\r\n\t\t\tconsole?.warn(`unknown event type ${typeof event}`);\r\n\t\t}\r\n\t}\r\n\r\n}","export default class Composite {\r\n\r\n\tstatic defaults = {\r\n\t\tcheck: null,\r\n\t}\r\n\r\n\tconstructor(element: HTMLElement, options: Object = {}) {\r\n\t\tthis.el = element;\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\r\n\t\tthis.boot();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tif (typeof BX !== 'undefined') { return; }\r\n\r\n\t\tBX?.removeCustomEvent('onFrameDataReceived', this.onFrameReady);\r\n\t}\r\n\r\n\tboot() {\r\n\t\tconst anchor = this.anchor();\r\n\r\n\t\tif (typeof BX !== 'undefined' && anchor == null) { return; }\r\n\r\n\t\tBX?.addCustomEvent('onFrameDataReceived', this.onFrameReady);\r\n\t}\r\n\r\n\tonFrameReady = () => {\r\n\t\tthis.options.check();\r\n\t}\r\n\r\n\tanchor() {\r\n\t\tlet parent = this.el.parentElement;\r\n\r\n\t\twhile (parent) {\r\n\t\t\tlet start = false;\r\n\t\t\tlet nodes = [];\r\n\r\n\t\t\tfor (const child of parent.children) {\r\n\t\t\t\tif (child.id == null != null && /^bxdynamic_.*_start$/.test(child.id)) {\r\n\t\t\t\t\tstart = true;\r\n\t\t\t\t} else if (child.id == null != null && /^bxdynamic_.*_end$/.test(child.id)) {\r\n\t\t\t\t\tstart = false;\r\n\r\n\t\t\t\t\tfor (const node of nodes) {\r\n\t\t\t\t\t\tif (node === this.el || node.contains(this.el)) {\r\n\t\t\t\t\t\t\treturn node;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tnodes = [];\r\n\t\t\t\t} else if (start) {\r\n\t\t\t\t\tnodes.push(child);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tparent = parent.parentElement;\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t}\r\n\r\n}","import MutationFactory from \"./nodepreserver/mutationfactory\";\r\nimport Subscriber from \"./nodepreserver/subscriber\";\r\nimport Composite from \"./nodepreserver/composite\";\r\n\r\nexport default class NodePreserver {\r\n\r\n\tstatic defaults = {\r\n\t\trestore: null,\r\n\t\tsubscriber: null,\r\n\t\tmutation: true,\r\n\t\tcomposite: true,\r\n\t}\r\n\r\n\t/** @var MutationSkeleton */\r\n\tmutation;\r\n\t/** @var Subscriber */\r\n\tsubscriber;\r\n\t/** @var Composite */\r\n\tcomposite;\r\n\r\n\tconstructor(element, options = {}) {\r\n\t\tthis.el = element;\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\r\n\t\tthis.install();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.uninstall();\r\n\t\tthis.options = {};\r\n\t\tthis.el = null;\r\n\t}\r\n\r\n\tinstall() {\r\n\t\tthis.installMutation();\r\n\t\tthis.installSubscriber();\r\n\t\tthis.installComposite();\r\n\t}\r\n\r\n\tuninstall() {\r\n\t\tthis.uninstallMutation();\r\n\t\tthis.uninstallSubscriber();\r\n\t\tthis.uninstallComposite();\r\n\t}\r\n\r\n\tinstallMutation() {\r\n\t\tif (!this.isEnabled('mutation')) { return; }\r\n\r\n\t\tthis.mutation = MutationFactory.make(this.el, this.driverOptions('mutation'));\r\n\t}\r\n\r\n\tuninstallMutation() {\r\n\t\tif (this.mutation == null) { return; }\r\n\r\n\t\tthis.mutation.destroy();\r\n\t}\r\n\r\n\tinstallSubscriber() {\r\n\t\tif (!this.isEnabled('subscriber')) { return; }\r\n\r\n\t\tthis.subscriber = new Subscriber(this.el, this.driverOptions('subscriber'));\r\n\t}\r\n\r\n\tuninstallSubscriber() {\r\n\t\tif (this.subscriber == null) { return; }\r\n\r\n\t\tthis.subscriber.destroy();\r\n\t\tthis.subscriber = null;\r\n\t}\r\n\r\n\tinstallComposite() {\r\n\t\tif (!this.isEnabled('composite')) { return; }\r\n\r\n\t\tthis.composite = new Composite(this.el, this.driverOptions('composite'));\r\n\t}\r\n\r\n\tuninstallComposite() {\r\n\t\tif (this.composite == null) { return; }\r\n\r\n\t\tthis.composite.destroy();\r\n\t}\r\n\r\n\tisEnabled(type) {\r\n\t\treturn !!this.options[type];\r\n\t}\r\n\r\n\tdriverOptions(type) {\r\n\t\tconst option = typeof this.options[type] === 'object' ? this.options[type] : {};\r\n\t\tconst overrides = {\r\n\t\t\tcheck: this.check,\r\n\t\t};\r\n\r\n\t\treturn Object.assign({}, option, overrides);\r\n\t}\r\n\r\n\tcheck = () => {\r\n\t\tconst found = document.body.contains(this.el);\r\n\r\n\t\tif (!found) {\r\n\t\t\tthis.options.restore();\r\n\t\t}\r\n\r\n\t\treturn found;\r\n\t}\r\n}","import MutationLoop from \"./mutationloop\";\r\nimport MutationObserver from \"./mutationobserver\";\r\n\r\nexport default class MutationFactory {\r\n\r\n\tstatic make(element, options) {\r\n\t\tif (typeof window.MutationObserver === 'function') {\r\n\t\t\treturn new MutationObserver(element, options);\r\n\t\t}\r\n\r\n\t\treturn new MutationLoop(element, options);\r\n\t}\r\n\r\n}","export default class Template {\r\n\r\n\t/**\r\n\t * @param {string=} template\r\n\t * @param {Object} vars\r\n\t * @returns {string}\r\n\t */\r\n\tstatic compile(template, vars) {\r\n\t\tlet key;\r\n\t\tlet replaceKey;\r\n\t\tlet replaceValue;\r\n\t\tlet result = template;\r\n\r\n\t\tfor (key in vars) {\r\n\t\t\tif (!vars.hasOwnProperty(key)) { continue; }\r\n\r\n\t\t\treplaceKey = '#' + key.toUpperCase() + '#';\r\n\t\t\treplaceValue = vars[key];\r\n\r\n\t\t\tdo {\r\n\t\t\t\tresult = result.replace(replaceKey, replaceValue);\r\n\t\t\t} while (result.indexOf(replaceKey) !== -1);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tstatic toElement(html) {\r\n\t\tconst context = document.createElement('div');\r\n\t\tcontext.innerHTML = html;\r\n\r\n\t\treturn context.firstElementChild;\r\n\t}\r\n\r\n\tstatic toElements(html) {\r\n\t\tconst context = document.createElement('div');\r\n\t\tcontext.innerHTML = html;\r\n\r\n\t\treturn [...context.children];\r\n\t}\r\n\r\n}","export class Sdkloader {\r\n\r\n\tstatic instance = null;\r\n\r\n\tstatic getInstance() {\r\n\t\tif (this.instance == null) {\r\n\t\t\tthis.instance = new Sdkloader();\r\n\t\t}\r\n\r\n\t\treturn this.instance;\r\n\t}\r\n\r\n\tload() : Promise {\r\n\t\tif (this._loadPromise != null) { return this._loadPromise; }\r\n\r\n\t\tthis._loadPromise = new Promise((resolve, reject) => {\r\n\t\t\tif (this.testGlobal()) {\r\n\t\t\t\tresolve();\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tconst script = document.createElement('script');\r\n\t\t\tconst anchor = document.getElementsByTagName(\"script\")[0] || document.body;\r\n\r\n\t\t\tscript.type = \"text/javascript\";\r\n\t\t\tscript.async = true;\r\n\t\t\tscript.src = 'https://pay.yandex.ru/sdk/v1/pay.js';\r\n\r\n\t\t\tscript.onload = () => {\r\n\t\t\t\tthis.loopGlobal(() => {\r\n\t\t\t\t\tthis._loadPromise = null;\r\n\t\t\t\t\tresolve();\r\n\t\t\t\t});\r\n\t\t\t};\r\n\t\t\tscript.onerror = () => {\r\n\t\t\t\tthis._loadPromise = null;\r\n\t\t\t\tscript.remove();\r\n\r\n\t\t\t\treject(new Error('cant load yandex pay sdk library'));\r\n\t\t\t};\r\n\r\n\t\t\tanchor.parentNode.insertBefore(script, anchor);\r\n\t\t});\r\n\r\n\t\treturn this._loadPromise;\r\n\t}\r\n\r\n\tloopGlobal(resolve) : void {\r\n\t\tif (this.testGlobal()) {\r\n\t\t\tresolve();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsetTimeout(() => { this.loopGlobal(resolve) }, 100);\r\n\t}\r\n\r\n\ttestGlobal() : boolean {\r\n\t\treturn window.YaPay?.createPayment != null;\r\n\t}\r\n}","export class Intersection {\r\n\r\n\tstatic defaults = {};\r\n\r\n\tobserver;\r\n\r\n\tconstructor(element: HTMLElement, options: Object = {}) {\r\n\t\tthis.el = element;\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t}\r\n\r\n\twait() : Promise {\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tif (typeof IntersectionObserver === 'undefined') {\r\n\t\t\t\tresolve(this.el);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tthis.observer = new IntersectionObserver((entries, observer) => {\r\n\t\t\t\tentries.forEach((entry) => {\r\n\t\t\t\t\tif (entry.isIntersecting) {\r\n\t\t\t\t\t\tconst element = entry.target;\r\n\t\t\t\t\t\tobserver.unobserve(element);\r\n\t\t\t\t\t\tresolve(element);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t});\r\n\r\n\t\t\tthis.observer.observe(this.el);\r\n\t\t});\r\n\t}\r\n\r\n\trestore(node: HTMLElement) : void {\r\n\t\tthis.observer?.unobserve(this.el);\r\n\t\tthis.el = node;\r\n\t\tthis.observer?.observe(this.el);\r\n\t}\r\n}","import Utils from \"../../utils/template\";\r\n\r\nexport default class Display {\r\n\r\n\tstatic defaults = {\r\n\r\n\t}\r\n\r\n\tconstructor(factory, options) {\r\n\t\tthis.factory = factory;\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t}\r\n\r\n\tstyle() {\r\n\r\n\t}\r\n\r\n\tmount(node, payment, type) {\r\n\r\n\t}\r\n\r\n\tunmount(node, payment) {\r\n\r\n\t}\r\n\r\n\tgetOption(name) {\r\n\t\treturn this.options[name];\r\n\t}\r\n}","import Display from './display';\r\nimport Utils from \"../../utils/template\";\r\n\r\nexport default class Button extends Display {\r\n\r\n\tstatic defaults = {\r\n\t\tstyle: `<style>#STYLE#</style>`,\r\n\t\tstyleHeight: `##ID# .ya-pay-button, ##ID# .bx-yapay-skeleton-loading {height:#HEIGHT#px;}`,\r\n\t\tstyleBorder: `##ID# .ya-pay-button, ##ID# .bx-yapay-skeleton-loading {border-radius:#BORDER#px;}`,\r\n\t\tstyleWidth: `##ID# .ya-pay-button, ##ID# .bx-yapay-skeleton-loading, ##ID# .bx-yapay-divider{width: #WIDTH#px;}`,\r\n\t}\r\n\r\n\tstyle() {\r\n\t\tconst collectHeight = this.collectHeight();\r\n\t\tconst collectBorder = this.collectBorder();\r\n\t\tconst collectWidth = this.collectWidth();\r\n\r\n\t\treturn Utils.compile(this.getOption('style'), {\r\n\t\t\tstyle: collectHeight + collectBorder + collectWidth,\r\n\t\t});\r\n\t}\r\n\r\n\tmount(node, payment, type) {\r\n\t\tconst theme = this.getOption('VARIANT_BUTTON') || YaPay.ButtonTheme.Black;\r\n\t\tconst width = this.getOption('WIDTH_BUTTON') || YaPay.ButtonWidth.Max;\r\n\r\n\t\tpayment.mountButton(node, {\r\n\t\t\ttype: type,\r\n\t\t\ttheme: theme,\r\n\t\t\twidth: width !== 'OWN' ? width : YaPay.ButtonWidth.Max\r\n\t\t});\r\n\t}\r\n\r\n\tunmount(node, payment) {\r\n\t\tpayment.unmountButton(node);\r\n\t}\r\n\r\n\tcollectHeight() {\r\n\r\n\t\tlet result = '';\r\n\r\n\t\tconst heightVariant = this.getOption('HEIGHT_TYPE_BUTTON') || null;\r\n\r\n\t\tif (heightVariant == null) {\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tresult = Utils.compile(this.getOption('styleHeight'), {\r\n\t\t\tid: this.factory.getOption('containerId'),\r\n\t\t\theight: this.getOption('HEIGHT_VALUE_BUTTON') || '54',\r\n\t\t});\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tcollectBorder() {\r\n\t\tlet result = '';\r\n\r\n\t\tconst borderVariant = this.getOption('BORDER_RADIUS_TYPE_BUTTON') || null;\r\n\r\n\t\tif (borderVariant == null) {\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tresult = Utils.compile(this.getOption('styleBorder'), {\r\n\t\t\tid: this.factory.getOption('containerId'),\r\n\t\t\tborder: this.getOption('BORDER_RADIUS_VALUE_BUTTON') ?? '8',\r\n\t\t});\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tcollectWidth() {\r\n\t\tlet result = '';\r\n\r\n\t\tconst widthVariant = this.getOption('WIDTH_BUTTON');\r\n\r\n\t\tif (widthVariant !== 'OWN') {\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tresult = Utils.compile(this.getOption('styleWidth'), {\r\n\t\t\tid: this.factory.getOption('containerId'),\r\n\t\t\twidth: this.getOption('WIDTH_VALUE_BUTTON') || '282',\r\n\t\t});\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\twidth() {\r\n\t\tlet width = this.getOption('WIDTH_BUTTON') || 'MAX';\r\n\r\n\t\tif (width === 'OWN'){\r\n\t\t\twidth = 'MAX';\r\n\t\t}\r\n\r\n\t\treturn width;\r\n\t}\r\n}","import Display from './display';\r\nimport Utils from \"../../utils/template\";\r\n\r\nexport default class Widget extends Display {\r\n\r\n\tstatic defaults = {\r\n\t\tstyle: `<style>#STYLE#</style>`,\r\n\t\tstyleBorder: `##ID# .bx-yapay-skeleton-loading {border-radius:#BORDER#px !important;}`,\r\n\t\tstyleWidth: `##ID# .ya-pay-widget, ##ID# .bx-yapay-skeleton-loading, ##ID# .bx-yapay-divider{width: #WIDTH#px !important;}`,\r\n\t}\r\n\r\n\tstyle() {\r\n\t\tconst collectBorder = this.collectBorder();\r\n\t\tconst collectWidth = this.collectWidth();\r\n\r\n\t\treturn Utils.compile(this.getOption('style'), {\r\n\t\t\tstyle: collectBorder + collectWidth,\r\n\t\t});\r\n\t}\r\n\r\n\tmount(node, payment, type) {\r\n\t\tpayment.mountWidget(node, {\r\n\t\t\twidgetType: this.getOption('TYPE_WIDGET') || YaPay.WidgetType.Compact,\r\n\t\t\twidgetTheme: this.getOption('THEME_WIDGET') || YaPay.WidgetTheme.Dark,\r\n\t\t\tbuttonTheme: this.getOption('BUTTON_THEME_WIDGET') || YaPay.ButtonTheme.Black,\r\n\t\t\tborderRadius: this.getOption('BORDER_RADIUS_VALUE_WIDGET') || '8',\r\n\t\t\tbnplSelected: !!Number(this.getOption('SPLIT_SELECT_WIDGET') || false),\r\n\t\t});\r\n\t}\r\n\r\n\tunmount(node, payment) {\r\n\t\tpayment.unmountWidget(node);\r\n\t}\r\n\r\n\tcollectBorder() {\r\n\t\tlet result = '';\r\n\r\n\t\tconst borderVariant = this.getOption('BORDER_RADIUS_TYPE_WIDGET') || null;\r\n\r\n\t\tif (borderVariant == null) {\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tresult = Utils.compile(this.getOption('styleBorder'), {\r\n\t\t\tid: this.factory.getOption('containerId'),\r\n\t\t\tborder: this.getOption('BORDER_RADIUS_VALUE_WIDGET') ?? '8',\r\n\t\t});\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tcollectWidth() {\r\n\t\tlet result = '';\r\n\r\n\t\tconst widthVariant = this.getOption('WIDTH_TYPE_WIDGET') || null;\r\n\r\n\t\tif (widthVariant == null) {\r\n\t\t\treturn result;\r\n\t\t}\r\n\r\n\t\tresult = Utils.compile(this.getOption('styleWidth'), {\r\n\t\t\tid: this.factory.getOption('containerId'),\r\n\t\t\twidth: this.getOption('WIDTH_VALUE_WIDGET') || '282',\r\n\t\t});\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\twidth() {\r\n\t\treturn 'MAX';\r\n\t}\r\n}","import Button from \"./button\";\r\nimport Widget from \"./widget\";\r\n\r\nexport default class Factory {\r\n\r\n\t/**\r\n\t * @param {string} type\r\n\t * @param {Factory} factory\r\n\t * @param {Object} options\r\n\t * @returns {Button|Widget}\r\n\t * @throws {Error}\r\n\t */\r\n\tstatic make(type, factory, options) {\r\n\t\tif (type === 'Button') {\r\n\t\t\treturn new Button(factory, options);\r\n\t\t} else if (type === 'Widget') {\r\n\t\t\treturn new Widget(factory, options);\r\n\t\t}\r\n\r\n\t\tthrow new Error('unknown display ' + type);\r\n\t}\r\n\r\n}","export class Concurrency {\r\n\r\n\tstatic elements = {};\r\n\r\n\tstatic push(mode: string, widget: Widget) : void {\r\n\t\tif (this.elements[mode] == null) {\r\n\t\t\tthis.elements[mode] = [];\r\n\t\t}\r\n\r\n\t\tthis.elements[mode].push(widget);\r\n\t}\r\n\r\n\tstatic pop(mode: string, widget: Widget) : void {\r\n\t\tconst index = this.elements[mode].indexOf(widget);\r\n\r\n\t\tif (index === -1) { return; }\r\n\r\n\t\tthis.elements[mode].splice(index, 1);\r\n\t}\r\n\r\n\tstatic same(mode: string) : Array {\r\n\t\treturn this.elements[mode] ?? [];\r\n\t}\r\n\r\n}","import SolutionRegistry from './solutionregistry';\r\nimport NodePreserver from \"./ui/nodepreserver\";\r\nimport Utils from './utils/template';\r\nimport {EventProxy} from \"./utils/eventproxy\";\r\nimport {Sdkloader} from \"./sdkloader\";\r\nimport {Intersection} from \"./intersection\";\r\nimport Display from \"./ui/display/factory\";\r\nimport {Concurrency} from \"./concurrency\";\r\n\r\nexport default class Factory {\r\n\r\n\tstatic defaults = {\r\n\t\tsolution: null,\r\n\t\ttemplate:\r\n\t\t\t'<div id=\"#ID#\" ' +\r\n\t\t\t\t'class=\"bx-yapay-drawer-container ' +\r\n\t\t\t\t'yapay-behavior--#MODE# ' +\r\n\t\t\t\t'yapay-display--#DISPLAY# ' +\r\n\t\t\t\t'yapay-width--#WIDTH# ' +\r\n\t\t\t\t'yapay-solution--#SOLUTION#\">' +\r\n\t\t\t\t'#STYLE#' +\r\n\t\t\t\t'#DIVIDER#' +\r\n\t\t\t\t'<div class=\"bx-yapay-drawer\"></div>' +\r\n\t\t\t'</div>',\r\n\t\tdivider:\r\n\t\t\t'<div class=\"bx-yapay-divider\"> ' +\r\n\t\t\t\t'<span class=\"bx-yapay-divider__corner\"></span> ' +\r\n\t\t\t\t'<span class=\"bx-yapay-divider__text\">#LABEL#</span> ' +\r\n\t\t\t\t'<span class=\"bx-yapay-divider__corner at--right\"></span> ' +\r\n\t\t\t'</div>',\r\n\t\tuseDivider: false,\r\n\t\tcontainerSelector: '.bx-yapay-drawer',\r\n\t\tloaderSelector: '.bx-yapay-skeleton-loading',\r\n\t\tevent: null,\r\n\t\teventConfig: {},\r\n\t\tpreserve: {\r\n\t\t\tcomposite: true,\r\n\t\t},\r\n\t\twaitLimit: 30,\r\n\t\twaitTimeout: 1000,\r\n\t}\r\n\r\n\tdefaults;\r\n\toptions;\r\n\twaitCount = 0;\r\n\tsolution;\r\n\r\n\tconstructor(options = {}) {\r\n\t\tthis.defaults = Object.assign({}, this.constructor.defaults);\r\n\t\tthis.options = {};\r\n\r\n\t\tthis.setOptions(options);\r\n\t\tthis.createSolution();\r\n\t\tthis.bootSolution();\r\n\t\tthis.bootLocal();\r\n\t}\r\n\r\n\tinject(selector, position) {\r\n\t\tlet selectorSanitized;\r\n\r\n\t\treturn Promise.resolve()\r\n\t\t\t.then(() => {\r\n\t\t\t\tselectorSanitized = this.filterMedia(selector);\r\n\t\t\t})\r\n\t\t\t.then(() => this.waitEvent())\r\n\t\t\t.then(() => this.waitElement(selectorSanitized))\r\n\t\t\t.then((anchor) => this.checkElement(anchor))\r\n\t\t\t.then((anchor) => this.renderElement(anchor, position))\r\n\t\t\t.then((element) => this.install(element))\r\n\t\t\t.then((widget) => this.insertLoader(widget))\r\n\t\t\t.then((widget) => {\r\n\t\t\t\tconst intersection = new Intersection(widget.el);\r\n\t\t\t\t\r\n\t\t\t\tif (this.getOption('preserve')) {\r\n\t\t\t\t\tthis.preserve(selectorSanitized, position, widget, intersection);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn intersection.wait().then(() => widget);\r\n\t\t\t})\r\n\t\t\t.then((widget) => this.testConcurrency(widget))\r\n\t\t\t.then((widget) => Sdkloader.getInstance().load().then(() => widget));\r\n\t}\r\n\r\n\tfilterMedia(selector: string) : string {\r\n\t\tconst resultParts = [];\r\n\r\n\t\tfor (const part of selector.split(',')) {\r\n\t\t\tconst partSanitized = part.trim();\r\n\r\n\t\t\tif (partSanitized === '') { continue; }\r\n\r\n\t\t\tconst [partSelector, matchMedia] = this.testSelectorMedia(partSanitized);\r\n\r\n\t\t\tif (!matchMedia) { continue; }\r\n\r\n\t\t\tresultParts.push(partSelector);\r\n\t\t}\r\n\r\n\t\tif (resultParts.length === 0) {\r\n\t\t\tthrow new Error('widget not matched any media of ' + selector);\r\n\t\t}\r\n\r\n\t\treturn resultParts.join(',');\r\n\t}\r\n\r\n\tcheckElement(anchor) {\r\n\t\tconst selector = this.containerSelector();\r\n\t\tconst contains = (\r\n\t\t\t!!anchor.querySelector(selector)\r\n\t\t\t|| this.containsSiblingElement(anchor, selector)\r\n\t\t);\r\n\r\n\t\tif (contains) {\r\n\t\t\tthrow new Error('the element already has a container');\r\n\t\t}\r\n\r\n\t\treturn anchor;\r\n\t}\r\n\r\n\tcontainerSelector() {\r\n\t\treturn '#' + this.getOption('containerId') + ' ' + this.getOption('containerSelector');\r\n\t}\r\n\r\n\tcontainsSiblingElement(anchor, selector) {\r\n\t\tlet result = false;\r\n\t\tlet next = anchor.parentElement?.firstElementChild;\r\n\r\n\t\twhile (next) {\r\n\t\t\tif (next.matches(selector) || next.querySelector(selector)) {\r\n\t\t\t\tresult = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tnext = next.nextElementSibling;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\t\r\n\tpreserve(selector, position, widget, intersection) {\r\n\t\tconst preserver = new NodePreserver(widget.el, Object.assign({}, this.preserveOptions(), {\r\n\t\t\trestore: () => {\r\n\t\t\t\tpreserver.destroy();\r\n\t\t\t\t// noinspection JSIgnoredPromiseFromCall\r\n\t\t\t\tthis.restore(selector, position, widget, intersection);\r\n\t\t\t},\r\n\t\t}));\r\n\r\n\t\twidget.setPreserver(preserver);\r\n\t}\r\n\r\n\tpreserveOptions() {\r\n\t\tconst preserveOption = this.getOption('preserve');\r\n\r\n\t\treturn typeof preserveOption === 'object' ? preserveOption : {};\r\n\t}\r\n\r\n\trestore(selector, position, widget, intersection) {\r\n\t\treturn Promise.resolve()\r\n\t\t\t.then(() => this.waitElement(selector))\r\n\t\t\t.then((anchor) => {\r\n\t\t\t\tconst element = this.renderElement(anchor, position);\r\n\r\n\t\t\t\twidget.restore(element);\r\n\t\t\t\tintersection?.restore(element);\r\n\r\n\t\t\t\tif (this.getOption('preserve')) {\r\n\t\t\t\t\tthis.preserve(selector, position, widget, intersection);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn widget;\r\n\t\t\t});\r\n\t}\r\n\r\n\ttestConcurrency(widget) {\r\n\t\tconst mode = this.getOption('mode');\r\n\r\n\t\tif (mode == null) { return; }\r\n\r\n\t\tfor (const sibling of Concurrency.same(mode)) {\r\n\t\t\tif (document.documentElement.contains(sibling.el)) { continue; }\r\n\r\n\t\t\tsibling.destroy();\r\n\t\t\tConcurrency.pop(mode, sibling);\r\n\t\t}\r\n\r\n\t\tConcurrency.push(mode, widget);\r\n\r\n\t\treturn widget;\r\n\t}\r\n\r\n\tinstall(element) {\r\n\t\tconst widget = new BX.YandexPay.Widget(element);\r\n\r\n\t\twidget.setSolution(this.solution);\r\n\t\twidget.boot();\r\n\r\n\t\treturn widget;\r\n\t}\r\n\r\n\tinsertLoader(widget) {\r\n\t\twidget.bootLoader();\r\n\t\treturn widget;\r\n\t}\r\n\r\n\twaitEvent() {\r\n\t\tconst name = this.getOption('event');\r\n\r\n\t\tif (name == null) { return null; }\r\n\r\n\t\treturn new Promise((resolve) => {\r\n\t\t\tconst eventProxy = EventProxy.make(this.getOption('eventConfig'));\r\n\t\t\tconst callback = () => {\r\n\t\t\t\teventProxy.off(name, callback);\r\n\t\t\t\tresolve();\r\n\t\t\t};\r\n\r\n\t\t\teventProxy.on(name, callback);\r\n\t\t});\r\n\t}\r\n\r\n\twaitElement(selector) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthis.waitCount = 0;\r\n\t\t\tthis.waitElementLoop(selector, resolve, reject);\r\n\t\t});\r\n\t}\r\n\r\n\twaitElementLoop(selector, resolve, reject) {\r\n\t\tconst anchor = this.findElement(selector);\r\n\r\n\t\tif (anchor) {\r\n\t\t\tresolve(anchor);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t++this.waitCount;\r\n\r\n\t\tif (this.waitCount >= this.getOption('waitLimit')) {\r\n\t\t\treject('cant find element by selector ' + selector);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsetTimeout(this.waitElementLoop.bind(this, selector, resolve, reject), this.getOption('waitTimeout'));\r\n\t}\r\n\r\n\tfindElement(selector) {\r\n\t\tlet elementList;\r\n\t\tlet variant = selector.trim();\r\n\t\tlet result;\r\n\r\n\t\tif (variant === '') { throw new Error('widget selector is empty'); }\r\n\r\n\t\telementList = this.searchBySelector(variant) ?? this.searchById(selector) ?? this.searchByClassName(selector);\r\n\r\n\t\tif (elementList == null) { return null; }\r\n\r\n\t\tif (elementList.length > 1) {\r\n\t\t\tresult = this.reduceVisible(elementList);\r\n\t\t}\r\n\r\n\t\tif (result == null) {\r\n\t\t\tresult = elementList[0];\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tsearchBySelector(selector) {\r\n\t\ttry {\r\n\t\t\tconst result = [];\r\n\r\n\t\t\tfor (const part of selector.split(',')) { // first selector\r\n\t\t\t\tconst partSanitized = part.trim();\r\n\r\n\t\t\t\tif (partSanitized === '' || !this.isCssSelector(partSanitized)) { continue; }\r\n\r\n\t\t\t\tconst collection = document.querySelectorAll(partSanitized);\r\n\r\n\t\t\t\tfor (const element of collection) {\r\n\t\t\t\t\tresult.push(element);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn result.length > 0 ? result : null;\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tsearchById(selector) {\r\n\t\ttry {\r\n\t\t\tconst element = document.getElementById(selector);\r\n\r\n\t\t\treturn element != null ? [element] : null;\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tsearchByClassName(selector) {\r\n\t\ttry {\r\n\t\t\tconst collection = document.getElementsByClassName(selector);\r\n\r\n\t\t\treturn collection.length > 0 ? collection : null;\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\treduceVisible(collection) {\r\n\t\tlet result = null;\r\n\t\t\r\n\t\tfor (const element of collection) {\r\n\t\t\tif (this.testVisible(element)) {\r\n\t\t\t\tresult = element;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\t\r\n\ttestVisible(element) {\r\n\t\treturn (element.offsetWidth || element.offsetHeight || element.getClientRects().length );\r\n\t}\r\n\r\n\tisCssSelector(selector) {\r\n\t\treturn /^[.#]/.test(selector);\r\n\t}\r\n\r\n\ttestSelectorMedia(selector) {\r\n\t\tconst partials = /^(.*):media(\\(.*\\))$/.exec(selector);\r\n\r\n\t\tif (partials == null) { return [ selector, true ]; }\r\n\r\n\t\treturn [\r\n\t\t\tpartials[1],\r\n\t\t\twindow.matchMedia(partials[2]).matches,\r\n\t\t];\r\n\t}\r\n\r\n\trenderElement(anchor, position) {\r\n\t\tconst selector = this.containerSelector();\r\n\t\tconst divider = this.getDivider();\r\n\t\tconst display = this.getDisplay();\r\n\r\n\t\tconst html = Utils.compile(this.getOption('template'), {\r\n\t\t\tdivider: divider,\r\n\t\t\tstyle: display != null ? display.style() : '',\r\n\t\t\twidth: display != null ? display.width().toLowerCase() : 'auto',\r\n\t\t\tid: this.getOption('containerId'),\r\n\t\t\tmode: this.getOption('mode') || 'payment',\r\n\t\t\tdisplay: this.getOption('displayType')?.toLowerCase() || 'button',\r\n\t\t\tsolution: this.getOption('solution')?.toLowerCase(),\r\n\t\t});\r\n\r\n\t\tlet elements = Utils.toElements(html);\r\n\t\tlet result = null;\r\n\r\n\t\tif (position.indexOf('after') === 0) { elements = elements.reverse(); }\r\n\r\n\t\tfor (const element of elements) {\r\n\t\t\tanchor.insertAdjacentElement(position, element);\r\n\r\n\t\t\tif (result != null) { continue; }\r\n\r\n\t\t\tresult = element.matches(selector) ? element : element.querySelector(selector);\r\n\t\t}\r\n\r\n\t\tif (result == null) {\r\n\t\t\tthrow new Error(`cant find template container by selector ${selector}`);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tcreateSolution() {\r\n\t\tconst name = this.getOption('solution');\r\n\t\tconst mode = this.getOption('mode');\r\n\r\n\t\tthis.solution = SolutionRegistry.createPage(name, mode);\r\n\t}\r\n\r\n\tbootSolution() {\r\n\t\tthis.solution?.bootFactory(this);\r\n\t}\r\n\r\n\tgetDisplay() {\r\n\t\tconst type = this.getOption('displayType');\r\n\t\tconst options = this.getOption('displayParameters');\r\n\r\n\t\tif (type == null) { return null; }\r\n\r\n\t\treturn Display.make(type, this, options);\r\n\t}\r\n\r\n\tgetDivider() {\r\n\t\treturn this.getOption('useDivider')\r\n\t\t\t? Utils.compile(this.getOption('divider'), {label: this.getOption('label')})\r\n\t\t\t: '';\r\n\t}\r\n\r\n\tbootLocal() {\r\n\t\tEventProxy.make().fire('bxYapayFactoryInit', {\r\n\t\t\tfactory: this,\r\n\t\t});\r\n\t}\r\n\r\n\textendDefaults(options) {\r\n\t\tthis.defaults = Object.assign(this.defaults, options);\r\n\t}\r\n\r\n\tsetOptions(options) {\r\n\t\tthis.options = Object.assign(this.options, options);\r\n\t}\r\n\r\n\tgetOption(name) {\r\n\t\treturn this.options[name] ?? this.defaults[name];\r\n\t}\r\n}","export default class SolutionRegistry {\r\n\r\n\tstatic getFactory(name) {\r\n\t\tif (name == null) { return null; }\r\n\r\n\t\tlet namespace, type;\r\n\r\n\t\t[namespace, type] = name.split('.');\r\n\r\n\t\tlet factory = window?.BX?.YandexPay?.Solution?.[namespace]?.factory;\r\n\r\n\t\tif (type != null)\r\n\t\t{\r\n\t\t\tfactory = window?.BX?.YandexPay?.Solution?.[namespace]?.[type]?.factory;\r\n\t\t}\r\n\r\n\t\tif (factory == null) {\r\n\t\t\tconsole?.warn(`cant find solution ${name}`);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\treturn factory;\r\n\t}\r\n\r\n\tstatic createPage(name, mode) {\r\n\t\tconst factory = this.getFactory(name);\r\n\r\n\t\tif (factory == null) { return null; }\r\n\r\n\t\treturn factory.create(mode);\r\n\t}\r\n\r\n}","import Template from '../utils/template';\r\n\r\nexport default class AbstractStep {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '',\r\n\t}\r\n\r\n\tdefaults;\r\n\toptions;\r\n\twidget;\r\n\tdelayTimeouts = {};\r\n\r\n\t/**\r\n\t * @param {Widget} widget\r\n\t * @param {Object} options\r\n\t */\r\n\tconstructor(widget, options = {}) {\r\n\t\tthis.widget = widget;\r\n\t\tthis.defaults = Object.assign({}, this.constructor.defaults);\r\n\t\tthis.options = Object.assign({}, options);\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\t// nothing by default\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param {string} name\r\n\t * @returns {*}\r\n\t */\r\n\tgetOption(name) {\r\n\t\treturn this.options[name] ?? this.widget.getOption(name) ?? this.defaults[name];\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object<Element>} node Element\r\n\t * @param {Object} data Options\r\n\t */\r\n\trender(node, data = {}) {\r\n\t\tnode.innerHTML = this.compile(data);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object} data\r\n\t * @returns {string}\r\n\t */\r\n\tcompile(data) {\r\n\t\treturn Template.compile(this.getOption('template'), data);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object<Element>} node\r\n\t */\r\n\trestore(node) {\r\n\t\t// nothing by default\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} url\r\n\t * @param {Object} data\r\n\t * @returns {Promise.<Object>}\r\n\t */\r\n\tquery(url, data) {\r\n\t\treturn fetch(url, {\r\n\t\t\tmethod: 'POST',\r\n\t\t\theaders: { 'Content-Type': 'application/json' },\r\n\t\t\tbody: JSON.stringify(data)\r\n\t\t})\r\n\t\t\t.then(response => {return response.json()})\r\n\t}\r\n\r\n\tisRest() : boolean {\r\n\t\treturn this.getOption('isRest');\r\n\t}\r\n\r\n\tgetElement(key, context, method) {\r\n\t\tlet selector = this.getElementSelector(key);\r\n\r\n\t\treturn this.getNode(selector, context, method || 'querySelector');\r\n\t}\r\n\r\n\tgetElementSelector(key) {\r\n\t\tlet optionKey = key + 'Element';\r\n\r\n\t\treturn this.options[optionKey];\r\n\t}\r\n\r\n\tgetNode(selector, context, method) {\r\n\t\tif (selector.substr(0, 1) === '#') { // is id query\r\n\t\t\tcontext = document;\r\n\t\t} else if (!context) {\r\n\t\t\tcontext = this.el;\r\n\t\t}\r\n\r\n\t\treturn context[method](selector);\r\n\t}\r\n\r\n\tclearDelay(name) {\r\n\t\tif (this.delayTimeouts[name] == null) { return; }\r\n\r\n\t\tclearTimeout(this.delayTimeouts[name]);\r\n\t\tthis.delayTimeouts[name] = null;\r\n\t}\r\n\r\n\tdelay(name, args = [], timeout = 300) {\r\n\t\tthis.clearDelay(name);\r\n\t\tthis.delayTimeouts[name] = setTimeout(this[name].bind(this, ...args), timeout);\r\n\t}\r\n\r\n\tshowError(type, message, err = null) {\r\n\t\tlet notify = type + ' - ' + message;\r\n\r\n\t\tif (err) {\r\n\t\t\tnotify += ' ' + err;\r\n\t\t}\r\n\r\n\t\tconsole.error(notify);\r\n\t}\r\n}","import Template from \"../utils/template\";\r\n\r\nexport default class Base {\r\n\tstatic defaults = {\r\n\t\ttemplate: null,\r\n\t}\r\n\r\n\tconstructor(options = {}) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t\tthis.widget = null;\r\n\t}\r\n\r\n\trender(node, data = {}) {\r\n\t\tnode.innerHTML = this.compile(data);\r\n\t}\r\n\r\n\tcompile(data) {\r\n\t\treturn Template.compile(this.options.template, data);\r\n\t}\r\n\r\n\tsetWidget(widget) {\r\n\t\tthis.widget = widget;\r\n\t}\r\n\r\n\tgetOption(key) {\r\n\t\tif (key in this.options) {\r\n\t\t\treturn this.options[key];\r\n\t\t} else {\r\n\t\t\treturn this.widget.options[key];\r\n\t\t}\r\n\t}\r\n}","import Base from \"./base\";\r\nimport Template from \"../utils/template\";\r\n\r\nexport default class Form extends Base {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<form name=\"form\" action=\"#ACTION#\" method=\"#METHOD#\">'\r\n\t\t\t+ '#INPUTS#'\r\n\t\t\t+ '</form>',\r\n\t}\r\n\r\n\trender(node, data) {\r\n\t\tsuper.render(node, data);\r\n\t\tthis.autosubmit(node);\r\n\t}\r\n\r\n\tcompile(data) {\r\n\t\tconst template = this.options.template;\r\n\t\tconst vars = Object.assign(data, {\r\n\t\t\t'inputs': this.makeInputs(data)\r\n\t\t});\r\n\r\n\t\treturn Template.compile(template, vars);\r\n\t}\r\n\r\n\tmakeInputs(data) {\r\n\t\tlet key;\r\n\t\tlet vars = data.params;\r\n\t\tlet value;\r\n\t\tlet template;\r\n\r\n\t\tif (Object.keys(vars).length === 0) { return ''; }\r\n\r\n\t\ttemplate = data.termUrl ? '<input type=\"hidden\" name=\"TermUrl\" value=\"' + vars.termUrl + '\">' : '';\r\n\r\n\t\tfor (key in vars)\r\n\t\t{\r\n\t\t\tif (!vars.hasOwnProperty(key)) { continue; }\r\n\r\n\t\t\tvalue = vars[key];\r\n\r\n\t\t\ttemplate += '<input type=\"hidden\" name=\"' + key + '\" value=\"' + value + '\">';\r\n\t\t}\r\n\r\n\t\treturn template;\r\n\t}\r\n\r\n\tmakeTermUrl() {\r\n\t\tlet result = this.getOption('notifyUrl');\r\n\t\tlet backUrl = window.location.href;\r\n\r\n\t\tresult +=\r\n\t\t\t(result.indexOf('?') === -1 ? '?' : '&')\r\n\t\t\t+ 'backurl=' + encodeURIComponent(backUrl)\r\n\t\t\t+ '&service=' + this.getOption('requestSign')\r\n\t\t\t+ '&paymentId=' + this.getOption('externalId');\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tautosubmit(node) {\r\n\t\tconst form = node.querySelector('form');\r\n\r\n\t\tform.submit();\r\n\t}\r\n}","import Base from \"./base\";\r\nimport Template from \"../utils/template\";\r\n\r\nexport default class Iframe extends Base {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<iframe style=\"display: none;\"></iframe>',\r\n\t}\r\n\r\n\trender(node, data) {\r\n\t\tthis.insertIframe(node, data);\r\n\t}\r\n\r\n\tinsertIframe(node, data) {\r\n\t\tnode.innerHTML = Template.compile(this.options.template, data);\r\n\t\tthis.compile(node, data);\r\n\t}\r\n\r\n\tcompile(node, data) {\r\n\t\tlet iframe = node.querySelector('iframe');\r\n\t\tlet contentIframe = iframe.contentWindow || ( iframe.contentDocument.document || iframe.contentDocument);\r\n\t\tlet html = data.params;\r\n\r\n\t\tcontentIframe.document.open();\r\n\t\tcontentIframe.document.write(html);\r\n\t\tcontentIframe.document.close();\r\n\t}\r\n}","import Base from \"./base\";\r\nimport Template from \"../utils/template\";\r\n\r\nexport default class IframeRbs extends Base {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<iframe style=\"display: none;\"></iframe>',\r\n\t}\r\n\r\n\trender(node, data) {\r\n\t\tthis.insertIframe(node, data);\r\n\t}\r\n\r\n\tinsertIframe(node, data) {\r\n\t\tnode.innerHTML = Template.compile(this.options.template, data);\r\n\t\tthis.compile(node, data);\r\n\t}\r\n\r\n\tcompile(node, data) {\r\n\t\tPromise.resolve()\r\n\t\t\t.then(() => this.renderIframe(node, data))\r\n\t\t\t.then(() => this.query(data));\r\n\t}\r\n\r\n\tquery (data) {\r\n\t\tfetch(this.getOption('notifyUrl'), {\r\n\t\t\tmethod: 'POST',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t},\r\n\t\t\tbody: JSON.stringify({\r\n\t\t\t\tservice: this.getOption('requestSign'),\r\n\t\t\t\taccept: 'json',\r\n\t\t\t\tsecure: data.params.secure,\r\n\t\t\t\texternalId: data.params.notify.externalId,\r\n\t\t\t\tpaySystemId: data.params.notify.paySystemId\r\n\t\t\t})\r\n\t\t})\r\n\t\t\t.then(response => response.json())\r\n\t\t\t.then(result => {\r\n\t\t\t\tif (result.success === true) {\r\n\t\t\t\t\tthis.widget.go(result.state, result);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.widget.go('error', result);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(error => console.log(error) );\r\n\t}\r\n\r\n\trenderIframe(node, data) {\r\n\t\tlet iframe = node.querySelector('iframe');\r\n\t\tlet contentIframe = iframe.contentWindow || ( iframe.contentDocument.document || iframe.contentDocument);\r\n\t\tlet html = `<form name=\"form\" action=\"${data.action}\" method=\"POST\">`;\r\n\r\n\t\tcontentIframe.document.open();\r\n\t\tcontentIframe.document.write(html);\r\n\t\tcontentIframe.document.close();\r\n\r\n\t\tcontentIframe.document.querySelector('form').submit();\r\n\t}\r\n}\r\n","import AbstractStep from \"./abstractstep\";\r\nimport SecureForm from \"../secure3d/form\";\r\nimport SecureIframe from \"../secure3d/iframe\";\r\nimport SecureRbs from \"../secure3d/iframerbs\";\r\n\r\nexport default class Step3ds extends AbstractStep {\r\n\r\n\trender(node, data) {\r\n\t\tconst view = this.makeView(data);\r\n\t\tview.setWidget(this.widget);\r\n\t\tview.render(node, data);\r\n\t}\r\n\r\n\tmakeView(data) {\r\n\t\tlet view = data.view;\r\n\r\n\t\tif (view === 'form') {\r\n\t\t\treturn new SecureForm();\r\n\t\t} else if (view === 'iframe') {\r\n\t\t\treturn new SecureIframe();\r\n\t\t} else if (view === 'iframerbs') {\r\n\t\t\treturn new SecureRbs();\r\n\t\t}\r\n\r\n\t\tthrow new Error('view secure3d missing')\r\n\t}\r\n}","import AbstractStep from './abstractstep';\r\n\r\nexport default class Finish extends AbstractStep {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<div class=\"alert alert-success\" role=\"alert\"><strong>#MESSAGE#</strong></div>'\r\n\t}\r\n\r\n}","import AbstractStep from './abstractstep';\r\n\r\nexport default class Failure extends AbstractStep {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<div class=\"alert alert-danger\" role=\"alert\"><strong>#MESSAGE#</strong></div>'\r\n\t}\r\n\r\n}","import AbstractStep from './abstractstep';\r\nimport Utils from \"../utils/template\";\r\n\r\nexport default class Loader extends AbstractStep {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<div class=\"bx-yapay-skeleton-loading\"></div>',\r\n\t\tloaderSelector: '.bx-yapay-skeleton-loading',\r\n\t}\r\n\r\n\trender(node, data = {}) {\r\n\t\tconst html = this.compile(data);\r\n\t\tconst element = Utils.toElement(html);\r\n\r\n\t\tnode.insertAdjacentElement('beforeend', element);\r\n\t\tthis.restoreElement = element;\r\n\t}\r\n\r\n\trestore(node) {\r\n\t\tif (this.restoreElement == null) { return; }\r\n\r\n\t\tnode.insertAdjacentElement('beforeend', this.restoreElement);\r\n\t}\r\n\r\n\tremove(node) {\r\n\t\tconst loader = node.querySelector(this.getOption('loaderSelector'));\r\n\t\tloader?.remove();\r\n\t}\r\n\r\n}\r\n","export default class Proxy {\r\n\r\n\tpaymentData;\r\n\tcart;\r\n\twidget;\r\n\r\n\tconstructor(cart) {\r\n\t\tthis.cart = cart;\r\n\t\tthis.widget = cart.widget;\r\n\t\tthis.paymentData = this.getPaymentData();\r\n\t}\r\n\r\n\tgetOption(name) {\r\n\t\treturn this.cart.getOption(name);\r\n\t}\r\n\r\n\tbootstrap() {\r\n\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\r\n\t}\r\n\r\n\tgetPaymentData() {\r\n\r\n\t}\r\n\r\n\trestore(node) {\r\n\r\n\t}\r\n\r\n\tmount(node, payment) {\r\n\r\n\t}\r\n}","import Proxy from \"./proxy\";\r\nimport {EventProxy} from \"../../utils/eventproxy\";\r\n\r\nexport default class Rest extends Proxy {\r\n\r\n\tbootstrap() {\r\n\t\tthis.getButtonData()\r\n\t\t\t.then((result) => {\r\n\t\t\t\tif (result.status === 'fail') { throw new Error(result.reason); }\r\n\t\t\t\tthis.combineOrderWithData(result.data);\r\n\t\t\t\tthis.createPayment(this.cart.element, this.paymentData);\r\n\t\t\t})\r\n\t\t\t.catch((error) => {\r\n\t\t\t\tthis.widget.removeLoader();\r\n\t\t\t});\r\n\t}\r\n\r\n\tgetButtonData() {\r\n\r\n\t\tlet data = {\r\n\t\t\tproductId: this.getOption('productId'),\r\n\t\t\tmode: this.getOption('mode'),\r\n\t\t\tcurrencyCode: this.getOption('currencyCode'),\r\n\t\t\tsetupId: this.getOption('setupId'),\r\n\t\t};\r\n\r\n\t\treturn this.cart.query(this.getOption('restUrl') + 'button/data', data);\r\n\t}\r\n\r\n\tgetPaymentData() {\r\n\t\treturn {\r\n\t\t\tenv: this.getOption('env'),\r\n\t\t\tversion: 3,\r\n\t\t\tmerchantId: this.getOption('merchantId'),\r\n\t\t\tcart: { externalId: \"checkout-b2b-test-order-id\", },\r\n\t\t\tcurrencyCode: this.getOption('currencyCode'),\r\n\t\t}\r\n\t}\r\n\r\n\tonPaymentSuccess(event) {\r\n\t\tthis.authorize(event)\r\n\t\t\t.then((result) => {\r\n\t\t\t\tif (result.status === 'success') {\r\n\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\twindow.location.href = result.data.redirect;\r\n\t\t\t\t\t}, 1000);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.cart.showError('authorize', result.reasonCode, result.reason);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\tEventProxy.make().fire('bxYapayPaymentSuccess', event);\r\n\t}\r\n\r\n\tonPaymentAbort(event) {\r\n\t\tEventProxy.make().fire('bxYapayPaymentAbort', event);\r\n\t}\r\n\r\n\tonPaymentError(event) {\r\n\t\tEventProxy.make().fire('bxYapayPaymentError', event);\r\n\t\tthis.cart.showError('yapayPayment','payment not created', event.reason);\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\t\tif (this._mounted != null) { return; }\r\n\r\n\t\tthis._mounted = false;\r\n\r\n\t\tYaPay.createSession(paymentData, {\r\n\t\t\tonSuccess: this.onPaymentSuccess.bind(this),\r\n\t\t\tonAbort: this.onPaymentAbort.bind(this),\r\n\t\t\tonError: this.onPaymentError.bind(this),\r\n\t\t\tagent: { name: \"CMS-Bitrix\", version: \"1.0\" }\r\n\t\t})\r\n\t\t\t.then((paymentSession) => {\r\n\t\t\t\tthis._mounted = true;\r\n\t\t\t\tthis.widget.removeLoader();\r\n\t\t\t\tthis.mount(paymentSession);\r\n\t\t\t})\r\n\t\t\t.catch((err) => {\r\n\t\t\t\tthis._mounted = null;\r\n\t\t\t\tnode.remove();\r\n\t\t\t\tthis.cart.showError('yapayPayment', 'payment not created', err);\r\n\t\t\t});\r\n\t}\r\n\r\n\tauthorize(event) {\r\n\t\tlet data = {\r\n\t\t\torderId: event.orderId,\r\n\t\t\thash: event.metadata,\r\n\t\t\tsuccessUrl: this.getOption('successUrl'),\r\n\t\t};\r\n\r\n\t\treturn this.cart.query(this.getOption('restUrl') + 'authorize', data);\r\n\t}\r\n\r\n\tbindDebug(payment) {\r\n\t\tfor (const key in YaPay.CheckoutEventType) {\r\n\t\t\tif (!YaPay.CheckoutEventType.hasOwnProperty(key)) { continue; }\r\n\r\n\t\t\tpayment.on(YaPay.CheckoutEventType[key], function() {\r\n\t\t\t\tconsole.log(arguments);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tmount(payment) {\r\n\t\tthis.cart.initialContent = null;\r\n\t\tthis.payment = payment;\r\n\t\tthis.cart.display.mount(this.cart.element, payment, YaPay.ButtonType.Checkout);\r\n\r\n\t\tEventProxy.make().fire('bxYapayMountButton');\r\n\t}\r\n\r\n\trestore(node) {\r\n\t\tif (this.payment == null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.cart.display.mount(node, this.payment, YaPay.ButtonType.Checkout);\r\n\t\tEventProxy.make().fire('bxYapayRestoreButton');\r\n\t}\r\n\r\n\tcombineOrderWithData(data) {\r\n\t\tconst { cart } = this.paymentData;\r\n\r\n\t\tlet exampleData = {\r\n\t\t\tcart: {\r\n\t\t\t\t...cart,\r\n\t\t\t\titems: data.items,\r\n\t\t\t\ttotal: {\r\n\t\t\t\t\tamount: data.total.amount,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tmetadata: data.metadata\r\n\t\t};\r\n\r\n\t\tObject.assign(this.paymentData, exampleData);\r\n\t}\r\n\r\n\tchangeOffer(newProductId) {\r\n\t\tlet productId = this.getOption('productId');\r\n\r\n\t\tif (productId !== newProductId) { // todo in items\r\n\t\t\tthis.widget.setOptions({productId: newProductId});\r\n\r\n\t\t\tif (this._mounted == null) {\r\n\t\t\t\tthis.bootstrap();\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tthis.update();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tchangeBasket() {\r\n\t\tthis.update();\r\n\t}\r\n\r\n\tupdate() {\r\n\t\tthis.payment.update(async () => {\r\n\t\t\tconst result = await this.getButtonData()\r\n\t\t\t\t.then(result => result)\r\n\t\t\t\t.catch((error) => {\r\n\t\t\t\t\tthis.cart.showError('getButtonData','get not button data', error);\r\n\t\t\t\t});\r\n\r\n\t\t\tif (result.status === 'fail') {\r\n\t\t\t\tthis._mounted = null;\r\n\t\t\t\tthis.cart.display.unmount(this.cart.element, this.payment);\r\n\t\t\t\tthrow new Error(result.reason);\r\n\t\t\t}\r\n\r\n\t\t\treturn {\r\n\t\t\t\tcart: {\r\n\t\t\t\t\titems: result.data.items\r\n\t\t\t\t},\r\n\t\t\t\ttotal: {\r\n\t\t\t\t\tamount: result.data.total.amount,\r\n\t\t\t\t},\r\n\t\t\t\tmetadata: result.data.metadata,\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}","import Proxy from \"./proxy\";\r\n\r\nexport default class Site extends Proxy {\r\n\r\n\tbootstrap() {\r\n\t\tthis.reflow();\r\n\t}\r\n\r\n\tgetPaymentData() {\r\n\t\tlet paymentData = {\r\n\t\t\tenv: this.getOption('env'),\r\n\t\t\tversion: 2,\r\n\t\t\tcountryCode: YaPay.CountryCode.Ru,\r\n\t\t\tcurrencyCode: YaPay.CurrencyCode.Rub,\r\n\t\t\tmerchant: {\r\n\t\t\t\tid: this.getOption('merchantId'),\r\n\t\t\t\tname: this.getOption('merchantName'),\r\n\t\t\t\turl: this.getOption('siteUrl')\r\n\t\t\t},\r\n\t\t\torder: { id: '0' },\r\n\t\t\tpaymentMethods: [\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: YaPay.PaymentMethodType.Card,\r\n\t\t\t\t\tgateway: this.getOption('gateway'),\r\n\t\t\t\t\tgatewayMerchantId: this.getOption('gatewayMerchantId'),\r\n\t\t\t\t\tallowedAuthMethods: [YaPay.AllowedAuthMethod.PanOnly],\r\n\t\t\t\t\tallowedCardNetworks: [\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.UnionPay,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Uzcard,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Discover,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.AmericanExpress,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Visa,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Mastercard,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Mir,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Maestro,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.VisaElectron\r\n\t\t\t\t\t]\r\n\t\t\t\t}\r\n\t\t\t],\r\n\r\n\t\t\trequiredFields: {\r\n\r\n\t\t\t\tbillingContact: {\r\n\t\t\t\t\temail: this.getOption('useEmail') || false\r\n\t\t\t\t},\r\n\r\n\t\t\t\tshippingContact: {\r\n\t\t\t\t\tname: this.getOption('useName') || false,\r\n\t\t\t\t\temail: this.getOption('useEmail') || false,\r\n\t\t\t\t\tphone: this.getOption('usePhone') || false,\r\n\t\t\t\t},\r\n\r\n\t\t\t\tshippingTypes: {\r\n\t\t\t\t\tdirect: true,\r\n\t\t\t\t\tpickup: true,\r\n\t\t\t\t},\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.getOption('paymentCash') != null) {\r\n\t\t\tpaymentData.paymentMethods.push({\r\n\t\t\t\ttype: YaPay.PaymentMethodType.Cash,\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn paymentData;\r\n\t}\r\n\r\n\tgetProducts(){\r\n\r\n\t\tlet data = {\r\n\t\t\tyapayAction: 'getProducts',\r\n\t\t\tproductId: this.getOption('productId'),\r\n\t\t\tmode: this.getOption('mode'),\r\n\t\t\tsetupId: this.getOption('setupId')\r\n\t\t};\r\n\r\n\t\treturn this.cart.query(this.getOption('purchaseUrl'), data);\r\n\t}\r\n\r\n\tgetShippingOptions(address) {\r\n\r\n\t\tlet data = {\r\n\t\t\taddress: address,\r\n\t\t\tyapayAction: 'deliveryOptions',\r\n\t\t\titems: this.paymentData.order.items,\r\n\t\t\tsetupId: this.getOption('setupId'),\r\n\t\t\tpaySystemId: this.getOption('paySystemId'),\r\n\t\t};\r\n\r\n\t\treturn this.cart.query(this.getOption('purchaseUrl'), data);\r\n\t}\r\n\r\n\tgetPickupOptions(bounds) {\r\n\r\n\t\tlet data = {\r\n\t\t\tbounds: bounds,\r\n\t\t\tyapayAction: 'pickupOptions',\r\n\t\t\titems: this.paymentData.order.items,\r\n\t\t\tsetupId: this.getOption('setupId'),\r\n\t\t\tpaySystemId: this.getOption('paySystemId'),\r\n\t\t};\r\n\r\n\t\treturn this.cart.query(this.getOption('purchaseUrl'), data);\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\t\tif (this._mounted != null) { return; }\r\n\r\n\t\tthis._mounted = false;\r\n\r\n\t\tYaPay.createPayment(paymentData, { agent: { name: \"CMS-Bitrix\", version: \"1.0\" } })\r\n\t\t\t.then((payment) => {\r\n\t\t\t\tthis._mounted = true;\r\n\r\n\t\t\t\tthis.widget.removeLoader();\r\n\t\t\t\tthis.mountButton(node, payment);\r\n\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Process, (event) => {\r\n\r\n\t\t\t\t\tthis.orderAccept(event).then((result) => {\r\n\r\n\t\t\t\t\t\tif (result.error) { throw new Error(result.error.message, result.error.code); }\r\n\r\n\t\t\t\t\t\tif(!this.isPaymentTypeCash(event)) {\r\n\t\t\t\t\t\t\tthis.notify(result, event).then(result => {\r\n\t\t\t\t\t\t\t\tif (result.success === true) {\r\n\t\t\t\t\t\t\t\t\tthis.widget.go(result.state, result);\r\n\t\t\t\t\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Success);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.widget.go('error', result);\r\n\t\t\t\t\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Error);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Success);\r\n\r\n\t\t\t\t\t\t\t\tif (result.redirect != null) {\r\n\t\t\t\t\t\t\t\t\twindow.location.href = result.redirect;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.catch((error) => {\r\n\t\t\t\t\t\t\tthis.cart.showError('yapayProcess', '', error); // todo test it\r\n\t\t\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Error);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Error, (event) => {\r\n\t\t\t\t\tthis.cart.showError('yapayError', 'service temporary unavailable');\r\n\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Error);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Change, (event) => {\r\n\t\t\t\t\t//    ,   \r\n\t\t\t\t\tif (event.shippingAddress) {\r\n\t\t\t\t\t\tthis.getShippingOptions(event.shippingAddress).then((result) => {\r\n\t\t\t\t\t\t\tpayment.update({shippingOptions: result})\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//   \r\n\t\t\t\t\tif (event.shippingOption){\r\n\t\t\t\t\t\tpayment.update({\r\n\t\t\t\t\t\t\torder: this.combineOrderWithDirectShipping(event.shippingOption),\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//   ,   \r\n\t\t\t\t\tif (event.pickupBounds) {\r\n\t\t\t\t\t\tthis.getPickupOptions(event.pickupBounds).then((result) => {\r\n\t\t\t\t\t\t\tpayment.update({pickupPoints: result})\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (event.pickupInfo) {\r\n\t\t\t\t\t\tthis.getPickupDetail(event.pickupInfo.pickupPointId).then((result) => {\r\n\t\t\t\t\t\t\tpayment.update({\r\n\t\t\t\t\t\t\t\tpickupPoint: result\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t//   \r\n\t\t\t\t\tif (event.pickupPoint) {\r\n\t\t\t\t\t\tpayment.update({\r\n\t\t\t\t\t\t\torder: this.combineOrderWithPickupShipping(event.pickupPoint),\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.catch((err) => {\r\n\t\t\t\tthis._mounted = null;\r\n\t\t\t\tthis.cart.showError('yapayPayment','payment not created', err);\r\n\t\t\t});\r\n\t}\r\n\r\n\tmountButton(node, payment) {\r\n\t\tthis.cart.initialContent = null;\r\n\r\n\t\tconst theme = this.cart.display.getOption('VARIANT_BUTTON') || YaPay.ButtonTheme.Black;\r\n\t\tconst width = this.cart.display.getOption('WIDTH_BUTTON') || YaPay.ButtonWidth.Auto;\r\n\r\n\t\tthis.paymentButton = payment.createButton({\r\n\t\t\ttype: YaPay.ButtonType.Checkout,\r\n\t\t\ttheme: theme,\r\n\t\t\twidth: width,\r\n\t\t});\r\n\r\n\t\tthis.paymentButton.mount(this.cart.element);\r\n\r\n\t\tthis.paymentButton.on(YaPay.ButtonEventType.Click, () => {\r\n\t\t\tpayment.checkout();\r\n\t\t});\r\n\t}\r\n\r\n\tgetPickupDetail(pickupId) {\r\n\t\tlet data = {\r\n\t\t\tpickupId: pickupId,\r\n\t\t\tyapayAction: 'pickupDetail',\r\n\t\t\titems: this.paymentData.order.items,\r\n\t\t\tsetupId: this.getOption('setupId'),\r\n\t\t\tpaySystemId: this.getOption('paySystemId'),\r\n\t\t};\r\n\r\n\t\treturn this.cart.query(this.getOption('purchaseUrl'), data);\r\n\t}\r\n\r\n\torderAccept(event) {\r\n\r\n\t\tlet deliveryType = event.shippingMethodInfo.shippingOption ? 'delivery' : 'pickup';\r\n\t\tlet delivery;\r\n\r\n\t\tif (deliveryType === 'pickup') {\r\n\t\t\tdelivery = {\r\n\t\t\t\taddress: event.shippingMethodInfo.pickupPoint.address,\r\n\t\t\t\tpickup: event.shippingMethodInfo.pickupPoint,\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdelivery = {\r\n\t\t\t\taddress: event.shippingMethodInfo.shippingAddress,\r\n\t\t\t\tdelivery: event.shippingMethodInfo.shippingOption,\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet orderData = {\r\n\t\t\tsetupId: this.getOption('setupId'),\r\n\t\t\titems: this.paymentData.order.items,\r\n\t\t\tpayment: event.paymentMethodInfo,\r\n\t\t\tcontact: event.shippingContact,\r\n\t\t\tyapayAction: 'orderAccept',\r\n\t\t\tdeliveryType: deliveryType,\r\n\t\t\tpaySystemId: this.isPaymentTypeCash(event) ? this.getOption('paymentCash') : this.getOption('paySystemId'),\r\n\t\t\torderAmount: event.orderAmount\r\n\t\t};\r\n\r\n\t\tlet data = {...orderData, ...delivery };\r\n\r\n\t\treturn this.cart.query(this.getOption('purchaseUrl'), data);\r\n\t}\r\n\r\n\tisPaymentTypeCash(event) {\r\n\t\treturn (event.paymentMethodInfo.type === 'CASH');\r\n\t}\r\n\r\n\tnotify(payment, yandexPayData) {\r\n\r\n\t\tlet data = {\r\n\t\t\tservice: this.getOption('requestSign'),\r\n\t\t\taccept: 'json',\r\n\t\t\tyandexData: yandexPayData,\r\n\t\t\texternalId: payment.externalId,\r\n\t\t\tpaySystemId: payment.paySystemId\r\n\t\t};\r\n\r\n\t\treturn this.cart.query(this.getOption('notifyUrl'), data);\r\n\t}\r\n\r\n\tchangeOffer(newProductId) {\r\n\t\tlet productId = this.getOption('productId');\r\n\r\n\t\tif (productId !== newProductId) { // todo in items\r\n\t\t\tthis.widget.setOptions({productId: newProductId});\r\n\t\t\tthis.reflow();\r\n\t\t}\r\n\t}\r\n\r\n\tchangeBasket() {\r\n\t\tthis.reflow();\r\n\t}\r\n\r\n\treflow() {\r\n\t\tthis.getProducts()\r\n\t\t\t.then((result) => {\r\n\t\t\t\tif (result.error) { throw new Error(result.error.message); }\r\n\r\n\t\t\t\tthis.combineOrderWithProducts(result);\r\n\t\t\t\tthis.createPayment(this.cart.element, this.paymentData);\r\n\t\t\t})\r\n\t\t\t.catch((error) => {\r\n\t\t\t\tthis.widget.removeLoader();\r\n\t\t\t\t// todo this.showError();\r\n\t\t\t});\r\n\t}\r\n\r\n\tcombineOrderWithPickupShipping(pickupOption) {\r\n\t\tconst { order } = this.paymentData;\r\n\r\n\t\treturn {\r\n\t\t\t...order,\r\n\t\t\titems: [\r\n\t\t\t\t...order.items,\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: 'SHIPPING',\r\n\t\t\t\t\tlabel: pickupOption.label,\r\n\t\t\t\t\tamount: pickupOption.amount,\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\ttotal: {\r\n\t\t\t\t...order.total,\r\n\t\t\t\tamount: this.amountSum(order.total.amount, pickupOption.amount),\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n\r\n\tcombineOrderWithDirectShipping(shippingOption) {\r\n\t\tconst { order } = this.paymentData;\r\n\r\n\t\treturn {\r\n\t\t\t...order,\r\n\t\t\titems: [\r\n\t\t\t\t...order.items,\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: 'SHIPPING',\r\n\t\t\t\t\tlabel: shippingOption.label,\r\n\t\t\t\t\tamount: shippingOption.amount,\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\ttotal: {\r\n\t\t\t\t...order.total,\r\n\t\t\t\tamount: this.amountSum(order.total.amount, shippingOption.amount),\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n\r\n\tcombineOrderWithProducts(products) {\r\n\t\tconst { order } = this.paymentData;\r\n\r\n\t\tlet exampleOrder = {\r\n\t\t\t...order,\r\n\t\t\titems: products.items,\r\n\t\t\ttotal: {\r\n\t\t\t\tamount: products.amount,\r\n\t\t\t},\r\n\t\t};\r\n\r\n\t\tObject.assign(this.paymentData.order, exampleOrder);\r\n\t}\r\n\r\n\trestore(node) {\r\n\t\tif (this.paymentButton == null) {\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.paymentButton.mount(node);\r\n\t}\r\n\r\n\tamountSum(amountA, amountB) {\r\n\t\treturn (Number(amountA) + Number(amountB)).toFixed(2);\r\n\t}\r\n}","import AbstractStep from '../abstractstep';\r\nimport { ready } from \"../../utils/ready\";\r\nimport Display from \"../../ui/display/factory\";\r\nimport {EventProxy} from \"../../utils/eventproxy\";\r\nimport Rest from \"./rest\";\r\nimport Site from \"./site\";\r\n\r\nexport default class Cart extends AbstractStep {\r\n\r\n\tisBootstrap = false;\r\n\telement;\r\n\tdisplay;\r\n\tinitialContent;\r\n\r\n\trender(node, data) {\r\n\t\tthis.element = node;\r\n\t\tthis.display = this.getDisplay();\r\n\t\tthis.initialContent = this.element.innerHTML;\r\n\r\n\t\tthis.bootProxy();\r\n\t\tthis.bootSolution();\r\n\t\tthis.bootLocal();\r\n\t\tthis.delayBootstrap();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.destroyLocal()\r\n\t\tthis.destroySolution();\r\n\t}\r\n\r\n\tbootProxy() : Rest|Site{\r\n\t\tthis.proxy = this.isRest() ? new Rest(this) : new Site(this);\r\n\t}\r\n\r\n\trestore(node) {\r\n\t\tif (this.initialContent != null) {\r\n\t\t\tnode.innerHTML = this.initialContent;\r\n\t\t}\r\n\r\n\t\tthis.element = node;\r\n\t\tthis.proxy.restore(node);\r\n\t}\r\n\r\n\tbootstrap() {\r\n\t\tthis.isBootstrap = true;\r\n\t\tthis.proxy.bootstrap();\r\n\t}\r\n\r\n\tbootSolution() {\r\n\t\tthis.widget.getSolution()?.bootCart(this);\r\n\t}\r\n\r\n\tdestroySolution() {\r\n\t\tthis.widget.getSolution()?.destroyCart(this);\r\n\t}\r\n\r\n\tbootLocal() {\r\n\t\tEventProxy.make().fire('bxYapayCartInit', {\r\n\t\t\tcart: this,\r\n\t\t});\r\n\t}\r\n\r\n\tdestroyLocal() {\r\n\t\tEventProxy.make().fire('bxYapayCartDestroy', {\r\n\t\t\tcart: this,\r\n\t\t});\r\n\t}\r\n\r\n\tdelayChangeBasket() {\r\n\t\tthis.delay('changeBasket');\r\n\t}\r\n\r\n\tdelayChangeOffer(productId) {\r\n\t\tthis.delay('changeOffer', [productId]);\r\n\t}\r\n\r\n\tdelayBootstrap() {\r\n\t\tready(() => {\r\n\t\t\tthis.delay('bootstrap');\r\n\t\t});\r\n\t}\r\n\r\n\tchangeBasket() {\r\n\t\tif (!this.isBootstrap) { return; }\r\n\t\tthis.proxy?.changeBasket();\r\n\t}\r\n\r\n\tchangeOffer(newProductId) {\r\n\t\tconsole.log('offer - ' + this.isBootstrap);\r\n\r\n\t\tif (this.isBootstrap) {\r\n\t\t\tthis.proxy?.changeOffer(newProductId);\r\n\t\t} else {\r\n\t\t\tthis.widget.setOptions({productId: newProductId});\r\n\t\t}\r\n\t}\r\n\r\n\tgetDisplay() {\r\n\t\tconst type = this.getOption('displayType');\r\n\t\tconst options = this.getOption('displayParameters');\r\n\t\treturn Display.make(type, this, options);\r\n\t}\r\n}","export function ready(callback) {\r\n\tif (document.readyState === 'complete' || document.readyState === 'interactive') {\r\n\t\tsetTimeout(callback, 1);\r\n\t} else {\r\n\t\tdocument.addEventListener('DOMContentLoaded', callback);\r\n\t}\r\n}","export default class Proxy {\r\n\r\n\tpayment;\r\n\twidget;\r\n\r\n\tconstructor(payment) {\r\n\t\tthis.payment = payment;\r\n\t\tthis.widget = payment.widget;\r\n\t}\r\n\r\n\tgetOption(name) {\r\n\t\treturn this.payment.getOption(name);\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\r\n\t}\r\n\r\n\tgetPaymentData(data) {\r\n\r\n\t}\r\n}","import Proxy from \"./proxy\";\r\n\r\nexport default class Rest extends Proxy {\r\n\r\n\tgetPaymentData(data) {\r\n\t\treturn {\r\n\t\t\tenv: this.getOption('env'),\r\n\t\t\tversion: 3,\r\n\t\t\tcurrencyCode: YaPay.CurrencyCode.Rub,\r\n\t\t\tmerchantId: this.getOption('merchantId'),\r\n\t\t\torderId: data.id,\r\n\t\t\tcart: {\r\n\t\t\t\titems: data.items,\r\n\t\t\t\ttotal: {\r\n\t\t\t\t\tamount: data.total,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tmetadata: this.getOption('metadata'),\r\n\t\t}\r\n\t}\r\n\r\n\tonPaymentSuccess(event) {\r\n\t\tthis.payment.element.remove();\r\n\r\n\t\tthis.authorize(event)\r\n\t\t\t.then((result) => {\r\n\t\t\t\tif (result.status === 'success') {\r\n\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\twindow.location.href = result.data.redirect;\r\n\t\t\t\t\t}, 1000);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tthis.payment.showError('authorize', result.reasonCode, result.reason);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t}\r\n\r\n\tonPaymentAbort(event) {\r\n\r\n\t}\r\n\r\n\tonPaymentError(event) {\r\n\t\tsetTimeout(() => {\r\n\t\t\twindow.location.href = this.getOption('failUrl');\r\n\t\t}, 1000);\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\r\n\t\tYaPay.createSession(paymentData, {\r\n\t\t\tonSuccess: this.onPaymentSuccess.bind(this),\r\n\t\t\tonAbort: this.onPaymentAbort.bind(this),\r\n\t\t\tonError: this.onPaymentError.bind(this),\r\n\t\t\tagent: { name: 'CMS-Bitrix', version: '1.0' }\r\n\t\t})\r\n\t\t\t.then( (paymentSession) => {\r\n\r\n\t\t\t\tthis.widget.removeLoader();\r\n\r\n\t\t\t\tpaymentSession.mountButton(node, {\r\n\t\t\t\t\ttype: YaPay.ButtonType.Pay,\r\n\t\t\t\t\ttheme: this.getOption('buttonTheme') || YaPay.ButtonTheme.Black,\r\n\t\t\t\t\twidth: this.getOption('buttonWidth') || YaPay.ButtonWidth.Auto,\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.catch( (err) => {\r\n\t\t\t\tthis.payment.showError('yapayPayment','payment not created', err);\r\n\t\t\t});\r\n\t}\r\n\r\n\tauthorize(event) {\r\n\t\tlet data = {\r\n\t\t\torderId: event.orderId,\r\n\t\t\thash: event.metadata,\r\n\t\t\tsuccessUrl: this.getOption('successUrl'),\r\n\t\t};\r\n\r\n\t\treturn this.payment.query(this.getOption('restUrl') + 'authorize', data);\r\n\t}\r\n}","import Proxy from \"./proxy\";\r\n\r\nexport default class Site extends Proxy {\r\n\r\n\tgetPaymentData(data) {\r\n\t\treturn {\r\n\t\t\tenv: this.getOption('env'),\r\n\t\t\tversion: 2,\r\n\t\t\tcountryCode: YaPay.CountryCode.Ru,\r\n\t\t\tcurrencyCode: YaPay.CurrencyCode.Rub,\r\n\t\t\tmerchant: {\r\n\t\t\t\tid: this.getOption('merchantId'),\r\n\t\t\t\tname: this.getOption('merchantName')\r\n\t\t\t},\r\n\t\t\torder: {\r\n\t\t\t\tid: data.id,\r\n\t\t\t\ttotal: { amount: data.total },\r\n\t\t\t\titems: data.items\r\n\t\t\t},\r\n\t\t\tpaymentMethods: [\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: YaPay.PaymentMethodType.Card,\r\n\t\t\t\t\tgateway: this.getOption('gateway'),\r\n\t\t\t\t\tgatewayMerchantId: this.getOption('gatewayMerchantId'),\r\n\t\t\t\t\tallowedAuthMethods: [YaPay.AllowedAuthMethod.PanOnly],\r\n\t\t\t\t\tallowedCardNetworks: [\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.UnionPay,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Uzcard,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Discover,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.AmericanExpress,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Visa,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Mastercard,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Mir,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Maestro,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.VisaElectron\r\n\t\t\t\t\t]\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t}\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\t\tYaPay.createPayment(paymentData, { agent: { name: \"CMS-Bitrix\", version: \"1.0\" } })\r\n\t\t\t.then( (payment) => {\r\n\t\t\t\tlet button = payment.createButton({\r\n\t\t\t\t\ttype: YaPay.ButtonType.Pay,\r\n\t\t\t\t\ttheme: this.getOption('buttonTheme') || YaPay.ButtonTheme.Black,\r\n\t\t\t\t\twidth: this.getOption('buttonWidth') || YaPay.ButtonWidth.Auto,\r\n\t\t\t\t});\r\n\r\n\t\t\t\tthis.widget.removeLoader();\r\n\t\t\t\tbutton.mount(node);\r\n\r\n\t\t\t\tbutton.on(YaPay.ButtonEventType.Click, function onPaymentButtonClick() {\r\n\t\t\t\t\tpayment.checkout();\r\n\t\t\t\t});\r\n\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Process, (event) => {\r\n\r\n\t\t\t\t\tthis.notify(payment, event).then((result) => {});\r\n\r\n\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Success);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Error, function onPaymentError(event) {\r\n\t\t\t\t\tconsole.log({'errors': event});\r\n\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Error);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Abort, function onPaymentAbort(event) {});\r\n\t\t\t})\r\n\t\t\t.catch(function (err) {\r\n\t\t\t\tconsole.log({'payment not create': err});\r\n\t\t\t});\r\n\t}\r\n\r\n\tnotify(payment, yandexPayData) {\r\n\t\treturn fetch(this.getOption('notifyUrl'), {\r\n\t\t\tmethod: 'POST',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t},\r\n\t\t\tbody: JSON.stringify({\r\n\t\t\t\tservice: this.getOption('requestSign'),\r\n\t\t\t\taccept: 'json',\r\n\t\t\t\tyandexData: yandexPayData,\r\n\t\t\t\texternalId: this.getOption('externalId'),\r\n\t\t\t\tpaySystemId: this.getOption('paySystemId')\r\n\t\t\t})\r\n\t\t})\r\n\t\t\t.then(response => response.json())\r\n\t\t\t.then(result => {\r\n\t\t\t\tif (result.success === true) {\r\n\t\t\t\t\tthis.widget.go(result.state, result);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.widget.go('error', result);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(error => console.log(error) );\r\n\t}\r\n}","import AbstractStep from '../abstractstep';\r\nimport Rest from \"./rest\";\r\nimport Site from \"./site\";\r\n\r\nexport default class Payment extends AbstractStep {\r\n\trender(node, data) {\r\n\t\tthis.element = node;\r\n\t\tthis.bootProxy();\r\n\r\n\t\tconst paymentData = this.getPaymentData(data);\r\n\t\tthis.createPayment(node, paymentData);\r\n\t}\r\n\r\n\tbootProxy() : Rest|Site {\r\n\t\tthis.proxy = this.isRest() ? new Rest(this) : new Site(this);\r\n\t}\r\n\r\n\tgetPaymentData(data) {\r\n\t\treturn this.proxy.getPaymentData(data);\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\t\tthis.proxy.createPayment(node, paymentData);\r\n\t}\r\n}","import StepFactory from './step/factory';\r\nimport Loader from './step/loader';\r\nimport Page from \"../solution/reference/page\";\r\nimport NodePreserver from \"./ui/nodepreserver\";\r\n\r\nexport default class Widget {\r\n\r\n\tstatic defaults = {}\r\n\r\n\tdefaults;\r\n\toptions;\r\n\tloader;\r\n\tel;\r\n\tstep;\r\n\t/** @var Page|null */\r\n\tsolution;\r\n\t/** @var NodePreserver|null */\r\n\tpreserver;\r\n\r\n\t/**\r\n\t * @param {Object<Element>} element\r\n\t * @param {Object} options\r\n\t */\r\n\tconstructor(element, options = {}) {\r\n\t\tthis.defaults = Object.assign({}, this.constructor.defaults);\r\n\t\tthis.options = {};\r\n\t\tthis.el = element;\r\n\r\n\t\tthis.setOptions(options);\r\n\t}\r\n\r\n\tboot() {\r\n\t\tthis.bootSolution();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.destroyStep()\r\n\t\tthis.destroySolution();\r\n\t\tthis.destroyPreserver();\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object} data\r\n\t */\r\n\tpayment(data) {\r\n\t\tthis.go('payment', data);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object} data\r\n\t */\r\n\tcart(data){\r\n\t\tthis.go('cart', data);\r\n\t}\r\n\r\n\trestore(element) {\r\n\t\tthis.el = element;\r\n\t\tthis.step?.restore(element);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} type\r\n\t * @param {Object} data\r\n\t */\r\n\tgo(type, data) {\r\n\t\tthis.step = this.makeStep(type);\r\n\t\tthis.step.render(this.el, data);\r\n\t}\r\n\r\n\tdestroyStep() {\r\n\t\tthis.step?.destroy();\r\n\t}\r\n\r\n\tbootLoader() {\r\n\t\tthis.loader = new Loader(this);\r\n\t\tthis.loader.render(this.el);\r\n\t}\r\n\r\n\tremoveLoader() {\r\n\t\tif (this.loader == null) { return; }\r\n\t\tthis.loader.remove(this.el);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {String} type\r\n\t * @returns {AbstractCart|Finish|Step3ds|Payment|Failure}\r\n\t * @throws {Error}\r\n\t */\r\n\tmakeStep(type) {\r\n\t\tconst options = this.getOption(type) || {};\r\n\r\n\t\treturn StepFactory.make(type, this, options);\r\n\t}\r\n\r\n\tsetPreserver(preserver: NodePreserver) : void {\r\n\t\tthis.preserver = preserver;\r\n\t}\r\n\r\n\tdestroyPreserver() : void {\r\n\t\tthis.preserver?.destroy();\r\n\t}\r\n\r\n\tsetSolution(solution: Page) : void {\r\n\t\tthis.solution = solution;\r\n\t}\r\n\r\n\tgetSolution() : Page {\r\n\t\treturn this.solution;\r\n\t}\r\n\r\n\tbootSolution() {\r\n\t\tthis.getSolution()?.bootWidget(this);\r\n\t}\r\n\r\n\tdestroySolution() {\r\n\t\tthis.getSolution()?.destroyWidget(this);\r\n\t}\r\n\r\n\textendDefaults(options) {\r\n\t\tthis.defaults = Object.assign(this.defaults, options);\r\n\t}\r\n\r\n\tsetOptions(options) {\r\n\t\tthis.options = Object.assign(this.options, options);\r\n\t}\r\n\r\n\tgetOption(name) {\r\n\t\treturn this.options[name] ?? this.defaults[name];\r\n\t}\r\n}\r\n","import Secure3d from './secure3d';\r\nimport Finish from './finish';\r\nimport Failure from './failure';\r\nimport Loader from './loader';\r\nimport Cart from './cart/cart';\r\nimport Payment from './payment/payment';\r\n\r\nexport default class Factory {\r\n\r\n\t/**\r\n\t * @param {string} type\r\n\t * @param {Widget} widget\r\n\t * @param {Object} options\r\n\t * @returns {Cart|Finish|Step3ds|Payment|Failure}\r\n\t * @throws {Error}\r\n\t */\r\n\tstatic make(type, widget, options = {}) {\r\n\t\tif (type === '3ds') {\r\n\t\t\treturn new Secure3d(widget, options);\r\n\t\t} else if (type === 'finished') {\r\n\t\t\treturn new Finish(widget, options);\r\n\t\t} else if (type === 'error') {\r\n\t\t\treturn new Failure(widget, options);\r\n\t\t} else if (type === 'payment') {\r\n\t\t\treturn new Payment(widget, options);\r\n\t\t} else if (type === 'cart') {\r\n\t\t\treturn new Cart(widget, options);\r\n\t\t} else if (type === 'loader') {\r\n\t\t\treturn new Loader(widget, options);\r\n\t\t}\r\n\r\n\t\tthrow new Error('unknown step ' + type);\r\n\t}\r\n\r\n}","import FactoryClass from './factory';\r\nimport WidgetClass from './widget';\r\n\r\nconst previousFactory = window.BX?.YandexPay?.Factory;\r\nconst previousWidget = window.BX?.YandexPay?.Widget;\r\n\r\nexport const Factory = previousFactory ?? FactoryClass;\r\nexport const Widget = previousWidget ?? WidgetClass;"],"names":["MutationSkeleton","constructor","element","options","el","Object","assign","this","defaults","destroy","check","MutationLoop","loop","loopTimeout","loopCancel","clearTimeout","_loopTimeout","setTimeout","timeout","MutationObserver","listener","mutations","mutation","removedNodes","removedNode","HTMLElement","contains","runCheck","observe","disconnect","anchor","getAnchor","observer","window","childList","subtree","console","warn","delay","_checkTimeout","document","body","matched","selector","split","trim","closest","EventProxy","config","callbackMap","on","name","callback","matchEvent","onBxEvent","onJQueryEvent","onPlainEvent","off","offBxEvent","offJQueryEvent","offPlainEvent","fire","data","fireBxEvent","fireJQueryEvent","firePlainEvent","type","BX","addCustomEvent","removeCustomEvent","onCustomEvent","jQuery","selfConfig","typeConfig","canProxyCallback","originalCallback","evt","proxyData","originalEvent","_evt$originalEvent","detail","pushCallbackVariation","popCallbackVariation","hasPlainAndJQueryCollision","triggerHandler","CustomEvent","addEventListener","removeEventListener","dispatchEvent","proxy","WeakMap","set","map","result","get","delete","Subscriber","eventProxy","bind","unbind","bindOn","bindEvent","unbindOff","unbindEvent","event","Array","isArray","forEach","one","Composite","onFrameReady","boot","parent","parentElement","start","nodes","child","children","id","test","node","push","NodePreserver","found","restore","install","uninstall","installMutation","installSubscriber","installComposite","uninstallMutation","uninstallSubscriber","uninstallComposite","isEnabled","make","driverOptions","subscriber","composite","option","overrides","Template","template","vars","key","replaceKey","replaceValue","hasOwnProperty","toUpperCase","replace","indexOf","html","context","createElement","innerHTML","firstElementChild","Sdkloader","instance","load","_loadPromise","Promise","resolve","reject","testGlobal","script","getElementsByTagName","async","src","onload","loopGlobal","onerror","remove","Error","parentNode","insertBefore","YaPay","createPayment","Intersection","wait","IntersectionObserver","entries","entry","isIntersecting","target","unobserve","Display","factory","style","mount","payment","unmount","getOption","Button","collectHeight","collectBorder","collectWidth","Utils","compile","theme","ButtonTheme","Black","width","ButtonWidth","Max","mountButton","unmountButton","height","border","styleHeight","styleBorder","styleWidth","Widget","mountWidget","widgetType","WidgetType","Compact","widgetTheme","WidgetTheme","Dark","buttonTheme","borderRadius","bnplSelected","Number","unmountWidget","Factory","Concurrency","mode","widget","elements","index","splice","waitCount","setOptions","createSolution","bootSolution","bootLocal","inject","position","selectorSanitized","then","filterMedia","waitEvent","waitElement","checkElement","renderElement","insertLoader","intersection","preserve","testConcurrency","getInstance","resultParts","part","partSanitized","partSelector","matchMedia","testSelectorMedia","length","join","containerSelector","querySelector","containsSiblingElement","next","_anchor$parentElement","matches","nextElementSibling","preserver","preserveOptions","setPreserver","preserveOption","sibling","same","documentElement","pop","YandexPay","setSolution","solution","bootLoader","waitElementLoop","findElement","elementList","variant","searchBySelector","searchById","searchByClassName","reduceVisible","isCssSelector","collection","querySelectorAll","e","getElementById","getElementsByClassName","testVisible","offsetWidth","offsetHeight","getClientRects","partials","exec","divider","getDivider","display","getDisplay","toLowerCase","_this$getOption2","toElements","reverse","insertAdjacentElement","namespace","_window","_window$BX","_window$BX$YandexPay","Solution","_window$BX$YandexPay$","_window$BX$YandexPay$2","_window2","_window2$BX","_window2$BX$YandexPay","_window2$BX$YandexPay2","_window2$BX$YandexPay3","_window2$BX$YandexPay4","getFactory","create","createPage","bootFactory","label","extendDefaults","useDivider","loaderSelector","eventConfig","waitLimit","waitTimeout","AbstractStep","delayTimeouts","render","query","url","fetch","method","headers","JSON","stringify","response","json","isRest","getElement","getElementSelector","getNode","optionKey","substr","clearDelay","args","showError","message","err","notify","error","Base","setWidget","Form","autosubmit","makeInputs","value","params","keys","termUrl","makeTermUrl","backUrl","location","href","encodeURIComponent","submit","Iframe","insertIframe","iframe","contentIframe","contentWindow","contentDocument","open","write","close","IframeRbs","renderIframe","service","accept","secure","externalId","paySystemId","success","go","state","catch","log","action","Step3ds","view","makeView","SecureForm","SecureIframe","SecureRbs","Finish","Failure","Loader","toElement","restoreElement","loader","Proxy","cart","paymentData","getPaymentData","bootstrap","Rest","getButtonData","status","reason","combineOrderWithData","removeLoader","productId","currencyCode","setupId","env","version","merchantId","onPaymentSuccess","authorize","redirect","reasonCode","onPaymentAbort","onPaymentError","_mounted","createSession","onSuccess","onAbort","onError","agent","paymentSession","orderId","hash","metadata","successUrl","bindDebug","CheckoutEventType","arguments","initialContent","ButtonType","Checkout","exampleData","items","total","amount","changeOffer","newProductId","update","changeBasket","Site","reflow","countryCode","CountryCode","Ru","CurrencyCode","Rub","merchant","order","paymentMethods","PaymentMethodType","Card","gateway","gatewayMerchantId","allowedAuthMethods","AllowedAuthMethod","PanOnly","allowedCardNetworks","AllowedCardNetwork","UnionPay","Uzcard","Discover","AmericanExpress","Visa","Mastercard","Mir","Maestro","VisaElectron","requiredFields","billingContact","email","shippingContact","phone","shippingTypes","direct","pickup","Cash","getProducts","yapayAction","getShippingOptions","address","getPickupOptions","bounds","PaymentEventType","Process","orderAccept","code","isPaymentTypeCash","complete","CompleteReason","Success","Change","shippingAddress","shippingOptions","shippingOption","combineOrderWithDirectShipping","pickupBounds","pickupPoints","pickupInfo","getPickupDetail","pickupPointId","pickupPoint","combineOrderWithPickupShipping","Auto","paymentButton","createButton","ButtonEventType","Click","checkout","pickupId","delivery","deliveryType","shippingMethodInfo","paymentMethodInfo","contact","orderAmount","yandexPayData","yandexData","combineOrderWithProducts","pickupOption","amountSum","products","exampleOrder","amountA","amountB","toFixed","Cart","isBootstrap","bootProxy","delayBootstrap","destroyLocal","destroySolution","getSolution","bootCart","destroyCart","delayChangeBasket","delayChangeOffer","readyState","Pay","button","Abort","Payment","destroyStep","destroyPreserver","step","makeStep","Secure3d","bootWidget","destroyWidget","previousFactory","previousWidget","_window$BX2","_window$BX2$YandexPay","FactoryClass","WidgetClass"],"mappings":"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"}