{"version":3,"file":"widget.js","sources":["../solutionregistry.js","../ui/nodepreserver/mutationskeleton.js","../ui/nodepreserver/mutationloop.js","../ui/nodepreserver/mutationobserver.js","../ui/nodepreserver/mutationfactory.js","../ui/nodepreserver/subscriber.js","../ui/nodepreserver.js","../utils/template.js","../factory.js","../step/abstractstep.js","../secure3d/base.js","../secure3d/form.js","../secure3d/iframe.js","../secure3d/iframerbs.js","../step/secure3d.js","../step/finish.js","../step/failure.js","../step/payment.js","../step/cart/proxy.js","../step/cart/rest.js","../step/cart/site.js","../step/cart/abstractcart.js","../utils/ready.js","../step/factory.js","../widget.js"],"sourcesContent":["export default class SolutionRegistry {\r\n\r\n\tstatic pages = {};\r\n\r\n\tstatic getFactory(name) {\r\n\t\tif (name == null) { return null; }\r\n\r\n\t\tconst factory = window?.BX?.YandexPay?.Solution?.[name]?.factory;\r\n\r\n\t\tif (factory == null) {\r\n\t\t\tconsole?.warn(`cant find solution ${name}`);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\treturn factory;\r\n\t}\r\n\r\n\tstatic getPage(name, mode) {\r\n\t\tif (name == null || mode == null) { return null; }\r\n\r\n\t\tconst key = name + ':' + mode;\r\n\r\n\t\tif (this.pages[key] == null) {\r\n\t\t\tthis.pages[key] = this.createPage(name, mode);\r\n\t\t}\r\n\r\n\t\treturn this.pages[key];\r\n\t}\r\n\r\n\tstatic createPage(name, mode) {\r\n\t\tconst factory = this.getFactory(name);\r\n\r\n\t\tif (factory == null) { return null; }\r\n\r\n\t\treturn factory.create(mode);\r\n\t}\r\n\r\n}","export default class MutationSkeleton {\r\n\r\n\tstatic defaults = {\r\n\t\tcheck: null,\r\n\t}\r\n\r\n\tconstructor(element, options = {}) {\r\n\t\tthis.el = element;\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t}\r\n\r\n\tdestroy() {\r\n\r\n\t}\r\n\r\n}","import MutationSkeleton from \"./mutationskeleton\";\r\n\r\nexport default class MutationLoop extends MutationSkeleton {\r\n\r\n\tstatic defaults = Object.assign({}, MutationSkeleton.defaults, {\r\n\t\ttimeout: 1000,\r\n\t})\r\n\r\n\tconstructor(element, options = {}) {\r\n\t\tsuper(element, options);\r\n\t\tthis.loopTimeout();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.loopCancel();\r\n\t}\r\n\r\n\tloopTimeout() {\r\n\t\tclearTimeout(this._loopTimeout);\r\n\t\tthis._loopTimeout = setTimeout(this.loop, this.options.timeout);\r\n\t}\r\n\r\n\tloopCancel() {\r\n\t\tclearTimeout(this._loopTimeout);\r\n\t}\r\n\r\n\tloop = () => {\r\n\t\tthis.options.check() && this.loopTimeout();\r\n\t}\r\n\r\n}","import MutationSkeleton from \"./mutationskeleton\";\r\n\r\nexport default class MutationObserver extends MutationSkeleton {\r\n\r\n\tstatic defaults = Object.assign({}, MutationSkeleton.defaults, {\r\n\t\tanchor: null,\r\n\t\tdelay: 0,\r\n\t})\r\n\r\n\tconstructor(element, options = {}) {\r\n\t\tsuper(element, options);\r\n\t\tthis.observe();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.disconnect();\r\n\t}\r\n\r\n\tobserve() {\r\n\t\tconst anchor = this.getAnchor();\r\n\r\n\t\tif (anchor == null) {\r\n\t\t\tconsole?.warn('cant find anchor for node preserver');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.observer = new window.MutationObserver(this.listener);\r\n\t\tthis.observer.observe(anchor, {\r\n\t\t\tchildList: true,\r\n\t\t\tsubtree: true,\r\n\t\t});\r\n\t}\r\n\r\n\tdisconnect() {\r\n\t\tif (this.observer == null) { return; }\r\n\r\n\t\tthis.observer.disconnect();\r\n\t\tthis.observer = null;\r\n\t}\r\n\r\n\tlistener = (mutations) => {\r\n\t\tfor (const mutation of mutations) {\r\n\t\t\tif (mutation.removedNodes == null) { continue; }\r\n\r\n\t\t\tfor (const removedNode of mutation.removedNodes) {\r\n\t\t\t\tif (!(removedNode instanceof HTMLElement)) { continue; }\r\n\r\n\t\t\t\tif (removedNode === this.el || removedNode.contains(this.el)) {\r\n\t\t\t\t\tthis.runCheck();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\trunCheck() {\r\n\t\tconst delay = this.options.delay;\r\n\r\n\t\tif (delay == null) {\r\n\t\t\tthis.options.check();\r\n\t\t} else {\r\n\t\t\tclearTimeout(this._checkTimeout);\r\n\t\t\tthis._checkTimeout = setTimeout(() => { this.options.check(); }, delay);\r\n\t\t}\r\n\t}\r\n\r\n\tgetAnchor() {\r\n\t\tif (this.options.anchor == null) { return document.body; }\r\n\r\n\t\treturn this.el.closest(this.options.anchor);\r\n\t}\r\n\r\n}","import MutationLoop from \"./mutationloop\";\r\nimport MutationObserver from \"./mutationobserver\";\r\n\r\nexport default class MutationFactory {\r\n\r\n\tstatic make(element, options) {\r\n\t\tif (typeof window.MutationObserver === 'function') {\r\n\t\t\treturn new MutationObserver(element, options);\r\n\t\t}\r\n\r\n\t\treturn new MutationLoop(element, options);\r\n\t}\r\n\r\n}","export default class Subscriber {\r\n\r\n\tstatic defaults = {\r\n\t\tcheck: null,\r\n\t\ton: null,\r\n\t\toff: null,\r\n\t}\r\n\r\n\tconstructor(element, options = {}) {\r\n\t\tthis.el = element;\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\r\n\t\tthis.bind();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.unbind();\r\n\r\n\t\tthis.options = {};\r\n\t\tthis.el = null;\r\n\t}\r\n\r\n\tbind() {\r\n\t\tif (this.options.on == null) {\r\n\t\t\tconsole?.warn('define \"on\" option for subscriber of node preserver');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.options.on(this.options.check);\r\n\t}\r\n\r\n\tunbind() {\r\n\t\tif (this.options.off == null) {\r\n\t\t\tconsole?.warn('define \"off\" option for subscriber of node preserver');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.options.off(this.options.check);\r\n\t}\r\n\r\n}","import MutationFactory from \"./nodepreserver/mutationfactory\";\r\nimport Subscriber from \"./nodepreserver/subscriber\";\r\n\r\nexport default class NodePreserver {\r\n\r\n\tstatic defaults = {\r\n\t\trestore: null,\r\n\t\tsubscriber: null,\r\n\t\tmutation: true,\r\n\t}\r\n\r\n\t/** @var MutationSkeleton */\r\n\tmutation;\r\n\t/** @var Subscriber */\r\n\tsubscriber;\r\n\r\n\tconstructor(element, options = {}) {\r\n\t\tthis.el = element;\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\r\n\t\tthis.install();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.uninstall();\r\n\t\tthis.options = {};\r\n\t\tthis.el = null;\r\n\t}\r\n\r\n\tinstall() {\r\n\t\tthis.installMutation();\r\n\t\tthis.installSubscriber();\r\n\t}\r\n\r\n\tuninstall() {\r\n\t\tthis.uninstallMutation();\r\n\t\tthis.uninstallSubscriber();\r\n\t}\r\n\r\n\tinstallMutation() {\r\n\t\tif (!this.isEnabled('mutation')) { return; }\r\n\r\n\t\tthis.mutation = MutationFactory.make(this.el, this.driverOptions('mutation'));\r\n\t}\r\n\r\n\tuninstallMutation() {\r\n\t\tif (this.mutation == null) { return; }\r\n\r\n\t\tthis.mutation.destroy();\r\n\t}\r\n\r\n\tinstallSubscriber() {\r\n\t\tif (!this.isEnabled('subscriber')) { return; }\r\n\r\n\t\tthis.subscriber = new Subscriber(this.el, this.driverOptions('subscriber'));\r\n\t}\r\n\r\n\tuninstallSubscriber() {\r\n\t\tif (this.subscriber == null) { return; }\r\n\r\n\t\tthis.subscriber.destroy();\r\n\t\tthis.subscriber = null;\r\n\t}\r\n\r\n\tisEnabled(type) {\r\n\t\treturn !!this.options[type];\r\n\t}\r\n\r\n\tdriverOptions(type) {\r\n\t\tconst option = typeof this.options[type] === 'object' ? this.options[type] : {};\r\n\t\tconst overrides = {\r\n\t\t\tcheck: this.check,\r\n\t\t};\r\n\r\n\t\treturn Object.assign({}, option, overrides);\r\n\t}\r\n\r\n\tcheck = () => {\r\n\t\tconst found = document.body.contains(this.el);\r\n\r\n\t\tif (!found) {\r\n\t\t\tthis.options.restore();\r\n\t\t}\r\n\r\n\t\treturn found;\r\n\t}\r\n}","export default class Template {\r\n\r\n\t/**\r\n\t * @param {string=} template\r\n\t * @param {Object} vars\r\n\t * @returns {string}\r\n\t */\r\n\tstatic compile(template, vars) {\r\n\t\tlet key;\r\n\t\tlet replaceKey;\r\n\t\tlet replaceValue;\r\n\t\tlet result = template;\r\n\r\n\t\tfor (key in vars) {\r\n\t\t\tif (!vars.hasOwnProperty(key)) { continue; }\r\n\r\n\t\t\treplaceKey = '#' + key.toUpperCase() + '#';\r\n\t\t\treplaceValue = vars[key];\r\n\r\n\t\t\tdo {\r\n\t\t\t\tresult = result.replace(replaceKey, replaceValue);\r\n\t\t\t} while (result.indexOf(replaceKey) !== -1);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tstatic toElement(html) {\r\n\t\tconst context = document.createElement('div');\r\n\t\tcontext.innerHTML = html;\r\n\r\n\t\treturn context.firstElementChild;\r\n\t}\r\n\r\n\tstatic toElements(html) {\r\n\t\tconst context = document.createElement('div');\r\n\t\tcontext.innerHTML = html;\r\n\r\n\t\treturn [...context.children];\r\n\t}\r\n\r\n}","import SolutionRegistry from './solutionregistry';\r\nimport NodePreserver from \"./ui/nodepreserver\";\r\nimport Utils from './utils/template';\r\n\r\nexport default class Factory {\r\n\r\n\tstatic defaults = {\r\n\t\tsolution: null,\r\n\t\ttemplate: '<div id=\"yandexpay\" class=\"bx-yapay-drawer\"></div>',\r\n\t\tcontainerSelector: '.bx-yapay-drawer',\r\n\t\tpreserve: false,\r\n\t\twaitLimit: 30,\r\n\t\twaitTimeout: 1000,\r\n\t}\r\n\r\n\tdefaults;\r\n\toptions;\r\n\twaitCount = 0;\r\n\r\n\tconstructor(options = {}) {\r\n\t\tthis.defaults = Object.assign({}, this.constructor.defaults);\r\n\t\tthis.options = {};\r\n\r\n\t\tthis.setOptions(options);\r\n\t\tthis.bootSolution();\r\n\t}\r\n\r\n\tinject(selector, position) {\r\n\t\treturn Promise.resolve()\r\n\t\t\t.then(() => this.waitElement(selector))\r\n\t\t\t.then((anchor) => this.checkElement(anchor))\r\n\t\t\t.then((anchor) => {\r\n\t\t\t\tconst element = this.renderElement(anchor, position);\r\n\t\t\t\tconst widget = this.install(element);\r\n\r\n\t\t\t\tif (this.getOption('preserve')) {\r\n\t\t\t\t\tthis.preserve(selector, position, widget);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn widget;\r\n\t\t\t})\r\n\t}\r\n\r\n\tcheckElement(anchor) {\r\n\t\tconst selector = this.getOption('containerSelector');\r\n\t\tconst contains = (\r\n\t\t\t!!anchor.querySelector(selector)\r\n\t\t\t|| this.containsSiblingElement(anchor, selector)\r\n\t\t);\r\n\r\n\t\tif (contains) {\r\n\t\t\tthrow new Error('the element already has a container');\r\n\t\t}\r\n\r\n\t\treturn anchor;\r\n\t}\r\n\r\n\tcontainsSiblingElement(anchor, selector) {\r\n\t\tlet result = false;\r\n\t\tlet next = anchor.parentElement?.firstElementChild;\r\n\r\n\t\twhile (next) {\r\n\t\t\tif (next.matches(selector) || next.querySelector(selector)) {\r\n\t\t\t\tresult = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tnext = next.nextElementSibling;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\t\r\n\tpreserve(selector, position, widget) {\r\n\t\tconst preserver = new NodePreserver(widget.el, Object.assign({}, this.preserveOptions(), {\r\n\t\t\trestore: () => {\r\n\t\t\t\tpreserver.destroy();\r\n\t\t\t\t// noinspection JSIgnoredPromiseFromCall\r\n\t\t\t\tthis.restore(selector, position, widget);\r\n\t\t\t},\r\n\t\t}));\r\n\t}\r\n\r\n\tpreserveOptions() {\r\n\t\tconst preserveOption = this.getOption('preserve');\r\n\r\n\t\treturn typeof preserveOption === 'object' ? preserveOption : {};\r\n\t}\r\n\r\n\trestore(selector, position, widget) {\r\n\t\treturn Promise.resolve()\r\n\t\t\t.then(() => this.waitElement(selector))\r\n\t\t\t.then((anchor) => {\r\n\t\t\t\tconst element = this.renderElement(anchor, position);\r\n\r\n\t\t\t\twidget.restore(element);\r\n\r\n\t\t\t\tif (this.getOption('preserve')) {\r\n\t\t\t\t\tthis.preserve(selector, position, widget);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn widget;\r\n\t\t\t});\r\n\t}\r\n\r\n\tinstall(element) {\r\n\t\treturn new BX.YandexPay.Widget(element);\r\n\t}\r\n\r\n\twaitElement(selector) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthis.waitCount = 0;\r\n\t\t\tthis.waitElementLoop(selector, resolve, reject);\r\n\t\t});\r\n\t}\r\n\r\n\twaitElementLoop(selector, resolve, reject) {\r\n\t\tconst anchor = this.findElement(selector);\r\n\r\n\t\tif (anchor) {\r\n\t\t\tresolve(anchor);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t++this.waitCount;\r\n\r\n\t\tif (this.waitCount >= this.getOption('waitLimit')) {\r\n\t\t\treject('cant find element by selector ' + selector);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsetTimeout(this.waitElementLoop.bind(this, selector, resolve, reject), this.getOption('waitTimeout'));\r\n\t}\r\n\r\n\tfindElement(selector) {\r\n\t\tlet elementList;\r\n\t\tlet variant = selector.trim();\r\n\t\tlet result;\r\n\r\n\t\tif (variant === '') { throw new Error('widget selector is empty'); }\r\n\r\n\t\telementList = this.searchBySelector(variant) ?? this.searchById(selector) ?? this.searchByClassName(selector);\r\n\r\n\t\tif (elementList == null) { return null; }\r\n\r\n\t\tif (elementList.length > 1) {\r\n\t\t\tresult = this.reduceVisible(elementList);\r\n\t\t}\r\n\r\n\t\tif (result == null) {\r\n\t\t\tresult = elementList[0];\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tsearchBySelector(selector) {\r\n\t\ttry {\r\n\t\t\tconst result = [];\r\n\r\n\t\t\tfor (const part of selector.split(',')) { // first selector\r\n\t\t\t\tconst partSanitized = part.trim();\r\n\r\n\t\t\t\tif (partSanitized === '' || !this.isCssSelector(partSanitized)) { continue; }\r\n\r\n\t\t\t\tconst collection = document.querySelectorAll(partSanitized);\r\n\r\n\t\t\t\tfor (const element of collection) {\r\n\t\t\t\t\tresult.push(element);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn result.length > 0 ? result : null;\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tsearchById(selector) {\r\n\t\ttry {\r\n\t\t\tconst element = document.getElementById(selector);\r\n\r\n\t\t\treturn element != null ? [element] : null;\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tsearchByClassName(selector) {\r\n\t\ttry {\r\n\t\t\tconst collection = document.getElementsByClassName(selector);\r\n\r\n\t\t\treturn collection.length > 0 ? collection : null;\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\treduceVisible(collection) {\r\n\t\tlet result = null;\r\n\t\t\r\n\t\tfor (const element of collection) {\r\n\t\t\tif (this.testVisible(element)) {\r\n\t\t\t\tresult = element;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\t\r\n\ttestVisible(element) {\r\n\t\treturn (element.offsetWidth || element.offsetHeight || element.getClientRects().length );\r\n\t}\r\n\r\n\tisCssSelector(selector) {\r\n\t\treturn /^[.#]/.test(selector);\r\n\t}\r\n\r\n\trenderElement(anchor, position) {\r\n\t\tconst selector = this.getOption('containerSelector');\r\n\t\tconst width = this.getOption('buttonWidth') || YaPay.ButtonWidth.Auto;\r\n\t\tconst html = Utils.compile(this.getOption('template'), {\r\n\t\t\tlabel: this.getOption('label'),\r\n\t\t\twidth: width.toLowerCase(),\r\n\t\t});\r\n\t\tlet elements = Utils.toElements(html);\r\n\t\tlet result = null;\r\n\r\n\t\tif (position.indexOf('after') === 0) { elements = elements.reverse(); }\r\n\r\n\t\tfor (const element of elements) {\r\n\t\t\tanchor.insertAdjacentElement(position, element);\r\n\r\n\t\t\tif (result != null) { continue; }\r\n\r\n\t\t\tresult = element.matches(selector) ? element : element.querySelector(selector);\r\n\t\t}\r\n\r\n\t\tif (result == null) {\r\n\t\t\tthrow new Error(`cant find template container by selector ${selector}`);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tbootSolution() {\r\n\t\tconst name = this.getOption('solution');\r\n\t\tconst mode = this.getOption('mode');\r\n\t\tconst solution = SolutionRegistry.getPage(name, mode);\r\n\r\n\t\tif (solution == null) { return; }\r\n\r\n\t\tsolution.bootFactory(this);\r\n\t}\r\n\r\n\textendDefaults(options) {\r\n\t\tthis.defaults = Object.assign(this.defaults, options);\r\n\t}\r\n\r\n\tsetOptions(options) {\r\n\t\tthis.options = Object.assign(this.options, options);\r\n\t}\r\n\r\n\tgetOption(name) {\r\n\t\treturn this.options[name] ?? this.defaults[name]\r\n\t}\r\n}","import Template from '../utils/template';\r\n\r\nexport default class AbstractStep {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '',\r\n\t}\r\n\r\n\tdefaults;\r\n\toptions;\r\n\twidget;\r\n\tdelayTimeouts = {};\r\n\r\n\t/**\r\n\t * @param {Widget} widget\r\n\t * @param {Object} options\r\n\t */\r\n\tconstructor(widget, options = {}) {\r\n\t\tthis.widget = widget;\r\n\t\tthis.defaults = Object.assign({}, this.constructor.defaults);\r\n\t\tthis.options = Object.assign({}, options);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param {string} name\r\n\t * @returns {*}\r\n\t */\r\n\tgetOption(name) {\r\n\t\treturn this.options[name] ?? this.widget.getOption(name) ?? this.defaults[name];\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object<Element>} node Element\r\n\t * @param {Object} data Options\r\n\t */\r\n\trender(node, data = {}) {\r\n\t\tnode.innerHTML = this.compile(data);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object} data\r\n\t * @returns {string}\r\n\t */\r\n\tcompile(data) {\r\n\t\treturn Template.compile(this.getOption('template'), data);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object<Element>} node\r\n\t */\r\n\trestore(node) {\r\n\t\t// nothing by default\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} url\r\n\t * @param {Object} data\r\n\t * @returns {Promise.<Object>}\r\n\t */\r\n\tquery(url, data) {\r\n\t\treturn fetch(url, {\r\n\t\t\tmethod: 'POST',\r\n\t\t\theaders: { 'Content-Type': 'application/json' },\r\n\t\t\tbody: JSON.stringify(data)\r\n\t\t})\r\n\t\t\t.then(response => {return response.json()})\r\n\t}\r\n\r\n\tgetTemplate(key) {\r\n\t\tlet optionKey = key + 'Template';\r\n\t\tlet option = this.options[optionKey];\r\n\t\tlet optionFirstSymbol = option.substr(0, 1);\r\n\t\tlet result;\r\n\r\n\t\tif (optionFirstSymbol === '.' || optionFirstSymbol === '#') {\r\n\t\t\tresult = this.getNode(option).innerHTML;\r\n\t\t} else {\r\n\t\t\tresult = option;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetElement(key, context, method) {\r\n\t\tlet selector = this.getElementSelector(key);\r\n\r\n\t\treturn this.getNode(selector, context, method || 'querySelector');\r\n\t}\r\n\r\n\tgetElementSelector(key) {\r\n\t\tlet optionKey = key + 'Element';\r\n\r\n\t\treturn this.options[optionKey];\r\n\t}\r\n\r\n\tgetNode(selector, context, method) {\r\n\t\tif (selector.substr(0, 1) === '#') { // is id query\r\n\t\t\tcontext = document;\r\n\t\t} else if (!context) {\r\n\t\t\tcontext = this.el;\r\n\t\t}\r\n\r\n\t\treturn context[method](selector);\r\n\t}\r\n\r\n\tclearDelay(name) {\r\n\t\tif (this.delayTimeouts[name] == null) { return; }\r\n\r\n\t\tclearTimeout(this.delayTimeouts[name]);\r\n\t\tthis.delayTimeouts[name] = null;\r\n\t}\r\n\r\n\tdelay(name, args = [], timeout = 300) {\r\n\t\tthis.clearDelay(name);\r\n\t\tthis.delayTimeouts[name] = setTimeout(this[name].bind(this, ...args), timeout);\r\n\t}\r\n\r\n}","import Template from \"../utils/template\";\r\n\r\nexport default class Base {\r\n\tstatic defaults = {\r\n\t\ttemplate: null,\r\n\t}\r\n\r\n\tconstructor(options = {}) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t\tthis.widget = null;\r\n\t}\r\n\r\n\trender(node, data = {}) {\r\n\t\tnode.innerHTML = this.compile(data);\r\n\t}\r\n\r\n\tcompile(data) {\r\n\t\treturn Template.compile(this.options.template, data);\r\n\t}\r\n\r\n\tsetWidget(widget) {\r\n\t\tthis.widget = widget;\r\n\t}\r\n\r\n\tgetOption(key) {\r\n\t\tif (key in this.options) {\r\n\t\t\treturn this.options[key];\r\n\t\t} else {\r\n\t\t\treturn this.widget.options[key];\r\n\t\t}\r\n\t}\r\n}","import Base from \"./base\";\r\nimport Template from \"../utils/template\";\r\n\r\nexport default class Form extends Base {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<form name=\"form\" action=\"#ACTION#\" method=\"#METHOD#\">'\r\n\t\t\t+ '#INPUTS#'\r\n\t\t\t+ '</form>',\r\n\t}\r\n\r\n\trender(node, data) {\r\n\t\tsuper.render(node, data);\r\n\t\tthis.autosubmit(node);\r\n\t}\r\n\r\n\tcompile(data) {\r\n\t\tconst template = this.options.template;\r\n\t\tconst vars = Object.assign(data, {\r\n\t\t\t'inputs': this.makeInputs(data)\r\n\t\t});\r\n\r\n\t\treturn Template.compile(template, vars);\r\n\t}\r\n\r\n\tmakeInputs(data) {\r\n\t\tlet key;\r\n\t\tlet vars = data.params;\r\n\t\tlet value;\r\n\t\tlet template;\r\n\r\n\t\tif (Object.keys(vars).length === 0) { return ''; }\r\n\r\n\t\ttemplate = data.termUrl ? '<input type=\"hidden\" name=\"TermUrl\" value=\"' + vars.termUrl + '\">' : '';\r\n\r\n\t\tfor (key in vars)\r\n\t\t{\r\n\t\t\tif (!vars.hasOwnProperty(key)) { continue; }\r\n\r\n\t\t\tvalue = vars[key];\r\n\r\n\t\t\ttemplate += '<input type=\"hidden\" name=\"' + key + '\" value=\"' + value + '\">';\r\n\t\t}\r\n\r\n\t\treturn template;\r\n\t}\r\n\r\n\tmakeTermUrl() {\r\n\t\tlet result = this.getOption('notifyUrl');\r\n\t\tlet backUrl = window.location.href;\r\n\r\n\t\tresult +=\r\n\t\t\t(result.indexOf('?') === -1 ? '?' : '&')\r\n\t\t\t+ 'backurl=' + encodeURIComponent(backUrl)\r\n\t\t\t+ '&service=' + this.getOption('requestSign')\r\n\t\t\t+ '&paymentId=' + this.getOption('externalId');\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tautosubmit(node) {\r\n\t\tconst form = node.querySelector('form');\r\n\r\n\t\tform.submit();\r\n\t}\r\n}","import Base from \"./base\";\r\nimport Template from \"../utils/template\";\r\n\r\nexport default class Iframe extends Base {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<iframe style=\"display: none;\"></iframe>',\r\n\t}\r\n\r\n\trender(node, data) {\r\n\t\tthis.insertIframe(node, data);\r\n\t}\r\n\r\n\tinsertIframe(node, data) {\r\n\t\tnode.innerHTML = Template.compile(this.options.template, data);\r\n\t\tthis.compile(node, data);\r\n\t}\r\n\r\n\tcompile(node, data) {\r\n\t\tlet iframe = node.querySelector('iframe');\r\n\t\tlet contentIframe = iframe.contentWindow || ( iframe.contentDocument.document || iframe.contentDocument);\r\n\t\tlet html = data.params;\r\n\r\n\t\tcontentIframe.document.open();\r\n\t\tcontentIframe.document.write(html);\r\n\t\tcontentIframe.document.close();\r\n\t}\r\n}","import Base from \"./base\";\r\nimport Template from \"../utils/template\";\r\n\r\nexport default class IframeRbs extends Base {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<iframe style=\"display: none;\"></iframe>',\r\n\t}\r\n\r\n\trender(node, data) {\r\n\t\tthis.insertIframe(node, data);\r\n\t}\r\n\r\n\tinsertIframe(node, data) {\r\n\t\tnode.innerHTML = Template.compile(this.options.template, data);\r\n\t\tthis.compile(node, data);\r\n\t}\r\n\r\n\tcompile(node, data) {\r\n\t\tPromise.resolve()\r\n\t\t\t.then(() => this.renderIframe(node, data))\r\n\t\t\t.then(() => this.query(data));\r\n\t}\r\n\r\n\tquery (data) {\r\n\t\tfetch(this.getOption('notifyUrl'), {\r\n\t\t\tmethod: 'POST',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t},\r\n\t\t\tbody: JSON.stringify({\r\n\t\t\t\tservice: this.getOption('requestSign'),\r\n\t\t\t\taccept: 'json',\r\n\t\t\t\tsecure: data.params.secure,\r\n\t\t\t\texternalId: data.params.notify.externalId,\r\n\t\t\t\tpaySystemId: data.params.notify.paySystemId\r\n\t\t\t})\r\n\t\t})\r\n\t\t\t.then(response => response.json())\r\n\t\t\t.then(result => {\r\n\t\t\t\tif (result.success === true) {\r\n\t\t\t\t\tthis.widget.go(result.state, result);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.widget.go('error', result);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(error => console.log(error) );\r\n\t}\r\n\r\n\trenderIframe(node, data) {\r\n\t\tlet iframe = node.querySelector('iframe');\r\n\t\tlet contentIframe = iframe.contentWindow || ( iframe.contentDocument.document || iframe.contentDocument);\r\n\t\tlet html = `<form name=\"form\" action=\"${data.action}\" method=\"POST\">`;\r\n\r\n\t\tcontentIframe.document.open();\r\n\t\tcontentIframe.document.write(html);\r\n\t\tcontentIframe.document.close();\r\n\r\n\t\tcontentIframe.document.querySelector('form').submit();\r\n\t}\r\n}\r\n","import AbstractStep from \"./abstractstep\";\r\nimport SecureForm from \"../secure3d/form\";\r\nimport SecureIframe from \"../secure3d/iframe\";\r\nimport SecureRbs from \"../secure3d/iframerbs\";\r\n\r\nexport default class Step3ds extends AbstractStep {\r\n\r\n\trender(node, data) {\r\n\t\tconst view = this.makeView(data);\r\n\t\tview.setWidget(this.widget);\r\n\t\tview.render(node, data);\r\n\t}\r\n\r\n\tmakeView(data) {\r\n\t\tlet view = data.view;\r\n\r\n\t\tif (view === 'form') {\r\n\t\t\treturn new SecureForm();\r\n\t\t} else if (view === 'iframe') {\r\n\t\t\treturn new SecureIframe();\r\n\t\t} else if (view === 'iframerbs') {\r\n\t\t\treturn new SecureRbs();\r\n\t\t}\r\n\r\n\t\tthrow new Error('view secure3d missing')\r\n\t}\r\n}","import AbstractStep from './abstractstep';\r\n\r\nexport default class Finish extends AbstractStep {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<div class=\"alert alert-success\" role=\"alert\"><strong>#MESSAGE#</strong></div>'\r\n\t}\r\n\r\n}","import AbstractStep from './abstractstep';\r\n\r\nexport default class Failure extends AbstractStep {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<div class=\"alert alert-danger\" role=\"alert\"><strong>#MESSAGE#</strong></div>'\r\n\t}\r\n\r\n}","import Template from '../utils/template';\r\nimport AbstractStep from './abstractstep';\r\n\r\nconst YaPay = window.YaPay;\r\n\r\nexport default class Payment extends AbstractStep {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<div class=\"alert alert-success\" role=\"alert\"><strong>#MESSAGE#</strong></div>'\r\n\t}\r\n\r\n\trender(node, data) {\r\n\t\tconst paymentData = this.getPaymentData(data);\r\n\r\n\t\tthis.createPayment(node, paymentData);\r\n\t}\r\n\r\n\tcompile(data) {\r\n\t\treturn Template.compile(this.options.template, data);\r\n\t}\r\n\r\n\tgetPaymentData(data) {\r\n\t\treturn {\r\n\t\t\tenv: this.getOption('env'),\r\n\t\t\tversion: 2,\r\n\t\t\tcountryCode: YaPay.CountryCode.Ru,\r\n\t\t\tcurrencyCode: YaPay.CurrencyCode.Rub,\r\n\t\t\tmerchant: {\r\n\t\t\t\tid: this.getOption('merchantId'),\r\n\t\t\t\tname: this.getOption('merchantName')\r\n\t\t\t},\r\n\t\t\torder: {\r\n\t\t\t\tid: data.id,\r\n\t\t\t\ttotal: { amount: data.total },\r\n\t\t\t\titems: data.items\r\n\t\t\t},\r\n\t\t\tpaymentMethods: [\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: YaPay.PaymentMethodType.Card,\r\n\t\t\t\t\tgateway: this.getOption('gateway'),\r\n\t\t\t\t\tgatewayMerchantId: this.getOption('gatewayMerchantId'),\r\n\t\t\t\t\tallowedAuthMethods: [YaPay.AllowedAuthMethod.PanOnly],\r\n\t\t\t\t\tallowedCardNetworks: [\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.UnionPay,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Uzcard,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Discover,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.AmericanExpress,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Visa,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Mastercard,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Mir,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Maestro,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.VisaElectron\r\n\t\t\t\t\t]\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t}\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\t\t// Создать платеж.\r\n\t\tYaPay.createPayment(paymentData, { agent: { name: \"CMS-Bitrix\", version: \"1.0\" } })\r\n\t\t\t.then( (payment) => {\r\n\t\t\t\t// Создать экземпляр кнопки.\r\n\t\t\t\tlet button = payment.createButton({\r\n\t\t\t\t\ttype: YaPay.ButtonType.Pay,\r\n\t\t\t\t\ttheme: this.getOption('buttonTheme') || YaPay.ButtonTheme.Black,\r\n\t\t\t\t\twidth: this.getOption('buttonWidth') || YaPay.ButtonWidth.Auto,\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Смонтировать кнопку в DOM.\r\n\t\t\t\tbutton.mount(node);\r\n\r\n\t\t\t\t// Подписаться на событие click.\r\n\t\t\t\tbutton.on(YaPay.ButtonEventType.Click, function onPaymentButtonClick() {\r\n\t\t\t\t\t// Запустить оплату после клика на кнопку.\r\n\t\t\t\t\tpayment.checkout();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Подписаться на событие process.\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Process, (event) => {\r\n\t\t\t\t\t// Получить платежный токен.\r\n\t\t\t\t\tthis.notify(payment, event).then((result) => {\r\n\t\t\t\t\t});\r\n\t\t\t\t\t/*alert('Payment token — ' + event.token);\r\n\r\n\t\t\t\t\t// Опционально (если выполнить шаг 7).\r\n\t\t\t\t\talert('Billing email — ' + event.billingContact.email);\r\n\r\n\t\t\t\t\t// Закрыть форму Yandex Pay.\r\n\t\t\t\t\t*/\r\n\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Success);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Подписаться на событие error.\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Error, function onPaymentError(event) {\r\n\t\t\t\t\t// Вывести информацию о недоступности оплаты в данный момент\r\n\t\t\t\t\t// и предложить пользователю другой способ оплаты.\r\n\r\n\t\t\t\t\t// Закрыть форму Yandex.Pay.\r\n\t\t\t\t\tconsole.log({'errors': event});\r\n\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Error);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Подписаться на событие abort.\r\n\t\t\t\t// Это когда пользователь закрыл форму Yandex Pay.\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Abort, function onPaymentAbort(event) {\r\n\t\t\t\t\t// Предложить пользователю другой способ оплаты.\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.catch(function (err) {\r\n\t\t\t\t// Платеж не создан.\r\n\t\t\t\tconsole.log({'payment not create': err});\r\n\t\t\t});\r\n\t}\r\n\r\n\tnotify(payment, yandexPayData) {\r\n\t\treturn fetch(this.getOption('notifyUrl'), {\r\n\t\t\tmethod: 'POST',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t},\r\n\t\t\tbody: JSON.stringify({\r\n\t\t\t\tservice: this.getOption('requestSign'),\r\n\t\t\t\taccept: 'json',\r\n\t\t\t\tyandexData: yandexPayData,\r\n\t\t\t\texternalId: this.getOption('externalId'),\r\n\t\t\t\tpaySystemId: this.getOption('paySystemId')\r\n\t\t\t})\r\n\t\t})\r\n\t\t\t.then(response => response.json())\r\n\t\t\t.then(result => {\r\n\t\t\t\tif (result.success === true) {\r\n\t\t\t\t\tthis.widget.go(result.state, result);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.widget.go('error', result);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(error => console.log(error) );\r\n\t}\r\n}","export default class Proxy {\n\n\tconstructor(cart) {\n\t\tthis.cart = cart;\n\t}\n\n\tgetOption(name) {\n\t\treturn this.cart.getOption(name);\n\t}\n\n\tbootstrap() {\n\n\t}\n\n\tcreatePayment(node, paymentData) {\n\n\t}\n\n\tgetPaymentData() {\n\n\t}\n}","import Proxy from \"./proxy\";\n\nexport default class RestProxy extends Proxy {\n\n\tbootstrap() {\n\t\tthis.getButtonData()\n\t\t\t.then((result) => {\n\n\t\t\t\tif (result.status === 'fail') { throw new Error(result.reason); }\n\n\t\t\t\tthis.combineOrderWithData(result.data);\n\t\t\t\tthis.createPayment(this.cart.element, this.cart.paymentData);\n\n\t\t\t})\n\t\t\t.catch((error) => {\n\n\t\t\t});\n\t}\n\n\tgetButtonData() {\n\n\t\tlet data = {\n\t\t\tproductId: this.getOption('productId'),\n\t\t\tmode: this.getOption('mode'),\n\t\t\tcurrencyCode: this.getOption('currencyCode'),\n\t\t};\n\n\t\treturn this.cart.query(this.getOption('restUrl'), data);\n\t}\n\n\tgetPaymentData() {\n\t\treturn {\n\t\t\tenv: this.getOption('env'),\n\t\t\tversion: 2,\n\t\t\tmerchant: {\n\t\t\t\tid: this.getOption('merchantId'),\n\t\t\t\tname: this.getOption('merchantName'),\n\t\t\t},\n\t\t\torder: { id: '0' },\n\t\t}\n\t}\n\n\tcreatePayment(node, paymentData) {\n\t\t// Создать платеж.\n\t\tYaPay.createPayment(paymentData, { agent: { name: \"CMS-Bitrix\", version: \"1.0\" } })\n\t\t\t.then((payment) => {\n\t\t\t\tthis.cart.removeLoader();\n\t\t\t\tthis.cart.mountButton(node, payment);\n\n\t\t\t\t// Подписаться на событие process.\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Process, (event) => {\n\t\t\t\t\t// Получить платежный токен.\n\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Success);\n\t\t\t\t\tthis.cart.paymentButton.destroy();\n\n\t\t\t\t\tconsole.log(\"Process\", event);\n\t\t\t\t});\n\n\t\t\t\t// Подписаться на событие error.\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Error, (event) => {\n\n\t\t\t\t\t//this.cart.showError('yapayError', 'service temporary unavailable');\n\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Error);\n\t\t\t\t\tthis.cart.paymentButton.destroy();\n\n\t\t\t\t\tconsole.log(\"Process\", event);\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tnode.remove();\n\t\t\t\tthis.cart.showError('yapayPayment','payment not created', err);\n\t\t\t});\n\t}\n\n\tcombineOrderWithData(data) {\n\t\tconst { order } = this.cart.paymentData;\n\n\t\tlet exampleData = {\n\t\t\torder: {\n\t\t\t\titems: data.items,\n\t\t\t\ttotal: {\n\t\t\t\t\tamount: data.total.amount,\n\t\t\t\t},\n\t\t\t\t...order\n\t\t\t},\n\t\t\tmetadata: data.metadata\n\t\t};\n\n\t\tObject.assign(this.cart.paymentData, exampleData);\n\t}\n\n\tchangeOffer(newProductId) {\n\t\tlet productId = this.getOption('productId');\n\n\t\tif (productId !== newProductId) { // todo in items\n\t\t\tthis.cart.widget.setOptions({productId: newProductId});\n\t\t\tthis.getButtonData().then((result) => {\n\t\t\t\tthis.combineOrderWithData(result);\n\t\t\t});\n\t\t}\n\t}\n}","import Proxy from \"./proxy\";\n\nexport default class SiteProxy extends Proxy {\n\n\tbootstrap() {\n\t\tthis.getProducts()\n\t\t\t.then((result) => {\n\n\t\t\t\tif (result.error) { throw new Error(result.error.message); }\n\n\t\t\t\tthis.combineOrderWithProducts(result);\n\t\t\t\tthis.createPayment(this.cart.element, this.cart.paymentData);\n\n\t\t\t})\n\t\t\t.catch((error) => {\n\n\t\t\t});\n\t}\n\n\tgetPaymentData() {\n\t\treturn {\n\t\t\tenv: this.getOption('env'),\n\t\t\tversion: 2,\n\t\t\tcountryCode: YaPay.CountryCode.Ru,\n\t\t\tcurrencyCode: YaPay.CurrencyCode.Rub,\n\t\t\tmerchant: {\n\t\t\t\tid: this.getOption('merchantId'),\n\t\t\t\tname: this.getOption('merchantName'),\n\t\t\t\turl: this.getOption('siteUrl')\n\t\t\t},\n\t\t\torder: { id: '0' },\n\t\t\tpaymentMethods: [\n\t\t\t\t{\n\t\t\t\t\ttype: YaPay.PaymentMethodType.Card,\n\t\t\t\t\tgateway: this.getOption('gateway'),\n\t\t\t\t\tgatewayMerchantId: this.getOption('gatewayMerchantId'),\n\t\t\t\t\tallowedAuthMethods: [YaPay.AllowedAuthMethod.PanOnly],\n\t\t\t\t\tallowedCardNetworks: [\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.UnionPay,\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Uzcard,\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Discover,\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.AmericanExpress,\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Visa,\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Mastercard,\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Mir,\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Maestro,\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.VisaElectron\n\t\t\t\t\t]\n\t\t\t\t}\n\t\t\t],\n\n\t\t\trequiredFields: {\n\n\t\t\t\tbillingContact: {\n\t\t\t\t\temail: this.getOption('useEmail') || false\n\t\t\t\t},\n\n\t\t\t\tshippingContact: {\n\t\t\t\t\tname: this.getOption('useName') || false,\n\t\t\t\t\temail: this.getOption('useEmail') || false,\n\t\t\t\t\tphone: this.getOption('usePhone') || false,\n\t\t\t\t},\n\n\t\t\t\tshippingTypes: {\n\t\t\t\t\tdirect: true,\n\t\t\t\t\tpickup: true,\n\t\t\t\t},\n\t\t\t}\n\t\t}\n\t}\n\n\tgetProducts(){\n\n\t\tlet data = {\n\t\t\tyapayAction: 'getProducts',\n\t\t\tproductId: this.getOption('productId'),\n\t\t\tmode: this.getOption('mode'),\n\t\t\tsetupId: this.getOption('setupId')\n\t\t};\n\n\t\treturn this.cart.query(this.getOption('purchaseUrl'), data);\n\t}\n\n\tgetShippingOptions(address) {\n\n\t\tlet data = {\n\t\t\taddress: address,\n\t\t\tyapayAction: 'deliveryOptions',\n\t\t\titems: this.cart.paymentData.order.items,\n\t\t\tsetupId: this.getOption('setupId'),\n\t\t};\n\n\t\treturn this.cart.query(this.getOption('purchaseUrl'), data);\n\t}\n\n\tgetPickupOptions(bounds) {\n\n\t\tlet data = {\n\t\t\tbounds: bounds,\n\t\t\tyapayAction: 'pickupOptions',\n\t\t\titems: this.cart.paymentData.order.items,\n\t\t\tsetupId: this.getOption('setupId'),\n\t\t};\n\n\t\treturn this.cart.query(this.getOption('purchaseUrl'), data);\n\t}\n\n\tcreatePayment(node, paymentData) {\n\t\t// Создать платеж.\n\t\tYaPay.createPayment(paymentData, { agent: { name: \"CMS-Bitrix\", version: \"1.0\" } })\n\t\t\t.then((payment) => {\n\t\t\t\tthis.cart.removeLoader();\n\t\t\t\tthis.cart.mountButton(node, payment);\n\n\t\t\t\t// Подписаться на событие process.\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Process, (event) => {\n\t\t\t\t\t// Получить платежный токен.\n\t\t\t\t\tthis.orderAccept(event).then((result) => {\n\n\t\t\t\t\t\tif (result.error) { throw new Error(result.error.message, result.error.code); }\n\n\t\t\t\t\t\tif(!this.isPaymentTypeCash(event)) {\n\t\t\t\t\t\t\tthis.notify(result, event).then(result => {\n\t\t\t\t\t\t\t\tif (result.success === true) {\n\t\t\t\t\t\t\t\t\tthis.cart.widget.go(result.state, result);\n\t\t\t\t\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Success);\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tthis.cart.widget.go('error', result);\n\t\t\t\t\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Error);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Success);\n\n\t\t\t\t\t\t\t\tif (result.redirect != null) {\n\t\t\t\t\t\t\t\t\twindow.location.href = result.redirect;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.catch((error) => {\n\t\t\t\t\t\t\tthis.cart.showError('yapayProcess', '', error); // todo test it\n\t\t\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Error);\n\t\t\t\t\t\t});\n\t\t\t\t});\n\n\t\t\t\t// Подписаться на событие error.\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Error, (event) => {\n\t\t\t\t\tthis.cart.showError('yapayError', 'service temporary unavailable');\n\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Error);\n\t\t\t\t});\n\n\t\t\t\t// Подписаться на событие change.\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Change, (event) => {\n\n\t\t\t\t\t// если выбрали адрес доставки, отдаем скисок доставок\n\t\t\t\t\tif (event.shippingAddress) {\n\t\t\t\t\t\tthis.getShippingOptions(event.shippingAddress).then((result) => {\n\t\t\t\t\t\t\tpayment.update({shippingOptions: result})\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// добавляем выбранную доставку\n\t\t\t\t\tif (event.shippingOption){\n\t\t\t\t\t\tpayment.update({\n\t\t\t\t\t\t\torder: this.combineOrderWithDirectShipping(event.shippingOption),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// если выбрали ПВЗ, отдаем список ПВЗ\n\t\t\t\t\tif (event.pickupBounds) {\n\t\t\t\t\t\tthis.getPickupOptions(event.pickupBounds).then((result) => {\n\t\t\t\t\t\t\tpayment.update({pickupPoints: result})\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t\t// добавляем выбранный ПВЗ\n\t\t\t\t\tif (event.pickupPoint) {\n\t\t\t\t\t\tpayment.update({\n\t\t\t\t\t\t\torder: this.combineOrderWithPickupShipping(event.pickupPoint),\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\n\t\t\t\t});\n\t\t\t})\n\t\t\t.catch((err) => {\n\t\t\t\tthis.cart.showError('yapayPayment','payment not created', err);\n\t\t\t});\n\t}\n\n\torderAccept(event) {\n\n\t\tlet deliveryType = event.shippingMethodInfo.shippingOption ? 'delivery' : 'pickup';\n\t\tlet delivery;\n\n\t\tif (deliveryType === 'pickup') {\n\t\t\tdelivery = {\n\t\t\t\taddress: event.shippingMethodInfo.pickupPoint.address,\n\t\t\t\tpickup: event.shippingMethodInfo.pickupPoint,\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tdelivery = {\n\t\t\t\taddress: event.shippingMethodInfo.shippingAddress,\n\t\t\t\tdelivery: event.shippingMethodInfo.shippingOption,\n\t\t\t}\n\t\t}\n\n\t\tlet orderData = {\n\t\t\tsetupId: this.getOption('setupId'),\n\t\t\titems: this.cart.paymentData.order.items,\n\t\t\tpayment: event.paymentMethodInfo,\n\t\t\tcontact: event.shippingContact,\n\t\t\tyapayAction: 'orderAccept',\n\t\t\tdeliveryType: deliveryType,\n\t\t\tpaySystemId: this.isPaymentTypeCash(event) ? this.getOption('paymentCash') : this.getOption('paySystemId'),\n\t\t\torderAmount: event.orderAmount\n\t\t};\n\n\t\tlet data = {...orderData, ...delivery };\n\n\t\treturn this.cart.query(this.getOption('purchaseUrl'), data);\n\t}\n\n\tisPaymentTypeCash(event) {\n\t\treturn (event.paymentMethodInfo.type === 'CASH');\n\t}\n\n\tnotify(payment, yandexPayData) {\n\n\t\tlet data = {\n\t\t\tservice: this.getOption('requestSign'),\n\t\t\taccept: 'json',\n\t\t\tyandexData: yandexPayData,\n\t\t\texternalId: payment.externalId,\n\t\t\tpaySystemId: payment.paySystemId\n\t\t};\n\n\t\treturn this.cart.query(this.getOption('notifyUrl'), data);\n\t}\n\n\tchangeOffer(newProductId) {\n\t\tlet productId = this.getOption('productId');\n\n\t\tif (productId !== newProductId) { // todo in items\n\t\t\tthis.cart.widget.setOptions({productId: newProductId});\n\t\t\tthis.getProducts().then((result) => {\n\t\t\t\tthis.combineOrderWithProducts(result);\n\t\t\t});\n\t\t}\n\t}\n\n\tcombineOrderWithPickupShipping(pickupOption) {\n\t\tconst { order } = this.cart.paymentData;\n\n\t\treturn {\n\t\t\t...order,\n\t\t\titems: [\n\t\t\t\t...order.items,\n\t\t\t\t{\n\t\t\t\t\ttype: 'SHIPPING',\n\t\t\t\t\tlabel: pickupOption.label,\n\t\t\t\t\tamount: pickupOption.amount,\n\t\t\t\t},\n\t\t\t],\n\t\t\ttotal: {\n\t\t\t\t...order.total,\n\t\t\t\tamount: this.cart.amountSum(order.total.amount, pickupOption.amount),\n\t\t\t},\n\t\t};\n\t}\n\n\tcombineOrderWithDirectShipping(shippingOption) {\n\t\tconst { order } = this.cart.paymentData;\n\n\t\treturn {\n\t\t\t...order,\n\t\t\titems: [\n\t\t\t\t...order.items,\n\t\t\t\t{\n\t\t\t\t\ttype: 'SHIPPING',\n\t\t\t\t\tlabel: shippingOption.label,\n\t\t\t\t\tamount: shippingOption.amount,\n\t\t\t\t},\n\t\t\t],\n\t\t\ttotal: {\n\t\t\t\t...order.total,\n\t\t\t\tamount: this.cart.amountSum(order.total.amount, shippingOption.amount),\n\t\t\t},\n\t\t};\n\t}\n\n\tcombineOrderWithProducts(products) {\n\t\tconst { order } = this.cart.paymentData;\n\n\t\tlet exampleOrder = {\n\t\t\t...order,\n\t\t\titems: products.items,\n\t\t\ttotal: {\n\t\t\t\tamount: products.amount,\n\t\t\t},\n\t\t};\n\n\t\tObject.assign(this.cart.paymentData.order, exampleOrder);\n\t}\n}","import Template from '../../utils/template';\nimport AbstractStep from '../abstractstep';\nimport { ready } from \"../../utils/ready\";\nimport RestProxy from \"./rest\";\nimport SiteProxy from \"./site\";\n\nconst YaPay = window.YaPay;\n\nexport default class AbstractCart extends AbstractStep {\n\n\tstatic defaults = {\n\t\tloaderTemplate: '<div class=\"bx-yapay-skeleton-loading width--#WIDTH#\"></div>',\n\t\tloaderSelector: '.bx-yapay-skeleton-loading',\n\t}\n\n\trender(node, data) {\n\t\tthis.isBootstrap = false;\n\t\tthis.element = node;\n\t\tthis.paymentButton = null;\n\t\tthis.proxy = this.getOption('gateway') === 'rest'\n\t\t\t? new RestProxy(this)\n\t\t\t: new SiteProxy(this);\n\t\tthis.paymentData = this.getPaymentData();\n\n\t\tthis.bootSolution();\n\t\tthis.insertLoader();\n\t\tthis.setupPaymentCash();\n\t\tthis.delayBootstrap();\n\t}\n\n\tcompile(data) {\n\t\treturn Template.compile(this.options.template, data);\n\t}\n\n\trestore(node) {\n\t\tthis.element = node;\n\t\tthis.restoreButton(node);\n\t}\n\n\tbootstrap() {\n\t\tthis.isBootstrap = true;\n\t\tthis.proxy.bootstrap();\n\t}\n\n\tbootSolution() {\n\t\tconst solution = this.widget.getSolution();\n\n\t\tif (solution == null) { return; }\n\n\t\tsolution.bootCart(this);\n\t}\n\n\tdelayChangeOffer(productId) {\n\t\tthis.delay('changeOffer', [productId]);\n\t}\n\n\tdelayBootstrap() {\n\t\tready(() => {\n\t\t\tthis.delay('bootstrap');\n\t\t});\n\t}\n\n\tchangeOffer(newProductId) {\n\t\tif (!this.isBootstrap) { return; }\n\t\tthis.proxy?.changeOffer(newProductId);\n\t}\n\n\tsetupPaymentCash(){\n\t\t// Указываем возможность оплаты заказа при получении\n\t\tif (this.getOption('paymentCash') == null) { return; }\n\n\t\tthis.paymentData.paymentMethods.push({\n\t\t\ttype: YaPay.PaymentMethodType.Cash,\n\t\t});\n\t}\n\n\tgetPaymentData() {\n\t\treturn this.proxy.getPaymentData();\n\t}\n\n\tcreatePayment(node, paymentData) {\n\t\tthis.proxy.createPayment(node, paymentData);\n\t}\n\n\tmountButton(node, payment) {\n\t\tthis.paymentButton = payment.createButton({\n\t\t\ttype: YaPay.ButtonType.Checkout,\n\t\t\ttheme: this.getOption('buttonTheme') || YaPay.ButtonTheme.Black,\n\t\t\twidth: this.getOption('buttonWidth') || YaPay.ButtonWidth.Auto,\n\t\t});\n\n\t\tthis.paymentButton.mount(this.element);\n\n\t\tthis.paymentButton.on(YaPay.ButtonEventType.Click, () => {\n\t\t\tpayment.checkout();\n\t\t});\n\t}\n\n\trestoreButton(node) {\n\t\tif (this.paymentButton == null) {\n\t\t\tthis.insertLoader();\n\t\t\treturn;\n\t\t}\n\n\t\t//this.removeLoader();\n\t\tthis.paymentButton.mount(node);\n\t}\n\n\tamountSum(amountA, amountB) {\n\t\treturn (Number(amountA) + Number(amountB)).toFixed(2);\n\t}\n\n\tshowError(type, message, err = null) {\n\t\tlet notify = type + ' - ' + message;\n\n\t\tif (err) {\n\t\t\tnotify += ' ' + err;\n\t\t}\n\n\t\talert(notify);\n\t}\n\n\tinsertLoader() {\n\t\tconst width = this.getOption('buttonWidth') || YaPay.ButtonWidth.Auto;\n\n\t\tthis.element.innerHTML = Template.compile(this.getOption('loaderTemplate'), {\n\t\t\twidth: width.toLowerCase(),\n\t\t\tlabel: this.getOption('label'),\n\t\t});\n\t}\n\n\tremoveLoader() {\n\t\tconst loader = this.element.querySelector(this.getOption('loaderSelector'));\n\n\t\tif (loader == null) { return; }\n\n\t\tloader.remove();\n\t}\n}","export function ready(callback) {\r\n\tif (document.readyState === 'complete' || document.readyState === 'interactive') {\r\n\t\tsetTimeout(callback, 1);\r\n\t} else {\r\n\t\tdocument.addEventListener('DOMContentLoaded', callback);\r\n\t}\r\n}","import Secure3d from './secure3d';\r\nimport Finish from './finish';\r\nimport Failure from './failure';\r\nimport Payment from './payment';\r\nimport AbstractCart from \"./cart/abstractcart\";\r\n\r\nexport default class Factory {\r\n\r\n\t/**\r\n\t * @param {string} type\r\n\t * @param {Widget} widget\r\n\t * @param {Object} options\r\n\t * @returns {AbstractCart|Finish|Step3ds|Payment|Failure}\r\n\t * @throws {Error}\r\n\t */\r\n\tstatic make(type, widget, options = {}) {\r\n\t\tif (type === '3ds') {\r\n\t\t\treturn new Secure3d(widget, options);\r\n\t\t} else if (type === 'finished') {\r\n\t\t\treturn new Finish(widget, options);\r\n\t\t} else if (type === 'error') {\r\n\t\t\treturn new Failure(widget, options);\r\n\t\t} else if (type === 'payment') {\r\n\t\t\treturn new Payment(widget, options);\r\n\t\t} else if (type === 'cart') {\r\n\t\t\treturn new AbstractCart(widget, options);\r\n\t\t}\r\n\r\n\t\tthrow new Error('unknown step ' + type);\r\n\t}\r\n\r\n}","import StepFactory from './step/factory';\r\nimport SolutionRegistry from \"./solutionregistry\";\r\n\r\nexport default class Widget {\r\n\r\n\tstatic defaults = {}\r\n\r\n\tdefaults;\r\n\toptions;\r\n\tel;\r\n\tstep;\r\n\r\n\t/**\r\n\t * @param {Object<Element>} element\r\n\t * @param {Object} options\r\n\t */\r\n\tconstructor(element, options = {}) {\r\n\t\tthis.defaults = Object.assign({}, this.constructor.defaults);\r\n\t\tthis.options = {};\r\n\t\tthis.el = element;\r\n\r\n\t\tthis.setOptions(options);\r\n\t\tthis.bootSolution();\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object} data\r\n\t */\r\n\tpayment(data) {\r\n\t\tthis.go('payment', data);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object} data\r\n\t */\r\n\tcart(data){\r\n\t\tthis.go('cart', data);\r\n\t}\r\n\r\n\trestore(element) {\r\n\t\tthis.el = element;\r\n\t\tthis.step?.restore(element);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} type\r\n\t * @param {Object} data\r\n\t */\r\n\tgo(type, data) {\r\n\t\tthis.step = this.makeStep(type);\r\n\t\tthis.step.render(this.el, data);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {String} type\r\n\t * @returns {AbstractCart|Finish|Step3ds|Payment|Failure}\r\n\t * @throws {Error}\r\n\t */\r\n\tmakeStep(type) {\r\n\t\tconst options = this.getOption(type) || {};\r\n\r\n\t\treturn StepFactory.make(type, this, options);\r\n\t}\r\n\r\n\tgetSolution() {\r\n\t\tconst name = this.getOption('solution');\r\n\t\tconst mode = this.getOption('mode');\r\n\r\n\t\treturn SolutionRegistry.getPage(name, mode);\r\n\t}\r\n\r\n\tbootSolution() {\r\n\t\tconst solution = this.getSolution();\r\n\r\n\t\tif (solution == null) { return; }\r\n\r\n\t\tsolution.bootWidget(this);\r\n\t}\r\n\r\n\textendDefaults(options) {\r\n\t\tthis.defaults = Object.assign(this.defaults, options);\r\n\t}\r\n\r\n\tsetOptions(options) {\r\n\t\tthis.options = Object.assign(this.options, options);\r\n\t}\r\n\r\n\tgetOption(name) {\r\n\t\treturn this.options[name] ?? this.defaults[name];\r\n\t}\r\n}\r\n"],"names":["SolutionRegistry","name","factory","window","_window","BX","_window$BX","YandexPay","_window$BX$YandexPay","Solution","_window$BX$YandexPay$","_window$BX$YandexPay$2","console","warn","mode","key","this","pages","createPage","getFactory","create","MutationSkeleton","element","options","el","Object","assign","constructor","defaults","check","MutationLoop","_this","loopTimeout","loopCancel","clearTimeout","_loopTimeout","setTimeout","loop","timeout","MutationObserver","mutations","mutation","removedNodes","removedNode","HTMLElement","contains","runCheck","observe","disconnect","anchor","getAnchor","observer","listener","childList","subtree","delay","_checkTimeout","_this2","document","body","closest","MutationFactory","Subscriber","bind","unbind","on","off","NodePreserver","found","restore","install","uninstall","installMutation","installSubscriber","uninstallMutation","uninstallSubscriber","isEnabled","make","driverOptions","destroy","subscriber","type","option","babelHelpers","overrides","Template","template","vars","replaceKey","replaceValue","result","hasOwnProperty","toUpperCase","replace","indexOf","html","context","createElement","innerHTML","firstElementChild","children","Factory","setOptions","bootSolution","selector","position","Promise","resolve","then","waitElement","checkElement","renderElement","widget","getOption","preserve","querySelector","containsSiblingElement","Error","next","parentElement","_anchor$parentElement","matches","nextElementSibling","preserver","preserveOptions","preserveOption","_this3","Widget","reject","_this4","waitCount","waitElementLoop","findElement","elementList","variant","trim","searchBySelector","searchById","searchByClassName","length","reduceVisible","split","partSanitized","isCssSelector","querySelectorAll","push","e","getElementById","collection","getElementsByClassName","testVisible","offsetWidth","offsetHeight","getClientRects","test","width","YaPay","ButtonWidth","Auto","Utils","compile","label","toLowerCase","elements","toElements","reverse","insertAdjacentElement","solution","getPage","bootFactory","containerSelector","waitLimit","waitTimeout","AbstractStep","node","data","url","fetch","method","headers","JSON","stringify","response","json","optionKey","optionFirstSymbol","substr","getNode","getElementSelector","delayTimeouts","args","clearDelay","Base","Form","autosubmit","makeInputs","params","keys","termUrl","backUrl","location","href","encodeURIComponent","submit","Iframe","insertIframe","iframe","contentIframe","contentWindow","contentDocument","open","write","close","IframeRbs","renderIframe","query","service","accept","secure","externalId","notify","paySystemId","success","go","state","error","log","action","Step3ds","view","makeView","setWidget","render","SecureForm","SecureIframe","SecureRbs","Finish","Failure","Payment","paymentData","getPaymentData","createPayment","env","version","countryCode","CountryCode","Ru","currencyCode","CurrencyCode","Rub","merchant","id","order","total","amount","items","paymentMethods","PaymentMethodType","Card","gateway","gatewayMerchantId","allowedAuthMethods","AllowedAuthMethod","PanOnly","allowedCardNetworks","AllowedCardNetwork","UnionPay","Uzcard","Discover","AmericanExpress","Visa","Mastercard","Mir","Maestro","VisaElectron","agent","payment","button","createButton","ButtonType","Pay","theme","ButtonTheme","Black","mount","ButtonEventType","Click","checkout","PaymentEventType","Process","event","complete","CompleteReason","Success","Abort","err","yandexPayData","yandexData","Proxy","cart","RestProxy","getButtonData","status","reason","combineOrderWithData","productId","removeLoader","mountButton","paymentButton","remove","showError","exampleData","metadata","newProductId","SiteProxy","getProducts","message","combineOrderWithProducts","requiredFields","billingContact","email","shippingContact","phone","shippingTypes","direct","pickup","yapayAction","setupId","address","bounds","orderAccept","code","isPaymentTypeCash","redirect","Change","shippingAddress","getShippingOptions","update","shippingOptions","shippingOption","combineOrderWithDirectShipping","pickupBounds","getPickupOptions","pickupPoints","pickupPoint","combineOrderWithPickupShipping","delivery","deliveryType","shippingMethodInfo","paymentMethodInfo","contact","orderAmount","pickupOption","amountSum","products","exampleOrder","AbstractCart","isBootstrap","proxy","insertLoader","setupPaymentCash","delayBootstrap","restoreButton","bootstrap","getSolution","bootCart","callback","readyState","addEventListener","changeOffer","Cash","Checkout","amountA","amountB","Number","toFixed","alert","loader","loaderTemplate","loaderSelector","Secure3d","step","makeStep","StepFactory","bootWidget"],"mappings":"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"}