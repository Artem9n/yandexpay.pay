{"version":3,"file":"widget.js","sources":["../utils/template.js","../factory.js","../step/abstractstep.js","../secure3d/base.js","../secure3d/form.js","../secure3d/iframe.js","../secure3d/iframerbs.js","../step/secure3d.js","../step/finish.js","../step/failure.js","../step/payment.js","../utils/ready.js","../step/cart.js","../step/factory.js","../widget.js"],"sourcesContent":["export default class Template {\r\n\r\n\t/**\r\n\t * @param {string=} template\r\n\t * @param {Object} vars\r\n\t * @returns {string}\r\n\t */\r\n\tstatic compile(template, vars) {\r\n\t\tlet key;\r\n\t\tlet replaceKey;\r\n\t\tlet replaceValue;\r\n\t\tlet result = template;\r\n\r\n\t\tfor (key in vars) {\r\n\t\t\tif (!vars.hasOwnProperty(key)) { continue; }\r\n\r\n\t\t\treplaceKey = '#' + key.toUpperCase() + '#';\r\n\t\t\treplaceValue = vars[key];\r\n\r\n\t\t\tdo {\r\n\t\t\t\tresult = result.replace(replaceKey, replaceValue);\r\n\t\t\t} while (result.indexOf(replaceKey) !== -1);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tstatic toElement(html) {\r\n\t\tconst context = document.createElement('div');\r\n\t\tcontext.innerHTML = html;\r\n\r\n\t\treturn context.firstElementChild;\r\n\t}\r\n\r\n}","import Utils from './utils/template';\r\n\r\nexport default class Factory {\r\n\r\n\tdefaults = {\r\n\t\ttemplate: '<div id=\"yandexpay\" class=\"yandex-pay\"></div>',\r\n\t}\r\n\r\n\tinject(selector, position) {\r\n\t\treturn Promise.resolve()\r\n\t\t\t.then(() => this.waitElement(selector))\r\n\t\t\t.then((anchor) => {\r\n\t\t\t\tconst element = this.renderElement(anchor, position);\r\n\r\n\t\t\t\treturn this.install(element);\r\n\t\t\t});\r\n\t}\r\n\r\n\tinstall(element) {\r\n\t\treturn new BX.YandexPay.Widget(element);\r\n\t}\r\n\r\n\twaitElement(selector) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthis.waitCount = 0;\r\n\t\t\tthis.waitLimit = 10;\r\n\t\t\tthis.waitElementLoop(selector, resolve, reject);\r\n\t\t});\r\n\t}\r\n\r\n\twaitElementLoop(selector, resolve, reject) {\r\n\t\tconst anchor = this.findElement(selector);\r\n\r\n\t\tif (anchor) {\r\n\t\t\tresolve(anchor);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t++this.waitCount;\r\n\r\n\t\tif (this.waitCount >= this.waitLimit) {\r\n\t\t\treject('cant find element by selector ' + selector);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsetTimeout(this.waitElementLoop.bind(this, selector, resolve, reject), 1000);\r\n\t}\r\n\r\n\tfindElement(selector) {\r\n\t\tlet elementList;\r\n\t\tlet variant = selector.trim();\r\n\t\tlet result;\r\n\r\n\t\tif (variant === '') { throw new Error('widget selector is empty'); }\r\n\r\n\t\telementList = this.searchBySelector(variant) ?? this.searchById(selector) ?? this.searchByClassName(selector);\r\n\r\n\t\tif (elementList == null) { return null; }\r\n\r\n\t\tif (elementList.length > 1) {\r\n\t\t\tresult = this.reduceVisible(elementList);\r\n\t\t}\r\n\r\n\t\tif (result == null) {\r\n\t\t\tresult = elementList[0];\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tsearchBySelector(selector) {\r\n\t\ttry {\r\n\t\t\tconst result = [];\r\n\r\n\t\t\tfor (const part of selector.split(',')) { // first selector\r\n\t\t\t\tconst partSanitized = part.trim();\r\n\r\n\t\t\t\tif (partSanitized === '') { continue; }\r\n\r\n\t\t\t\tconst collection = document.querySelectorAll(partSanitized);\r\n\r\n\t\t\t\tfor (const element of collection) {\r\n\t\t\t\t\tresult.push(element);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn result.length > 0 ? result : null;\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tsearchById(selector) {\r\n\t\ttry {\r\n\t\t\tconst element = document.getElementById(selector);\r\n\r\n\t\t\treturn element != null ? [element] : null;\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tsearchByClassName(selector) {\r\n\t\ttry {\r\n\t\t\tconst collection = document.getElementsByClassName(selector);\r\n\r\n\t\t\treturn collection.length > 0 ? collection : null;\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\treduceVisible(collection) {\r\n\t\tlet result = null;\r\n\t\t\r\n\t\tfor (const element of collection) {\r\n\t\t\tif (this.testVisible(element)) {\r\n\t\t\t\tresult = element;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\t\r\n\ttestVisible(element) {\r\n\t\treturn (element.offsetWidth || element.offsetHeight || element.getClientRects().length );\r\n\t}\r\n\r\n\tisCssSelector(selector) {\r\n\t\treturn /^[.#]/.test(selector);\r\n\t}\r\n\r\n\trenderElement(anchor, position) {\r\n\t\tconst result = Utils.toElement(this.defaults.template);\r\n\r\n\t\tanchor.insertAdjacentElement(position, result);\r\n\r\n\t\treturn result;\r\n\t}\r\n}","import Template from '../utils/template';\r\n\r\nexport default class AbstractStep {\r\n\r\n\tstatic optionSection = null;\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '',\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object} options\r\n\t */\r\n\tconstructor(options = {}) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t\tthis.widget = null;\r\n\t\tthis.delayTimeouts = {};\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param {Widget} widget\r\n\t */\r\n\tsetWidget(widget) {\r\n\t\tthis.widget = widget;\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param {string} key\r\n\t * @returns {*}\r\n\t */\r\n\tgetOption(key) {\r\n\t\tconst section = this.constructor.optionSection;\r\n\r\n\t\t/*if (this.widget.options[section] !== null && this.widget.options[section][key]) {\r\n\t\t\treturn this.widget.options[section][key];\r\n\t\t} else */if (key in this.options) {\r\n\t\t\treturn this.options[key];\r\n\t\t} else {\r\n\t\t\treturn this.widget.options[key];\r\n\t\t}\r\n\t}\r\n\r\n\tsetOption(key, value) {\r\n\t\tif (key in this.options) {\r\n\t\t\tthis.options[key] = value;\r\n\t\t} else if (key in this.widget.options){\r\n\t\t\tthis.widget.options[key] = value;\r\n\t\t}\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object<Element>} node Element\r\n\t * @param {Object} data Options\r\n\t */\r\n\trender(node, data = {}) {\r\n\t\tnode.innerHTML = this.compile(data);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object} data\r\n\t * @returns {string}\r\n\t */\r\n\tcompile(data) {\r\n\t\treturn Template.compile(this.options.template, data);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} url\r\n\t * @param {Object} data\r\n\t * @returns {Promise.<Object>}\r\n\t */\r\n\tquery(url, data) {\r\n\t\treturn fetch(url, {\r\n\t\t\tmethod: 'POST',\r\n\t\t\theaders: { 'Content-Type': 'application/json' },\r\n\t\t\tbody: JSON.stringify(data)\r\n\t\t})\r\n\t\t\t.then(response => {return response.json()})\r\n\t}\r\n\r\n\tgetTemplate(key) {\r\n\t\tlet optionKey = key + 'Template';\r\n\t\tlet option = this.options[optionKey];\r\n\t\tlet optionFirstSymbol = option.substr(0, 1);\r\n\t\tlet result;\r\n\r\n\t\tif (optionFirstSymbol === '.' || optionFirstSymbol === '#') {\r\n\t\t\tresult = this.getNode(option).innerHTML;\r\n\t\t} else {\r\n\t\t\tresult = option;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetElement(key, context, method) {\r\n\t\tlet selector = this.getElementSelector(key);\r\n\r\n\t\treturn this.getNode(selector, context, method || 'querySelector');\r\n\t}\r\n\r\n\tgetElementSelector(key) {\r\n\t\tlet optionKey = key + 'Element';\r\n\r\n\t\treturn this.options[optionKey];\r\n\t}\r\n\r\n\tgetNode(selector, context, method) {\r\n\t\tlet result;\r\n\r\n\t\tif (selector.substr(0, 1) === '#') { // is id query\r\n\t\t\tcontext = document;\r\n\t\t} else if (!context) {\r\n\t\t\tcontext = this.el;\r\n\t\t}\r\n\r\n\t\treturn context[method](selector);\r\n\t}\r\n\r\n\tclearDelay(name) {\r\n\t\tif (this.delayTimeouts[name] === null) { return; }\r\n\r\n\t\tclearTimeout(this.delayTimeouts[name]);\r\n\t\tthis.delayTimeouts[name] = null;\r\n\t}\r\n\r\n\tdelay(name, args = [], timeout = 300) {\r\n\t\tthis.clearDelay(name);\r\n\t\tthis.delayTimeouts[name] = setTimeout(this[name].bind(this, ...args), timeout);\r\n\t}\r\n\r\n}","import Template from \"../utils/template\";\r\n\r\nexport default class Base {\r\n\tstatic defaults = {\r\n\t\ttemplate: null,\r\n\t}\r\n\r\n\tconstructor(options = {}) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t\tthis.widget = null;\r\n\t}\r\n\r\n\trender(node, data = {}) {\r\n\t\tnode.innerHTML = this.compile(data);\r\n\t}\r\n\r\n\tcompile(data) {\r\n\t\treturn Template.compile(this.options.template, data);\r\n\t}\r\n\r\n\tsetWidget(widget) {\r\n\t\tthis.widget = widget;\r\n\t}\r\n\r\n\tgetOption(key) {\r\n\t\tif (key in this.options) {\r\n\t\t\treturn this.options[key];\r\n\t\t} else {\r\n\t\t\treturn this.widget.options[key];\r\n\t\t}\r\n\t}\r\n}","import Base from \"./base\";\r\nimport Template from \"../utils/template\";\r\n\r\nexport default class Form extends Base {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<form name=\"form\" action=\"#ACTION#\" method=\"#METHOD#\">'\r\n\t\t\t+ '#INPUTS#'\r\n\t\t\t+ '</form>',\r\n\t}\r\n\r\n\trender(node, data) {\r\n\t\tsuper.render(node, data);\r\n\t\tthis.autosubmit(node);\r\n\t}\r\n\r\n\tcompile(data) {\r\n\t\tconst template = this.options.template;\r\n\t\tconst vars = Object.assign(data, {\r\n\t\t\t'inputs': this.makeInputs(data)\r\n\t\t});\r\n\r\n\t\treturn Template.compile(template, vars);\r\n\t}\r\n\r\n\tmakeInputs(data) {\r\n\t\tlet key;\r\n\t\tlet vars = data.params;\r\n\t\tlet value;\r\n\t\tlet template;\r\n\r\n\t\tif (Object.keys(vars).length === 0) { return ''; }\r\n\r\n\t\ttemplate = data.termUrl ? '<input type=\"hidden\" name=\"TermUrl\" value=\"' + vars.termUrl + '\">' : '';\r\n\r\n\t\tfor (key in vars)\r\n\t\t{\r\n\t\t\tif (!vars.hasOwnProperty(key)) { continue; }\r\n\r\n\t\t\tvalue = vars[key];\r\n\r\n\t\t\ttemplate += '<input type=\"hidden\" name=\"' + key + '\" value=\"' + value + '\">';\r\n\t\t}\r\n\r\n\t\treturn template;\r\n\t}\r\n\r\n\tmakeTermUrl() {\r\n\t\tlet result = this.getOption('notifyUrl');\r\n\t\tlet backUrl = window.location.href;\r\n\r\n\t\tresult +=\r\n\t\t\t(result.indexOf('?') === -1 ? '?' : '&')\r\n\t\t\t+ 'backurl=' + encodeURIComponent(backUrl)\r\n\t\t\t+ '&service=' + this.getOption('requestSign')\r\n\t\t\t+ '&paymentId=' + this.getOption('externalId');\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tautosubmit(node) {\r\n\t\tconst form = node.querySelector('form');\r\n\r\n\t\tform.submit();\r\n\t}\r\n}","import Base from \"./base\";\r\nimport Template from \"../utils/template\";\r\n\r\nexport default class Iframe extends Base {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<iframe style=\"display: none;\"></iframe>',\r\n\t}\r\n\r\n\trender(node, data) {\r\n\t\tthis.insertIframe(node, data);\r\n\t}\r\n\r\n\tinsertIframe(node, data) {\r\n\t\tnode.innerHTML = Template.compile(this.options.template, data);\r\n\t\tthis.compile(node, data);\r\n\t}\r\n\r\n\tcompile(node, data) {\r\n\t\tlet iframe = node.querySelector('iframe');\r\n\t\tlet contentIframe = iframe.contentWindow || ( iframe.contentDocument.document || iframe.contentDocument);\r\n\t\tlet html = data.params;\r\n\r\n\t\tcontentIframe.document.open();\r\n\t\tcontentIframe.document.write(html);\r\n\t\tcontentIframe.document.close();\r\n\t}\r\n}","import Base from \"./base\";\r\nimport Template from \"../utils/template\";\r\n\r\nexport default class IframeRbs extends Base {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<iframe style=\"display: none;\"></iframe>',\r\n\t}\r\n\r\n\trender(node, data) {\r\n\t\tthis.insertIframe(node, data);\r\n\t}\r\n\r\n\tinsertIframe(node, data) {\r\n\t\tnode.innerHTML = Template.compile(this.options.template, data);\r\n\t\tthis.compile(node, data);\r\n\t}\r\n\r\n\tcompile(node, data) {\r\n\t\tPromise.resolve()\r\n\t\t\t.then(() => this.renderIframe(node, data))\r\n\t\t\t.then(() => this.query(data));\r\n\t}\r\n\r\n\tquery (data) {\r\n\t\tfetch(this.getOption('notifyUrl'), {\r\n\t\t\tmethod: 'POST',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t},\r\n\t\t\tbody: JSON.stringify({\r\n\t\t\t\tservice: this.getOption('requestSign'),\r\n\t\t\t\taccept: 'json',\r\n\t\t\t\tsecure: data.params.secure,\r\n\t\t\t\texternalId: data.params.notify.externalId,\r\n\t\t\t\tpaySystemId: data.params.notify.paySystemId\r\n\t\t\t})\r\n\t\t})\r\n\t\t\t.then(response => response.json())\r\n\t\t\t.then(result => {\r\n\t\t\t\tif (result.success === true) {\r\n\t\t\t\t\tthis.widget.go(result.state, result);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.widget.go('error', result);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(error => console.log(error) );\r\n\t}\r\n\r\n\trenderIframe(node, data) {\r\n\t\tlet iframe = node.querySelector('iframe');\r\n\t\tlet contentIframe = iframe.contentWindow || ( iframe.contentDocument.document || iframe.contentDocument);\r\n\t\tlet html = `<form name=\"form\" action=\"${data.action}\" method=\"POST\">`;\r\n\r\n\t\tcontentIframe.document.open();\r\n\t\tcontentIframe.document.write(html);\r\n\t\tcontentIframe.document.close();\r\n\r\n\t\tcontentIframe.document.querySelector('form').submit();\r\n\t}\r\n}\r\n","import AbstractStep from \"./abstractstep\";\r\nimport SecureForm from \"../secure3d/form\";\r\nimport SecureIframe from \"../secure3d/iframe\";\r\nimport SecureRbs from \"../secure3d/iframerbs\";\r\n\r\nexport default class Step3ds extends AbstractStep {\r\n\r\n\trender(node, data) {\r\n\t\tconst view = this.makeView(data);\r\n\t\tview.setWidget(this.widget);\r\n\t\tview.render(node, data);\r\n\t}\r\n\r\n\tmakeView(data) {\r\n\t\tlet view = data.view;\r\n\r\n\t\tif (view === 'form') {\r\n\t\t\treturn new SecureForm();\r\n\t\t} else if (view === 'iframe') {\r\n\t\t\treturn new SecureIframe();\r\n\t\t} else if (view === 'iframerbs') {\r\n\t\t\treturn new SecureRbs();\r\n\t\t}\r\n\r\n\t\tthrow new Error('view secure3d missing')\r\n\t}\r\n}","import Template from '../utils/template';\r\nimport AbstractStep from './abstractstep';\r\n\r\nexport default class Finish extends AbstractStep {\r\n\r\n\tstatic optionPrefix = 'finish';\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<div class=\"alert alert-success\" role=\"alert\"><strong>#MESSAGE#</strong></div>'\r\n\t}\r\n\r\n}","import AbstractStep from './abstractstep';\r\n\r\nexport default class Failure extends AbstractStep {\r\n\r\n\tstatic optionPrefix = 'failure';\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<div class=\"alert alert-danger\" role=\"alert\"><strong>#MESSAGE#</strong></div>'\r\n\t}\r\n\r\n}","import Template from '../utils/template';\r\nimport AbstractStep from './abstractstep';\r\nimport StepFactory from \"./factory\";\r\n\r\nconst YaPay = window.YaPay;\r\n\r\nexport default class Payment extends AbstractStep {\r\n\r\n\tstatic optionPrefix = 'payment';\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<div class=\"alert alert-success\" role=\"alert\"><strong>#MESSAGE#</strong></div>'\r\n\t}\r\n\r\n\trender(node, data) {\r\n\t\tconst paymentData = this.getPaymentData(data);\r\n\r\n\t\tthis.createPayment(node, paymentData);\r\n\t}\r\n\r\n\tcompile(data) {\r\n\t\treturn Template.compile(this.options.template, data);\r\n\t}\r\n\r\n\tgetPaymentData(data) {\r\n\t\treturn {\r\n\t\t\tenv: this.getOption('env'),\r\n\t\t\tversion: 2,\r\n\t\t\tcountryCode: YaPay.CountryCode.Ru,\r\n\t\t\tcurrencyCode: YaPay.CurrencyCode.Rub,\r\n\t\t\tmerchant: {\r\n\t\t\t\tid: this.getOption('merchantId'),\r\n\t\t\t\tname: this.getOption('merchantName')\r\n\t\t\t},\r\n\t\t\torder: {\r\n\t\t\t\tid: data.id,\r\n\t\t\t\ttotal: { amount: data.total },\r\n\t\t\t\titems: data.items\r\n\t\t\t},\r\n\t\t\tpaymentMethods: [\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: YaPay.PaymentMethodType.Card,\r\n\t\t\t\t\tgateway: this.getOption('gateway'),\r\n\t\t\t\t\tgatewayMerchantId: this.getOption('gatewayMerchantId'),\r\n\t\t\t\t\tallowedAuthMethods: [YaPay.AllowedAuthMethod.PanOnly],\r\n\t\t\t\t\tallowedCardNetworks: [\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.UnionPay,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Uzcard,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Discover,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.AmericanExpress,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Visa,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Mastercard,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Mir,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Maestro,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.VisaElectron\r\n\t\t\t\t\t]\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t}\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\t\t// Создать платеж.\r\n\t\tYaPay.createPayment(paymentData, { agent: { name: \"CMS-Bitrix\", version: \"1.0\" } })\r\n\t\t\t.then( (payment) => {\r\n\t\t\t\t// Создать экземпляр кнопки.\r\n\t\t\t\tlet button = payment.createButton({\r\n\t\t\t\t\ttype: YaPay.ButtonType.Pay,\r\n\t\t\t\t\ttheme: this.getOption('buttonTheme') || YaPay.ButtonTheme.Black,\r\n\t\t\t\t\twidth: this.getOption('buttonWidth') || YaPay.ButtonWidth.Auto,\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Смонтировать кнопку в DOM.\r\n\t\t\t\tbutton.mount(node);\r\n\r\n\t\t\t\t// Подписаться на событие click.\r\n\t\t\t\tbutton.on(YaPay.ButtonEventType.Click, function onPaymentButtonClick() {\r\n\t\t\t\t\t// Запустить оплату после клика на кнопку.\r\n\t\t\t\t\tpayment.checkout();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Подписаться на событие process.\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Process, (event) => {\r\n\t\t\t\t\t// Получить платежный токен.\r\n\t\t\t\t\tthis.notify(payment, event).then((result) => {\r\n\t\t\t\t\t});\r\n\t\t\t\t\t/*alert('Payment token — ' + event.token);\r\n\r\n\t\t\t\t\t// Опционально (если выполнить шаг 7).\r\n\t\t\t\t\talert('Billing email — ' + event.billingContact.email);\r\n\r\n\t\t\t\t\t// Закрыть форму Yandex Pay.\r\n\t\t\t\t\t*/\r\n\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Success);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Подписаться на событие error.\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Error, function onPaymentError(event) {\r\n\t\t\t\t\t// Вывести информацию о недоступности оплаты в данный момент\r\n\t\t\t\t\t// и предложить пользователю другой способ оплаты.\r\n\r\n\t\t\t\t\t// Закрыть форму Yandex.Pay.\r\n\t\t\t\t\tconsole.log({'errors': event});\r\n\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Error);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Подписаться на событие abort.\r\n\t\t\t\t// Это когда пользователь закрыл форму Yandex Pay.\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Abort, function onPaymentAbort(event) {\r\n\t\t\t\t\t// Предложить пользователю другой способ оплаты.\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.catch(function (err) {\r\n\t\t\t\t// Платеж не создан.\r\n\t\t\t\tconsole.log({'payment not create': err});\r\n\t\t\t});\r\n\t}\r\n\r\n\tnotify(payment, yandexPayData) {\r\n\t\treturn fetch(this.getOption('notifyUrl'), {\r\n\t\t\tmethod: 'POST',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t},\r\n\t\t\tbody: JSON.stringify({\r\n\t\t\t\tservice: this.getOption('requestSign'),\r\n\t\t\t\taccept: 'json',\r\n\t\t\t\tyandexData: yandexPayData,\r\n\t\t\t\texternalId: this.getOption('externalId'),\r\n\t\t\t\tpaySystemId: this.getOption('paySystemId')\r\n\t\t\t})\r\n\t\t})\r\n\t\t\t.then(response => response.json())\r\n\t\t\t.then(result => {\r\n\t\t\t\tif (result.success === true) {\r\n\t\t\t\t\tthis.widget.go(result.state, result);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.widget.go('error', result);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(error => console.log(error) );\r\n\t}\r\n}","export function ready(callback) {\r\n\tif (document.readyState === 'complete' || document.readyState === 'interactive') {\r\n\t\tsetTimeout(callback, 1);\r\n\t} else {\r\n\t\tdocument.addEventListener('DOMContentLoaded', callback);\r\n\t}\r\n}","import Template from '../utils/template';\r\nimport AbstractStep from './abstractstep';\r\nimport { ready } from \"../utils/ready\";\r\n\r\nconst YaPay = window.YaPay;\r\n\r\nexport default class Cart extends AbstractStep {\r\n\r\n\tstatic defaults = {\r\n\t\tloaderTemplate:\r\n\t\t\t'<div class=\"yandex-pay__label width--#WIDTH#\"><em></em><span>#LABEL#</span></div>'\r\n\t\t\t+ '<div class=\"yandex-pay-skeleton-loading width--#WIDTH#\"></div>',\r\n\t\tloaderSelector: '.yandex-pay-skeleton-loading',\r\n\t}\r\n\r\n\trender(node, data) {\r\n\t\tthis.isBootstrap = false;\r\n\t\tthis.element = node;\r\n\t\tthis.insertLoader();\r\n\t\tthis.paymentData = this.getPaymentData(data);\r\n\r\n\t\tthis.setupPaymentCash();\r\n\t\tthis.installSolution();\r\n\t\tthis.delayBootstrap();\r\n\t}\r\n\r\n\tcompile(data) {\r\n\t\treturn Template.compile(this.options.template, data);\r\n\t}\r\n\r\n\tinstallSolution() {\r\n\t\tconst type = this.getOption('solution');\r\n\r\n\t\tif (type == null) { return; }\r\n\r\n\t\tconst factory = window?.BX?.YandexPay?.Solution?.[type]?.factory;\r\n\r\n\t\tif (factory == null) {\r\n\t\t\tconsole?.warn(`cant find solution ${type}`);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tfactory.create(this);\r\n\t}\r\n\r\n\tdelayChangeOffer(productId) {\r\n\t\tthis.delay('changeOffer', [productId]);\r\n\t}\r\n\r\n\tdelayBootstrap() {\r\n\t\tready(() => {\r\n\t\t\tthis.delay('bootstrap');\r\n\t\t});\r\n\t}\r\n\r\n\tbootstrap() {\r\n\t\tthis.isBootstrap = true;\r\n\r\n\t\tthis.getProducts()\r\n\t\t\t.then((result) => {\r\n\r\n\t\t\t\tif (result.error) { throw new Error(result.error.message, result.error.code); }\r\n\r\n\t\t\t\tthis.combineOrderWithProducts(result);\r\n\t\t\t\tthis.createPayment(this.element, this.paymentData);\r\n\r\n\t\t\t})\r\n\t\t\t.catch((error) => {\r\n\t\t\t\t//this.showError('bootstrap', '', error);\r\n\t\t\t});\r\n\t}\r\n\r\n\tchangeOffer(newProductId) {\r\n\r\n\t\tif (!this.isBootstrap) { return; }\r\n\r\n\t\tlet productId = this.getOption('productId');\r\n\r\n\t\tif (productId !== newProductId) { // todo in items\r\n\t\t\tthis.setOption('productId', newProductId);\r\n\t\t\tthis.getProducts().then((result) => {\r\n\t\t\t\tthis.combineOrderWithProducts(result);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tsetupPaymentCash(){\r\n\t\t// Указываем возможность оплаты заказа при получении\r\n\t\tif (this.getOption('paymentCash') !== null) {\r\n\t\t\tthis.paymentData.paymentMethods.push({\r\n\t\t\t\ttype: YaPay.PaymentMethodType.Cash,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tgetPaymentData(data) {\r\n\t\treturn {\r\n\t\t\tenv: this.getOption('env'),\r\n\t\t\tversion: 2,\r\n\t\t\tcountryCode: YaPay.CountryCode.Ru,\r\n\t\t\tcurrencyCode: YaPay.CurrencyCode.Rub,\r\n\t\t\tmerchant: {\r\n\t\t\t\tid: this.getOption('merchantId'),\r\n\t\t\t\tname: this.getOption('merchantName'),\r\n\t\t\t\turl: this.getOption('siteUrl')\r\n\t\t\t},\r\n\t\t\torder: { id: '0' },\r\n\t\t\tpaymentMethods: [\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: YaPay.PaymentMethodType.Card,\r\n\t\t\t\t\tgateway: this.getOption('gateway'),\r\n\t\t\t\t\tgatewayMerchantId: this.getOption('gatewayMerchantId'),\r\n\t\t\t\t\tallowedAuthMethods: [YaPay.AllowedAuthMethod.PanOnly],\r\n\t\t\t\t\tallowedCardNetworks: [\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.UnionPay,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Uzcard,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Discover,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.AmericanExpress,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Visa,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Mastercard,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Mir,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Maestro,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.VisaElectron\r\n\t\t\t\t\t]\r\n\t\t\t\t}\r\n\t\t\t],\r\n\r\n\t\t\trequiredFields: {\r\n\r\n\t\t\t\tbillingContact: {\r\n\t\t\t\t\temail: this.getOption('useEmail') || false\r\n\t\t\t\t},\r\n\r\n\t\t\t\tshippingContact: {\r\n\t\t\t\t\tname: this.getOption('useName') || false,\r\n\t\t\t\t\temail: this.getOption('useEmail') || false,\r\n\t\t\t\t\tphone: this.getOption('usePhone') || false,\r\n\t\t\t\t},\r\n\r\n\t\t\t\tshippingTypes: {\r\n\t\t\t\t\tdirect: true,\r\n\t\t\t\t\tpickup: true,\r\n\t\t\t\t},\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\t\t// Создать платеж.\r\n\t\tYaPay.createPayment(paymentData, { agent: { name: \"CMS-Bitrix\", version: \"1.0\" } })\r\n\t\t\t.then((payment) => {\r\n\t\t\t\t// Создать экземпляр кнопки.\r\n\t\t\t\tlet button = payment.createButton({\r\n\t\t\t\t\ttype: YaPay.ButtonType.Checkout,\r\n\t\t\t\t\ttheme: this.getOption('buttonTheme') || YaPay.ButtonTheme.Black,\r\n\t\t\t\t\twidth: this.getOption('buttonWidth') || YaPay.ButtonWidth.Auto,\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Смонтировать кнопку в DOM.\r\n\t\t\t\tthis.removeLoader();\r\n\t\t\t\tbutton.mount(node);\r\n\r\n\t\t\t\t// Подписаться на событие click.\r\n\t\t\t\tbutton.on(YaPay.ButtonEventType.Click, () => {\r\n\t\t\t\t\t// Запустить оплату после клика на кнопку.\r\n\t\t\t\t\tpayment.checkout();\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Подписаться на событие process.\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Process, (event) => {\r\n\t\t\t\t\t// Получить платежный токен.\r\n\t\t\t\t\tthis.orderAccept(event).then((result) => {\r\n\r\n\t\t\t\t\t\tif (result.error) { throw new Error(result.error.message, result.error.code); }\r\n\r\n\t\t\t\t\t\tif(!this.isPaymentTypeCash(event)) {\r\n\t\t\t\t\t\t\tthis.notify(result, event).then(result => {\r\n\t\t\t\t\t\t\t\tif (result.success === true) {\r\n\t\t\t\t\t\t\t\t\tthis.widget.go(result.state, result);\r\n\t\t\t\t\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Success);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.widget.go('error', result);\r\n\t\t\t\t\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Error);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\r\n\t\t\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Success);\r\n\r\n\t\t\t\t\t\t\tif (result.redirect !== null) {\r\n\t\t\t\t\t\t\t\twindow.location.href = result.redirect;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t})\r\n\t\t\t\t\t.catch((error) => {\r\n\t\t\t\t\t\tthis.showError('yapayProcess', '', error); // todo test it\r\n\t\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Error);\r\n\t\t\t\t\t});\r\n\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Подписаться на событие error.\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Error, (event) => {\r\n\t\t\t\t\tthis.showError('yapayError', 'service temporary unavailable');\r\n\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Error);\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Подписаться на событие change.\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Change, (event) => {\r\n\r\n\t\t\t\t\tif (event.shippingAddress) {\r\n\t\t\t\t\t\tthis.getShippingOptions(event.shippingAddress).then((result) => {\r\n\t\t\t\t\t\t\tpayment.update({shippingOptions: result})\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (event.shippingOption){\r\n\t\t\t\t\t\tpayment.update({\r\n\t\t\t\t\t\t\torder: this.combineOrderWithDirectShipping(event.shippingOption),\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (event.pickupBounds) {\r\n\t\t\t\t\t\tthis.getPickupOptions(event.pickupBounds).then((result) => {\r\n\t\t\t\t\t\t\tpayment.update({pickupPoints: result})\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tif (event.pickupPoint) {\r\n\t\t\t\t\t\tpayment.update({\r\n\t\t\t\t\t\t\torder: this.combineOrderWithPickupShipping(event.pickupPoint),\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.catch((err) => {\r\n\t\t\t\tthis.showError('yapayPayment','payment not created', err);\r\n\t\t\t});\r\n\t}\r\n\r\n\tisPaymentTypeCash(event) {\r\n\t\treturn (event.paymentMethodInfo.type === 'CASH');\r\n\t}\r\n\r\n\tgetProducts(){\r\n\r\n\t\tlet data = {\r\n\t\t\tyapayAction: 'getProducts',\r\n\t\t\tproductId: this.getOption('productId'),\r\n\t\t\tmode: this.getOption('mode'),\r\n\t\t\tsetupId: this.getOption('setupId')\r\n\t\t};\r\n\r\n\t\treturn this.query(this.getOption('purchaseUrl'), data);\r\n\t}\r\n\r\n\tnotify(payment, yandexPayData) {\r\n\r\n\t\tlet data = {\r\n\t\t\tservice: this.getOption('requestSign'),\r\n\t\t\taccept: 'json',\r\n\t\t\tyandexData: yandexPayData,\r\n\t\t\texternalId: payment.externalId,\r\n\t\t\tpaySystemId: payment.paySystemId\r\n\t\t};\r\n\r\n\t\treturn this.query(this.getOption('notifyUrl'), data);\r\n\t}\r\n\r\n\torderAccept(event) {\r\n\r\n\t\tlet deliveryType = event.shippingMethodInfo.shippingOption ? 'delivery' : 'pickup';\r\n\t\tlet delivery;\r\n\r\n\t\tif (deliveryType === 'pickup') {\r\n\t\t\tdelivery = {\r\n\t\t\t\taddress: event.shippingMethodInfo.pickupPoint.address,\r\n\t\t\t\tpickup: event.shippingMethodInfo.pickupPoint,\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdelivery = {\r\n\t\t\t\taddress: event.shippingMethodInfo.shippingAddress,\r\n\t\t\t\tdelivery: event.shippingMethodInfo.shippingOption,\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet orderData = {\r\n\t\t\tsetupId: this.getOption('setupId'),\r\n\t\t\titems: this.paymentData.order.items,\r\n\t\t\tpayment: event.paymentMethodInfo,\r\n\t\t\tcontact: event.shippingContact,\r\n\t\t\tyapayAction: 'orderAccept',\r\n\t\t\tdeliveryType: deliveryType,\r\n\t\t\tpaySystemId: this.isPaymentTypeCash(event) ? this.getOption('paymentCash') : this.getOption('paySystemId'),\r\n\t\t\torderAmount: event.orderAmount\r\n\t\t};\r\n\r\n\t\tlet data = {...orderData, ...delivery };\r\n\r\n\t\treturn this.query(this.getOption('purchaseUrl'), data);\r\n\t}\r\n\r\n\tgetShippingOptions(address) {\r\n\r\n\t\tlet data = {\r\n\t\t\taddress: address,\r\n\t\t\tyapayAction: 'deliveryOptions',\r\n\t\t\titems: this.paymentData.order.items,\r\n\t\t\tsetupId: this.getOption('setupId'),\r\n\t\t};\r\n\r\n\t\treturn this.query(this.getOption('purchaseUrl'), data);\r\n\t}\r\n\r\n\tgetPickupOptions(bounds) {\r\n\r\n\t\tlet data = {\r\n\t\t\tbounds: bounds,\r\n\t\t\tyapayAction: 'pickupOptions',\r\n\t\t\titems: this.paymentData.order.items,\r\n\t\t\tsetupId: this.getOption('setupId'),\r\n\t\t};\r\n\r\n\t\treturn this.query(this.getOption('purchaseUrl'), data);\r\n\t}\r\n\r\n\tcombineOrderWithPickupShipping(pickupOption) {\r\n\t\tconst { order } = this.paymentData;\r\n\r\n\t\treturn {\r\n\t\t\t...order,\r\n\t\t\titems: [\r\n\t\t\t\t...order.items,\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: 'SHIPPING',\r\n\t\t\t\t\tlabel: pickupOption.label,\r\n\t\t\t\t\tamount: pickupOption.amount,\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\ttotal: {\r\n\t\t\t\t...order.total,\r\n\t\t\t\tamount: this.amountSum(order.total.amount, pickupOption.amount),\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n\r\n\tcombineOrderWithDirectShipping(shippingOption) {\r\n\t\tconst { order } = this.paymentData;\r\n\r\n\t\treturn {\r\n\t\t\t...order,\r\n\t\t\titems: [\r\n\t\t\t\t...order.items,\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: 'SHIPPING',\r\n\t\t\t\t\tlabel: shippingOption.label,\r\n\t\t\t\t\tamount: shippingOption.amount,\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\ttotal: {\r\n\t\t\t\t...order.total,\r\n\t\t\t\tamount: this.amountSum(order.total.amount, shippingOption.amount),\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n\r\n\tcombineOrderWithProducts(products) {\r\n\t\tconst { order } = this.paymentData;\r\n\r\n\t\tlet exampleOrder = {\r\n\t\t\t...order,\r\n\t\t\titems: products.items,\r\n\t\t\ttotal: {\r\n\t\t\t\tamount: products.amount,\r\n\t\t\t},\r\n\t\t};\r\n\r\n\t\tObject.assign(this.paymentData.order, exampleOrder);\r\n\t}\r\n\r\n\tamountSum(amountA, amountB) {\r\n\t\treturn (Number(amountA) + Number(amountB)).toFixed(2);\r\n\t}\r\n\r\n\tshowError(type, message, err = null) {\r\n\t\tlet notify = type + ' - ' + message;\r\n\r\n\t\tif (err) {\r\n\t\t\tnotify += ' ' + err;\r\n\t\t}\r\n\r\n\t\talert(notify);\r\n\t}\r\n\r\n\tinsertLoader() {\r\n\r\n\t\tconst width = this.getOption('buttonWidth') || YaPay.ButtonWidth.Auto;\r\n\r\n\t\tthis.element.innerHTML = Template.compile(this.getOption('loaderTemplate'), {\r\n\t\t\twidth: width.toLowerCase(),\r\n\t\t\tlabel: this.getOption('label'),\r\n\t\t});\r\n\t}\r\n\r\n\tremoveLoader() {\r\n\t\tconst loader = this.element.querySelector(this.getOption('loaderSelector'));\r\n\t\tif (loader == null) { return; }\r\n\t\tloader.remove();\r\n\t}\r\n}","import Secure3d from './secure3d';\r\nimport Finish from './finish';\r\nimport Failure from './failure';\r\nimport Payment from './payment';\r\nimport Cart from \"./cart\";\r\n\r\nexport default class Factory {\r\n\r\n\t/**\r\n\t * @param {string} type\r\n\t * @returns {Cart|Finish|Step3ds|Payment|Failure}\r\n\t * @throws {Error}\r\n\t */\r\n\tstatic make(type) {\r\n\t\tif (type === '3ds') {\r\n\t\t\treturn new Secure3d();\r\n\t\t} else if (type === 'finished') {\r\n\t\t\treturn new Finish();\r\n\t\t} else if (type === 'error') {\r\n\t\t\treturn new Failure();\r\n\t\t} else if (type === 'payment') {\r\n\t\t\treturn new Payment();\r\n\t\t} else if (type === 'cart'){\r\n\t\t\treturn new Cart();\r\n\t\t}\r\n\r\n\t\tthrow new Error('unknown step ' + type);\r\n\t}\r\n\r\n}","import StepFactory from './step/factory';\r\n\r\nexport default class Widget {\r\n\r\n\t/**\r\n\t * @type {{failureTemplate: string, modalTemplate: string, finishedTemplate: string}}\r\n\t */\r\n\tdefaults = {\r\n\t\tfinishedTemplate:   '<div class=\"alert alert-success\" role=\"alert\"><strong>#MESSAGE#</strong></div>',\r\n\t\tfailureTemplate:      '<div class=\"alert alert-danger\" role=\"alert\"><strong>#MESSAGE#</strong></div>',\r\n\t\tmodalTemplate:      '<div class=\"yandex-pay-modal-inner\">#IFRAME#</div>',\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object<Element>} element\r\n\t */\r\n\tconstructor(element){\r\n\t\tthis.el = element;\r\n\t}\r\n\r\n\tsetOptions(options) {\r\n\t\tthis.options = Object.assign({}, this.defaults, options);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object} data\r\n\t */\r\n\tpayment(data) {\r\n\t\tthis.go('payment', data);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object} data\r\n\t */\r\n\tcart(data){\r\n\t\tthis.go('cart', data);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} type\r\n\t * @param {Object} data\r\n\t */\r\n\tgo(type, data) {\r\n\t\tconst step = this.makeStep(type);\r\n\r\n\t\tstep.render(this.el, data);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {String} type\r\n\t * @returns {Cart|Finish|Step3ds|Payment|Failure}\r\n\t * @throws {Error}\r\n\t */\r\n\tmakeStep(type) {\r\n\t\tconst step = StepFactory.make(type);\r\n\r\n\t\tstep.setWidget(this);\r\n\r\n\t\treturn step;\r\n\t}\r\n}\r\n"],"names":["Template","template","vars","key","replaceKey","replaceValue","result","hasOwnProperty","toUpperCase","replace","indexOf","html","context","document","createElement","innerHTML","firstElementChild","Factory","selector","position","Promise","resolve","then","waitElement","anchor","element","renderElement","install","BX","YandexPay","Widget","reject","waitCount","waitLimit","waitElementLoop","findElement","setTimeout","bind","elementList","variant","trim","Error","searchBySelector","searchById","searchByClassName","length","reduceVisible","split","part","partSanitized","collection","querySelectorAll","push","e","getElementById","getElementsByClassName","testVisible","offsetWidth","offsetHeight","getClientRects","test","Utils","toElement","defaults","insertAdjacentElement","AbstractStep","options","Object","assign","constructor","widget","delayTimeouts","section","optionSection","value","node","data","compile","url","fetch","method","headers","body","JSON","stringify","response","json","optionKey","option","optionFirstSymbol","substr","getNode","getElementSelector","el","name","clearTimeout","args","timeout","clearDelay","Base","Form","autosubmit","makeInputs","params","keys","termUrl","getOption","backUrl","window","location","href","encodeURIComponent","form","querySelector","submit","Iframe","insertIframe","iframe","contentIframe","contentWindow","contentDocument","open","write","close","IframeRbs","renderIframe","query","service","accept","secure","externalId","notify","paySystemId","success","go","state","catch","error","console","log","action","Step3ds","view","makeView","setWidget","render","SecureForm","SecureIframe","SecureRbs","Finish","Failure","YaPay","Payment","paymentData","getPaymentData","createPayment","env","version","countryCode","CountryCode","Ru","currencyCode","CurrencyCode","Rub","merchant","id","order","total","amount","items","paymentMethods","type","PaymentMethodType","Card","gateway","gatewayMerchantId","allowedAuthMethods","AllowedAuthMethod","PanOnly","allowedCardNetworks","AllowedCardNetwork","UnionPay","Uzcard","Discover","AmericanExpress","Visa","Mastercard","Mir","Maestro","VisaElectron","agent","payment","button","createButton","ButtonType","Pay","theme","ButtonTheme","Black","width","ButtonWidth","Auto","mount","on","ButtonEventType","Click","onPaymentButtonClick","checkout","PaymentEventType","Process","event","complete","CompleteReason","Success","onPaymentError","Abort","onPaymentAbort","err","yandexPayData","yandexData","ready","callback","readyState","addEventListener","Cart","isBootstrap","insertLoader","setupPaymentCash","installSolution","delayBootstrap","factory","Solution","warn","create","productId","delay","getProducts","message","code","combineOrderWithProducts","newProductId","setOption","Cash","requiredFields","billingContact","email","shippingContact","phone","shippingTypes","direct","pickup","Checkout","removeLoader","orderAccept","isPaymentTypeCash","redirect","showError","Change","shippingAddress","getShippingOptions","update","shippingOptions","shippingOption","combineOrderWithDirectShipping","pickupBounds","getPickupOptions","pickupPoints","pickupPoint","combineOrderWithPickupShipping","paymentMethodInfo","yapayAction","mode","setupId","deliveryType","shippingMethodInfo","delivery","address","orderData","contact","orderAmount","bounds","pickupOption","label","amountSum","products","exampleOrder","amountA","amountB","Number","toFixed","alert","toLowerCase","loader","remove","loaderTemplate","loaderSelector","Secure3d","finishedTemplate","failureTemplate","modalTemplate","step","makeStep","StepFactory","make"],"mappings":"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"}