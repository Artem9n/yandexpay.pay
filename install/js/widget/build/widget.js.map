{"version":3,"file":"widget.js","sources":["../solutionregistry.js","../ui/nodepreserver/mutationskeleton.js","../ui/nodepreserver/mutationloop.js","../ui/nodepreserver/mutationobserver.js","../ui/nodepreserver/mutationfactory.js","../ui/nodepreserver/subscriber.js","../ui/nodepreserver.js","../utils/template.js","../factory.js","../step/abstractstep.js","../secure3d/base.js","../secure3d/form.js","../secure3d/iframe.js","../secure3d/iframerbs.js","../step/secure3d.js","../step/finish.js","../step/failure.js","../step/payment.js","../step/cart/proxy.js","../step/cart/rest.js","../step/cart/site.js","../step/cart/abstractcart.js","../utils/ready.js","../step/factory.js","../widget.js"],"sourcesContent":["export default class SolutionRegistry {\r\n\r\n\tstatic pages = {};\r\n\r\n\tstatic getFactory(name) {\r\n\t\tif (name == null) { return null; }\r\n\r\n\t\tconst factory = window?.BX?.YandexPay?.Solution?.[name]?.factory;\r\n\r\n\t\tif (factory == null) {\r\n\t\t\tconsole?.warn(`cant find solution ${name}`);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\treturn factory;\r\n\t}\r\n\r\n\tstatic getPage(name, mode) {\r\n\t\tif (name == null || mode == null) { return null; }\r\n\r\n\t\tconst key = name + ':' + mode;\r\n\r\n\t\tif (this.pages[key] == null) {\r\n\t\t\tthis.pages[key] = this.createPage(name, mode);\r\n\t\t}\r\n\r\n\t\treturn this.pages[key];\r\n\t}\r\n\r\n\tstatic createPage(name, mode) {\r\n\t\tconst factory = this.getFactory(name);\r\n\r\n\t\tif (factory == null) { return null; }\r\n\r\n\t\treturn factory.create(mode);\r\n\t}\r\n\r\n}","export default class MutationSkeleton {\r\n\r\n\tstatic defaults = {\r\n\t\tcheck: null,\r\n\t}\r\n\r\n\tconstructor(element, options = {}) {\r\n\t\tthis.el = element;\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t}\r\n\r\n\tdestroy() {\r\n\r\n\t}\r\n\r\n}","import MutationSkeleton from \"./mutationskeleton\";\r\n\r\nexport default class MutationLoop extends MutationSkeleton {\r\n\r\n\tstatic defaults = Object.assign({}, MutationSkeleton.defaults, {\r\n\t\ttimeout: 1000,\r\n\t})\r\n\r\n\tconstructor(element, options = {}) {\r\n\t\tsuper(element, options);\r\n\t\tthis.loopTimeout();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.loopCancel();\r\n\t}\r\n\r\n\tloopTimeout() {\r\n\t\tclearTimeout(this._loopTimeout);\r\n\t\tthis._loopTimeout = setTimeout(this.loop, this.options.timeout);\r\n\t}\r\n\r\n\tloopCancel() {\r\n\t\tclearTimeout(this._loopTimeout);\r\n\t}\r\n\r\n\tloop = () => {\r\n\t\tthis.options.check() && this.loopTimeout();\r\n\t}\r\n\r\n}","import MutationSkeleton from \"./mutationskeleton\";\r\n\r\nexport default class MutationObserver extends MutationSkeleton {\r\n\r\n\tstatic defaults = Object.assign({}, MutationSkeleton.defaults, {\r\n\t\tanchor: null,\r\n\t\tdelay: 0,\r\n\t})\r\n\r\n\tconstructor(element, options = {}) {\r\n\t\tsuper(element, options);\r\n\t\tthis.observe();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.disconnect();\r\n\t}\r\n\r\n\tobserve() {\r\n\t\tconst anchor = this.getAnchor();\r\n\r\n\t\tif (anchor == null) {\r\n\t\t\tconsole?.warn('cant find anchor for node preserver');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.observer = new window.MutationObserver(this.listener);\r\n\t\tthis.observer.observe(anchor, {\r\n\t\t\tchildList: true,\r\n\t\t\tsubtree: true,\r\n\t\t});\r\n\t}\r\n\r\n\tdisconnect() {\r\n\t\tif (this.observer == null) { return; }\r\n\r\n\t\tthis.observer.disconnect();\r\n\t\tthis.observer = null;\r\n\t}\r\n\r\n\tlistener = (mutations) => {\r\n\t\tfor (const mutation of mutations) {\r\n\t\t\tif (mutation.removedNodes == null) { continue; }\r\n\r\n\t\t\tfor (const removedNode of mutation.removedNodes) {\r\n\t\t\t\tif (!(removedNode instanceof HTMLElement)) { continue; }\r\n\r\n\t\t\t\tif (removedNode === this.el || removedNode.contains(this.el)) {\r\n\t\t\t\t\tthis.runCheck();\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\trunCheck() {\r\n\t\tconst delay = this.options.delay;\r\n\r\n\t\tif (delay == null) {\r\n\t\t\tthis.options.check();\r\n\t\t} else {\r\n\t\t\tclearTimeout(this._checkTimeout);\r\n\t\t\tthis._checkTimeout = setTimeout(() => { this.options.check(); }, delay);\r\n\t\t}\r\n\t}\r\n\r\n\tgetAnchor() {\r\n\t\tif (this.options.anchor == null) { return document.body; }\r\n\r\n\t\treturn this.el.closest(this.options.anchor);\r\n\t}\r\n\r\n}","import MutationLoop from \"./mutationloop\";\r\nimport MutationObserver from \"./mutationobserver\";\r\n\r\nexport default class MutationFactory {\r\n\r\n\tstatic make(element, options) {\r\n\t\tif (typeof window.MutationObserver === 'function') {\r\n\t\t\treturn new MutationObserver(element, options);\r\n\t\t}\r\n\r\n\t\treturn new MutationLoop(element, options);\r\n\t}\r\n\r\n}","export default class Subscriber {\r\n\r\n\tstatic defaults = {\r\n\t\tcheck: null,\r\n\t\ton: null,\r\n\t\toff: null,\r\n\t}\r\n\r\n\tconstructor(element, options = {}) {\r\n\t\tthis.el = element;\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\r\n\t\tthis.bind();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.unbind();\r\n\r\n\t\tthis.options = {};\r\n\t\tthis.el = null;\r\n\t}\r\n\r\n\tbind() {\r\n\t\tif (this.options.on == null) {\r\n\t\t\tconsole?.warn('define \"on\" option for subscriber of node preserver');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.options.on(this.options.check);\r\n\t}\r\n\r\n\tunbind() {\r\n\t\tif (this.options.off == null) {\r\n\t\t\tconsole?.warn('define \"off\" option for subscriber of node preserver');\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.options.off(this.options.check);\r\n\t}\r\n\r\n}","import MutationFactory from \"./nodepreserver/mutationfactory\";\r\nimport Subscriber from \"./nodepreserver/subscriber\";\r\n\r\nexport default class NodePreserver {\r\n\r\n\tstatic defaults = {\r\n\t\trestore: null,\r\n\t\tsubscriber: null,\r\n\t\tmutation: true,\r\n\t}\r\n\r\n\t/** @var MutationSkeleton */\r\n\tmutation;\r\n\t/** @var Subscriber */\r\n\tsubscriber;\r\n\r\n\tconstructor(element, options = {}) {\r\n\t\tthis.el = element;\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\r\n\t\tthis.install();\r\n\t}\r\n\r\n\tdestroy() {\r\n\t\tthis.uninstall();\r\n\t\tthis.options = {};\r\n\t\tthis.el = null;\r\n\t}\r\n\r\n\tinstall() {\r\n\t\tthis.installMutation();\r\n\t\tthis.installSubscriber();\r\n\t}\r\n\r\n\tuninstall() {\r\n\t\tthis.uninstallMutation();\r\n\t\tthis.uninstallSubscriber();\r\n\t}\r\n\r\n\tinstallMutation() {\r\n\t\tif (!this.isEnabled('mutation')) { return; }\r\n\r\n\t\tthis.mutation = MutationFactory.make(this.el, this.driverOptions('mutation'));\r\n\t}\r\n\r\n\tuninstallMutation() {\r\n\t\tif (this.mutation == null) { return; }\r\n\r\n\t\tthis.mutation.destroy();\r\n\t}\r\n\r\n\tinstallSubscriber() {\r\n\t\tif (!this.isEnabled('subscriber')) { return; }\r\n\r\n\t\tthis.subscriber = new Subscriber(this.el, this.driverOptions('subscriber'));\r\n\t}\r\n\r\n\tuninstallSubscriber() {\r\n\t\tif (this.subscriber == null) { return; }\r\n\r\n\t\tthis.subscriber.destroy();\r\n\t\tthis.subscriber = null;\r\n\t}\r\n\r\n\tisEnabled(type) {\r\n\t\treturn !!this.options[type];\r\n\t}\r\n\r\n\tdriverOptions(type) {\r\n\t\tconst option = typeof this.options[type] === 'object' ? this.options[type] : {};\r\n\t\tconst overrides = {\r\n\t\t\tcheck: this.check,\r\n\t\t};\r\n\r\n\t\treturn Object.assign({}, option, overrides);\r\n\t}\r\n\r\n\tcheck = () => {\r\n\t\tconst found = document.body.contains(this.el);\r\n\r\n\t\tif (!found) {\r\n\t\t\tthis.options.restore();\r\n\t\t}\r\n\r\n\t\treturn found;\r\n\t}\r\n}","export default class Template {\r\n\r\n\t/**\r\n\t * @param {string=} template\r\n\t * @param {Object} vars\r\n\t * @returns {string}\r\n\t */\r\n\tstatic compile(template, vars) {\r\n\t\tlet key;\r\n\t\tlet replaceKey;\r\n\t\tlet replaceValue;\r\n\t\tlet result = template;\r\n\r\n\t\tfor (key in vars) {\r\n\t\t\tif (!vars.hasOwnProperty(key)) { continue; }\r\n\r\n\t\t\treplaceKey = '#' + key.toUpperCase() + '#';\r\n\t\t\treplaceValue = vars[key];\r\n\r\n\t\t\tdo {\r\n\t\t\t\tresult = result.replace(replaceKey, replaceValue);\r\n\t\t\t} while (result.indexOf(replaceKey) !== -1);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tstatic toElement(html) {\r\n\t\tconst context = document.createElement('div');\r\n\t\tcontext.innerHTML = html;\r\n\r\n\t\treturn context.firstElementChild;\r\n\t}\r\n\r\n\tstatic toElements(html) {\r\n\t\tconst context = document.createElement('div');\r\n\t\tcontext.innerHTML = html;\r\n\r\n\t\treturn [...context.children];\r\n\t}\r\n\r\n}","import SolutionRegistry from './solutionregistry';\r\nimport NodePreserver from \"./ui/nodepreserver\";\r\nimport Utils from './utils/template';\r\n\r\nexport default class Factory {\r\n\r\n\tstatic defaults = {\r\n\t\tsolution: null,\r\n\t\ttemplate: '<div id=\"yandexpay\" class=\"bx-yapay-drawer\"></div>',\r\n\t\tcontainerSelector: '.bx-yapay-drawer',\r\n\t\tpreserve: false,\r\n\t\twaitLimit: 30,\r\n\t\twaitTimeout: 1000,\r\n\t}\r\n\r\n\tdefaults;\r\n\toptions;\r\n\twaitCount = 0;\r\n\r\n\tconstructor(options = {}) {\r\n\t\tthis.defaults = Object.assign({}, this.constructor.defaults);\r\n\t\tthis.options = {};\r\n\r\n\t\tthis.setOptions(options);\r\n\t\tthis.bootSolution();\r\n\t}\r\n\r\n\tinject(selector, position) {\r\n\t\treturn Promise.resolve()\r\n\t\t\t.then(() => this.waitElement(selector))\r\n\t\t\t.then((anchor) => this.checkElement(anchor))\r\n\t\t\t.then((anchor) => {\r\n\t\t\t\tconst element = this.renderElement(anchor, position);\r\n\t\t\t\tconst widget = this.install(element);\r\n\r\n\t\t\t\tif (this.getOption('preserve')) {\r\n\t\t\t\t\tthis.preserve(selector, position, widget);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn widget;\r\n\t\t\t})\r\n\t}\r\n\r\n\tcheckElement(anchor) {\r\n\t\tconst selector = this.getOption('containerSelector');\r\n\t\tconst contains = (\r\n\t\t\t!!anchor.querySelector(selector)\r\n\t\t\t|| this.containsSiblingElement(anchor, selector)\r\n\t\t);\r\n\r\n\t\tif (contains) {\r\n\t\t\tthrow new Error('the element already has a container');\r\n\t\t}\r\n\r\n\t\treturn anchor;\r\n\t}\r\n\r\n\tcontainsSiblingElement(anchor, selector) {\r\n\t\tlet result = false;\r\n\t\tlet next = anchor.parentElement?.firstElementChild;\r\n\r\n\t\twhile (next) {\r\n\t\t\tif (next.matches(selector) || next.querySelector(selector)) {\r\n\t\t\t\tresult = true;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\r\n\t\t\tnext = next.nextElementSibling;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\t\r\n\tpreserve(selector, position, widget) {\r\n\t\tconst preserver = new NodePreserver(widget.el, Object.assign({}, this.preserveOptions(), {\r\n\t\t\trestore: () => {\r\n\t\t\t\tpreserver.destroy();\r\n\t\t\t\t// noinspection JSIgnoredPromiseFromCall\r\n\t\t\t\tthis.restore(selector, position, widget);\r\n\t\t\t},\r\n\t\t}));\r\n\t}\r\n\r\n\tpreserveOptions() {\r\n\t\tconst preserveOption = this.getOption('preserve');\r\n\r\n\t\treturn typeof preserveOption === 'object' ? preserveOption : {};\r\n\t}\r\n\r\n\trestore(selector, position, widget) {\r\n\t\treturn Promise.resolve()\r\n\t\t\t.then(() => this.waitElement(selector))\r\n\t\t\t.then((anchor) => {\r\n\t\t\t\tconst element = this.renderElement(anchor, position);\r\n\r\n\t\t\t\twidget.restore(element);\r\n\r\n\t\t\t\tif (this.getOption('preserve')) {\r\n\t\t\t\t\tthis.preserve(selector, position, widget);\r\n\t\t\t\t}\r\n\r\n\t\t\t\treturn widget;\r\n\t\t\t});\r\n\t}\r\n\r\n\tinstall(element) {\r\n\t\treturn new BX.YandexPay.Widget(element);\r\n\t}\r\n\r\n\twaitElement(selector) {\r\n\t\treturn new Promise((resolve, reject) => {\r\n\t\t\tthis.waitCount = 0;\r\n\t\t\tthis.waitElementLoop(selector, resolve, reject);\r\n\t\t});\r\n\t}\r\n\r\n\twaitElementLoop(selector, resolve, reject) {\r\n\t\tconst anchor = this.findElement(selector);\r\n\r\n\t\tif (anchor) {\r\n\t\t\tresolve(anchor);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t++this.waitCount;\r\n\r\n\t\tif (this.waitCount >= this.getOption('waitLimit')) {\r\n\t\t\treject('cant find element by selector ' + selector);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tsetTimeout(this.waitElementLoop.bind(this, selector, resolve, reject), this.getOption('waitTimeout'));\r\n\t}\r\n\r\n\tfindElement(selector) {\r\n\t\tlet elementList;\r\n\t\tlet variant = selector.trim();\r\n\t\tlet result;\r\n\r\n\t\tif (variant === '') { throw new Error('widget selector is empty'); }\r\n\r\n\t\telementList = this.searchBySelector(variant) ?? this.searchById(selector) ?? this.searchByClassName(selector);\r\n\r\n\t\tif (elementList == null) { return null; }\r\n\r\n\t\tif (elementList.length > 1) {\r\n\t\t\tresult = this.reduceVisible(elementList);\r\n\t\t}\r\n\r\n\t\tif (result == null) {\r\n\t\t\tresult = elementList[0];\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tsearchBySelector(selector) {\r\n\t\ttry {\r\n\t\t\tconst result = [];\r\n\r\n\t\t\tfor (const part of selector.split(',')) { // first selector\r\n\t\t\t\tconst partSanitized = part.trim();\r\n\r\n\t\t\t\tif (partSanitized === '' || !this.isCssSelector(partSanitized)) { continue; }\r\n\r\n\t\t\t\tconst collection = document.querySelectorAll(partSanitized);\r\n\r\n\t\t\t\tfor (const element of collection) {\r\n\t\t\t\t\tresult.push(element);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treturn result.length > 0 ? result : null;\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tsearchById(selector) {\r\n\t\ttry {\r\n\t\t\tconst element = document.getElementById(selector);\r\n\r\n\t\t\treturn element != null ? [element] : null;\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\tsearchByClassName(selector) {\r\n\t\ttry {\r\n\t\t\tconst collection = document.getElementsByClassName(selector);\r\n\r\n\t\t\treturn collection.length > 0 ? collection : null;\r\n\t\t} catch (e) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\t}\r\n\r\n\treduceVisible(collection) {\r\n\t\tlet result = null;\r\n\t\t\r\n\t\tfor (const element of collection) {\r\n\t\t\tif (this.testVisible(element)) {\r\n\t\t\t\tresult = element;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\t\r\n\ttestVisible(element) {\r\n\t\treturn (element.offsetWidth || element.offsetHeight || element.getClientRects().length );\r\n\t}\r\n\r\n\tisCssSelector(selector) {\r\n\t\treturn /^[.#]/.test(selector);\r\n\t}\r\n\r\n\trenderElement(anchor, position) {\r\n\t\tconst selector = this.getOption('containerSelector');\r\n\t\tconst width = this.getOption('buttonWidth') || YaPay.ButtonWidth.Auto;\r\n\t\tconst html = Utils.compile(this.getOption('template'), {\r\n\t\t\tlabel: this.getOption('label'),\r\n\t\t\twidth: width.toLowerCase(),\r\n\t\t});\r\n\t\tlet elements = Utils.toElements(html);\r\n\t\tlet result = null;\r\n\r\n\t\tif (position.indexOf('after') === 0) { elements = elements.reverse(); }\r\n\r\n\t\tfor (const element of elements) {\r\n\t\t\tanchor.insertAdjacentElement(position, element);\r\n\r\n\t\t\tif (result != null) { continue; }\r\n\r\n\t\t\tresult = element.matches(selector) ? element : element.querySelector(selector);\r\n\t\t}\r\n\r\n\t\tif (result == null) {\r\n\t\t\tthrow new Error(`cant find template container by selector ${selector}`);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tbootSolution() {\r\n\t\tconst name = this.getOption('solution');\r\n\t\tconst mode = this.getOption('mode');\r\n\t\tconst solution = SolutionRegistry.getPage(name, mode);\r\n\r\n\t\tif (solution == null) { return; }\r\n\r\n\t\tsolution.bootFactory(this);\r\n\t}\r\n\r\n\textendDefaults(options) {\r\n\t\tthis.defaults = Object.assign(this.defaults, options);\r\n\t}\r\n\r\n\tsetOptions(options) {\r\n\t\tthis.options = Object.assign(this.options, options);\r\n\t}\r\n\r\n\tgetOption(name) {\r\n\t\treturn this.options[name] ?? this.defaults[name]\r\n\t}\r\n}","import Template from '../utils/template';\r\n\r\nexport default class AbstractStep {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '',\r\n\t}\r\n\r\n\tdefaults;\r\n\toptions;\r\n\twidget;\r\n\tdelayTimeouts = {};\r\n\r\n\t/**\r\n\t * @param {Widget} widget\r\n\t * @param {Object} options\r\n\t */\r\n\tconstructor(widget, options = {}) {\r\n\t\tthis.widget = widget;\r\n\t\tthis.defaults = Object.assign({}, this.constructor.defaults);\r\n\t\tthis.options = Object.assign({}, options);\r\n\t}\r\n\r\n\t/**\r\n\t *\r\n\t * @param {string} name\r\n\t * @returns {*}\r\n\t */\r\n\tgetOption(name) {\r\n\t\treturn this.options[name] ?? this.widget.getOption(name) ?? this.defaults[name];\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object<Element>} node Element\r\n\t * @param {Object} data Options\r\n\t */\r\n\trender(node, data = {}) {\r\n\t\tnode.innerHTML = this.compile(data);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object} data\r\n\t * @returns {string}\r\n\t */\r\n\tcompile(data) {\r\n\t\treturn Template.compile(this.getOption('template'), data);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object<Element>} node\r\n\t */\r\n\trestore(node) {\r\n\t\t// nothing by default\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} url\r\n\t * @param {Object} data\r\n\t * @returns {Promise.<Object>}\r\n\t */\r\n\tquery(url, data) {\r\n\t\treturn fetch(url, {\r\n\t\t\tmethod: 'POST',\r\n\t\t\theaders: { 'Content-Type': 'application/json' },\r\n\t\t\tbody: JSON.stringify(data)\r\n\t\t})\r\n\t\t\t.then(response => {return response.json()})\r\n\t}\r\n\r\n\tgetTemplate(key) {\r\n\t\tlet optionKey = key + 'Template';\r\n\t\tlet option = this.options[optionKey];\r\n\t\tlet optionFirstSymbol = option.substr(0, 1);\r\n\t\tlet result;\r\n\r\n\t\tif (optionFirstSymbol === '.' || optionFirstSymbol === '#') {\r\n\t\t\tresult = this.getNode(option).innerHTML;\r\n\t\t} else {\r\n\t\t\tresult = option;\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tgetElement(key, context, method) {\r\n\t\tlet selector = this.getElementSelector(key);\r\n\r\n\t\treturn this.getNode(selector, context, method || 'querySelector');\r\n\t}\r\n\r\n\tgetElementSelector(key) {\r\n\t\tlet optionKey = key + 'Element';\r\n\r\n\t\treturn this.options[optionKey];\r\n\t}\r\n\r\n\tgetNode(selector, context, method) {\r\n\t\tif (selector.substr(0, 1) === '#') { // is id query\r\n\t\t\tcontext = document;\r\n\t\t} else if (!context) {\r\n\t\t\tcontext = this.el;\r\n\t\t}\r\n\r\n\t\treturn context[method](selector);\r\n\t}\r\n\r\n\tclearDelay(name) {\r\n\t\tif (this.delayTimeouts[name] == null) { return; }\r\n\r\n\t\tclearTimeout(this.delayTimeouts[name]);\r\n\t\tthis.delayTimeouts[name] = null;\r\n\t}\r\n\r\n\tdelay(name, args = [], timeout = 300) {\r\n\t\tthis.clearDelay(name);\r\n\t\tthis.delayTimeouts[name] = setTimeout(this[name].bind(this, ...args), timeout);\r\n\t}\r\n\r\n}","import Template from \"../utils/template\";\r\n\r\nexport default class Base {\r\n\tstatic defaults = {\r\n\t\ttemplate: null,\r\n\t}\r\n\r\n\tconstructor(options = {}) {\r\n\t\tthis.options = Object.assign({}, this.constructor.defaults, options);\r\n\t\tthis.widget = null;\r\n\t}\r\n\r\n\trender(node, data = {}) {\r\n\t\tnode.innerHTML = this.compile(data);\r\n\t}\r\n\r\n\tcompile(data) {\r\n\t\treturn Template.compile(this.options.template, data);\r\n\t}\r\n\r\n\tsetWidget(widget) {\r\n\t\tthis.widget = widget;\r\n\t}\r\n\r\n\tgetOption(key) {\r\n\t\tif (key in this.options) {\r\n\t\t\treturn this.options[key];\r\n\t\t} else {\r\n\t\t\treturn this.widget.options[key];\r\n\t\t}\r\n\t}\r\n}","import Base from \"./base\";\r\nimport Template from \"../utils/template\";\r\n\r\nexport default class Form extends Base {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<form name=\"form\" action=\"#ACTION#\" method=\"#METHOD#\">'\r\n\t\t\t+ '#INPUTS#'\r\n\t\t\t+ '</form>',\r\n\t}\r\n\r\n\trender(node, data) {\r\n\t\tsuper.render(node, data);\r\n\t\tthis.autosubmit(node);\r\n\t}\r\n\r\n\tcompile(data) {\r\n\t\tconst template = this.options.template;\r\n\t\tconst vars = Object.assign(data, {\r\n\t\t\t'inputs': this.makeInputs(data)\r\n\t\t});\r\n\r\n\t\treturn Template.compile(template, vars);\r\n\t}\r\n\r\n\tmakeInputs(data) {\r\n\t\tlet key;\r\n\t\tlet vars = data.params;\r\n\t\tlet value;\r\n\t\tlet template;\r\n\r\n\t\tif (Object.keys(vars).length === 0) { return ''; }\r\n\r\n\t\ttemplate = data.termUrl ? '<input type=\"hidden\" name=\"TermUrl\" value=\"' + vars.termUrl + '\">' : '';\r\n\r\n\t\tfor (key in vars)\r\n\t\t{\r\n\t\t\tif (!vars.hasOwnProperty(key)) { continue; }\r\n\r\n\t\t\tvalue = vars[key];\r\n\r\n\t\t\ttemplate += '<input type=\"hidden\" name=\"' + key + '\" value=\"' + value + '\">';\r\n\t\t}\r\n\r\n\t\treturn template;\r\n\t}\r\n\r\n\tmakeTermUrl() {\r\n\t\tlet result = this.getOption('notifyUrl');\r\n\t\tlet backUrl = window.location.href;\r\n\r\n\t\tresult +=\r\n\t\t\t(result.indexOf('?') === -1 ? '?' : '&')\r\n\t\t\t+ 'backurl=' + encodeURIComponent(backUrl)\r\n\t\t\t+ '&service=' + this.getOption('requestSign')\r\n\t\t\t+ '&paymentId=' + this.getOption('externalId');\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n\tautosubmit(node) {\r\n\t\tconst form = node.querySelector('form');\r\n\r\n\t\tform.submit();\r\n\t}\r\n}","import Base from \"./base\";\r\nimport Template from \"../utils/template\";\r\n\r\nexport default class Iframe extends Base {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<iframe style=\"display: none;\"></iframe>',\r\n\t}\r\n\r\n\trender(node, data) {\r\n\t\tthis.insertIframe(node, data);\r\n\t}\r\n\r\n\tinsertIframe(node, data) {\r\n\t\tnode.innerHTML = Template.compile(this.options.template, data);\r\n\t\tthis.compile(node, data);\r\n\t}\r\n\r\n\tcompile(node, data) {\r\n\t\tlet iframe = node.querySelector('iframe');\r\n\t\tlet contentIframe = iframe.contentWindow || ( iframe.contentDocument.document || iframe.contentDocument);\r\n\t\tlet html = data.params;\r\n\r\n\t\tcontentIframe.document.open();\r\n\t\tcontentIframe.document.write(html);\r\n\t\tcontentIframe.document.close();\r\n\t}\r\n}","import Base from \"./base\";\r\nimport Template from \"../utils/template\";\r\n\r\nexport default class IframeRbs extends Base {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<iframe style=\"display: none;\"></iframe>',\r\n\t}\r\n\r\n\trender(node, data) {\r\n\t\tthis.insertIframe(node, data);\r\n\t}\r\n\r\n\tinsertIframe(node, data) {\r\n\t\tnode.innerHTML = Template.compile(this.options.template, data);\r\n\t\tthis.compile(node, data);\r\n\t}\r\n\r\n\tcompile(node, data) {\r\n\t\tPromise.resolve()\r\n\t\t\t.then(() => this.renderIframe(node, data))\r\n\t\t\t.then(() => this.query(data));\r\n\t}\r\n\r\n\tquery (data) {\r\n\t\tfetch(this.getOption('notifyUrl'), {\r\n\t\t\tmethod: 'POST',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t},\r\n\t\t\tbody: JSON.stringify({\r\n\t\t\t\tservice: this.getOption('requestSign'),\r\n\t\t\t\taccept: 'json',\r\n\t\t\t\tsecure: data.params.secure,\r\n\t\t\t\texternalId: data.params.notify.externalId,\r\n\t\t\t\tpaySystemId: data.params.notify.paySystemId\r\n\t\t\t})\r\n\t\t})\r\n\t\t\t.then(response => response.json())\r\n\t\t\t.then(result => {\r\n\t\t\t\tif (result.success === true) {\r\n\t\t\t\t\tthis.widget.go(result.state, result);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.widget.go('error', result);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(error => console.log(error) );\r\n\t}\r\n\r\n\trenderIframe(node, data) {\r\n\t\tlet iframe = node.querySelector('iframe');\r\n\t\tlet contentIframe = iframe.contentWindow || ( iframe.contentDocument.document || iframe.contentDocument);\r\n\t\tlet html = `<form name=\"form\" action=\"${data.action}\" method=\"POST\">`;\r\n\r\n\t\tcontentIframe.document.open();\r\n\t\tcontentIframe.document.write(html);\r\n\t\tcontentIframe.document.close();\r\n\r\n\t\tcontentIframe.document.querySelector('form').submit();\r\n\t}\r\n}\r\n","import AbstractStep from \"./abstractstep\";\r\nimport SecureForm from \"../secure3d/form\";\r\nimport SecureIframe from \"../secure3d/iframe\";\r\nimport SecureRbs from \"../secure3d/iframerbs\";\r\n\r\nexport default class Step3ds extends AbstractStep {\r\n\r\n\trender(node, data) {\r\n\t\tconst view = this.makeView(data);\r\n\t\tview.setWidget(this.widget);\r\n\t\tview.render(node, data);\r\n\t}\r\n\r\n\tmakeView(data) {\r\n\t\tlet view = data.view;\r\n\r\n\t\tif (view === 'form') {\r\n\t\t\treturn new SecureForm();\r\n\t\t} else if (view === 'iframe') {\r\n\t\t\treturn new SecureIframe();\r\n\t\t} else if (view === 'iframerbs') {\r\n\t\t\treturn new SecureRbs();\r\n\t\t}\r\n\r\n\t\tthrow new Error('view secure3d missing')\r\n\t}\r\n}","import AbstractStep from './abstractstep';\r\n\r\nexport default class Finish extends AbstractStep {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<div class=\"alert alert-success\" role=\"alert\"><strong>#MESSAGE#</strong></div>'\r\n\t}\r\n\r\n}","import AbstractStep from './abstractstep';\r\n\r\nexport default class Failure extends AbstractStep {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<div class=\"alert alert-danger\" role=\"alert\"><strong>#MESSAGE#</strong></div>'\r\n\t}\r\n\r\n}","import Template from '../utils/template';\r\nimport AbstractStep from './abstractstep';\r\n\r\nconst YaPay = window.YaPay;\r\n\r\nexport default class Payment extends AbstractStep {\r\n\r\n\tstatic defaults = {\r\n\t\ttemplate: '<div class=\"alert alert-success\" role=\"alert\"><strong>#MESSAGE#</strong></div>'\r\n\t}\r\n\r\n\trender(node, data) {\r\n\t\tconst paymentData = this.getPaymentData(data);\r\n\r\n\t\tthis.createPayment(node, paymentData);\r\n\t}\r\n\r\n\tcompile(data) {\r\n\t\treturn Template.compile(this.options.template, data);\r\n\t}\r\n\r\n\tgetPaymentData(data) {\r\n\t\treturn {\r\n\t\t\tenv: this.getOption('env'),\r\n\t\t\tversion: 2,\r\n\t\t\tcountryCode: YaPay.CountryCode.Ru,\r\n\t\t\tcurrencyCode: YaPay.CurrencyCode.Rub,\r\n\t\t\tmerchant: {\r\n\t\t\t\tid: this.getOption('merchantId'),\r\n\t\t\t\tname: this.getOption('merchantName')\r\n\t\t\t},\r\n\t\t\torder: {\r\n\t\t\t\tid: data.id,\r\n\t\t\t\ttotal: { amount: data.total },\r\n\t\t\t\titems: data.items\r\n\t\t\t},\r\n\t\t\tpaymentMethods: [\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: YaPay.PaymentMethodType.Card,\r\n\t\t\t\t\tgateway: this.getOption('gateway'),\r\n\t\t\t\t\tgatewayMerchantId: this.getOption('gatewayMerchantId'),\r\n\t\t\t\t\tallowedAuthMethods: [YaPay.AllowedAuthMethod.PanOnly],\r\n\t\t\t\t\tallowedCardNetworks: [\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.UnionPay,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Uzcard,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Discover,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.AmericanExpress,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Visa,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Mastercard,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Mir,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Maestro,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.VisaElectron\r\n\t\t\t\t\t]\r\n\t\t\t\t}\r\n\t\t\t],\r\n\t\t}\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\r\n\t\tYaPay.createPayment(paymentData, { agent: { name: \"CMS-Bitrix\", version: \"1.0\" } })\r\n\t\t\t.then( (payment) => {\r\n\r\n\t\t\t\tlet button = payment.createButton({\r\n\t\t\t\t\ttype: YaPay.ButtonType.Pay,\r\n\t\t\t\t\ttheme: this.getOption('buttonTheme') || YaPay.ButtonTheme.Black,\r\n\t\t\t\t\twidth: this.getOption('buttonWidth') || YaPay.ButtonWidth.Auto,\r\n\t\t\t\t});\r\n\r\n\t\t\t\tbutton.mount(node);\r\n\r\n\t\t\t\tbutton.on(YaPay.ButtonEventType.Click, function onPaymentButtonClick() {\r\n\t\t\t\t\tpayment.checkout();\r\n\t\t\t\t});\r\n\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Process, (event) => {\r\n\r\n\t\t\t\t\tthis.notify(payment, event).then((result) => {});\r\n\r\n\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Success);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Error, function onPaymentError(event) {\r\n\t\t\t\t\tconsole.log({'errors': event});\r\n\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Error);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Abort, function onPaymentAbort(event) {});\r\n\t\t\t})\r\n\t\t\t.catch(function (err) {\r\n\t\t\t\tconsole.log({'payment not create': err});\r\n\t\t\t});\r\n\t}\r\n\r\n\tnotify(payment, yandexPayData) {\r\n\t\treturn fetch(this.getOption('notifyUrl'), {\r\n\t\t\tmethod: 'POST',\r\n\t\t\theaders: {\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t},\r\n\t\t\tbody: JSON.stringify({\r\n\t\t\t\tservice: this.getOption('requestSign'),\r\n\t\t\t\taccept: 'json',\r\n\t\t\t\tyandexData: yandexPayData,\r\n\t\t\t\texternalId: this.getOption('externalId'),\r\n\t\t\t\tpaySystemId: this.getOption('paySystemId')\r\n\t\t\t})\r\n\t\t})\r\n\t\t\t.then(response => response.json())\r\n\t\t\t.then(result => {\r\n\t\t\t\tif (result.success === true) {\r\n\t\t\t\t\tthis.widget.go(result.state, result);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.widget.go('error', result);\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t.catch(error => console.log(error) );\r\n\t}\r\n}","export default class Proxy {\r\n\r\n\tconstructor(cart) {\r\n\t\tthis.cart = cart;\r\n\t}\r\n\r\n\tgetOption(name) {\r\n\t\treturn this.cart.getOption(name);\r\n\t}\r\n\r\n\tbootstrap() {\r\n\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\r\n\t}\r\n\r\n\tgetPaymentData() {\r\n\r\n\t}\r\n}","import Proxy from \"./proxy\";\r\n\r\nexport default class RestProxy extends Proxy {\r\n\r\n\tbootstrap() {\r\n\t\tthis.getButtonData()\r\n\t\t\t.then((result) => {\r\n\t\t\t\tif (result.status === 'fail') { throw new Error(result.reason); }\r\n\r\n\t\t\t\tthis.combineOrderWithData(result.data);\r\n\t\t\t\tthis.createPayment(this.cart.element, this.cart.paymentData);\r\n\r\n\t\t\t})\r\n\t\t\t.catch((error) => {\r\n\r\n\t\t\t});\r\n\t}\r\n\r\n\tgetButtonData() {\r\n\r\n\t\tlet data = {\r\n\t\t\tproductId: this.getOption('productId'),\r\n\t\t\tmode: this.getOption('mode'),\r\n\t\t\tcurrencyCode: this.getOption('currencyCode'),\r\n\t\t\tsetupId: this.getOption('setupId'),\r\n\t\t};\r\n\r\n\t\treturn this.cart.query(this.getOption('restUrl') + 'button/data', data);\r\n\t}\r\n\r\n\tgetPaymentData() {\r\n\t\treturn {\r\n\t\t\tenv: this.getOption('env'),\r\n\t\t\tversion: 3,\r\n\t\t\tmerchantId: this.getOption('merchantId'),\r\n\t\t\tcart: { externalId: \"checkout-b2b-test-order-id\", },\r\n\t\t\tcurrencyCode: this.getOption('currencyCode'),\r\n\t\t}\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\r\n\t\tconsole.log(paymentData);\r\n\t\tYaPay.createCheckout(paymentData, { agent: { name: \"CMS-Bitrix\", version: \"1.0\" } })\r\n\t\t\t.then((payment) => {\r\n\t\t\t\tthis.cart.removeLoader();\r\n\t\t\t\tthis.mountButton(node, payment);\r\n\r\n\t\t\t\tpayment.on(YaPay.CheckoutEventType.Success, (event) => {\r\n\r\n\t\t\t\t\tthis.authorize(event)\r\n\t\t\t\t\t\t.then((result) => {\r\n\t\t\t\t\t\t\tif (result.status === 'success') {\r\n\t\t\t\t\t\t\t\tsetTimeout(function() {\r\n\t\t\t\t\t\t\t\t\twindow.location.href = result.data.redirect;\r\n\t\t\t\t\t\t\t\t}, 1000);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tthis.cart.showError('authorize', result.reasonCode, result.reason);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\r\n\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Success);\r\n\t\t\t\t\tconsole.log(\"Process\", event);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tpayment.on(YaPay.CheckoutEventType.Error, (event) => {\r\n\t\t\t\t\tconsole.log(\"Process\", event);\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.catch((err) => {\r\n\t\t\t\tnode.remove();\r\n\t\t\t\tthis.cart.showError('yapayPayment','payment not created', err);\r\n\t\t\t});\r\n\t}\r\n\r\n\tauthorize(event) {\r\n\t\tlet data = {\r\n\t\t\torderId: event.orderId,\r\n\t\t\thash: event.metadata,\r\n\t\t\tsuccessUrl: this.getOption('successUrl'),\r\n\t\t};\r\n\r\n\t\treturn this.cart.query(this.getOption('restUrl') + 'authorize', data);\r\n\t}\r\n\r\n\tbindDebug(payment) {\r\n\t\tfor (const key in YaPay.CheckoutEventType) {\r\n\t\t\tif (!YaPay.CheckoutEventType.hasOwnProperty(key)) { continue; }\r\n\r\n\t\t\tpayment.on(YaPay.CheckoutEventType[key], function() {\r\n\t\t\t\tconsole.log(arguments);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tmountButton(node, payment) {\r\n\r\n\t\tthis.payment = payment;\r\n\r\n\t\tpayment.mountButton(this.cart.element, {\r\n\t\t\ttype: YaPay.ButtonType.Checkout,\r\n\t\t\ttheme: this.getOption('buttonTheme') || YaPay.ButtonTheme.Black,\r\n\t\t\twidth: this.getOption('buttonWidth') || YaPay.ButtonWidth.Auto,\r\n\t\t});\r\n\t}\r\n\r\n\trestoreButton(node) {\r\n\t\tif (this.payment == null) {\r\n\t\t\tthis.cart.insertLoader();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tthis.payment.mountButton(node, {\r\n\t\t\ttype: YaPay.ButtonType.Checkout,\r\n\t\t\ttheme: this.getOption('buttonTheme') || YaPay.ButtonTheme.Black,\r\n\t\t\twidth: this.getOption('buttonWidth') || YaPay.ButtonWidth.Auto,\r\n\t\t});\r\n\t}\r\n\r\n\tcombineOrderWithData(data) {\r\n\t\tconst { cart } = this.cart.paymentData;\r\n\r\n\t\tlet exampleData = {\r\n\t\t\tcart: {\r\n\t\t\t\t...cart,\r\n\t\t\t\titems: data.items,\r\n\t\t\t\ttotal: {\r\n\t\t\t\t\tamount: data.total.amount,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t\tmetadata: data.metadata\r\n\t\t};\r\n\r\n\t\tObject.assign(this.cart.paymentData, exampleData);\r\n\t}\r\n\r\n\tchangeOffer(newProductId) {\r\n\t\tlet productId = this.getOption('productId');\r\n\r\n\t\tif (productId !== newProductId) { // todo in items\r\n\t\t\tthis.cart.widget.setOptions({productId: newProductId});\r\n\t\t\tthis.getButtonData().then((result) => {\r\n\t\t\t\tthis.combineOrderWithData(result.data);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tchangeBasket() {\r\n\t\tthis.getButtonData().then((result) => {\r\n\t\t\tthis.combineOrderWithData(result.data);\r\n\t\t});\r\n\t}\r\n}","import Proxy from \"./proxy\";\r\n\r\nexport default class SiteProxy extends Proxy {\r\n\r\n\tbootstrap() {\r\n\t\tthis.getProducts()\r\n\t\t\t.then((result) => {\r\n\r\n\t\t\t\tif (result.error) { throw new Error(result.error.message); }\r\n\r\n\t\t\t\tthis.combineOrderWithProducts(result);\r\n\t\t\t\tthis.createPayment(this.cart.element, this.cart.paymentData);\r\n\r\n\t\t\t})\r\n\t\t\t.catch((error) => {\r\n\r\n\t\t\t});\r\n\t}\r\n\r\n\tgetPaymentData() {\r\n\t\treturn {\r\n\t\t\tenv: this.getOption('env'),\r\n\t\t\tversion: 2,\r\n\t\t\tcountryCode: YaPay.CountryCode.Ru,\r\n\t\t\tcurrencyCode: YaPay.CurrencyCode.Rub,\r\n\t\t\tmerchant: {\r\n\t\t\t\tid: this.getOption('merchantId'),\r\n\t\t\t\tname: this.getOption('merchantName'),\r\n\t\t\t\turl: this.getOption('siteUrl')\r\n\t\t\t},\r\n\t\t\torder: { id: '0' },\r\n\t\t\tpaymentMethods: [\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: YaPay.PaymentMethodType.Card,\r\n\t\t\t\t\tgateway: this.getOption('gateway'),\r\n\t\t\t\t\tgatewayMerchantId: this.getOption('gatewayMerchantId'),\r\n\t\t\t\t\tallowedAuthMethods: [YaPay.AllowedAuthMethod.PanOnly],\r\n\t\t\t\t\tallowedCardNetworks: [\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.UnionPay,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Uzcard,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Discover,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.AmericanExpress,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Visa,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Mastercard,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Mir,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.Maestro,\r\n\t\t\t\t\t\tYaPay.AllowedCardNetwork.VisaElectron\r\n\t\t\t\t\t]\r\n\t\t\t\t}\r\n\t\t\t],\r\n\r\n\t\t\trequiredFields: {\r\n\r\n\t\t\t\tbillingContact: {\r\n\t\t\t\t\temail: this.getOption('useEmail') || false\r\n\t\t\t\t},\r\n\r\n\t\t\t\tshippingContact: {\r\n\t\t\t\t\tname: this.getOption('useName') || false,\r\n\t\t\t\t\temail: this.getOption('useEmail') || false,\r\n\t\t\t\t\tphone: this.getOption('usePhone') || false,\r\n\t\t\t\t},\r\n\r\n\t\t\t\tshippingTypes: {\r\n\t\t\t\t\tdirect: true,\r\n\t\t\t\t\tpickup: true,\r\n\t\t\t\t},\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetProducts(){\r\n\r\n\t\tlet data = {\r\n\t\t\tyapayAction: 'getProducts',\r\n\t\t\tproductId: this.getOption('productId'),\r\n\t\t\tmode: this.getOption('mode'),\r\n\t\t\tsetupId: this.getOption('setupId')\r\n\t\t};\r\n\r\n\t\treturn this.cart.query(this.getOption('purchaseUrl'), data);\r\n\t}\r\n\r\n\tgetShippingOptions(address) {\r\n\r\n\t\tlet data = {\r\n\t\t\taddress: address,\r\n\t\t\tyapayAction: 'deliveryOptions',\r\n\t\t\titems: this.cart.paymentData.order.items,\r\n\t\t\tsetupId: this.getOption('setupId'),\r\n\t\t};\r\n\r\n\t\treturn this.cart.query(this.getOption('purchaseUrl'), data);\r\n\t}\r\n\r\n\tgetPickupOptions(bounds) {\r\n\r\n\t\tlet data = {\r\n\t\t\tbounds: bounds,\r\n\t\t\tyapayAction: 'pickupOptions',\r\n\t\t\titems: this.cart.paymentData.order.items,\r\n\t\t\tsetupId: this.getOption('setupId'),\r\n\t\t};\r\n\r\n\t\treturn this.cart.query(this.getOption('purchaseUrl'), data);\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\r\n\t\tYaPay.createPayment(paymentData, { agent: { name: \"CMS-Bitrix\", version: \"1.0\" } })\r\n\t\t\t.then((payment) => {\r\n\t\t\t\tthis.cart.removeLoader();\r\n\t\t\t\tthis.cart.mountButton(node, payment);\r\n\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Process, (event) => {\r\n\r\n\t\t\t\t\tthis.orderAccept(event).then((result) => {\r\n\r\n\t\t\t\t\t\tif (result.error) { throw new Error(result.error.message, result.error.code); }\r\n\r\n\t\t\t\t\t\tif(!this.isPaymentTypeCash(event)) {\r\n\t\t\t\t\t\t\tthis.notify(result, event).then(result => {\r\n\t\t\t\t\t\t\t\tif (result.success === true) {\r\n\t\t\t\t\t\t\t\t\tthis.cart.widget.go(result.state, result);\r\n\t\t\t\t\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Success);\r\n\t\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\t\tthis.cart.widget.go('error', result);\r\n\t\t\t\t\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Error);\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t});\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Success);\r\n\r\n\t\t\t\t\t\t\t\tif (result.redirect != null) {\r\n\t\t\t\t\t\t\t\t\twindow.location.href = result.redirect;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t})\r\n\t\t\t\t\t\t.catch((error) => {\r\n\t\t\t\t\t\t\tthis.cart.showError('yapayProcess', '', error); // todo test it\r\n\t\t\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Error);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t});\r\n\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Error, (event) => {\r\n\t\t\t\t\tthis.cart.showError('yapayError', 'service temporary unavailable');\r\n\t\t\t\t\tpayment.complete(YaPay.CompleteReason.Error);\r\n\t\t\t\t});\r\n\r\n\t\t\t\tpayment.on(YaPay.PaymentEventType.Change, (event) => {\r\n\t\t\t\t\t// если выбрали адрес доставки, отдаем скисок доставок\r\n\t\t\t\t\tif (event.shippingAddress) {\r\n\t\t\t\t\t\tthis.getShippingOptions(event.shippingAddress).then((result) => {\r\n\t\t\t\t\t\t\tpayment.update({shippingOptions: result})\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// добавляем выбранную доставку\r\n\t\t\t\t\tif (event.shippingOption){\r\n\t\t\t\t\t\tpayment.update({\r\n\t\t\t\t\t\t\torder: this.combineOrderWithDirectShipping(event.shippingOption),\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// если выбрали ПВЗ, отдаем список ПВЗ\r\n\t\t\t\t\tif (event.pickupBounds) {\r\n\t\t\t\t\t\tthis.getPickupOptions(event.pickupBounds).then((result) => {\r\n\t\t\t\t\t\t\tpayment.update({pickupPoints: result})\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// добавляем выбранный ПВЗ\r\n\t\t\t\t\tif (event.pickupPoint) {\r\n\t\t\t\t\t\tpayment.update({\r\n\t\t\t\t\t\t\torder: this.combineOrderWithPickupShipping(event.pickupPoint),\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t})\r\n\t\t\t.catch((err) => {\r\n\t\t\t\tthis.cart.showError('yapayPayment','payment not created', err);\r\n\t\t\t});\r\n\t}\r\n\r\n\torderAccept(event) {\r\n\r\n\t\tlet deliveryType = event.shippingMethodInfo.shippingOption ? 'delivery' : 'pickup';\r\n\t\tlet delivery;\r\n\r\n\t\tif (deliveryType === 'pickup') {\r\n\t\t\tdelivery = {\r\n\t\t\t\taddress: event.shippingMethodInfo.pickupPoint.address,\r\n\t\t\t\tpickup: event.shippingMethodInfo.pickupPoint,\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdelivery = {\r\n\t\t\t\taddress: event.shippingMethodInfo.shippingAddress,\r\n\t\t\t\tdelivery: event.shippingMethodInfo.shippingOption,\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tlet orderData = {\r\n\t\t\tsetupId: this.getOption('setupId'),\r\n\t\t\titems: this.cart.paymentData.order.items,\r\n\t\t\tpayment: event.paymentMethodInfo,\r\n\t\t\tcontact: event.shippingContact,\r\n\t\t\tyapayAction: 'orderAccept',\r\n\t\t\tdeliveryType: deliveryType,\r\n\t\t\tpaySystemId: this.isPaymentTypeCash(event) ? this.getOption('paymentCash') : this.getOption('paySystemId'),\r\n\t\t\torderAmount: event.orderAmount\r\n\t\t};\r\n\r\n\t\tlet data = {...orderData, ...delivery };\r\n\r\n\t\treturn this.cart.query(this.getOption('purchaseUrl'), data);\r\n\t}\r\n\r\n\tisPaymentTypeCash(event) {\r\n\t\treturn (event.paymentMethodInfo.type === 'CASH');\r\n\t}\r\n\r\n\tnotify(payment, yandexPayData) {\r\n\r\n\t\tlet data = {\r\n\t\t\tservice: this.getOption('requestSign'),\r\n\t\t\taccept: 'json',\r\n\t\t\tyandexData: yandexPayData,\r\n\t\t\texternalId: payment.externalId,\r\n\t\t\tpaySystemId: payment.paySystemId\r\n\t\t};\r\n\r\n\t\treturn this.cart.query(this.getOption('notifyUrl'), data);\r\n\t}\r\n\r\n\tchangeOffer(newProductId) {\r\n\t\tlet productId = this.getOption('productId');\r\n\r\n\t\tif (productId !== newProductId) { // todo in items\r\n\t\t\tthis.cart.widget.setOptions({productId: newProductId});\r\n\t\t\tthis.getProducts().then((result) => {\r\n\t\t\t\tthis.combineOrderWithProducts(result);\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\tchangeBasket() {\r\n\t\tthis.getProducts().then((result) => {\r\n\t\t\tthis.combineOrderWithProducts(result);\r\n\t\t});\r\n\t}\r\n\r\n\tcombineOrderWithPickupShipping(pickupOption) {\r\n\t\tconst { order } = this.cart.paymentData;\r\n\r\n\t\treturn {\r\n\t\t\t...order,\r\n\t\t\titems: [\r\n\t\t\t\t...order.items,\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: 'SHIPPING',\r\n\t\t\t\t\tlabel: pickupOption.label,\r\n\t\t\t\t\tamount: pickupOption.amount,\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\ttotal: {\r\n\t\t\t\t...order.total,\r\n\t\t\t\tamount: this.cart.amountSum(order.total.amount, pickupOption.amount),\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n\r\n\tcombineOrderWithDirectShipping(shippingOption) {\r\n\t\tconst { order } = this.cart.paymentData;\r\n\r\n\t\treturn {\r\n\t\t\t...order,\r\n\t\t\titems: [\r\n\t\t\t\t...order.items,\r\n\t\t\t\t{\r\n\t\t\t\t\ttype: 'SHIPPING',\r\n\t\t\t\t\tlabel: shippingOption.label,\r\n\t\t\t\t\tamount: shippingOption.amount,\r\n\t\t\t\t},\r\n\t\t\t],\r\n\t\t\ttotal: {\r\n\t\t\t\t...order.total,\r\n\t\t\t\tamount: this.cart.amountSum(order.total.amount, shippingOption.amount),\r\n\t\t\t},\r\n\t\t};\r\n\t}\r\n\r\n\tcombineOrderWithProducts(products) {\r\n\t\tconst { order } = this.cart.paymentData;\r\n\r\n\t\tlet exampleOrder = {\r\n\t\t\t...order,\r\n\t\t\titems: products.items,\r\n\t\t\ttotal: {\r\n\t\t\t\tamount: products.amount,\r\n\t\t\t},\r\n\t\t};\r\n\r\n\t\tObject.assign(this.cart.paymentData.order, exampleOrder);\r\n\t}\r\n\r\n\trestoreButton(node) {\r\n\t\tif (this.cart.paymentButton == null) {\r\n\t\t\tthis.cart.insertLoader();\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t//this.removeLoader();\r\n\t\tthis.cart.paymentButton.mount(node);\r\n\t}\r\n}","import Template from '../../utils/template';\r\nimport AbstractStep from '../abstractstep';\r\nimport { ready } from \"../../utils/ready\";\r\nimport RestProxy from \"./rest\";\r\nimport SiteProxy from \"./site\";\r\n\r\nconst YaPay = window.YaPay;\r\n\r\nexport default class AbstractCart extends AbstractStep {\r\n\r\n\tstatic defaults = {\r\n\t\tloaderTemplate: '<div class=\"bx-yapay-skeleton-loading width--#WIDTH#\"></div>',\r\n\t\tloaderSelector: '.bx-yapay-skeleton-loading',\r\n\t}\r\n\r\n\trender(node, data) {\r\n\t\tthis.isBootstrap = false;\r\n\t\tthis.element = node;\r\n\t\tthis.paymentButton = null;\r\n\t\tthis.proxy = this.getOption('isRest')\r\n\t\t\t? new RestProxy(this)\r\n\t\t\t: new SiteProxy(this);\r\n\t\tthis.paymentData = this.getPaymentData();\r\n\r\n\t\tthis.bootSolution();\r\n\t\tthis.insertLoader();\r\n\t\tthis.setupPaymentCash();\r\n\t\tthis.delayBootstrap();\r\n\t}\r\n\r\n\tcompile(data) {\r\n\t\treturn Template.compile(this.options.template, data);\r\n\t}\r\n\r\n\trestore(node) {\r\n\t\tthis.element = node;\r\n\t\tthis.restoreButton(node);\r\n\t}\r\n\r\n\tbootstrap() {\r\n\t\tthis.isBootstrap = true;\r\n\t\tthis.proxy.bootstrap();\r\n\t}\r\n\r\n\tbootSolution() {\r\n\t\tconst solution = this.widget.getSolution();\r\n\r\n\t\tif (solution == null) { return; }\r\n\r\n\t\tsolution.bootCart(this);\r\n\t}\r\n\r\n\tdelayChangeBasket() {\r\n\t\tthis.delay('changeBasket');\r\n\t}\r\n\r\n\tdelayChangeOffer(productId) {\r\n\t\tthis.delay('changeOffer', [productId]);\r\n\t}\r\n\r\n\tdelayBootstrap() {\r\n\t\tready(() => {\r\n\t\t\tthis.delay('bootstrap');\r\n\t\t});\r\n\t}\r\n\r\n\tchangeBasket() {\r\n\t\tif (!this.isBootstrap) { return; }\r\n\t\tthis.proxy?.changeBasket();\r\n\t}\r\n\r\n\tchangeOffer(newProductId) {\r\n\t\tif (!this.isBootstrap) { return; }\r\n\t\tthis.proxy?.changeOffer(newProductId);\r\n\t}\r\n\r\n\tsetupPaymentCash(){\r\n\t\t// Указываем возможность оплаты заказа при получении\r\n\t\tif (this.getOption('paymentCash') == null) { return; }\r\n\r\n\t\tthis.paymentData.paymentMethods.push({\r\n\t\t\ttype: YaPay.PaymentMethodType.Cash,\r\n\t\t});\r\n\t}\r\n\r\n\tgetPaymentData() {\r\n\t\treturn this.proxy.getPaymentData();\r\n\t}\r\n\r\n\tcreatePayment(node, paymentData) {\r\n\t\tthis.proxy.createPayment(node, paymentData);\r\n\t}\r\n\r\n\tmountButton(node, payment) {\r\n\t\tthis.paymentButton = payment.createButton({\r\n\t\t\ttype: YaPay.ButtonType.Checkout,\r\n\t\t\ttheme: this.getOption('buttonTheme') || YaPay.ButtonTheme.Black,\r\n\t\t\twidth: this.getOption('buttonWidth') || YaPay.ButtonWidth.Auto,\r\n\t\t});\r\n\r\n\t\tthis.paymentButton.mount(this.element);\r\n\r\n\t\tthis.paymentButton.on(YaPay.ButtonEventType.Click, () => {\r\n\t\t\tpayment.checkout();\r\n\t\t});\r\n\t}\r\n\r\n\trestoreButton(node) {\r\n\t\tthis.proxy.restoreButton(node);\r\n\t}\r\n\r\n\tamountSum(amountA, amountB) {\r\n\t\treturn (Number(amountA) + Number(amountB)).toFixed(2);\r\n\t}\r\n\r\n\tshowError(type, message, err = null) {\r\n\t\tlet notify = type + ' - ' + message;\r\n\r\n\t\tif (err) {\r\n\t\t\tnotify += ' ' + err;\r\n\t\t}\r\n\r\n\t\talert(notify);\r\n\t}\r\n\r\n\tinsertLoader() {\r\n\t\tconst width = this.getOption('buttonWidth') || YaPay.ButtonWidth.Auto;\r\n\r\n\t\tthis.element.innerHTML = Template.compile(this.getOption('loaderTemplate'), {\r\n\t\t\twidth: width.toLowerCase(),\r\n\t\t\tlabel: this.getOption('label'),\r\n\t\t});\r\n\t}\r\n\r\n\tremoveLoader() {\r\n\t\tconst loader = this.element.querySelector(this.getOption('loaderSelector'));\r\n\r\n\t\tif (loader == null) { return; }\r\n\r\n\t\tloader.remove();\r\n\t}\r\n}","export function ready(callback) {\r\n\tif (document.readyState === 'complete' || document.readyState === 'interactive') {\r\n\t\tsetTimeout(callback, 1);\r\n\t} else {\r\n\t\tdocument.addEventListener('DOMContentLoaded', callback);\r\n\t}\r\n}","import Secure3d from './secure3d';\r\nimport Finish from './finish';\r\nimport Failure from './failure';\r\nimport Payment from './payment';\r\nimport AbstractCart from \"./cart/abstractcart\";\r\n\r\nexport default class Factory {\r\n\r\n\t/**\r\n\t * @param {string} type\r\n\t * @param {Widget} widget\r\n\t * @param {Object} options\r\n\t * @returns {AbstractCart|Finish|Step3ds|Payment|Failure}\r\n\t * @throws {Error}\r\n\t */\r\n\tstatic make(type, widget, options = {}) {\r\n\t\tif (type === '3ds') {\r\n\t\t\treturn new Secure3d(widget, options);\r\n\t\t} else if (type === 'finished') {\r\n\t\t\treturn new Finish(widget, options);\r\n\t\t} else if (type === 'error') {\r\n\t\t\treturn new Failure(widget, options);\r\n\t\t} else if (type === 'payment') {\r\n\t\t\treturn new Payment(widget, options);\r\n\t\t} else if (type === 'cart') {\r\n\t\t\treturn new AbstractCart(widget, options);\r\n\t\t}\r\n\r\n\t\tthrow new Error('unknown step ' + type);\r\n\t}\r\n\r\n}","import StepFactory from './step/factory';\r\nimport SolutionRegistry from \"./solutionregistry\";\r\n\r\nexport default class Widget {\r\n\r\n\tstatic defaults = {}\r\n\r\n\tdefaults;\r\n\toptions;\r\n\tel;\r\n\tstep;\r\n\r\n\t/**\r\n\t * @param {Object<Element>} element\r\n\t * @param {Object} options\r\n\t */\r\n\tconstructor(element, options = {}) {\r\n\t\tthis.defaults = Object.assign({}, this.constructor.defaults);\r\n\t\tthis.options = {};\r\n\t\tthis.el = element;\r\n\r\n\t\tthis.setOptions(options);\r\n\t\tthis.bootSolution();\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object} data\r\n\t */\r\n\tpayment(data) {\r\n\t\tthis.go('payment', data);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {Object} data\r\n\t */\r\n\tcart(data){\r\n\t\tthis.go('cart', data);\r\n\t}\r\n\r\n\trestore(element) {\r\n\t\tthis.el = element;\r\n\t\tthis.step?.restore(element);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {string} type\r\n\t * @param {Object} data\r\n\t */\r\n\tgo(type, data) {\r\n\t\tthis.step = this.makeStep(type);\r\n\t\tthis.step.render(this.el, data);\r\n\t}\r\n\r\n\t/**\r\n\t * @param {String} type\r\n\t * @returns {AbstractCart|Finish|Step3ds|Payment|Failure}\r\n\t * @throws {Error}\r\n\t */\r\n\tmakeStep(type) {\r\n\t\tconst options = this.getOption(type) || {};\r\n\r\n\t\treturn StepFactory.make(type, this, options);\r\n\t}\r\n\r\n\tgetSolution() {\r\n\t\tconst name = this.getOption('solution');\r\n\t\tconst mode = this.getOption('mode');\r\n\r\n\t\treturn SolutionRegistry.getPage(name, mode);\r\n\t}\r\n\r\n\tbootSolution() {\r\n\t\tconst solution = this.getSolution();\r\n\r\n\t\tif (solution == null) { return; }\r\n\r\n\t\tsolution.bootWidget(this);\r\n\t}\r\n\r\n\textendDefaults(options) {\r\n\t\tthis.defaults = Object.assign(this.defaults, options);\r\n\t}\r\n\r\n\tsetOptions(options) {\r\n\t\tthis.options = Object.assign(this.options, options);\r\n\t}\r\n\r\n\tgetOption(name) {\r\n\t\treturn this.options[name] ?? this.defaults[name];\r\n\t}\r\n}\r\n"],"names":["SolutionRegistry","name","factory","window","_window","BX","_window$BX","YandexPay","_window$BX$YandexPay","Solution","_window$BX$YandexPay$","_window$BX$YandexPay$2","console","warn","mode","key","this","pages","createPage","getFactory","create","MutationSkeleton","element","options","el","Object","assign","constructor","defaults","check","MutationLoop","_this","loopTimeout","loopCancel","clearTimeout","_loopTimeout","setTimeout","loop","timeout","MutationObserver","mutations","mutation","removedNodes","removedNode","HTMLElement","contains","runCheck","observe","disconnect","anchor","getAnchor","observer","listener","childList","subtree","delay","_checkTimeout","_this2","document","body","closest","MutationFactory","Subscriber","bind","unbind","on","off","NodePreserver","found","restore","install","uninstall","installMutation","installSubscriber","uninstallMutation","uninstallSubscriber","isEnabled","make","driverOptions","destroy","subscriber","type","option","babelHelpers","overrides","Template","template","vars","replaceKey","replaceValue","result","hasOwnProperty","toUpperCase","replace","indexOf","html","context","createElement","innerHTML","firstElementChild","children","Factory","setOptions","bootSolution","selector","position","Promise","resolve","then","waitElement","checkElement","renderElement","widget","getOption","preserve","querySelector","containsSiblingElement","Error","next","parentElement","_anchor$parentElement","matches","nextElementSibling","preserver","preserveOptions","preserveOption","_this3","Widget","reject","_this4","waitCount","waitElementLoop","findElement","elementList","variant","trim","searchBySelector","searchById","searchByClassName","length","reduceVisible","split","partSanitized","isCssSelector","querySelectorAll","push","e","getElementById","collection","getElementsByClassName","testVisible","offsetWidth","offsetHeight","getClientRects","test","width","YaPay","ButtonWidth","Auto","Utils","compile","label","toLowerCase","elements","toElements","reverse","insertAdjacentElement","solution","getPage","bootFactory","containerSelector","waitLimit","waitTimeout","AbstractStep","node","data","url","fetch","method","headers","JSON","stringify","response","json","optionKey","optionFirstSymbol","substr","getNode","getElementSelector","delayTimeouts","args","clearDelay","Base","Form","autosubmit","makeInputs","params","keys","termUrl","backUrl","location","href","encodeURIComponent","submit","Iframe","insertIframe","iframe","contentIframe","contentWindow","contentDocument","open","write","close","IframeRbs","renderIframe","query","service","accept","secure","externalId","notify","paySystemId","success","go","state","error","log","action","Step3ds","view","makeView","setWidget","render","SecureForm","SecureIframe","SecureRbs","Finish","Failure","Payment","paymentData","getPaymentData","createPayment","env","version","countryCode","CountryCode","Ru","currencyCode","CurrencyCode","Rub","merchant","id","order","total","amount","items","paymentMethods","PaymentMethodType","Card","gateway","gatewayMerchantId","allowedAuthMethods","AllowedAuthMethod","PanOnly","allowedCardNetworks","AllowedCardNetwork","UnionPay","Uzcard","Discover","AmericanExpress","Visa","Mastercard","Mir","Maestro","VisaElectron","agent","payment","button","createButton","ButtonType","Pay","theme","ButtonTheme","Black","mount","ButtonEventType","Click","checkout","PaymentEventType","Process","event","complete","CompleteReason","Success","Abort","err","yandexPayData","yandexData","Proxy","cart","RestProxy","getButtonData","status","reason","combineOrderWithData","productId","setupId","merchantId","createCheckout","removeLoader","mountButton","CheckoutEventType","authorize","redirect","showError","reasonCode","remove","orderId","hash","metadata","successUrl","arguments","Checkout","insertLoader","exampleData","newProductId","SiteProxy","getProducts","message","combineOrderWithProducts","requiredFields","billingContact","email","shippingContact","phone","shippingTypes","direct","pickup","yapayAction","address","bounds","orderAccept","code","isPaymentTypeCash","Change","shippingAddress","getShippingOptions","update","shippingOptions","shippingOption","combineOrderWithDirectShipping","pickupBounds","getPickupOptions","pickupPoints","pickupPoint","combineOrderWithPickupShipping","delivery","deliveryType","shippingMethodInfo","paymentMethodInfo","contact","orderAmount","pickupOption","amountSum","products","exampleOrder","paymentButton","AbstractCart","isBootstrap","proxy","setupPaymentCash","delayBootstrap","restoreButton","bootstrap","getSolution","bootCart","callback","readyState","addEventListener","changeBasket","changeOffer","Cash","amountA","amountB","Number","toFixed","alert","loader","loaderTemplate","loaderSelector","Secure3d","step","makeStep","StepFactory","bootWidget"],"mappings":"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"}