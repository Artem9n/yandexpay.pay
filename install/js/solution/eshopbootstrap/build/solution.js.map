{"version":3,"file":"solution.js","sources":["../../../widget/utils/eventproxy.js","../../reference/page.js","../element.js","../basket.js","../order.js","../../reference/factory.js","../index.js"],"sourcesContent":["export class EventProxy {\n\n\tstatic make(config = {}) {\n\t\treturn new EventProxy(config);\n\t}\n\n\tconstructor(config = {}) {\n\t\tthis.config = config;\n\t}\n\n\ton(name, callback) {\n\t\tthis.matchEvent('bx') && this.onBxEvent(name, callback);\n\t\tthis.matchEvent('jquery') && this.onJQueryEvent(name, callback);\n\t\tthis.matchEvent('plain') && this.onPlainEvent(name, callback);\n\t}\n\n\toff(name, callback) {\n\t\tthis.matchEvent('bx') && this.offBxEvent(name, callback);\n\t\tthis.matchEvent('jquery') && this.offJQueryEvent(name, callback);\n\t\tthis.matchEvent('plain') && this.offPlainEvent(name, callback);\n\t}\n\n\tfire(name, data = {}) {\n\t\tthis.matchEvent('bx') && this.fireBxEvent(name, data);\n\t\tthis.matchEvent('jquery') && this.fireJQueryEvent(name, data);\n\t\tthis.matchEvent('plain') && this.firePlainEvent(name, data);\n\t}\n\n\tmatchEvent(type) {\n\t\treturn this.config[type] != null ? !!this.config[type] : !this.config['strict'];\n\t}\n\n\tonBxEvent(name, callback) {\n\t\tif (typeof BX === 'undefined') { return; }\n\n\t\tBX.addCustomEvent(name, callback);\n\t}\n\n\toffBxEvent(name, callback) {\n\t\tif (typeof BX === 'undefined') { return; }\n\n\t\tBX.removeCustomEvent(name, callback);\n\t}\n\n\tfireBxEvent(name, data) {\n\t\tif (typeof BX === 'undefined') { return; }\n\n\t\tBX.onCustomEvent(name, [data]);\n\t}\n\n\tonJQueryEvent(name, callback) {\n\t\tif (typeof jQuery === 'undefined') { return; }\n\n\t\tconst selfConfig = this.extractEventTypeConfig('jquery');\n\n\t\tif (selfConfig['proxy'] !== false) {\n\t\t\tconst originalCallback = callback;\n\n\t\t\tcallback = (evt, data) => {\n\t\t\t\tconst proxyData = data != null ? data : evt?.originalEvent?.detail;\n\n\t\t\t\toriginalCallback(proxyData);\n\t\t\t};\n\t\t}\n\n\t\tjQuery(document).on(name, callback);\n\t}\n\n\toffJQueryEvent(name, callback) {\n\t\tif (typeof jQuery === 'undefined') { return; }\n\n\t\tjQuery(document).off(name, callback); // todo unbind with proxy\n\t}\n\n\tfireJQueryEvent(name, data) {\n\t\tif (typeof jQuery === 'undefined') { return; }\n\n\t\tjQuery(document).triggerHandler(name, data);\n\t}\n\n\tonPlainEvent(name, callback) {\n\t\tif (this.isPlainEventDuplicateByJQuery()) { return; }\n\n\t\tconst selfConfig = this.extractEventTypeConfig('plain');\n\n\t\tif (selfConfig['proxy'] !== false) {\n\t\t\tconst originalCallback = callback;\n\n\t\t\tcallback = (evt) => {\n\t\t\t\toriginalCallback(evt.detail);\n\t\t\t};\n\t\t}\n\n\t\tdocument.addEventListener(name, callback);\n\t}\n\n\toffPlainEvent(name, callback) {\n\t\tif (this.isPlainEventDuplicateByJQuery()) { return; }\n\n\t\tdocument.removeEventListener(name, callback); // todo unbind with proxy\n\t}\n\n\tfirePlainEvent(name, data) {\n\t\t//if (this.isPlainEventDuplicateByJQuery()) { return; }\n\n\t\tdocument.dispatchEvent(new CustomEvent(name, { \"detail\": data })); // todo resolve collision with jquery\n\t}\n\n\tisPlainEventDuplicateByJQuery() {\n\t\tconst selfConfig = this.extractEventTypeConfig('plain');\n\n\t\treturn (selfConfig['force'] !== true && typeof jQuery !== 'undefined');\n\t}\n\n\textractEventTypeConfig(type) {\n\t\treturn typeof this.config[type] === 'object' && this.config[type] != null ? this.config : {}\n\t}\n\n}","import {EventProxy} from \"../../widget/utils/eventproxy\";\r\n\r\nexport default class Page {\r\n\r\n\tbootFactory(factory) {\r\n\r\n\t}\r\n\r\n\tbootWidget(widget) {\r\n\r\n\t}\r\n\r\n\tbootCart(cart) {\r\n\r\n\t}\r\n\r\n\tonEvent(name, callback, config = {}) {\r\n\t\tEventProxy.make(config).on(name, callback);\r\n\t}\r\n\r\n}","import Page from '../reference/page';\r\n\r\nexport default class Element extends Page {\r\n\r\n\tbootCart(cart) {\r\n\t\tthis.onEvent('onCatalogElementChangeOffer', (eventData) => {\r\n\t\t\tlet newProductId = parseInt(eventData?.newId, 10);\r\n\r\n\t\t\tif (isNaN(newProductId)) { return; }\r\n\r\n\t\t\tcart.delayChangeOffer(newProductId);\r\n\t\t});\r\n\t}\r\n}\r\n","import Page from '../reference/page';\r\n\r\nexport default class Basket extends Page {\r\n\r\n\tbootFactory(factory) {\r\n\t\tfactory.extendDefaults({\r\n\t\t\tpreserve: {\r\n\t\t\t\tmutation: {\r\n\t\t\t\t\tanchor: '[data-entity=\"basket-total-block\"]',\r\n\t\t\t\t\tdelay: null,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\tbootCart(cart) {\r\n\t\tif (typeof BX === 'undefined') { return; }\r\n\r\n\t\tthis.onEvent('OnBasketChange', () => {\r\n\t\t\tcart.getProducts().then((result) => {\r\n\t\t\t\tcart.combineOrderWithProducts(result);\r\n\t\t\t});\r\n\t\t});\r\n\t}\r\n}\r\n","import Page from '../reference/page';\r\n\r\nexport default class Order extends Page {\r\n\r\n\tbootFactory(factory) {\r\n\t\tfactory.extendDefaults({\r\n\t\t\tpreserve: {\r\n\t\t\t\tmutation: {\r\n\t\t\t\t\tanchor: '.bx-soa-cart-total',\r\n\t\t\t\t\tdelay: null,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n}\r\n","export default class Factory {\r\n\r\n\tclassMap = {};\r\n\r\n\tconstructor(classMap) {\r\n\t\tthis.classMap = classMap;\r\n\t}\r\n\r\n\tcreate(mode) {\r\n\t\tconst className = this.classMap[mode];\r\n\r\n\t\tif (className == null) { return null; }\r\n\r\n\t\treturn new className();\r\n\t}\r\n\r\n}","import Element from './element';\r\nimport Basket from './basket';\r\nimport Order from './order';\r\nimport Factory from '../reference/factory';\r\n\r\nimport './widget.css';\r\n\r\nconst factory = new Factory({\r\n\telement: Element,\r\n\tbasket: Basket,\r\n\torder: Order,\r\n});\r\n\r\nexport {\r\n\tfactory,\r\n}\r\n"],"names":["EventProxy","config","name","callback","matchEvent","onBxEvent","onJQueryEvent","onPlainEvent","offBxEvent","offJQueryEvent","offPlainEvent","data","fireBxEvent","fireJQueryEvent","firePlainEvent","type","BX","addCustomEvent","removeCustomEvent","onCustomEvent","jQuery","selfConfig","extractEventTypeConfig","originalCallback","evt","proxyData","originalEvent","detail","document","on","off","triggerHandler","isPlainEventDuplicateByJQuery","addEventListener","removeEventListener","dispatchEvent","CustomEvent","Page","factory","widget","cart","make","Element","onEvent","eventData","newProductId","parseInt","newId","isNaN","delayChangeOffer","Basket","extendDefaults","preserve","mutation","anchor","delay","getProducts","then","result","combineOrderWithProducts","Order","Factory","classMap","mode","className","element","basket","order"],"mappings":"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"}