{"version":3,"file":"solution.js","sources":["../../../widget/utils/eventproxy.js","../../reference/page.js","../element.js","../../eshopbootstrap/order.js","../index.js","../../reference/factory.js","../elementfast.js","../basket.js","../order.js"],"sourcesContent":["export class EventProxy {\r\n\r\n\tstatic make(config = {}) {\r\n\t\treturn new EventProxy(config);\r\n\t}\r\n\r\n\tconstructor(config = {}) {\r\n\t\tthis.config = config;\r\n\t\tthis.callbackMap = {};\r\n\t}\r\n\r\n\ton(name, callback) {\r\n\t\tthis.matchEvent('bx') && this.onBxEvent(name, callback);\r\n\t\tthis.matchEvent('jquery') && this.onJQueryEvent(name, callback);\r\n\t\tthis.matchEvent('plain') && this.onPlainEvent(name, callback);\r\n\t}\r\n\r\n\toff(name, callback) {\r\n\t\tthis.matchEvent('bx') && this.offBxEvent(name, callback);\r\n\t\tthis.matchEvent('jquery') && this.offJQueryEvent(name, callback);\r\n\t\tthis.matchEvent('plain') && this.offPlainEvent(name, callback);\r\n\t}\r\n\r\n\tfire(name, data = {}) {\r\n\t\tthis.matchEvent('bx') && this.fireBxEvent(name, data);\r\n\t\tthis.matchEvent('jquery') && this.fireJQueryEvent(name, data);\r\n\t\tthis.matchEvent('plain') && this.firePlainEvent(name, data);\r\n\t}\r\n\r\n\tmatchEvent(type) {\r\n\t\treturn this.config[type] != null ? !!this.config[type] : !this.config['strict'];\r\n\t}\r\n\r\n\tonBxEvent(name, callback) {\r\n\t\tif (typeof BX === 'undefined' || BX.addCustomEvent == null) { return; }\r\n\r\n\t\tBX.addCustomEvent(name, callback);\r\n\t}\r\n\r\n\toffBxEvent(name, callback) {\r\n\t\tif (typeof BX === 'undefined' || BX.removeCustomEvent == null) { return; }\r\n\r\n\t\tBX.removeCustomEvent(name, callback);\r\n\t}\r\n\r\n\tfireBxEvent(name, data) {\r\n\t\tif (typeof BX === 'undefined' || BX.onCustomEvent == null) { return; }\r\n\r\n\t\tBX.onCustomEvent(name, [data]);\r\n\t}\r\n\r\n\tonJQueryEvent(name, callback) {\r\n\t\tif (typeof jQuery === 'undefined') { return; }\r\n\r\n\t\tconst selfConfig = this.typeConfig('jquery');\r\n\r\n\t\tif (this.canProxyCallback(selfConfig)) {\r\n\t\t\tconst originalCallback = callback;\r\n\r\n\t\t\tcallback = (evt, data) => {\r\n\t\t\t\tconst proxyData = data != null ? data : evt?.originalEvent?.detail;\r\n\r\n\t\t\t\toriginalCallback(proxyData);\r\n\t\t\t};\r\n\r\n\t\t\tthis.pushCallbackVariation('jquery', originalCallback, callback);\r\n\t\t}\r\n\r\n\t\tjQuery(document).on(name, callback);\r\n\t}\r\n\r\n\toffJQueryEvent(name, callback) {\r\n\t\tif (typeof jQuery === 'undefined') { return; }\r\n\r\n\t\tconst selfConfig = this.typeConfig('jquery');\r\n\r\n\t\tif (this.canProxyCallback(selfConfig)) {\r\n\t\t\tcallback = this.popCallbackVariation('jquery', callback);\r\n\r\n\t\t\tif (callback == null) { return; }\r\n\t\t}\r\n\r\n\t\tjQuery(document).off(name, callback);\r\n\t}\r\n\r\n\tfireJQueryEvent(name, data) {\r\n\t\tif (typeof jQuery === 'undefined') { return; }\r\n\t\tif (this.hasPlainAndJQueryCollision()) { return; }\r\n\r\n\t\tjQuery(document).triggerHandler(new CustomEvent(name, { \"detail\": data }));\r\n\t}\r\n\r\n\tonPlainEvent(name, callback) {\r\n\t\tif (this.hasPlainAndJQueryCollision()) { return; }\r\n\r\n\t\tconst selfConfig = this.typeConfig('plain');\r\n\r\n\t\tif (this.canProxyCallback(selfConfig)) {\r\n\t\t\tconst originalCallback = callback;\r\n\r\n\t\t\tcallback = (evt) => {\r\n\t\t\t\toriginalCallback(evt.detail);\r\n\t\t\t};\r\n\r\n\t\t\tthis.pushCallbackVariation('plain', originalCallback, callback);\r\n\t\t}\r\n\r\n\t\tdocument.addEventListener(name, callback);\r\n\t}\r\n\r\n\toffPlainEvent(name, callback) {\r\n\t\tif (this.hasPlainAndJQueryCollision()) { return; }\r\n\r\n\t\tconst selfConfig = this.typeConfig('plain');\r\n\r\n\t\tif (this.canProxyCallback(selfConfig)) {\r\n\t\t\tcallback = this.popCallbackVariation('plain', callback);\r\n\r\n\t\t\tif (callback == null) { return; }\r\n\t\t}\r\n\r\n\t\tdocument.removeEventListener(name, callback);\r\n\t}\r\n\r\n\tfirePlainEvent(name, data) {\r\n\t\tdocument.dispatchEvent(new CustomEvent(name, { \"detail\": data }));\r\n\t}\r\n\r\n\thasPlainAndJQueryCollision() {\r\n\t\tif (!this.matchEvent('plain') || !this.matchEvent('jquery')) { return false; }\r\n\r\n\t\tconst plainConfig = this.typeConfig('plain');\r\n\r\n\t\treturn (plainConfig['force'] !== true && typeof jQuery !== 'undefined');\r\n\t}\r\n\r\n\tcanProxyCallback(selfConfig) {\r\n\t\treturn selfConfig['proxy'] !== false;\r\n\t}\r\n\r\n\ttypeConfig(type) {\r\n\t\treturn typeof this.config[type] === 'object' && this.config[type] != null ? this.config : {};\r\n\t}\r\n\r\n\tpushCallbackVariation(type, callback, proxy) {\r\n\t\tif (this.callbackMap[type] == null) {\r\n\t\t\tthis.callbackMap[type] = new WeakMap();\r\n\t\t}\r\n\r\n\t\tthis.callbackMap[type].set(callback, proxy);\r\n\t}\r\n\r\n\tpopCallbackVariation(type, callback) {\r\n\t\tif (this.callbackMap[type] == null) { return null; }\r\n\r\n\t\tconst map = this.callbackMap[type];\r\n\t\tconst result = map.get(callback);\r\n\r\n\t\tif (result != null) {\r\n\t\t\tmap.delete(callback);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n}","import {EventProxy} from \"../../widget/utils/eventproxy\";\r\n\r\nexport default class Page {\r\n\r\n\tbootFactory(factory) {\r\n\r\n\t}\r\n\r\n\tbootWidget(widget) {\r\n\r\n\t}\r\n\r\n\tbootCart(cart) {\r\n\r\n\t}\r\n\r\n\tonEvent(name, callback, config = {}) {\r\n\t\tEventProxy.make(config).on(name, callback);\r\n\t}\r\n\r\n\toffEvent(name, callback, config = {}) {\r\n\t\tEventProxy.make(config).off(name, callback);\r\n\t}\r\n\r\n}","import Page from \"../reference/page\";\r\n\r\nexport default class Element extends Page {\r\n\r\n\tinitialHandler;\r\n\r\n\tbootCart(cart) {\r\n\t\tthis.cart = cart;\r\n\t\tthis.onStarterOffer();\r\n\t\tthis.onCommonOffer();\r\n\t}\r\n\r\n\tonStarterOffer() {\r\n\t\tif (window?.elementStoresComponentParams == null) { return; }\r\n\r\n\t\tconst firstOfferId = parseInt(window?.elementStoresComponentParams?.OFFER_ID, 10);\r\n\r\n\t\tif (isNaN(firstOfferId)) { return; }\r\n\r\n\t\tthis.cart.changeOffer(firstOfferId);\r\n\t}\r\n\r\n\tonCommonOffer() {\r\n\r\n\t\tif (this.initialHandler != null) { return; }\r\n\r\n\t\t$(document).ajaxSuccess(( event, request, settings, data ) => {\r\n\t\t\tif (\r\n\t\t\t\tsettings.url.match(/(\\/catalog.item\\/)(.*)(\\/ajax.php)/) != null\r\n\t\t\t\t|| settings.url.indexOf('act=selectSku') !== -1\r\n\t\t\t) {\r\n\t\t\t\tconst response = data;\r\n\r\n\t\t\t\tif (typeof response !== \"object\") { return; }\r\n\r\n\t\t\t\tlet newProductId;\r\n\r\n\t\t\t\tfor (let key in response) {\r\n\r\n\t\t\t\t\tif (!response.hasOwnProperty(key)) { continue; }\r\n\r\n\t\t\t\t\tfor (let entity in response[key]) {\r\n\r\n\t\t\t\t\t\tif (!response[key].hasOwnProperty(entity)) { continue; }\r\n\r\n\t\t\t\t\t\tif (entity !== 'PRODUCT') { continue; }\r\n\r\n\t\t\t\t\t\tnewProductId = parseInt(response[key].PRODUCT?.ID, 10);\r\n\r\n\t\t\t\t\t\tif (!isNaN(newProductId)) { break; }\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (newProductId == null || isNaN(newProductId)) { return; }\r\n\r\n\t\t\t\tthis.initialHandler = true;\r\n\r\n\t\t\t\tthis.cart.delayChangeOffer(newProductId);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n","import Page from '../reference/page';\r\n\r\nexport default class Order extends Page {\r\n\r\n\tbootFactory(factory) {\r\n\t\tfactory.extendDefaults({\r\n\t\t\tpreserve: {\r\n\t\t\t\tmutation: {\r\n\t\t\t\t\tanchor: '#bx-soa-total-mobile, .bx-soa-cart-total',\r\n\t\t\t\t\tdelay: null,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n}\r\n","import Element from './element';\r\nimport ElementFast from './elementfast';\r\nimport Basket from './basket';\r\nimport Order from './order';\r\nimport Factory from '../reference/factory';\r\n\r\nimport './widget.css';\r\n\r\nconst factory = new Factory({\r\n\telement: Element,\r\n\telementFast: ElementFast,\r\n\tbasket: Basket,\r\n\torder: Order,\r\n});\r\n\r\nexport {\r\n\tfactory,\r\n}\r\n","export default class Factory {\r\n\r\n\tclassMap = {};\r\n\r\n\tconstructor(classMap) {\r\n\t\tthis.classMap = classMap;\r\n\t}\r\n\r\n\tcreate(mode) {\r\n\t\tconst className = this.classMap[mode];\r\n\r\n\t\tif (className == null) { return null; }\r\n\r\n\t\treturn new className();\r\n\t}\r\n\r\n}","import Element from \"./element\";\n\nexport default class ElementFast extends Element {\n\n}\n","import Page from '../reference/page';\r\n\r\nexport default class Basket extends Page {\r\n\r\n\tbootFactory(factory) {\r\n\t\tfactory.extendDefaults({\r\n\t\t\tpreserve: {\r\n\t\t\t\tmutation: {\r\n\t\t\t\t\tanchor: '[data-entity=\"basket-total-block\"]',\r\n\t\t\t\t\tdelay: null,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\tbootCart(cart) {\r\n\t\t$(document).ajaxComplete(( event, xhr, settings ) => {\r\n\t\t\tif (settings.url.match(/(\\/sale.basket.basket\\/)(.*)(\\/ajax.php)/) != null) {\r\n\t\t\t\tcart.delayChangeBasket();\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n}\r\n","import OrderEshop from '../eshopbootstrap/order';\r\n\r\nexport default class Order extends OrderEshop {\r\n\r\n}\r\n"],"names":["EventProxy","config","constructor","callbackMap","on","name","callback","matchEvent","this","onBxEvent","onJQueryEvent","onPlainEvent","off","offBxEvent","offJQueryEvent","offPlainEvent","fire","data","fireBxEvent","fireJQueryEvent","firePlainEvent","type","BX","addCustomEvent","removeCustomEvent","onCustomEvent","jQuery","selfConfig","typeConfig","canProxyCallback","originalCallback","evt","proxyData","originalEvent","_evt$originalEvent","detail","pushCallbackVariation","document","popCallbackVariation","hasPlainAndJQueryCollision","triggerHandler","CustomEvent","addEventListener","removeEventListener","dispatchEvent","proxy","WeakMap","set","map","result","get","delete","Page","bootFactory","factory","bootWidget","widget","bootCart","cart","onEvent","make","offEvent","Element","onStarterOffer","onCommonOffer","window","elementStoresComponentParams","firstOfferId","parseInt","_window2","_window2$elementStore","OFFER_ID","isNaN","changeOffer","initialHandler","$","ajaxSuccess","event","request","settings","url","match","indexOf","response","newProductId","key","hasOwnProperty","entity","PRODUCT","_response$key$PRODUCT","ID","delayChangeOffer","Order","extendDefaults","preserve","mutation","anchor","delay","classMap","create","mode","className","element","elementFast","basket","ajaxComplete","xhr","delayChangeBasket","order","OrderEshop"],"mappings":"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"}