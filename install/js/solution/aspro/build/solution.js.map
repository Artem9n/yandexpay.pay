{"version":3,"file":"solution.js","sources":["../../../widget/utils/eventproxy.js","../../reference/page.js","../../reference/element.js","../molecules/factorylayout.js","../../eshopbootstrap/basket.js","../index.js","../../reference/factory.js","../element.js","../basket.js","../order.js"],"sourcesContent":["export class EventProxy {\r\n\r\n\tstatic make(config = {}) {\r\n\t\treturn new EventProxy(config);\r\n\t}\r\n\r\n\tconstructor(config = {}) {\r\n\t\tthis.config = config;\r\n\t\tthis.callbackMap = {};\r\n\t}\r\n\r\n\ton(name, callback) {\r\n\t\tthis.matchEvent('bx') && this.onBxEvent(name, callback);\r\n\t\tthis.matchEvent('jquery') && this.onJQueryEvent(name, callback);\r\n\t\tthis.matchEvent('plain') && this.onPlainEvent(name, callback);\r\n\t}\r\n\r\n\toff(name, callback) {\r\n\t\tthis.matchEvent('bx') && this.offBxEvent(name, callback);\r\n\t\tthis.matchEvent('jquery') && this.offJQueryEvent(name, callback);\r\n\t\tthis.matchEvent('plain') && this.offPlainEvent(name, callback);\r\n\t}\r\n\r\n\tfire(name, data = {}) {\r\n\t\tthis.matchEvent('bx') && this.fireBxEvent(name, data);\r\n\t\tthis.matchEvent('jquery') && this.fireJQueryEvent(name, data);\r\n\t\tthis.matchEvent('plain') && this.firePlainEvent(name, data);\r\n\t}\r\n\r\n\tmatchEvent(type) {\r\n\t\treturn this.config[type] != null ? !!this.config[type] : !this.config['strict'];\r\n\t}\r\n\r\n\tonBxEvent(name, callback) {\r\n\t\tif (typeof BX === 'undefined') { return; }\r\n\r\n\t\tBX.addCustomEvent(name, callback);\r\n\t}\r\n\r\n\toffBxEvent(name, callback) {\r\n\t\tif (typeof BX === 'undefined') { return; }\r\n\r\n\t\tBX.removeCustomEvent(name, callback);\r\n\t}\r\n\r\n\tfireBxEvent(name, data) {\r\n\t\tif (typeof BX === 'undefined') { return; }\r\n\r\n\t\tBX.onCustomEvent(name, [data]);\r\n\t}\r\n\r\n\tonJQueryEvent(name, callback) {\r\n\t\tif (typeof jQuery === 'undefined') { return; }\r\n\r\n\t\tconst selfConfig = this.typeConfig('jquery');\r\n\r\n\t\tif (this.canProxyCallback(selfConfig)) {\r\n\t\t\tconst originalCallback = callback;\r\n\r\n\t\t\tcallback = (evt, data) => {\r\n\t\t\t\tconst proxyData = data != null ? data : evt?.originalEvent?.detail;\r\n\r\n\t\t\t\toriginalCallback(proxyData);\r\n\t\t\t};\r\n\r\n\t\t\tthis.pushCallbackVariation('jquery', originalCallback, callback);\r\n\t\t}\r\n\r\n\t\tjQuery(document).on(name, callback);\r\n\t}\r\n\r\n\toffJQueryEvent(name, callback) {\r\n\t\tif (typeof jQuery === 'undefined') { return; }\r\n\r\n\t\tconst selfConfig = this.typeConfig('jquery');\r\n\r\n\t\tif (this.canProxyCallback(selfConfig)) {\r\n\t\t\tcallback = this.popCallbackVariation('jquery', callback);\r\n\r\n\t\t\tif (callback == null) { return; }\r\n\t\t}\r\n\r\n\t\tjQuery(document).off(name, callback);\r\n\t}\r\n\r\n\tfireJQueryEvent(name, data) {\r\n\t\tif (typeof jQuery === 'undefined') { return; }\r\n\t\tif (this.hasPlainAndJQueryCollision()) { return; }\r\n\r\n\t\tjQuery(document).triggerHandler(new CustomEvent(name, { \"detail\": data }));\r\n\t}\r\n\r\n\tonPlainEvent(name, callback) {\r\n\t\tif (this.hasPlainAndJQueryCollision()) { return; }\r\n\r\n\t\tconst selfConfig = this.typeConfig('plain');\r\n\r\n\t\tif (this.canProxyCallback(selfConfig)) {\r\n\t\t\tconst originalCallback = callback;\r\n\r\n\t\t\tcallback = (evt) => {\r\n\t\t\t\toriginalCallback(evt.detail);\r\n\t\t\t};\r\n\r\n\t\t\tthis.pushCallbackVariation('plain', originalCallback, callback);\r\n\t\t}\r\n\r\n\t\tdocument.addEventListener(name, callback);\r\n\t}\r\n\r\n\toffPlainEvent(name, callback) {\r\n\t\tif (this.hasPlainAndJQueryCollision()) { return; }\r\n\r\n\t\tconst selfConfig = this.typeConfig('plain');\r\n\r\n\t\tif (this.canProxyCallback(selfConfig)) {\r\n\t\t\tcallback = this.popCallbackVariation('plain', callback);\r\n\r\n\t\t\tif (callback == null) { return; }\r\n\t\t}\r\n\r\n\t\tdocument.removeEventListener(name, callback);\r\n\t}\r\n\r\n\tfirePlainEvent(name, data) {\r\n\t\tdocument.dispatchEvent(new CustomEvent(name, { \"detail\": data }));\r\n\t}\r\n\r\n\thasPlainAndJQueryCollision() {\r\n\t\tif (!this.matchEvent('plain') || !this.matchEvent('jquery')) { return false; }\r\n\r\n\t\tconst plainConfig = this.typeConfig('plain');\r\n\r\n\t\treturn (plainConfig['force'] !== true && typeof jQuery !== 'undefined');\r\n\t}\r\n\r\n\tcanProxyCallback(selfConfig) {\r\n\t\treturn selfConfig['proxy'] !== false;\r\n\t}\r\n\r\n\ttypeConfig(type) {\r\n\t\treturn typeof this.config[type] === 'object' && this.config[type] != null ? this.config : {};\r\n\t}\r\n\r\n\tpushCallbackVariation(type, callback, proxy) {\r\n\t\tif (this.callbackMap[type] == null) {\r\n\t\t\tthis.callbackMap[type] = new WeakMap();\r\n\t\t}\r\n\r\n\t\tthis.callbackMap[type].set(callback, proxy);\r\n\t}\r\n\r\n\tpopCallbackVariation(type, callback) {\r\n\t\tif (this.callbackMap[type] == null) { return null; }\r\n\r\n\t\tconst map = this.callbackMap[type];\r\n\t\tconst result = map.get(callback);\r\n\r\n\t\tif (result != null) {\r\n\t\t\tmap.delete(callback);\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t}\r\n\r\n}","import {EventProxy} from \"../../widget/utils/eventproxy\";\r\n\r\nexport default class Page {\r\n\r\n\tbootFactory(factory) {\r\n\r\n\t}\r\n\r\n\tbootWidget(widget) {\r\n\r\n\t}\r\n\r\n\tbootCart(cart) {\r\n\r\n\t}\r\n\r\n\tonEvent(name, callback, config = {}) {\r\n\t\tEventProxy.make(config).on(name, callback);\r\n\t}\r\n\r\n\toffEvent(name, callback, config = {}) {\r\n\t\tEventProxy.make(config).off(name, callback);\r\n\t}\r\n\r\n}","import Page from './page';\r\n\r\nexport default class Element extends Page {\r\n\r\n\tinitialProduct;\r\n\tcart;\r\n\r\n\tbootFactory(factory) {\r\n\t\tthis.handleStarterOffer(true);\r\n\t}\r\n\r\n\tbootCart(cart) {\r\n\t\tthis.cart = cart;\r\n\r\n\t\tthis.handleStarterOffer(false);\r\n\t\tthis.bootInitialProduct();\r\n\t\tthis.handleCommonOffer(true);\r\n\t}\r\n\r\n\thandleStarterOffer(dir) {\r\n\t\tthis[dir ? 'onEvent' : 'offEvent']('onCatalogElementChangeOffer', this.onStarterOffer);\r\n\t}\r\n\r\n\thandleCommonOffer(dir) {\r\n\t\tthis[dir ? 'onEvent' : 'offEvent']('onCatalogElementChangeOffer', this.onCommonOffer);\r\n\t}\r\n\r\n\tonStarterOffer = (eventData) => {\r\n\t\tlet newProductId = this.eventProductId(eventData);\r\n\r\n\t\tif (newProductId == null) { return; }\r\n\r\n\t\tthis.initialProduct = newProductId;\r\n\t}\r\n\r\n\tonCommonOffer = (eventData) => {\r\n\t\tlet newProductId = this.eventProductId(eventData);\r\n\r\n\t\tif (newProductId == null) { return; }\r\n\r\n\t\tthis.cart.delayChangeOffer(newProductId);\r\n\t}\r\n\r\n\teventName() {\r\n\t\tthrow new Error('not implemented');\r\n\t}\r\n\r\n\teventProductId(eventData) {\r\n\t\tlet newProductId = parseInt(eventData?.newId, 10);\r\n\r\n\t\treturn !isNaN(newProductId) ? newProductId : null;\r\n\t}\r\n\r\n\tbootInitialProduct() {\r\n\t\tif (this.initialProduct == null) { return; }\r\n\r\n\t\tthis.cart.changeOffer(this.initialProduct);\r\n\t\tthis.initialProduct = null;\r\n\t}\r\n}\r\n","export default (factory, options) => {\r\n\r\n\tconst template = {\r\n\t\tuseDivider: true,\r\n\t};\r\n\r\n\tfactory.extendDefaults(Object.assign({}, options, template));\r\n}","import Page from '../reference/page';\r\n\r\nexport default class Basket extends Page {\r\n\r\n\tbootFactory(factory) {\r\n\t\tfactory.extendDefaults({\r\n\t\t\tpreserve: {\r\n\t\t\t\tmutation: {\r\n\t\t\t\t\tanchor: '[data-entity=\"basket-total-block\"]',\r\n\t\t\t\t\tdelay: null,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n\r\n\tbootCart(cart) {\r\n\t\tif (typeof BX === 'undefined') { return; }\r\n\r\n\t\tthis.onEvent('OnBasketChange', () => {\r\n\t\t\tcart.delayChangeBasket();\r\n\t\t});\r\n\t}\r\n}\r\n","import Element from './element';\r\nimport Basket from './basket';\r\nimport Order from './order';\r\nimport Factory from '../reference/factory';\r\n\r\nimport './widget.css';\r\n\r\nconst factory = new Factory({\r\n\telement: Element,\r\n\tbasket: Basket,\r\n\torder: Order,\r\n});\r\n\r\nexport {\r\n\tfactory,\r\n}\r\n","export default class Factory {\r\n\r\n\tclassMap = {};\r\n\r\n\tconstructor(classMap) {\r\n\t\tthis.classMap = classMap;\r\n\t}\r\n\r\n\tcreate(mode) {\r\n\t\tconst className = this.classMap[mode];\r\n\r\n\t\tif (className == null) { return null; }\r\n\r\n\t\treturn new className();\r\n\t}\r\n\r\n}","import ElementSkeleton from '../reference/element';\r\nimport factoryLayout from './molecules/factorylayout';\r\n\r\nexport default class Element extends ElementSkeleton {\r\n\r\n\tbootFactory(factory) {\r\n\t\tsuper.bootFactory(factory);\r\n\t\tfactoryLayout(factory);\r\n\t}\r\n\r\n\teventName() {\r\n\t\treturn 'onAsproSkuSetPrice';\r\n\t}\r\n\r\n\teventProductId(eventData) {\r\n\t\tconst newProductId = parseInt(eventData?.offer?.ID, 10);\r\n\r\n\t\treturn !isNaN(newProductId) ? newProductId : null;\r\n\t}\r\n}\r\n","import EshopBasket from '../eshopbootstrap/basket';\r\nimport factoryLayout from './molecules/factorylayout';\r\n\r\nexport default class Basket extends EshopBasket {\r\n\r\n\tbootFactory(factory) {\r\n\t\tfactoryLayout(factory, {\r\n\t\t\tpreserve: {\r\n\t\t\t\tmutation: {\r\n\t\t\t\t\tanchor: '[data-entity=\"basket-total-block\"]',\r\n\t\t\t\t\tdelay: null,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n}","import Page from '../reference/page';\r\nimport factoryLayout from './molecules/factorylayout';\r\n\r\nexport default class Order extends Page {\r\n\r\n\tbootFactory(factory) {\r\n\t\tfactoryLayout(factory, {\r\n\t\t\tpreserve: {\r\n\t\t\t\tmutation: {\r\n\t\t\t\t\tanchor: '#bx-soa-total, #bx-soa-total-mobile',\r\n\t\t\t\t\tdelay: null,\r\n\t\t\t\t},\r\n\t\t\t},\r\n\t\t});\r\n\t}\r\n}\r\n"],"names":["EventProxy","static","config","constructor","this","callbackMap","on","name","callback","matchEvent","onBxEvent","onJQueryEvent","onPlainEvent","off","offBxEvent","offJQueryEvent","offPlainEvent","fire","data","fireBxEvent","fireJQueryEvent","firePlainEvent","type","BX","addCustomEvent","removeCustomEvent","onCustomEvent","jQuery","selfConfig","typeConfig","canProxyCallback","originalCallback","evt","proxyData","originalEvent","_evt$originalEvent","detail","pushCallbackVariation","document","popCallbackVariation","hasPlainAndJQueryCollision","triggerHandler","CustomEvent","addEventListener","removeEventListener","dispatchEvent","proxy","WeakMap","set","map","result","get","delete","Page","bootFactory","factory","bootWidget","widget","bootCart","cart","onEvent","make","offEvent","Element","super","onStarterOffer","eventData","newProductId","eventProductId","initialProduct","onCommonOffer","delayChangeOffer","handleStarterOffer","bootInitialProduct","handleCommonOffer","dir","eventName","Error","parseInt","newId","isNaN","changeOffer","options","extendDefaults","Object","assign","useDivider","Basket","preserve","mutation","anchor","delay","delayChangeBasket","classMap","create","mode","className","element","ElementSkeleton","factoryLayout","offer","_eventData$offer","ID","basket","EshopBasket","order"],"mappings":"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"}